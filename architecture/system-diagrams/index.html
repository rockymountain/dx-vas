
<!DOCTYPE html>

<html class="no-js" lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Tài liệu kiến trúc và phát triển cho dự án Chuyển đổi số Trường Việt Anh (dx_vas)." name="description"/>
<meta content="DX VAS Team" name="author"/>
<link href="https://dx.truongvietanh.edu.vn/architecture/system-diagrams/" rel="canonical"/>
<link href="../.." rel="prev"/>
<link href="../rbac-deep-dive/" rel="next"/>
<link href="../../assets/images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Sơ đồ Hệ thống - DX VAS - Docs</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="pink" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#so-o-kien-truc-he-thong-dx-vas">
          Bỏ qua
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Đầu trang" class="md-header__inner md-grid">
<a aria-label="DX VAS - Docs" class="md-header__button md-logo" data-md-component="logo" href="../.." title="DX VAS - Docs">
<img alt="logo" src="../../assets/images/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DX VAS - Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Sơ đồ Hệ thống
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="pink" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="lime" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Tìm kiếm" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Tìm kiếm" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Tìm kiếm" class="md-search__options">
<button aria-label="Xoá" class="md-search__icon md-icon" tabindex="-1" title="Xoá" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/rockymountain/dx-vas.git" title="Xem mã nguồn">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    rockymountain/dx-vas
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../..">
          
  
  
    
  
  Kiến trúc Hệ thống

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../dev/dev-guide/">
          
  
  
    
  
  Hướng dẫn Phát triển

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../services/user-service/design/">
          
  
  
    
  
  Thiết kế Services

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../ADR/">
          
  
  
    
  
  Quyết định Kiến trúc (ADRs)

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Thanh điều hướng" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DX VAS - Docs" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="DX VAS - Docs">
<img alt="logo" src="../../assets/images/logo.png"/>
</a>
    DX VAS - Docs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/rockymountain/dx-vas.git" title="Xem mã nguồn">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    rockymountain/dx-vas
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Kiến trúc Hệ thống
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Kiến trúc Hệ thống
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Sơ đồ Hệ thống
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Sơ đồ Hệ thống
    
  </span>
</a>
<nav aria-label="Mục lục" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Mục lục
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#muc-luc">
<span class="md-ellipsis">
      📚 Mục lục
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-so-o-tong-quan-he-thong">
<span class="md-ellipsis">
      1. Sơ đồ tổng quan hệ thống
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-admission-flow-luong-tuyen-sinh">
<span class="md-ellipsis">
      2. Admission Flow – Luồng Tuyển sinh
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-notification-flow-luong-gui-thong-bao">
<span class="md-ellipsis">
      3. Notification Flow – Luồng Gửi Thông báo
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-rbac-evaluation-flow-luong-anh-gia-phan-quyen-ong">
<span class="md-ellipsis">
      4. RBAC Evaluation Flow – Luồng Đánh giá Phân quyền Động
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-data-synchronization-flow-ong-bo-hoc-sinh-crm-sis-lms">
<span class="md-ellipsis">
      5. Data Synchronization Flow – Đồng bộ học sinh CRM → SIS → LMS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-service-to-service-auth-flow-giao-tiep-giua-cac-dich-vu-noi-bo">
<span class="md-ellipsis">
      6. Service-to-Service Auth Flow – Giao tiếp giữa các dịch vụ nội bộ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-user-account-lifecycle-flow-vong-oi-tai-khoan-nguoi-dung">
<span class="md-ellipsis">
      7. User Account Lifecycle Flow – Vòng đời tài khoản người dùng
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-chu-giai-so-o-legend-huong-dan-oc">
<span class="md-ellipsis">
      8. Chú giải sơ đồ (Legend) - Hướng dẫn đọc
    </span>
</a>
<nav aria-label="8. Chú giải sơ đồ (Legend) - Hướng dẫn đọc" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ky-hieu-cac-thanh-phan-dung-trong-flowchart-sequencediagram">
<span class="md-ellipsis">
      🧩 Ký hiệu các thành phần (dùng trong flowchart &amp; sequenceDiagram):
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cach-oc-so-o">
<span class="md-ellipsis">
      🧭 Cách đọc sơ đồ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#luu-y-van-hanh">
<span class="md-ellipsis">
      🔐 Lưu ý vận hành
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#duy-tri-cap-nhat">
<span class="md-ellipsis">
      🛠 Duy trì &amp; cập nhật
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-deployment-overview-diagram-so-o-trien-khai-tong-quan">
<span class="md-ellipsis">
      9. Deployment Overview Diagram – Sơ đồ triển khai tổng quan
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../rbac-deep-dive/">
<span class="md-ellipsis">
    RBAC Chi tiết
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Hướng dẫn Phát triển
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Hướng dẫn Phát triển
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../dev/dev-guide/">
<span class="md-ellipsis">
    Tổng quan Phát triển (Dev Guide)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dev/backend-dev-guide/">
<span class="md-ellipsis">
    Backend Dev Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dev/ops-guide/">
<span class="md-ellipsis">
    Vận hành &amp; DevOps (Ops Guide)
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Thiết kế Services
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Thiết kế Services
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
<span class="md-ellipsis">
    User Service
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
            User Service
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../services/user-service/design/">
<span class="md-ellipsis">
    Tổng quan Thiết kế
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../services/user-service/interface-contract/">
<span class="md-ellipsis">
    Hợp đồng Giao diện
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../services/user-service/data-model/">
<span class="md-ellipsis">
    Mô hình Dữ liệu
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../services/user-service/openapi.yaml">
<span class="md-ellipsis">
    Đặc tả OpenAPI
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../ADR/">
<span class="md-ellipsis">
    Quyết định Kiến trúc (ADRs)
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Quyết định Kiến trúc (ADRs)
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Mục lục" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Mục lục
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#muc-luc">
<span class="md-ellipsis">
      📚 Mục lục
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-so-o-tong-quan-he-thong">
<span class="md-ellipsis">
      1. Sơ đồ tổng quan hệ thống
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-admission-flow-luong-tuyen-sinh">
<span class="md-ellipsis">
      2. Admission Flow – Luồng Tuyển sinh
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-notification-flow-luong-gui-thong-bao">
<span class="md-ellipsis">
      3. Notification Flow – Luồng Gửi Thông báo
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-rbac-evaluation-flow-luong-anh-gia-phan-quyen-ong">
<span class="md-ellipsis">
      4. RBAC Evaluation Flow – Luồng Đánh giá Phân quyền Động
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-data-synchronization-flow-ong-bo-hoc-sinh-crm-sis-lms">
<span class="md-ellipsis">
      5. Data Synchronization Flow – Đồng bộ học sinh CRM → SIS → LMS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-service-to-service-auth-flow-giao-tiep-giua-cac-dich-vu-noi-bo">
<span class="md-ellipsis">
      6. Service-to-Service Auth Flow – Giao tiếp giữa các dịch vụ nội bộ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-user-account-lifecycle-flow-vong-oi-tai-khoan-nguoi-dung">
<span class="md-ellipsis">
      7. User Account Lifecycle Flow – Vòng đời tài khoản người dùng
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-chu-giai-so-o-legend-huong-dan-oc">
<span class="md-ellipsis">
      8. Chú giải sơ đồ (Legend) - Hướng dẫn đọc
    </span>
</a>
<nav aria-label="8. Chú giải sơ đồ (Legend) - Hướng dẫn đọc" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ky-hieu-cac-thanh-phan-dung-trong-flowchart-sequencediagram">
<span class="md-ellipsis">
      🧩 Ký hiệu các thành phần (dùng trong flowchart &amp; sequenceDiagram):
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cach-oc-so-o">
<span class="md-ellipsis">
      🧭 Cách đọc sơ đồ
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#luu-y-van-hanh">
<span class="md-ellipsis">
      🔐 Lưu ý vận hành
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#duy-tri-cap-nhat">
<span class="md-ellipsis">
      🛠 Duy trì &amp; cập nhật
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9-deployment-overview-diagram-so-o-trien-khai-tong-quan">
<span class="md-ellipsis">
      9. Deployment Overview Diagram – Sơ đồ triển khai tổng quan
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="so-o-kien-truc-he-thong-dx-vas">Sơ đồ Kiến trúc Hệ thống dx-vas<a class="headerlink" href="#so-o-kien-truc-he-thong-dx-vas" title="Permanent link">¶</a></h1>
<p>Tài liệu này tập hợp tất cả các sơ đồ kiến trúc quan trọng của hệ thống chuyển đổi số dx-vas, bao gồm:</p>
<ul>
<li>Sơ đồ kiến trúc tổng thể</li>
<li>Diễn giải các khối chức năng</li>
<li>Các sơ đồ con chi tiết theo từng luồng nghiệp vụ (ví dụ: Tuyển sinh, Thông báo, Phân quyền RBAC...)</li>
</ul>
<h2 id="muc-luc">📚 Mục lục<a class="headerlink" href="#muc-luc" title="Permanent link">¶</a></h2>
<ol>
<li><a href="#1-sơ-đồ-tổng-quan-hệ-thống">Sơ đồ tổng quan hệ thống</a></li>
<li><a href="#2-admission-flow--luồng-tuyển-sinh">Admission Flow – Luồng Tuyển sinh</a></li>
<li><a href="#3-notification-flow--luồng-gửi-thông-báo">Notification Flow – Luồng Gửi Thông báo</a></li>
<li><a href="#4-rbac-evaluation-flow--luồng-đánh-giá-phân-quyền-động">RBAC Evaluation Flow – Luồng Đánh giá Phân quyền Động</a></li>
<li><a href="#5-data-synchronization-flow--đồng-bộ-học-sinh-crm--sis--lms">Data Synchronization Flow – Đồng bộ học sinh CRM → SIS → LMS</a></li>
<li><a href="#6-service-to-service-auth-flow--giao-tiếp-giữa-các-dịch-vụ-nội-bộ">Service-to-Service Auth Flow – Giao tiếp giữa các dịch vụ nội bộ</a></li>
<li><a href="#7-user-account-lifecycle-flow--vòng-đời-tài-khoản-người-dùng">User Account Lifecycle Flow – Vòng đời tài khoản người dùng</a></li>
<li><a href="#8-chú-giải-sơ-đồ-legend---hướng-dẫn-đọc">Chú giải sơ đồ (Legend) - Hướng dẫn đọc</a></li>
<li><a href="#9-deployment-overview-diagram--sơ-đồ-triển-khai-tổng-quan">Deployment Overview Diagram – Sơ đồ triển khai tổng quan</a></li>
</ol>
<hr/>
<h2 id="1-so-o-tong-quan-he-thong">1. Sơ đồ tổng quan hệ thống<a class="headerlink" href="#1-so-o-tong-quan-he-thong" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>flowchart TD
  subgraph Client_Apps
    Webform[Public Webform]
    Parent[PWA - Customer Portal]
    Staff[SPA - Admin Webapp]
  end

  subgraph Core_Services
    Gateway[API Gateway]
    Auth[Auth Service]
    User[User Service]
    Noti[Notification Service]
  end

  subgraph Business_Adapters
    CRM[CRM Adapter]
    SIS[SIS Adapter]
    LMS[LMS Adapter]
  end

  subgraph External_Services
    GSuite[Google OAuth2]
    Zalo[Zalo OA API]
    Gmail[Gmail API]
    Chat[Google Chat API]
  end

  Webform --&gt;|lead| CRM
  Parent --&gt; Gateway
  Staff --&gt; Gateway

  Gateway --&gt;|OAuth2 / OTP| Auth
  Gateway --&gt;|RBAC check| User
  Gateway --&gt;|Notify| Noti
  Gateway --&gt; CRM
  Gateway --&gt; SIS
  Gateway --&gt; LMS

  Noti --&gt; Zalo
  Noti --&gt; Gmail
  Noti --&gt; Chat
  Auth --&gt; GSuite

</code></pre>
<p><strong>Diễn giải sơ đồ tổng quan</strong></p>
<ol>
<li>🖥️ Client Applications (Giao diện người dùng)</li>
<li><strong>Public Webform</strong>: Cổng thu lead tuyển sinh.</li>
<li><strong>Customer Portal (PWA)</strong>: Giao diện dành cho phụ huynh &amp; học sinh – OTP login, xem điểm, lịch học, thông báo...</li>
<li><strong>Admin Webapp (SPA)</strong>: Giao diện dành cho nhân viên, giáo viên – quản lý học sinh, lớp, RBAC, thông báo...<blockquote>
<p>Hai ứng dụng này (Admin Webapp, Customer Portal) thay thế hoàn toàn việc truy cập trực tiếp vào UI của SuiteCRM, Gibbon, Moodle.</p>
</blockquote>
</li>
<li>🧠 Core Services</li>
<li><strong>API Gateway</strong>: Điểm kiểm soát chính, thực hiện xác thực, RBAC và định tuyến request.</li>
<li><strong>Auth Service</strong>: Xác thực Google OAuth2 và OTP.</li>
<li><strong>User Service</strong>: Quản lý thông tin người dùng, phân quyền.</li>
<li><strong>Notification Service</strong>: Gửi thông báo đa kênh.</li>
<li>🔌 Business Adapters</li>
<li>Các lớp tích hợp với hệ thống CRM, SIS, LMS qua API.</li>
<li>🌐 External Services</li>
<li>Các dịch vụ ngoài như Google OAuth2, Gmail API, Zalo OA, Google Chat API.</li>
</ol>
<hr/>
<h2 id="2-admission-flow-luong-tuyen-sinh">2. Admission Flow – Luồng Tuyển sinh<a class="headerlink" href="#2-admission-flow-luong-tuyen-sinh" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>flowchart TD
  A[Public Webform] --&gt; B[CRM Adapter]
  B --&gt; C[SuiteCRM]

  C --&gt;|Pipeline chuyển đổi Lead → Học sinh| D[SIS Adapter]
  D --&gt; E[Gibbon SIS]

  E --&gt;|Tạo user học sinh + lớp học| F[LMS Adapter]
  F --&gt; G[Moodle LMS]

  subgraph Frontend
    A
  end

  subgraph Business Systems
    C
    E
    G
  end

  subgraph Adapters
    B
    D
    F
  end

</code></pre>
<p><strong>Diễn giải Admission Flow:</strong></p>
<ol>
<li><strong>Phụ huynh điền thông tin tại Public Webform</strong> → <strong>CRM Adapter</strong> tiếp nhận dữ liệu.</li>
<li><strong>CRM Adapter</strong> chuyển tiếp qua API Gateway để tạo bản ghi lead trong <strong>SuiteCRM</strong>, nơi quản lý pipeline tuyển sinh (ví dụ: liên hệ, thử lớp, đóng phí...).</li>
<li>Khi lead đủ điều kiện nhập học:</li>
<li>CRM gửi thông tin sang <strong>SIS Adapter</strong> để tạo học sinh trong <strong>Gibbon SIS</strong>.</li>
<li>SIS xử lý:</li>
<li>Tạo hồ sơ học sinh, gán lớp, mã số định danh nội bộ.</li>
<li>Đẩy thông tin sang <strong>LMS Adapter</strong> để khởi tạo tài khoản Moodle.</li>
<li>Học sinh được khởi tạo trong <strong>Moodle LMS</strong> với liên kết SIS-ID, được phân lớp và kích hoạt lộ trình học trực tuyến.</li>
</ol>
<p>📌 Toàn bộ quá trình này đi qua API Gateway và các adapter, không tương tác trực tiếp với cơ sở dữ liệu nội bộ của SuiteCRM, Gibbon, Moodle.</p>
<hr/>
<h2 id="3-notification-flow-luong-gui-thong-bao">3. Notification Flow – Luồng Gửi Thông báo<a class="headerlink" href="#3-notification-flow-luong-gui-thong-bao" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>sequenceDiagram
  participant Service as Hệ thống phát sinh sự kiện (CRM/SIS/LMS)
  participant Gateway as API Gateway
  participant Noti as Notification Service
  participant Zalo as Zalo OA
  participant Gmail as Gmail API
  participant Chat as Google Chat

  Service-&gt;&gt;Gateway: Gửi yêu cầu gửi thông báo (POST /notifications)
  Gateway-&gt;&gt;Noti: Forward request + X-User-ID + RBAC check

  Noti-&gt;&gt;Noti: Kiểm tra phân quyền + Tra cấu hình kênh ưa thích
  alt Gửi qua Zalo OA
    Noti-&gt;&gt;Zalo: ZNS API
  end
  alt Gửi qua Gmail
    Noti-&gt;&gt;Gmail: Gmail API
  end
  alt Gửi qua Google Chat
    Noti-&gt;&gt;Chat: Chat webhook
  end

</code></pre>
<p><strong>Diễn giải Notification Flow:</strong></p>
<ol>
<li><strong>Một service nghiệp vụ (CRM, SIS, LMS...) phát sinh sự kiện</strong> – ví dụ:</li>
<li>CRM: phụ huynh đăng ký thành công</li>
<li>SIS: học sinh điểm danh trễ</li>
<li>LMS: bài tập đến hạn</li>
<li>Service gọi <code>POST /notifications</code> qua API Gateway, đính kèm JWT hoặc service token.</li>
<li><strong>API Gateway thực hiện kiểm tra phân quyền</strong> (nếu là người dùng cuối), rồi forward tới Notification Service.</li>
<li><strong>Notification Service</strong> kiểm tra:</li>
<li>User có quyền nhận loại thông báo này không?</li>
<li>Kênh ưa thích là gì? (Zalo / Gmail / Google Chat / WebPush...)</li>
<li>Thông báo được gửi đi qua các API tương ứng, với retry và xử lý lỗi nếu cần.</li>
</ol>
<p>📌 Notification Service hỗ trợ gửi đồng thời nhiều kênh và có thể log lại từng trạng thái gửi, cho phép tracking và alert nếu gửi thất bại.</p>
<hr/>
<h2 id="4-rbac-evaluation-flow-luong-anh-gia-phan-quyen-ong">4. RBAC Evaluation Flow – Luồng Đánh giá Phân quyền Động<a class="headerlink" href="#4-rbac-evaluation-flow-luong-anh-gia-phan-quyen-ong" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>sequenceDiagram
  participant Client as Client App (PWA/SPA)
  participant Gateway as API Gateway
  participant Redis as Redis Cache
  participant UserSvc as User Service
  participant Backend as Backend Service

  Client-&gt;&gt;Gateway: Gửi request + JWT
  Gateway-&gt;&gt;Gateway: Giải mã + xác thực JWT
  Gateway-&gt;&gt;UserSvc: Kiểm tra is_active (optional)
  Gateway-&gt;&gt;Redis: Tra RBAC:{user_id} cache
  alt Cache hit
    Gateway-&gt;&gt;Gateway: Lấy danh sách permission + condition
  else Cache miss
    Gateway-&gt;&gt;UserSvc: GET /users/{id}/permissions
    UserSvc--&gt;&gt;Gateway: Trả về danh sách role, permission, condition
    Gateway-&gt;&gt;Redis: Ghi lại cache
  end

  Gateway-&gt;&gt;Gateway: Evaluate permission + condition theo context
  alt Pass
    Gateway-&gt;&gt;Backend: Forward request + X-Permissions + X-User-ID
  else Fail
    Gateway--&gt;&gt;Client: 403 Forbidden
  end
</code></pre>
<p><strong>Diễn giải RBAC Evaluation Flow:</strong></p>
<ol>
<li><strong>Client App (PWA/SPA)</strong> gửi request REST đến API Gateway, kèm theo JWT (Bearer token).</li>
<li><strong>API Gateway</strong>:</li>
<li>Giải mã và xác thực token (kiểm tra chữ ký, thời hạn).</li>
<li>Kiểm tra trạng thái <code>is_active</code> của user từ User Service (nếu cần).</li>
<li>Tra Redis: key <code>RBAC:{user_id}</code> để lấy danh sách permissions.</li>
<li>Nếu Redis cache <strong>hit</strong>:</li>
<li>Gateway lấy danh sách <code>permission</code> kèm <code>condition</code> JSONB.</li>
<li>Nếu cache <strong>miss</strong>:</li>
<li>Gateway gọi <code>GET /users/{id}/permissions</code> từ User Service.</li>
<li>Ghi dữ liệu RBAC mới vào Redis với TTL.</li>
<li><strong>Evaluate</strong>:</li>
<li>Gateway so sánh từng permission + condition với context từ request.</li>
<li>Nếu có ít nhất một permission thỏa: cho phép request.</li>
<li><strong>Kết quả</strong>:</li>
<li>Nếu pass: forward đến Backend Service, kèm các header:<ul>
<li><code>X-Permissions</code>: danh sách mã quyền (đã pass)</li>
<li><code>X-User-ID</code>, <code>X-Role</code>, <code>Trace-ID</code>...</li>
</ul>
</li>
<li>Nếu fail: trả về <code>403 Forbidden</code>.</li>
</ol>
<p>📌 RBAC được đánh giá hoàn toàn tại Gateway, backend không cần decode JWT hay tái kiểm tra quyền.</p>
<p>📎 Tham khảo chi tiết logic phân quyền động tại: <a href="../rbac-deep-dive/">RBAC Deep Dive</a></p>
<hr/>
<h2 id="5-data-synchronization-flow-ong-bo-hoc-sinh-crm-sis-lms">5. Data Synchronization Flow – Đồng bộ học sinh CRM → SIS → LMS<a class="headerlink" href="#5-data-synchronization-flow-ong-bo-hoc-sinh-crm-sis-lms" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>sequenceDiagram
  participant CRM as SuiteCRM
  participant CRMA as CRM Adapter
  participant Gateway as API Gateway
  participant SISA as SIS Adapter
  participant SIS as Gibbon SIS
  participant LMSA as LMS Adapter
  participant LMS as Moodle LMS

  CRM-&gt;&gt;CRMA: Gửi sự kiện Lead chuyển thành Học sinh
  CRMA-&gt;&gt;Gateway: POST /admissions
  Gateway-&gt;&gt;SISA: Forward request

  SISA-&gt;&gt;SIS: Tạo hồ sơ học sinh + gán lớp
  SIS--&gt;&gt;SISA: Trả về mã học sinh (student_id)
  SISA-&gt;&gt;Gateway: POST /students/{id}/sync-to-lms
  Gateway-&gt;&gt;LMSA: Forward request
  LMSA-&gt;&gt;LMS: Tạo user Moodle + phân lớp

  LMS--&gt;&gt;LMSA: OK
  LMSA--&gt;&gt;Gateway: OK
</code></pre>
<p><strong>Diễn giải Data Synchronization Flow (CRM → SIS → LMS):</strong></p>
<ol>
<li><strong>Trong SuiteCRM</strong>, khi một <code>Lead</code> được đánh dấu là “đã trúng tuyển”, CRM sẽ phát sinh sự kiện chuyển đổi.</li>
<li><strong>CRM Adapter</strong> tiếp nhận sự kiện và gửi <code>POST /admissions</code> qua API Gateway.</li>
<li><strong>API Gateway</strong> forward đến <strong>SIS Adapter</strong>, nơi thực hiện:</li>
<li>Tạo học sinh mới trong <strong>Gibbon SIS</strong></li>
<li>Gán vào lớp, campus tương ứng</li>
<li>SIS trả về <code>student_id</code>, được lưu tại Adapter.</li>
<li>SIS Adapter gọi tiếp <code>POST /students/{id}/sync-to-lms</code> qua Gateway → forward đến <strong>LMS Adapter</strong>.</li>
<li><strong>LMS Adapter</strong> tạo tài khoản Moodle cho học sinh và phân lớp tương ứng.</li>
<li>Sau khi tạo thành công, phản hồi xác nhận được gửi ngược về.</li>
</ol>
<p>📌 Mọi hành động đều đi qua API Gateway và được kiểm soát phân quyền nếu có liên quan đến user. Quá trình sync có thể được lặp lại định kỳ hoặc phát động theo event.</p>
<hr/>
<h2 id="6-service-to-service-auth-flow-giao-tiep-giua-cac-dich-vu-noi-bo">6. Service-to-Service Auth Flow – Giao tiếp giữa các dịch vụ nội bộ<a class="headerlink" href="#6-service-to-service-auth-flow-giao-tiep-giua-cac-dich-vu-noi-bo" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>sequenceDiagram
  participant ServiceA as Notification Service
  participant Gateway as API Gateway
  participant UserSvc as User Service

  ServiceA-&gt;&gt;Gateway: POST /users/{id}/status + Internal Auth Header
  Gateway-&gt;&gt;Gateway: Xác thực token nội bộ / mTLS
  Gateway-&gt;&gt;UserSvc: Forward request + X-Service-Name + X-Signature
  UserSvc-&gt;&gt;UserSvc: Kiểm tra định danh service gọi
  UserSvc--&gt;&gt;Gateway: Response
  Gateway--&gt;&gt;ServiceA: Response
</code></pre>
<p><strong>Diễn giải Service-to-Service Auth Flow:</strong></p>
<ol>
<li><strong>Service A (ví dụ: Notification Service)</strong> cần lấy thông tin người dùng, nên gọi <code>POST /users/{id}/status</code> qua API Gateway.</li>
<li><strong>Gateway xác thực danh tính Service A</strong>:</li>
<li>Thông qua token nội bộ (Bearer token dành cho service)</li>
<li>Hoặc qua cơ chế mTLS (Mutual TLS)</li>
<li>Sau khi xác thực, Gateway forward request đến <strong>User Service</strong>, kèm theo:</li>
<li><code>X-Service-Name</code>: Tên service gọi (ví dụ: <code>notification-service</code>)</li>
<li><code>X-Signature</code>: Chữ ký HMAC hoặc JWT bảo vệ integrity</li>
<li><strong>User Service</strong> kiểm tra xem:</li>
<li>Request có đến từ một service tin cậy không?</li>
<li>Header có hợp lệ và khớp cấu hình gọi nội bộ không?</li>
<li>Nếu hợp lệ: tiếp tục xử lý và trả kết quả về.</li>
<li>Nếu sai định danh/mất chữ ký: trả lỗi <code>403</code> hoặc <code>401</code>.</li>
</ol>
<p>📌 Dù là service nội bộ, tất cả lời gọi đều phải qua API Gateway để kiểm soát, trace và log đầy đủ. Không cho phép service gọi nhau trực tiếp để tránh rò rỉ phân quyền hoặc bypass giám sát.</p>
<hr/>
<h2 id="7-user-account-lifecycle-flow-vong-oi-tai-khoan-nguoi-dung">7. User Account Lifecycle Flow – Vòng đời tài khoản người dùng<a class="headerlink" href="#7-user-account-lifecycle-flow-vong-oi-tai-khoan-nguoi-dung" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>flowchart LR
  Create[User được tạo\nPOST /users]
  Pending[Xác minh OTP hoặc nhận OAuth2]
  Active[is_active = true\nUser có thể đăng nhập]
  Inactive[is_active = false\nTài khoản bị vô hiệu hóa]
  Deleted[Tài khoản bị xóa - is_deleted = true]

  Create --&gt; Pending
  Pending --&gt; Active
  Active --&gt; Inactive
  Inactive --&gt; Active
  Active --&gt; Deleted
  Inactive --&gt; Deleted

  subgraph Events &amp; Side Effects
    RBAC[Emit: rbac_updated]
    STATUS[Emit: user_status_changed]
    Cache[Invalidate RBAC cache]
  end

  Active --&gt; RBAC
  Inactive --&gt; STATUS
  Deleted --&gt; STATUS
  RBAC --&gt; Cache
  STATUS --&gt; Cache
</code></pre>
<p><strong>Diễn giải User Account Lifecycle Flow:</strong></p>
<ol>
<li><strong>Tài khoản người dùng được tạo</strong>:</li>
<li>Qua <code>POST /users</code> (do nhân viên tạo), hoặc</li>
<li>Tự động tạo từ hệ thống CRM/SIS/LMS</li>
<li><strong>Trạng thái ban đầu: Pending</strong></li>
<li>Nếu là phụ huynh: chờ xác minh OTP</li>
<li>Nếu là GV/NV/HS: chờ xác thực qua Google OAuth2</li>
<li>Khi xác minh thành công:</li>
<li>Trạng thái chuyển sang <code>is_active = true</code></li>
<li>Người dùng có thể đăng nhập, JWT được cấp</li>
<li>Trong quá trình vận hành:</li>
<li>Tài khoản có thể bị khóa tạm thời → <code>is_active = false</code></li>
<li>Khi đó, mọi request bị chặn tại Gateway</li>
<li>Khi tài khoản bị xóa (logic delete):</li>
<li>Trạng thái <code>is_deleted = true</code> (nếu hỗ trợ)</li>
<li>Không thể khôi phục nếu đã xóa vĩnh viễn</li>
</ol>
<hr/>
<p><strong>Sự kiện liên quan:</strong></p>
<ul>
<li>Khi trạng thái user thay đổi:</li>
<li>Gửi sự kiện <code>user_status_changed</code></li>
<li>API Gateway hoặc các service có thể xử lý để invalidate cache, log bảo mật...</li>
<li>Khi vai trò hoặc phân quyền thay đổi:</li>
<li>Gửi sự kiện <code>rbac_updated</code> → cập nhật cache RBAC của người dùng</li>
</ul>
<p>📌 Việc kiểm soát vòng đời user giúp hệ thống đảm bảo bảo mật, tuân thủ và giám sát chặt chẽ trạng thái tài khoản.</p>
<hr/>
<h2 id="8-chu-giai-so-o-legend-huong-dan-oc">8. Chú giải sơ đồ (Legend) - Hướng dẫn đọc<a class="headerlink" href="#8-chu-giai-so-o-legend-huong-dan-oc" title="Permanent link">¶</a></h2>
<h3 id="ky-hieu-cac-thanh-phan-dung-trong-flowchart-sequencediagram">🧩 Ký hiệu các thành phần (dùng trong flowchart &amp; sequenceDiagram):<a class="headerlink" href="#ky-hieu-cac-thanh-phan-dung-trong-flowchart-sequencediagram" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Ký hiệu / Label</th>
<th>Ý nghĩa</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Hình chữ nhật</strong></td>
<td>Dịch vụ lõi trong hệ thống (Core Service, Adapter)</td>
</tr>
<tr>
<td><strong>Hình chữ nhật bo góc</strong></td>
<td>Giao diện người dùng (SPA, PWA, Webform) hoặc hệ thống bên ngoài</td>
</tr>
<tr>
<td><strong>Mũi tên →</strong></td>
<td>Gọi API hoặc hành động chính theo thứ tự thời gian</td>
</tr>
<tr>
<td><strong>Mũi tên --&gt;&gt;</strong></td>
<td>Trả kết quả hoặc phản hồi</td>
</tr>
<tr>
<td><strong>Alt</strong> (sequence)</td>
<td>Nhánh điều kiện (ví dụ: cache hit/miss, quyền pass/fail)</td>
</tr>
<tr>
<td><strong>Subgraph</strong></td>
<td>Phân nhóm logic (Frontend, Adapter, External Service...)</td>
</tr>
</tbody>
</table>
<blockquote>
<p>📝 Các label như <code>POST /users</code>, <code>X-Permissions</code>, <code>student_id</code>, v.v. dùng để minh họa request cụ thể trong sơ đồ.</p>
</blockquote>
<hr/>
<h3 id="cach-oc-so-o">🧭 Cách đọc sơ đồ<a class="headerlink" href="#cach-oc-so-o" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Flowchart</strong> (luồng trạng thái, nghiệp vụ):  </li>
<li>Đọc từ trái qua phải hoặc trên xuống.</li>
<li>Theo dõi các node thể hiện trạng thái hoặc hành động chính.</li>
<li>
<p>Các nhóm <code>subgraph</code> giúp hiểu mối liên hệ giữa thành phần.</p>
</li>
<li>
<p><strong>Sequence Diagram</strong> (chuỗi tương tác):  </p>
</li>
<li>Đọc theo chiều dọc từ trên xuống.</li>
<li>Cột là các thành phần tương tác (participants).</li>
<li>Dòng là request/response hoặc gọi API nội bộ.</li>
<li>Nhánh <code>alt</code> dùng để phân nhánh xử lý.</li>
</ol>
<hr/>
<h3 id="luu-y-van-hanh">🔐 Lưu ý vận hành<a class="headerlink" href="#luu-y-van-hanh" title="Permanent link">¶</a></h3>
<ul>
<li>Tất cả các sơ đồ đều phản ánh kiến trúc chuẩn hóa có API Gateway làm trung tâm điều phối.</li>
<li>Không có tương tác trực tiếp giữa các service với nhau hoặc với hệ thống kế thừa.</li>
<li>Phân quyền (RBAC), xác thực (OAuth2/OTP/mTLS), cache Redis, event-driven đều được mô hình hóa trong sơ đồ.</li>
</ul>
<hr/>
<h3 id="duy-tri-cap-nhat">🛠 Duy trì &amp; cập nhật<a class="headerlink" href="#duy-tri-cap-nhat" title="Permanent link">¶</a></h3>
<ul>
<li>Sơ đồ được viết bằng mã <strong>Mermaid</strong> trực tiếp trong file Markdown.</li>
<li>Được version control cùng source code, giúp dễ chỉnh sửa khi kiến trúc thay đổi.</li>
<li>Có thể xuất thành ảnh (SVG/PNG) nếu cần đưa vào slide, wiki, hoặc tài liệu PDF.</li>
</ul>
<hr/>
<h2 id="9-deployment-overview-diagram-so-o-trien-khai-tong-quan">9. Deployment Overview Diagram – Sơ đồ triển khai tổng quan<a class="headerlink" href="#9-deployment-overview-diagram-so-o-trien-khai-tong-quan" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>flowchart TD
  subgraph User Devices
    Browser[Browser / Mobile App]
  end

  subgraph Internet
    HTTPS[HTTPS Entrypoint]
  end

  subgraph Google Cloud
    %% Core Services
    subgraph Core_Services[Core Services - Cloud Run]
      Gateway[API Gateway]
      Auth[Auth Service]
      User[User Service]
      Noti[Notification Service]
    end

    %% Adapters
    subgraph Adapters[Adapters - Cloud Run]
      CRM[CRM Adapter]
      SIS[SIS Adapter]
      LMS[LMS Adapter]
    end

    %% Infrastructure
    subgraph Infrastructure[Data Infrastructure]
      Redis[Redis Cache - MemoryStore]
      PG[PostgreSQL - Cloud SQL - Core]
      MySQL[MySQL - Cloud SQL - Adapters]
      PubSub[Pub/Sub - Event Bus]
      Storage[GCS - Static Files]
    end
  end

  %% External access
  Browser --&gt; HTTPS --&gt; Gateway

  %% Routing to services
  Gateway --&gt; Auth
  Gateway --&gt; User
  Gateway --&gt; Noti
  Gateway --&gt; CRM
  Gateway --&gt; SIS
  Gateway --&gt; LMS

  %% DB connections
  Auth --&gt; PG
  User --&gt; PG
  Noti --&gt; PG
  CRM --&gt; MySQL
  SIS --&gt; MySQL
  LMS --&gt; MySQL

  %% Event &amp; Cache
  Gateway --&gt; Redis
  User --&gt; Redis
  Gateway --&gt; PubSub
  Noti --&gt; PubSub
  SIS --&gt; PubSub
  LMS --&gt; PubSub

  Gateway --&gt; Storage

</code></pre>
<p><strong>Diễn giải sơ đồ triển khai tổng quan:</strong></p>
<ol>
<li><strong>Client (Browser/Mobile App)</strong> giao tiếp qua HTTPS → truy cập vào điểm vào duy nhất: <code>API Gateway</code>.</li>
<li><strong>API Gateway</strong>, cùng tất cả các service (Auth, User, Notification, CRM/SIS/LMS Adapter), đều được triển khai dưới dạng container serverless trên <strong>Google Cloud Run</strong>.</li>
<li><strong>Các Core Services</strong> (Auth, User, Notification) sử dụng <strong>PostgreSQL</strong> qua <strong>Cloud SQL</strong> để tận dụng khả năng xử lý JSONB, concurrency cao và các tính năng SQL nâng cao.</li>
<li><strong>Các Adapter (CRM, SIS, LMS)</strong> sử dụng <strong>MySQL</strong>, tương thích với hệ quản trị mặc định của các hệ thống tích hợp (SuiteCRM, Gibbon, Moodle).</li>
<li>Dữ liệu RBAC và token được cache qua <strong>Redis (MemoryStore)</strong>.</li>
<li>Giao tiếp bất đồng bộ (event-driven) sử dụng <strong>Pub/Sub</strong> – các service phát/sử dụng sự kiện qua event bus này.</li>
<li><strong>Static file</strong> (ảnh, logo, config...) được phục vụ qua <strong>Google Cloud Storage (GCS)</strong>.</li>
<li>Mọi lời gọi giữa các service đều phải qua Gateway (hoặc gọi nội bộ có kiểm soát qua Envoy/mTLS) để đảm bảo xác thực, phân quyền và khả năng theo dõi (traceability).</li>
</ol>
<p>📌 Cấu trúc triển khai này đảm bảo:
- Khả năng mở rộng linh hoạt (Cloud Run autoscale)
- Tối ưu hiệu năng và tính năng theo từng nhóm thành phần
- Tách biệt logic rõ ràng (each service = 1 container)
- Bảo mật chặt chẽ và dễ dàng giám sát vận hành</p>
<p>📎 Cơ chế sử dụng hai CSDL (PostgreSQL &amp; MySQL) được trình bày rõ tại: <a href="../../#hạ-tầng-triển-khai">README</a></p>
<hr/>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Trở lại mục lục
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.annotate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u0110\u00e3 sao ch\u00e9p", "clipboard.copy": "Sao ch\u00e9p v\u00e0o b\u1ed9 nh\u1edb t\u1ea1m", "search.result.more.one": "1 t\u1eeb kh\u00e1c trong trang", "search.result.more.other": "# t\u1eeb kh\u00e1c trong trang", "search.result.none": "Kh\u00f4ng t\u00ecm th\u1ea5y t\u00e0i li\u1ec7u li\u00ean quan", "search.result.one": "1 t\u00e0i li\u1ec7u li\u00ean quan", "search.result.other": "# t\u00e0i li\u1ec7u li\u00ean quan", "search.result.placeholder": "Nh\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u t\u00ecm ki\u1ebfm", "search.result.term.missing": "Kh\u00f4ng", "select.version": "Ch\u1ecdn phi\u00ean b\u1ea3n"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>