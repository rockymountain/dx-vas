{"config":{"lang":["vi"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"T\u00c0I LI\u1ec6U KI\u1ebeN TR\u00daC CHI TI\u1ebeT \u2013 H\u1ec6 TH\u1ed0NG CHUY\u1ec2N \u0110\u1ed4I S\u1ed0 VAS","text":""},{"location":"#1-yeu-cau-du-an","title":"1. Y\u00eau c\u1ea7u d\u1ef1 \u00e1n","text":"<ul> <li> <p>M\u1ee5c ti\u00eau ch\u00ednh: Tri\u1ec3n khai m\u1ed9t h\u1ec7 th\u1ed1ng chuy\u1ec3n \u0111\u1ed5i s\u1ed1 to\u00e0n di\u1ec7n cho m\u1ed9t c\u00f4ng ty gi\u00e1o d\u1ee5c qu\u1ea3n l\u00fd nhi\u1ec1u tr\u01b0\u1eddng th\u00e0nh vi\u00ean, t\u00edch h\u1ee3p qu\u1ea3n l\u00fd h\u1ecdc sinh, gi\u00e1o vi\u00ean, ph\u1ee5 huynh, l\u1edbp h\u1ecdc, h\u1ecdc ph\u00ed, th\u00f4ng b\u00e1o, h\u1ecdc t\u1eadp online v\u00e0 quy tr\u00ecnh tuy\u1ec3n sinh.</p> </li> <li> <p>M\u00f4 h\u00ecnh v\u1eadn h\u00e0nh: </p> </li> <li>C\u00f4ng ty s\u1edf h\u1eefu v\u00e0 qu\u1ea3n l\u00fd 3 tr\u01b0\u1eddng th\u00e0nh vi\u00ean (m\u1ed7i tr\u01b0\u1eddng l\u00e0 m\u1ed9t tenant ri\u00eang bi\u1ec7t).</li> <li> <p>H\u1ec7 th\u1ed1ng v\u1eadn h\u00e0nh theo ki\u1ebfn tr\u00fac multi-tenant, m\u1ed7i tenant c\u00f3 stack ri\u00eang (frontend, adapters, auth/user sub-service), v\u00e0 d\u00f9ng chung API Gateway &amp; Tenant Master Services.</p> </li> <li> <p>Thi\u1ebft k\u1ebf ban \u0111\u1ea7u (cho to\u00e0n h\u1ec7 th\u1ed1ng):</p> </li> <li>1 c\u00f4ng ty qu\u1ea3n l\u00fd 3 tenant (tr\u01b0\u1eddng th\u00e0nh vi\u00ean).</li> <li> <p>T\u1ed5ng s\u1ed1 ng\u01b0\u1eddi d\u00f9ng d\u1ef1 ki\u1ebfn:</p> <ul> <li>100 nh\u00e2n vi\u00ean, gi\u00e1o vi\u00ean (to\u00e0n h\u1ec7 th\u1ed1ng)</li> <li>T\u1eeb 100 \u0111\u1ebfn 600 h\u1ecdc sinh m\u1ed7i tr\u01b0\u1eddng \u2192 t\u1ed5ng c\u1ed9ng kho\u1ea3ng 1000 h\u1ecdc sinh</li> <li>Kho\u1ea3ng 1000 ph\u1ee5 huynh, t\u01b0\u01a1ng \u1ee9ng 1:1 v\u1edbi h\u1ecdc sinh</li> </ul> </li> <li> <p>Kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng t\u1ed1i \u0111a (g\u1ea5p 2.5 l\u1ea7n):</p> </li> <li>250 nh\u00e2n vi\u00ean, gi\u00e1o vi\u00ean</li> <li>T\u1ed1i \u0111a 2500 h\u1ecdc sinh</li> <li>T\u1ed1i \u0111a 2500 ph\u1ee5 huynh</li> </ul>"},{"location":"#2-ang-nhap-phan-quyen-ong-rbac","title":"2. \u0110\u0103ng nh\u1eadp &amp; Ph\u00e2n quy\u1ec1n \u0111\u1ed9ng (RBAC)","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng ki\u1ebfn tr\u00fac RBAC \u0111\u1ed9ng v\u1edbi kh\u1ea3 n\u0103ng multi-tenant. Quy\u1ec1n truy c\u1eadp \u0111\u01b0\u1ee3c ki\u1ec3m so\u00e1t ch\u00ednh x\u00e1c theo t\u1eebng tenant (tr\u01b0\u1eddng th\u00e0nh vi\u00ean), k\u1ebft h\u1ee3p qu\u1ea3n tr\u1ecb t\u1eadp trung t\u1eeb Master v\u1edbi kh\u1ea3 n\u0103ng t\u00f9y bi\u1ebfn c\u1ee5c b\u1ed9 t\u1ea1i t\u1eebng tenant.</p>"},{"location":"#mo-hinh-phan-tang-inh-danh-va-rbac","title":"\ud83d\udd11 M\u00f4 h\u00ecnh ph\u00e2n t\u1ea7ng \u0111\u1ecbnh danh v\u00e0 RBAC","text":"<ul> <li>User Service Master:</li> <li>Qu\u1ea3n l\u00fd to\u00e0n b\u1ed9 \u0111\u1ecbnh danh ng\u01b0\u1eddi d\u00f9ng (<code>users_global</code>)</li> <li>Duy tr\u00ec th\u00f4ng tin <code>tenants</code>, <code>user_tenant_assignments</code></li> <li>Cung c\u1ea5p b\u1ed9 <code>global_roles_templates</code> v\u00e0 <code>global_permissions_templates</code></li> <li> <p>Tr\u1ea1ng th\u00e1i <code>is_active</code> to\u00e0n c\u1ee5c</p> </li> <li> <p>Sub User Service (per tenant):</p> </li> <li>Qu\u1ea3n l\u00fd RBAC ri\u00eang bi\u1ec7t c\u1ee7a tenant</li> <li>Tham chi\u1ebfu <code>user_id_global</code>, c\u00f3 <code>is_active_in_tenant</code></li> <li>Cho ph\u00e9p k\u1ebf th\u1eeba ho\u1eb7c tu\u1ef3 ch\u1ec9nh role/permission ri\u00eang</li> <li>Th\u1ef1c hi\u1ec7n g\u00e1n vai tr\u00f2, ph\u00e2n quy\u1ec1n, v\u00e0 ki\u1ec3m tra RBAC trong n\u1ed9i b\u1ed9 tenant</li> </ul> <p>\ud83d\udcd8 M\u1ecdi chi ti\u1ebft v\u1ec1 schema, b\u1ea3ng, quan h\u1ec7 \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a r\u00f5 trong: - <code>user-service/master/data-model.md</code> - <code>user-service/tenant/data-model.md</code></p>"},{"location":"#anh-gia-phan-quyen-tai-api-gateway","title":"\ud83d\udd10 \u0110\u00e1nh gi\u00e1 ph\u00e2n quy\u1ec1n t\u1ea1i API Gateway","text":"<ul> <li>JWT do Auth Master/Sub c\u1ea5p, ch\u1ee9a <code>user_id</code>, <code>tenant_id</code>, <code>roles</code>, <code>permissions</code></li> <li>Gateway th\u1ef1c hi\u1ec7n:</li> <li>X\u00e1c th\u1ef1c JWT</li> <li>Ki\u1ec3m tra <code>is_active</code> v\u00e0 <code>is_active_in_tenant</code></li> <li>Truy v\u1ea5n cache RBAC (theo <code>user_id + tenant_id</code>)</li> <li>\u0110\u00e1nh gi\u00e1 \u0111i\u1ec1u ki\u1ec7n JSONB n\u1ebfu c\u00f3 (VD: xem \u0111i\u1ec3m h\u1ecdc sinh n\u1ebfu c\u00f9ng l\u1edbp)</li> </ul>"},{"location":"#tinh-linh-hoat","title":"\ud83e\udded T\u00ednh linh ho\u1ea1t","text":"<ul> <li>M\u1ed9t user c\u00f3 th\u1ec3 thu\u1ed9c nhi\u1ec1u tenant v\u1edbi vai tr\u00f2 kh\u00e1c nhau</li> <li>Tenant c\u00f3 th\u1ec3 ch\u1ec9nh s\u1eeda RBAC ri\u00eang m\u00e0 kh\u00f4ng \u1ea3nh h\u01b0\u1edfng c\u00e1c tenant kh\u00e1c</li> <li>RBAC cache t\u1ea1i Gateway \u0111\u01b0\u1ee3c \u0111\u1ed3ng b\u1ed9 qua Pub/Sub ho\u1eb7c TTL t\u1ef1 \u0111\u1ed9ng</li> </ul> <p>\ud83d\udcd8 \u0110\u1ecdc th\u00eam m\u00f4 h\u00ecnh ph\u00e2n quy\u1ec1n chi ti\u1ebft t\u1ea1i: <code>rbac-deep-dive.md</code></p>"},{"location":"#3-auth-service","title":"3. Auth Service","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng m\u00f4 h\u00ecnh x\u00e1c th\u1ef1c \u0111a t\u1ea7ng \u0111\u1ec3 h\u1ed7 tr\u1ee3 multi-tenant, \u0111\u1ed3ng th\u1eddi \u0111\u1ea3m b\u1ea3o t\u00ednh linh ho\u1ea1t trong x\u00e1c th\u1ef1c Google OAuth2 v\u00e0 Local/OTP.</p>"},{"location":"#auth-service-master","title":"\ud83d\udd10 Auth Service Master","text":"<ul> <li>Ch\u1ecbu tr\u00e1ch nhi\u1ec7m x\u1eed l\u00fd x\u00e1c th\u1ef1c th\u00f4ng qua Google OAuth2 cho to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng.</li> <li>Sau khi ng\u01b0\u1eddi d\u00f9ng x\u00e1c th\u1ef1c th\u00e0nh c\u00f4ng qua Google, h\u1ec7 th\u1ed1ng s\u1ebd:</li> <li>X\u00e1c \u0111\u1ecbnh danh s\u00e1ch c\u00e1c tenant m\u00e0 ng\u01b0\u1eddi d\u00f9ng thu\u1ed9c v\u1ec1.</li> <li>N\u1ebfu ng\u01b0\u1eddi d\u00f9ng thu\u1ed9c nhi\u1ec1u tenant, hi\u1ec3n th\u1ecb giao di\u1ec7n ch\u1ecdn tenant.</li> <li>G\u1ecdi User Service Master \u0111\u1ec3 ki\u1ec3m tra <code>user_id_global</code>, v\u00e0 x\u00e1c th\u1ef1c xem ng\u01b0\u1eddi d\u00f9ng c\u00f3 quy\u1ec1n truy c\u1eadp tenant \u0111\u00e3 ch\u1ecdn kh\u00f4ng.</li> <li>G\u1ecdi Sub User Service (c\u1ee7a tenant \u0111\u00f3) \u0111\u1ec3 l\u1ea5y danh s\u00e1ch roles/permissions trong tenant.</li> <li>Ph\u00e1t h\u00e0nh JWT \"\u0111\u1ea7y \u0111\u1ee7\" ch\u1ee9a:<ul> <li><code>user_id</code></li> <li><code>tenant_id</code></li> <li><code>roles</code>, <code>permissions</code></li> <li><code>auth_provider</code>, <code>exp</code>, <code>trace_id</code>\u2026</li> </ul> </li> </ul>"},{"location":"#sub-auth-service-per-tenant","title":"\ud83d\udd10 Sub Auth Service (per tenant)","text":"<ul> <li>Tri\u1ec3n khai ri\u00eang bi\u1ec7t trong t\u1eebng tenant stack.</li> <li>X\u1eed l\u00fd x\u00e1c th\u1ef1c cho c\u00e1c user s\u1eed d\u1ee5ng:</li> <li>T\u00e0i kho\u1ea3n Local (t\u00ean \u0111\u0103ng nh\u1eadp/m\u1eadt kh\u1ea9u)</li> <li>OTP (SMS/email)</li> <li>Sau khi x\u00e1c th\u1ef1c local th\u00e0nh c\u00f4ng:</li> <li>G\u1ecdi User Service Master \u0111\u1ec3 \u0111\u0103ng k\u00fd ng\u01b0\u1eddi d\u00f9ng (n\u1ebfu l\u1ea7n \u0111\u1ea7u) v\u00e0 nh\u1eadn <code>user_id_global</code>.</li> <li>G\u1ecdi Sub User Service c\u1ee7a ch\u00ednh tenant \u0111\u1ec3 l\u1ea5y RBAC t\u01b0\u01a1ng \u1ee9ng.</li> <li>Ph\u00e1t h\u00e0nh JWT \u0111\u1ea7y \u0111\u1ee7 nh\u01b0 Auth Master.</li> </ul>"},{"location":"#tinh-nang-bao-mat-nang-cao","title":"\ud83d\udd10 T\u00ednh n\u0103ng b\u1ea3o m\u1eadt n\u00e2ng cao","text":"<ul> <li>C\u01a1 ch\u1ebf CAPTCHA v\u00e0 gi\u1edbi h\u1ea1n s\u1ed1 l\u1ea7n g\u1eedi OTP theo IP/user.</li> <li>JWT k\u00fd b\u1eb1ng key \u0111\u01b0\u1ee3c lu\u00e2n phi\u00ean \u0111\u1ecbnh k\u1ef3 (theo ch\u00ednh s\u00e1ch <code>ADR-006</code>).</li> <li>H\u1ed7 tr\u1ee3 \u0111\u0103ng xu\u1ea5t, l\u00e0m m\u1edbi token (refresh), ki\u1ec3m tra trace log \u0111\u0103ng nh\u1eadp.</li> </ul>"},{"location":"#luu-y-ve-trien-khai","title":"\ud83c\udfaf L\u01b0u \u00fd v\u1ec1 tri\u1ec3n khai:","text":"<ul> <li>M\u1ed7i tenant c\u00f3 th\u1ec3 d\u00f9ng Sub Auth Service t\u00f9y ch\u1ecdn (b\u1eaft bu\u1ed9c n\u1ebfu c\u00f3 h\u1ecdc sinh/ph\u1ee5 huynh kh\u00f4ng d\u00f9ng Workspace).</li> <li>T\u1ea5t c\u1ea3 JWT (k\u1ec3 c\u1ea3 t\u1eeb Sub Auth) \u0111\u1ec1u ph\u1ea3i tu\u00e2n th\u1ee7 format chu\u1ea9n v\u00e0 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c x\u00e1c minh b\u1edfi API Gateway.</li> </ul> <p>\ud83d\udcd8 Xem th\u00eam: ADR-006 \u2013 Auth Strategy</p>"},{"location":"#4-user-service","title":"4. User Service","text":"<p>User Service trong h\u1ec7 th\u1ed1ng dx-vas \u0111\u01b0\u1ee3c chia th\u00e0nh hai c\u1ea5p \u0111\u1ed9 \u0111\u1ec3 h\u1ed7 tr\u1ee3 ki\u1ebfn tr\u00fac multi-tenant:</p>"},{"location":"#user-service-master-tap-trung-toan-he-thong","title":"\ud83e\udde0 User Service Master (T\u1eadp trung to\u00e0n h\u1ec7 th\u1ed1ng)","text":"<ul> <li>L\u00e0 n\u01a1i qu\u1ea3n l\u00fd \u0111\u1ecbnh danh ng\u01b0\u1eddi d\u00f9ng to\u00e0n c\u1ee5c:</li> <li>B\u1ea3ng <code>users_global</code>: m\u1ed7i user c\u00f3 m\u1ed9t <code>user_id</code> duy nh\u1ea5t to\u00e0n h\u1ec7 th\u1ed1ng, k\u00e8m <code>auth_provider</code>, <code>email</code>, <code>phone</code>, <code>local_auth_tenant_id</code> (n\u1ebfu l\u00e0 user local).</li> <li>B\u1ea3ng <code>tenants</code>: danh s\u00e1ch tenant (tr\u01b0\u1eddng th\u00e0nh vi\u00ean) \u0111ang ho\u1ea1t \u0111\u1ed9ng.</li> <li>B\u1ea3ng <code>user_tenant_assignments</code>: \u00e1nh x\u1ea1 user \u2194 tenant (ng\u01b0\u1eddi d\u00f9ng c\u00f3 th\u1ec3 thu\u1ed9c nhi\u1ec1u tenant).</li> <li>Tr\u1ea1ng th\u00e1i <code>is_active</code> to\u00e0n c\u1ee5c.</li> <li>Qu\u1ea3n l\u00fd b\u1ed9 template role/permission d\u00f9ng chung to\u00e0n h\u1ec7 th\u1ed1ng (<code>global_roles_templates</code>, <code>global_permissions_templates</code>).</li> <li>Ph\u00e1t s\u1ef1 ki\u1ec7n Pub/Sub (<code>user_assigned_to_tenant</code>, <code>user_info_updated</code>) \u0111\u1ec3 \u0111\u1ed3ng b\u1ed9 xu\u1ed1ng Sub User Service.</li> <li>Cung c\u1ea5p API qu\u1ea3n tr\u1ecb cho Superadmin:</li> <li>T\u1ea1o tenant, g\u00e1n user v\u00e0o tenant, c\u1eadp nh\u1eadt th\u00f4ng tin \u0111\u1ecbnh danh chung.</li> </ul>"},{"location":"#sub-user-service-cap-tenant-uoc-trien-khai-trong-tung-stack-tenant","title":"\ud83e\udde9 Sub User Service (C\u1ea5p tenant \u2013 \u0111\u01b0\u1ee3c tri\u1ec3n khai trong t\u1eebng stack tenant)","text":"<ul> <li>Qu\u1ea3n l\u00fd RBAC ri\u00eang bi\u1ec7t cho t\u1eebng tenant:</li> <li>B\u1ea3ng <code>users_in_tenant</code>: tham chi\u1ebfu <code>user_id_global</code>, c\u00f3 <code>is_active_in_tenant</code>.</li> <li><code>roles_in_tenant</code>, <code>permissions_in_tenant</code>: k\u1ebf th\u1eeba t\u1eeb Master ho\u1eb7c t\u1ef1 \u0111\u1ecbnh ngh\u0129a.</li> <li>Mapping RBAC: <code>user_role_in_tenant</code>, <code>role_permission_in_tenant</code>.</li> <li>Truy v\u1ea5n RBAC t\u1ea1i API Gateway d\u1ef1a tr\u00ean <code>user_id + tenant_id</code>.</li> <li>\u0110\u1ed3ng b\u1ed9 h\u00f3a d\u1eef li\u1ec7u t\u1eeb Master th\u00f4ng qua Pub/Sub.</li> <li>Cung c\u1ea5p API cho Admin tenant \u0111\u1ec3:</li> <li>G\u00e1n role cho user trong tenant</li> <li>C\u1eadp nh\u1eadt tr\u1ea1ng th\u00e1i user trong tenant</li> <li>Xem nh\u1eadt k\u00fd ph\u00e2n quy\u1ec1n (n\u1ebfu b\u1eadt audit)</li> </ul>"},{"location":"#co-che-hoat-ong-ien-hinh","title":"\ud83d\udd04 C\u01a1 ch\u1ebf ho\u1ea1t \u0111\u1ed9ng \u0111i\u1ec3n h\u00ecnh:","text":"<ul> <li>Khi Superadmin g\u00e1n m\u1ed9t user v\u00e0o tenant:</li> <li>User Service Master ghi nh\u1eadn v\u00e0 ph\u00e1t s\u1ef1 ki\u1ec7n <code>user_assigned_to_tenant</code></li> <li>Sub User Service c\u1ee7a tenant nh\u1eadn s\u1ef1 ki\u1ec7n v\u00e0 t\u1ea1o b\u1ea3n ghi \"shadow user\" n\u1ebfu ch\u01b0a c\u00f3</li> <li>Khi user login th\u00e0nh c\u00f4ng v\u00e0 ch\u1ecdn tenant:</li> <li>Auth Service g\u1ecdi Master \u2192 ki\u1ec3m tra quy\u1ec1n truy c\u1eadp tenant</li> <li>G\u1ecdi Sub User Service \u2192 truy v\u1ea5n RBAC \u2192 tr\u1ea3 l\u1ea1i \u0111\u1ec3 ph\u00e1t h\u00e0nh JWT</li> </ul> <p>\ud83d\udcd8 Xem chi ti\u1ebft c\u1ea5u tr\u00fac b\u1ea3ng v\u00e0 lu\u1ed3ng t\u1ea1i: <code>rbac-deep-dive.md</code>, <code>user-service/data-model.md</code></p>"},{"location":"#5-api-gateway","title":"5. API Gateway","text":"<p>API Gateway \u0111\u00f3ng vai tr\u00f2 trung t\u00e2m \u0111i\u1ec1u ph\u1ed1i trong ki\u1ebfn tr\u00fac dx-vas, \u0111\u1eb7c bi\u1ec7t trong m\u00f4 h\u00ecnh multi-tenant. N\u00f3 x\u1eed l\u00fd x\u00e1c th\u1ef1c, ph\u00e2n quy\u1ec1n \u0111\u1ed9ng (RBAC), \u0111\u1ecbnh tuy\u1ebfn \u0111\u1ebfn \u0111\u00fang tenant stack, v\u00e0 b\u1ea3o v\u1ec7 c\u00e1c backend n\u1ed9i b\u1ed9.</p>"},{"location":"#inh-tuyen-theo-tenant","title":"\ud83e\udded \u0110\u1ecbnh tuy\u1ebfn theo Tenant","text":"<ul> <li>Gateway ph\u1ee5c v\u1ee5 nhi\u1ec1u tenant (tr\u01b0\u1eddng th\u00e0nh vi\u00ean) tr\u00ean c\u00f9ng m\u1ed9t entrypoint.</li> <li>Tenant \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh qua m\u1ed9t trong ba c\u00e1ch:</li> <li><code>tenant_id</code> trong JWT (\u01b0u ti\u00ean)</li> <li>Domain/subdomain c\u1ee7a Frontend App (VD: <code>abc.truongvietanh.edu.vn</code>)</li> <li> <p>Tham s\u1ed1 <code>tenant</code> trong URL (fallback, d\u00f9ng trong m\u00f4i tr\u01b0\u1eddng ph\u00e1t tri\u1ec3n)</p> </li> <li> <p>D\u1ef1a v\u00e0o <code>tenant_id</code>, Gateway s\u1ebd:</p> </li> <li>Forward request \u0111\u1ebfn Sub Adapter / Sub Service \u0111\u00fang tenant.</li> <li>Ho\u1eb7c \u0111\u1ebfn Tenant Master Service n\u1ebfu request thu\u1ed9c v\u1ec1 Superadmin Webapp.</li> </ul>"},{"location":"#kiem-tra-rbac-ong-theo-tenant","title":"\ud83d\udd10 Ki\u1ec3m tra RBAC \u0111\u1ed9ng theo tenant","text":"<ul> <li>Gateway th\u1ef1c hi\u1ec7n x\u00e1c th\u1ef1c JWT:</li> <li>Do Auth Master ho\u1eb7c Sub Auth Service ph\u00e1t h\u00e0nh.</li> <li> <p>Ph\u1ea3i ch\u1ee9a: <code>user_id</code>, <code>tenant_id</code>, <code>roles</code>, <code>permissions</code>, <code>auth_provider</code>.</p> </li> <li> <p>Ki\u1ec3m tra tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng:</p> </li> <li><code>is_active</code> to\u00e0n c\u1ee5c (t\u1eeb User Service Master)</li> <li> <p><code>is_active_in_tenant</code> (t\u1eeb Sub User Service)</p> </li> <li> <p>Truy v\u1ea5n Redis cache \u0111\u1ec3 l\u1ea5y <code>permissions</code> g\u1eafn theo <code>tenant_id</code>.</p> </li> <li>Evaluate <code>condition</code> (n\u1ebfu c\u00f3) theo context request (VD: <code>student_id</code>, <code>class_id</code>...)</li> </ul>"},{"location":"#forward-request","title":"\ud83d\udce6 Forward request","text":"<ul> <li>N\u1ebfu pass: Gateway forward request \u0111\u1ebfn backend service \u0111\u00fang tenant:</li> <li>G\u1eafn c\u00e1c header: <code>X-User-ID</code>, <code>X-Tenant-ID</code>, <code>X-Permissions</code>, <code>X-Role</code>, <code>X-Trace-ID</code>, <code>X-Auth-Method</code></li> <li>N\u1ebfu fail: Tr\u1ea3 l\u1ed7i 403 ho\u1eb7c 401 t\u00f9y tr\u01b0\u1eddng h\u1ee3p.</li> </ul>"},{"location":"#bao-ve-noi-dung-inh-danh","title":"\ud83d\udd10 B\u1ea3o v\u1ec7 n\u1ed9i dung &amp; \u0111\u1ecbnh danh","text":"<ul> <li>C\u00e1c header \u0111\u1ecbnh danh \u0111\u01b0\u1ee3c k\u00fd (<code>X-Signature</code>) ho\u1eb7c ch\u1ec9 forward trong n\u1ed9i b\u1ed9 (mTLS).</li> <li>Backend service KH\u00d4NG \u0111\u01b0\u1ee3c ch\u1ea5p nh\u1eadn header \u0111\u1ecbnh danh n\u1ebfu request t\u1eeb b\u00ean ngo\u00e0i Gateway.</li> </ul> <p>\ud83d\udcd8 S\u01a1 \u0111\u1ed3 \u0111\u00e1nh gi\u00e1 RBAC xem chi ti\u1ebft t\u1ea1i: \ud83d\udc49 RBAC Evaluation Flow \u2013 System Diagrams</p>"},{"location":"#6-notification-service-multi-tenant-option-b","title":"6. Notification Service (Multi-Tenant \u2013 Option B)","text":"<p>Notification Service trong ki\u1ebfn tr\u00fac dx-vas \u0111\u01b0\u1ee3c tri\u1ec3n khai theo m\u00f4 h\u00ecnh ph\u00e2n t\u1ea7ng, h\u1ed7 tr\u1ee3 g\u1eedi th\u00f4ng b\u00e1o c\u00e1ch ly theo tenant v\u00e0 broadcast to\u00e0n h\u1ec7 th\u1ed1ng b\u1eb1ng ki\u1ebfn tr\u00fac b\u1ea5t \u0111\u1ed3ng b\u1ed9 qua Pub/Sub.</p>"},{"location":"#phan-tang-dich-vu","title":"\ud83e\udded Ph\u00e2n t\u1ea7ng d\u1ecbch v\u1ee5","text":""},{"location":"#sub-notification-service-per-tenant","title":"\ud83d\udd39 Sub Notification Service (per Tenant)","text":"<ul> <li>M\u1ed7i tenant c\u00f3 m\u1ed9t instance Notification Service ri\u00eang trong stack c\u1ee7a m\u00ecnh.</li> <li>Ch\u1ee9c n\u0103ng:</li> <li>G\u1eedi th\u00f4ng b\u00e1o n\u1ed9i b\u1ed9 c\u1ee7a tenant (h\u1ecdc ph\u00ed, \u0111i\u1ec3m danh, v.v.)</li> <li>Qu\u1ea3n l\u00fd template ri\u00eang (<code>notification_templates_in_tenant</code>)</li> <li>S\u1eed d\u1ee5ng c\u1ea5u h\u00ecnh k\u00eanh ri\u00eang: Zalo OA, Gmail API, Google Chat webhook</li> <li>Ghi log theo d\u00f5i g\u1eedi th\u00f4ng b\u00e1o (<code>notification_logs_in_tenant</code>)</li> <li>L\u1eafng nghe Pub/Sub: Subscribe v\u00e0o topic <code>vas-global-notifications-topic</code>, l\u1ecdc v\u00e0 x\u1eed l\u00fd c\u00e1c th\u00f4ng b\u00e1o to\u00e0n h\u1ec7 th\u1ed1ng n\u1ebfu ph\u00f9 h\u1ee3p <code>tenant_id</code>.</li> </ul>"},{"location":"#notification-service-master-shared-core","title":"\ud83d\udd39 Notification Service Master (Shared Core)","text":"<ul> <li>Ph\u1ee5c v\u1ee5 Superadmin Webapp.</li> <li>Ch\u1ee9c n\u0103ng:</li> <li>G\u1eedi th\u00f4ng b\u00e1o to\u00e0n h\u1ec7 th\u1ed1ng ho\u1eb7c \u0111\u1ebfn m\u1ed9t nh\u00f3m tr\u01b0\u1eddng.</li> <li>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>global_notification_requested</code> l\u00ean Pub/Sub v\u1edbi:<ul> <li><code>target_tenant_ids</code> ho\u1eb7c ti\u00eau ch\u00ed l\u1ecdc (VD: <code>target_user_roles</code>)</li> <li><code>message_id</code>, n\u1ed9i dung g\u1ed1c, <code>correlation_id</code></li> </ul> </li> <li>Kh\u00f4ng can thi\u1ec7p chi ti\u1ebft x\u1eed l\u00fd t\u1ea1i c\u00e1c tenant.</li> <li>Thu th\u1eadp tr\u1ea1ng th\u00e1i g\u1eedi t\u1eeb c\u00e1c Sub Service th\u00f4ng qua s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i <code>tenant_notification_batch_status</code>.</li> </ul>"},{"location":"#luong-gui-thong-bao-toan-he-thong-option-b-event-based","title":"\ud83d\udd04 Lu\u1ed3ng g\u1eedi th\u00f4ng b\u00e1o to\u00e0n h\u1ec7 th\u1ed1ng (Option B \u2013 Event-based)","text":"<ol> <li>Superadmin g\u1eedi y\u00eau c\u1ea7u th\u00f4ng b\u00e1o \u2192 Notification Service Master nh\u1eadn.</li> <li>Master publish s\u1ef1 ki\u1ec7n l\u00ean topic <code>vas-global-notifications-topic</code>.</li> <li>C\u00e1c Sub Notification Service subscribe topic:</li> <li>L\u1ecdc theo <code>tenant_id</code>, x\u1eed l\u00fd n\u1ebfu ph\u00f9 h\u1ee3p.</li> <li>G\u1eedi th\u00f4ng b\u00e1o b\u1eb1ng k\u00eanh ri\u00eang.</li> <li>G\u1eedi s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i <code>tenant_notification_batch_status</code> l\u00ean topic <code>vas-tenant-notification-ack-topic</code>.</li> </ol>"},{"location":"#co-che-phong-ngua-rui-ro","title":"\u2705 C\u01a1 ch\u1ebf ph\u00f2ng ng\u1eeba r\u1ee7i ro","text":"R\u1ee7i ro Ph\u00f2ng ng\u1eeba Kh\u00f4ng theo d\u00f5i \u0111\u01b0\u1ee3c tr\u1ea1ng th\u00e1i g\u1eedi Sub g\u1eedi s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i, Master ho\u1eb7c m\u1ed9t Monitor Service thu th\u1eadp &amp; log G\u1eedi tr\u00f9ng th\u00f4ng b\u00e1o (non-idempotent) D\u00f9ng <code>message_id</code> duy nh\u1ea5t + ki\u1ec3m tra <code>processed_global_notifications</code> Sub x\u1eed l\u00fd nh\u1ea7m s\u1ef1 ki\u1ec7n kh\u00f4ng d\u00e0nh cho m\u00ecnh Payload ch\u1ee9a r\u00f5 <code>target_tenant_ids</code>, Sub l\u1ecdc k\u1ef9 Sub qu\u00e1 t\u1ea3i khi nh\u1eadn nhi\u1ec1u s\u1ef1 ki\u1ec7n Gi\u1edbi h\u1ea1n Pub/Sub <code>flow control</code> + x\u1eed l\u00fd b\u1ea5t \u0111\u1ed3ng b\u1ed9 n\u1ed9i b\u1ed9 L\u1ed7i c\u1ea5u h\u00ecnh k\u00eanh g\u1eedi Sub log l\u1ed7i r\u00f5, ph\u00e1t s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i v\u1edbi tr\u1ea1ng th\u00e1i l\u1ed7i c\u1ee5 th\u1ec3 Dead Letter Topic b\u1ecb \u0111\u1ea7y do l\u1ed7i l\u1eb7p l\u1ea1i Gi\u00e1m s\u00e1t DLT, c\u00f3 quy tr\u00ecnh re-publish sau fix logic <p>\ud83d\udce6 C\u00e1c th\u00e0nh ph\u1ea7n d\u1eef li\u1ec7u li\u00ean quan:</p> <ul> <li><code>notification_templates_in_tenant</code></li> <li><code>channel_configs_in_tenant</code></li> <li><code>notification_logs_in_tenant</code></li> <li><code>global_notification_requested</code> (Pub/Sub)</li> <li><code>tenant_notification_batch_status</code> (Pub/Sub ACK)</li> <li><code>processed_global_notifications</code> (DB Sub)</li> </ul>"},{"location":"#7-superadmin-webapp-spa","title":"7. Superadmin Webapp (SPA)","text":"<p>Superadmin Webapp l\u00e0 \u1ee9ng d\u1ee5ng qu\u1ea3n tr\u1ecb t\u1eadp trung d\u00e0nh ri\u00eang cho \u0111\u1ed9i ng\u0169 qu\u1ea3n l\u00fd c\u1ea5p c\u00f4ng ty \u2013 n\u01a1i \u0111i\u1ec1u h\u00e0nh to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng dx-vas \u0111a tenant.</p>"},{"location":"#chuc-nang-chinh","title":"\ud83c\udfdb\ufe0f Ch\u1ee9c n\u0103ng ch\u00ednh","text":"<ul> <li>Qu\u1ea3n l\u00fd danh s\u00e1ch tenant (tr\u01b0\u1eddng th\u00e0nh vi\u00ean):</li> <li>T\u1ea1o/s\u1eeda tenant m\u1edbi, k\u00edch ho\u1ea1t/kh\u00f3a tenant</li> <li>C\u1ea5u h\u00ecnh k\u1ebft n\u1ed1i CRM/SIS/LMS cho t\u1eebng tenant</li> <li>G\u00e1n ng\u01b0\u1eddi d\u00f9ng v\u00e0o tenant:</li> <li>Ch\u1ecdn user t\u1eeb danh s\u00e1ch to\u00e0n c\u1ee5c</li> <li>Ch\u1ecdn tenant v\u00e0 g\u00e1n vai tr\u00f2 ban \u0111\u1ea7u</li> <li>G\u1eedi l\u1eddi m\u1eddi/OTP t\u1edbi ng\u01b0\u1eddi d\u00f9ng n\u1ebfu c\u1ea7n</li> <li>Qu\u1ea3n l\u00fd role/permission to\u00e0n h\u1ec7 th\u1ed1ng:</li> <li>X\u00e2y d\u1ef1ng Global Role/Permission Templates</li> <li>Xem c\u00e1c tenant \u0111ang d\u00f9ng template n\u00e0o</li> <li>Clone/c\u1eadp nh\u1eadt/c\u1ea3nh b\u00e1o n\u1ebfu tenant ch\u1ec9nh s\u1eeda v\u01b0\u1ee3t chu\u1ea9n</li> <li>Qu\u1ea3n l\u00fd th\u00f4ng tin \u0111\u1ecbnh danh ng\u01b0\u1eddi d\u00f9ng:</li> <li>T\u00ecm ki\u1ebfm user to\u00e0n h\u1ec7 th\u1ed1ng</li> <li>Ki\u1ec3m tra h\u1ecd thu\u1ed9c tenant n\u00e0o, vai tr\u00f2 g\u00ec, tr\u1ea1ng th\u00e1i</li> <li>V\u00f4 hi\u1ec7u h\u00f3a t\u00e0i kho\u1ea3n to\u00e0n c\u1ee5c ho\u1eb7c theo t\u1eebng tenant</li> <li>T\u1ed5ng h\u1ee3p v\u00e0 theo d\u00f5i th\u1ed1ng k\u00ea to\u00e0n h\u1ec7 th\u1ed1ng:</li> <li>S\u1ed1 l\u01b0\u1ee3ng h\u1ecdc sinh/nh\u00e2n s\u1ef1 theo t\u1eebng tenant</li> <li>Log ho\u1ea1t \u0111\u1ed9ng to\u00e0n h\u1ec7 th\u1ed1ng</li> <li>B\u00e1o c\u00e1o ph\u00e2n quy\u1ec1n, truy c\u1eadp, \u0111\u0103ng nh\u1eadp, chi ph\u00ed (n\u1ebfu c\u1ea7n)</li> </ul>"},{"location":"#cong-nghe-tich-hop","title":"\ud83d\udee0 C\u00f4ng ngh\u1ec7 &amp; t\u00edch h\u1ee3p","text":"<ul> <li>SPA ch\u1ea1y tr\u00ean domain ri\u00eang (<code>superadmin.truongvietanh.edu.vn</code>)</li> <li>\u0110\u0103ng nh\u1eadp qua Google OAuth2 (y\u00eau c\u1ea7u quy\u1ec1n <code>superadmin</code>)</li> <li>G\u1ecdi API tr\u1ef1c ti\u1ebfp \u0111\u1ebfn User Service Master, Auth Master, v\u00e0 c\u00e1c Tenant Registry Services</li> <li>K\u1ebft n\u1ed1i \u0111\u1ebfn c\u00e1c service qu\u1ea3n l\u00fd chi ph\u00ed, logging, audit t\u1eadp trung</li> </ul> <p>\ud83d\udcd8 C\u00e1c API \u0111\u01b0\u1ee3c m\u00f4 t\u1ea3 trong: <code>ic-superadmin-webapp.md</code></p>"},{"location":"#8-ha-tang-trien-khai","title":"8. H\u1ea1 t\u1ea7ng tri\u1ec3n khai","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\u00ean Google Cloud theo m\u00f4 h\u00ecnh multi-tenant t\u00e1ch bi\u1ec7t theo stack, k\u1ebft h\u1ee3p v\u1edbi c\u00e1c th\u00e0nh ph\u1ea7n d\u00f9ng chung \u0111\u1ec3 t\u1ed1i \u01b0u ho\u00e1 b\u1ea3o m\u1eadt, kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng v\u00e0 qu\u1ea3n tr\u1ecb t\u1eadp trung.</p>"},{"location":"#mo-hinh-trien-khai","title":"\ud83e\uddf1 M\u00f4 h\u00ecnh tri\u1ec3n khai","text":""},{"location":"#shared-core-dung-chung-toan-he-thong","title":"\ud83d\udccc Shared Core (d\u00f9ng chung to\u00e0n h\u1ec7 th\u1ed1ng)","text":"<ul> <li>API Gateway: Trung t\u00e2m \u0111i\u1ec1u ph\u1ed1i request, x\u00e1c th\u1ef1c, ph\u00e2n quy\u1ec1n \u0111\u1ed9ng RBAC.</li> <li>Auth Service Master: X\u1eed l\u00fd Google OAuth2, ph\u00e1t h\u00e0nh JWT \u0111a tenant.</li> <li>User Service Master: Qu\u1ea3n l\u00fd \u0111\u1ecbnh danh ng\u01b0\u1eddi d\u00f9ng to\u00e0n c\u1ee5c, tenant registry, RBAC templates.</li> <li>Superadmin Webapp: Qu\u1ea3n tr\u1ecb to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng (tenant, ng\u01b0\u1eddi d\u00f9ng, RBAC templates, b\u00e1o c\u00e1o).</li> <li>Shared Redis Cluster: Cache RBAC theo <code>user_id + tenant_id</code> (theo namespace).</li> <li>Monitoring &amp; Audit Stack: Logging, tracing, SLO cho to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng.</li> <li>Pub/Sub Bus: Truy\u1ec1n s\u1ef1 ki\u1ec7n t\u1eeb Master xu\u1ed1ng c\u00e1c tenant stack.</li> </ul>"},{"location":"#tenant-stack-trien-khai-rieng-biet-cho-tung-truong-thanh-vien","title":"\ud83c\udfeb Tenant Stack (tri\u1ec3n khai ri\u00eang bi\u1ec7t cho t\u1eebng tr\u01b0\u1eddng th\u00e0nh vi\u00ean)","text":"<p>M\u1ed7i tenant (tr\u01b0\u1eddng) \u0111\u01b0\u1ee3c tri\u1ec3n khai d\u01b0\u1edbi d\u1ea1ng m\u1ed9t stack ri\u00eang bi\u1ec7t tr\u00ean Google Cloud Run, bao g\u1ed3m:</p> <ul> <li>Frontend Apps ri\u00eang (PWA + Admin SPA):</li> <li>Ch\u1ea1y theo domain c\u1ee7a t\u1eebng tr\u01b0\u1eddng: <code>abc.truongvietanh.edu.vn</code>, <code>xyz.truongvietanh.edu.vn</code></li> <li>Sub Auth Service:</li> <li>X\u00e1c th\u1ef1c Local/OTP (ph\u1ee5 huynh, h\u1ecdc sinh) \u0111\u1ed9c l\u1eadp theo tenant</li> <li>Sub User Service:</li> <li>Qu\u1ea3n l\u00fd RBAC ri\u00eang, mapping \u0111\u1ebfn <code>user_id_global</code>, ki\u1ec3m so\u00e1t <code>is_active_in_tenant</code></li> <li>CRM/SIS/LMS Adapter ri\u00eang:</li> <li>K\u1ebft n\u1ed1i \u0111\u1ebfn h\u1ec7 th\u1ed1ng legacy c\u1ee7a t\u1eebng tr\u01b0\u1eddng (SuiteCRM, Gibbon, Moodle)</li> <li>Database ri\u00eang ho\u1eb7c schema ph\u00e2n v\u00f9ng (n\u1ebfu d\u00f9ng chung Cloud SQL)</li> <li>Logging ri\u00eang, gi\u00e1m s\u00e1t ri\u00eang theo <code>tenant_id</code> v\u00e0 <code>env</code></li> </ul>"},{"location":"#cau-truc-project-gcp-e-xuat","title":"\u2699\ufe0f C\u1ea5u tr\u00fac Project GCP \u0111\u1ec1 xu\u1ea5t","text":"Project M\u1ee5c \u0111\u00edch <code>dx-vas-core</code> Shared Core Services (API Gateway, Auth/User Master, PubSub, Redis...) <code>dx-vas-network</code> Shared VPC, NAT, DNS n\u1ed9i b\u1ed9 <code>dx-vas-tenant-abc</code> Stack ri\u00eang cho tenant ABC <code>dx-vas-tenant-xyz</code> Stack ri\u00eang cho tenant XYZ <code>dx-vas-monitoring</code> Stack t\u1eadp trung cho logging, metrics, alerting <code>dx-vas-data</code> Cloud SQL, GCS, BigQuery d\u00f9ng chung ho\u1eb7c ph\u00e2n v\u00f9ng"},{"location":"#cac-cong-nghe-ha-tang-su-dung","title":"\u2601\ufe0f C\u00e1c c\u00f4ng ngh\u1ec7 h\u1ea1 t\u1ea7ng s\u1eed d\u1ee5ng","text":"<ul> <li>Cloud Run: Tri\u1ec3n khai serverless cho t\u1ea5t c\u1ea3 services</li> <li>Cloud SQL: PostgreSQL (core), MySQL (adapter)</li> <li>Redis (MemoryStore): RBAC caching</li> <li>Cloud Pub/Sub: \u0110\u1ed3ng b\u1ed9 \u0111\u1ecbnh danh gi\u1eefa master \u2194 tenant</li> <li>Cloud Monitoring &amp; Logging: SLO/SLA tracking</li> <li>Terraform: M\u00f4 h\u00ecnh ho\u00e1 h\u1ea1 t\u1ea7ng theo module (<code>core</code>, <code>tenant</code>, <code>shared</code>)</li> </ul> <p>\ud83d\udcd8 S\u01a1 \u0111\u1ed3 tri\u1ec3n khai xem t\u1ea1i: \ud83d\udc49 Deployment Overview Diagram</p>"},{"location":"#9-admin-webapp-spa-cap-o-tenant","title":"9. Admin Webapp - SPA (c\u1ea5p \u0111\u1ed9 tenant)","text":"<p>Admin Webapp l\u00e0 \u1ee9ng d\u1ee5ng qu\u1ea3n tr\u1ecb n\u1ed9i b\u1ed9 d\u00e0nh ri\u00eang cho t\u1eebng tr\u01b0\u1eddng th\u00e0nh vi\u00ean (tenant). \u0110\u00e2y l\u00e0 giao di\u1ec7n ch\u00ednh \u0111\u1ec3 gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean v\u00e0 ban gi\u00e1m hi\u1ec7u qu\u1ea3n l\u00fd ho\u1ea1t \u0111\u1ed9ng h\u1ecdc t\u1eadp, v\u1eadn h\u00e0nh v\u00e0 ph\u1ed1i h\u1ee3p gi\u1eefa c\u00e1c b\u1ed9 ph\u1eadn trong tr\u01b0\u1eddng.</p>"},{"location":"#ac-iem","title":"\ud83e\udde9 \u0110\u1eb7c \u0111i\u1ec3m","text":"<ul> <li>Tri\u1ec3n khai \u0111\u1ed9c l\u1eadp cho t\u1eebng tenant:</li> <li>C\u00f3 domain ri\u00eang, v\u00ed d\u1ee5: <code>admin.abcschool.edu.vn</code>, <code>admin.xyzschool.edu.vn</code></li> <li> <p>K\u1ebft n\u1ed1i v\u1edbi c\u00e1c service backend ri\u00eang: CRM/SIS/LMS Adapter, Sub User Service, Sub Auth Service</p> </li> <li> <p>\u0110\u0103ng nh\u1eadp:</p> </li> <li>Nh\u00e2n vi\u00ean, gi\u00e1o vi\u00ean s\u1eed d\u1ee5ng Google OAuth2 (qua Auth Master)</li> <li>M\u1ed9t s\u1ed1 tenant c\u00f3 th\u1ec3 cho ph\u00e9p Local login (t\u00f9y c\u1ea5u h\u00ecnh Sub Auth Service)</li> </ul>"},{"location":"#chuc-nang-chinh-theo-vai-tro","title":"\ud83d\udee0 Ch\u1ee9c n\u0103ng ch\u00ednh theo vai tr\u00f2","text":"<ul> <li>Gi\u00e1o vi\u00ean:</li> <li>Qu\u1ea3n l\u00fd l\u1edbp gi\u1ea3ng d\u1ea1y, \u0111i\u1ec3m danh, nh\u1eadp \u0111i\u1ec3m</li> <li>Xem th\u1eddi kh\u00f3a bi\u1ec3u, nh\u1eadn th\u00f4ng b\u00e1o</li> <li> <p>G\u1eedi ph\u1ea3n h\u1ed3i t\u1edbi ph\u1ee5 huynh/h\u1ecdc sinh</p> </li> <li> <p>Nh\u00e2n vi\u00ean h\u1ecdc v\u1ee5 / k\u1ebf to\u00e1n:</p> </li> <li>Qu\u1ea3n l\u00fd h\u1ed3 s\u01a1 h\u1ecdc sinh</li> <li>C\u1eadp nh\u1eadt h\u1ecdc ph\u00ed, t\u00ecnh tr\u1ea1ng \u0111\u00f3ng ti\u1ec1n</li> <li> <p>Th\u1ed1ng k\u00ea s\u0129 s\u1ed1, \u0111i\u1ec3m s\u1ed1, b\u00e1o c\u00e1o \u0111\u1ecbnh k\u1ef3</p> </li> <li> <p>Admin tr\u01b0\u1eddng (BGH):</p> </li> <li>G\u00e1n vai tr\u00f2 cho nh\u00e2n s\u1ef1 trong tenant</li> <li>Qu\u1ea3n l\u00fd ph\u00e2n quy\u1ec1n n\u1ed9i b\u1ed9 (RBAC tenant)</li> <li>K\u1ebft n\u1ed1i CRM/SIS/LMS n\u1ebfu \u0111\u01b0\u1ee3c ph\u00e9p</li> <li>Theo d\u00f5i nh\u1eadt k\u00fd ho\u1ea1t \u0111\u1ed9ng c\u1ee7a user trong tr\u01b0\u1eddng</li> </ul>"},{"location":"#phan-quyen-bao-mat-noi-bo","title":"\ud83d\udd12 Ph\u00e2n quy\u1ec1n &amp; b\u1ea3o m\u1eadt n\u1ed9i b\u1ed9","text":"<ul> <li>D\u1ef1a tr\u00ean RBAC t\u1eeb Sub User Service, quy\u1ec1n \u0111\u01b0\u1ee3c c\u1ea5p theo vai tr\u00f2 trong t\u1eebng tenant</li> <li>Backend ch\u1ec9 x\u1eed l\u00fd request c\u00f3 <code>X-Tenant-ID</code>, <code>X-User-ID</code> v\u00e0 <code>X-Permissions</code> do API Gateway c\u1ea5p ph\u00e1t</li> <li>M\u1ecdi thao t\u00e1c qu\u1ea3n tr\u1ecb \u0111\u01b0\u1ee3c ghi log v\u00e0 trace theo <code>tenant_id</code> \u0111\u1ec3 ph\u1ee5c v\u1ee5 audit</li> </ul> <p>\ud83d\udcd8 C\u00e1c API backend s\u1eed d\u1ee5ng \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a t\u1ea1i: <code>user-service/interface-contract.md</code></p>"},{"location":"#10-customer-portal-pwa-cap-o-tenant","title":"10. Customer Portal - PWA (c\u1ea5p \u0111\u1ed9 tenant)","text":"<ul> <li>Giao di\u1ec7n cho ph\u1ee5 huynh v\u00e0 h\u1ecdc sinh.</li> <li>H\u1ed7 tr\u1ee3 OTP/Zalo login, c\u00e0i \u0111\u1eb7t tr\u00ean mobile, offline v\u1edbi cache g\u1ea7n nh\u1ea5t.</li> <li>Ch\u1ebf \u0111\u1ed9 offline ch\u1ec9 cho ph\u00e9p \u0111\u1ecdc d\u1eef li\u1ec7u \u0111\u00e3 \u0111\u01b0\u1ee3c cache tr\u01b0\u1edbc \u0111\u00f3.</li> <li>\u0110\u1ed3ng b\u1ed9 l\u1ea1i d\u1eef li\u1ec7u t\u1ef1 \u0111\u1ed9ng khi c\u00f3 k\u1ebft n\u1ed1i m\u1ea1ng.</li> </ul>"},{"location":"#11-crm-suitecrm-cap-o-tenant","title":"11. CRM \u2013 SuiteCRM (c\u1ea5p \u0111\u1ed9 tenant)","text":"<ul> <li>Qu\u1ea3n l\u00fd pipeline tuy\u1ec3n sinh.</li> <li>Khi ph\u1ee5 huynh \u0111\u0103ng k\u00fd nh\u1eadp h\u1ecdc th\u00e0nh c\u00f4ng \u2192 t\u1ef1 chuy\u1ec3n sang SIS.</li> <li>Giao ti\u1ebfp qua API Gateway, ki\u1ec3m so\u00e1t RBAC.</li> <li>K\u1ebf ho\u1ea1ch chuy\u1ec3n \u0111\u1ed5i c\u01a1 ch\u1ebf \u0111\u1ed3ng b\u1ed9 sang event-driven, d\u00f9ng Pub/Sub ho\u1eb7c Redis stream.</li> </ul>"},{"location":"#12-sis-gibbon-cap-o-tenant","title":"12. SIS \u2013 Gibbon (c\u1ea5p \u0111\u1ed9 tenant)","text":"<ul> <li>Qu\u1ea3n l\u00fd h\u1ecdc sinh, l\u1edbp, \u0111i\u1ec3m danh, h\u1ecdc ph\u00ed.</li> <li>C\u00f3 export API cho LMS, Portal, Admin Webapp.</li> <li>L\u01b0u v\u1ebft l\u1ecbch s\u1eed: h\u1ecdc l\u1ef1c, l\u1edbp h\u1ecdc, h\u1ecdc b\u1ea1.</li> <li>Li\u00ean k\u1ebft ph\u1ee5 huynh \u2013 h\u1ecdc sinh l\u01b0u trong b\u1ea3ng tham chi\u1ebfu.</li> </ul>"},{"location":"#13-lms-moodle-cap-o-tenant","title":"13. LMS \u2013 Moodle (c\u1ea5p \u0111\u1ed9 tenant)","text":"<ul> <li>H\u1ecdc t\u1eadp online, giao b\u00e0i, ch\u1ea5m \u0111i\u1ec3m.</li> <li>SSO v\u1edbi OAuth2.</li> <li>T\u1ef1 \u0111\u1ed9ng \u0111\u1ed3ng b\u1ed9 h\u1ecdc sinh t\u1eeb SIS.</li> <li>\u0110i\u1ec3m c\u00f3 th\u1ec3 \u0111\u1ea9y ng\u01b0\u1ee3c v\u1ec1 SIS.</li> </ul>"},{"location":"#14-notification-service","title":"14. Notification Service","text":"<ul> <li>G\u1eedi th\u00f4ng b\u00e1o Web, Email (Gmail API), Zalo OA, Google Chat.</li> <li>Ph\u1ee5 huynh nh\u1eadn th\u00f4ng b\u00e1o qua Zalo/Email.</li> <li>H\u1ecdc sinh, gi\u00e1o vi\u00ean nh\u1eadn qua WebPush/Google Chat.</li> <li>Ng\u01b0\u1eddi d\u00f9ng ch\u1ecdn k\u00eanh \u01b0a th\u00edch qua giao di\u1ec7n.</li> <li>T\u00edch h\u1ee3p A/B testing v\u00e0 tracking n\u1ebfu c\u1ea7n.</li> </ul>"},{"location":"#15-zalo-oa-google-chat","title":"15. Zalo OA &amp; Google Chat","text":"<ul> <li>G\u1eedi th\u00f4ng b\u00e1o h\u1ecdc ph\u00ed, s\u1ef1 ki\u1ec7n qua Zalo ZNS.</li> <li>G\u1eedi n\u1ed9i b\u1ed9 (gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean) qua Google Chat.</li> <li>C\u00f3 x\u1eed l\u00fd l\u1ed7i API, quota, timeout.</li> <li>D\u1ef1 ki\u1ebfn b\u1ed5 sung c\u01a1 ch\u1ebf retry v\u00e0 dashboard ki\u1ec3m tra tr\u1ea1ng th\u00e1i g\u1eedi.</li> </ul>"},{"location":"#16-cicd-devops","title":"16. CI/CD &amp; DevOps","text":"<ul> <li>GitHub Actions / Cloud Build \u2192 Cloud Run.</li> <li>Staging + production, rollback.</li> <li>Test t\u1ef1 \u0111\u1ed9ng: unit, integration, End-to-End (E2E), v\u00e0 contract testing (Pact).</li> <li>\u0110\u00e3 \u00e1p d\u1ee5ng ADR-003 \u2013 secrets \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd v\u00e0 rotate \u0111\u1ecbnh k\u1ef3 qua Secret Manager.</li> <li>D\u1ef1 ki\u1ebfn tri\u1ec3n khai Chaos Testing cho c\u00e1c d\u1ecbch v\u1ee5 quan tr\u1ecdng.</li> </ul>"},{"location":"#17-bao-mat-giam-sat","title":"17. B\u1ea3o m\u1eadt &amp; Gi\u00e1m s\u00e1t","text":"<ul> <li>M\u00e3 h\u00f3a d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m.</li> <li>Ch\u1ed1ng OWASP Top 10, bao g\u1ed3m CSRF, XSS, SQL Injection.</li> <li>Tri\u1ec3n khai x\u00e1c th\u1ef1c \u0111a y\u1ebfu t\u1ed1 (MFA) cho c\u00e1c t\u00e0i kho\u1ea3n qu\u1ea3n tr\u1ecb v\u00e0 nh\u00e2n vi\u00ean quy\u1ec1n cao.</li> <li>Gi\u00e1m s\u00e1t x\u00e1c th\u1ef1c ph\u1ee5 huynh (login rate, reset m\u1eadt kh\u1ea9u).</li> <li>Ghi log chi ti\u1ebft theo ng\u01b0\u1eddi d\u00f9ng, endpoint, tr\u1ea1ng th\u00e1i.</li> </ul>"},{"location":"#18-data-migration-plan","title":"18. Data Migration Plan","text":"<ul> <li> <p>N\u1ebfu c\u00f3 h\u1ec7 th\u1ed1ng c\u0169, d\u1eef li\u1ec7u s\u1ebd \u0111\u01b0\u1ee3c di chuy\u1ec3n theo l\u1ed9 tr\u00ecnh Blueprint r\u00f5 r\u00e0ng:</p> </li> <li> <p>Mapping b\u1ea3ng d\u1eef li\u1ec7u</p> </li> <li>Ki\u1ec3m tra ch\u1ea5t l\u01b0\u1ee3ng d\u1eef li\u1ec7u (data quality)</li> <li>Ki\u1ec3m th\u1eed tr\u01b0\u1edbc v\u00e0 sau khi migrate</li> <li>Rollback plan n\u1ebfu ph\u00e1t hi\u1ec7n l\u1ed7i</li> <li>H\u1ed7 tr\u1ee3 ch\u1ebf \u0111\u1ed9 song song (parallel run)</li> </ul>"},{"location":"#19-ao-tao-chuyen-giao","title":"19. \u0110\u00e0o t\u1ea1o &amp; Chuy\u1ec3n giao","text":"<ul> <li>M\u1ed7i nh\u00f3m ng\u01b0\u1eddi d\u00f9ng s\u1ebd c\u00f3 g\u00f3i \u0111\u00e0o t\u1ea1o ri\u00eang (nh\u00e2n vi\u00ean, gi\u00e1o vi\u00ean, h\u1ecdc sinh, ph\u1ee5 huynh).</li> <li> <p>T\u00e0i li\u1ec7u bao g\u1ed3m:</p> </li> <li> <p>Video ng\u1eafn</p> </li> <li>Handout d\u1ea1ng PDF</li> <li>Demo tr\u1ef1c ti\u1ebfp (live/recorded)</li> </ul>"},{"location":"#20-tong-ket","title":"20. T\u1ed5ng k\u1ebft","text":"<p>H\u1ec7 th\u1ed1ng chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf m\u1edf r\u1ed9ng linh ho\u1ea1t \u0111\u1ebfn 5260 ng\u01b0\u1eddi d\u00f9ng, h\u1ed7 tr\u1ee3 x\u00e1c th\u1ef1c ph\u00e2n t\u00e1ch gi\u1eefa ng\u01b0\u1eddi d\u00f9ng c\u00f3 Workspace (OAuth2) v\u00e0 ph\u1ee5 huynh (Local/OTP), \u0111\u1ea3m b\u1ea3o b\u1ea3o m\u1eadt, gi\u00e1m s\u00e1t, ph\u1ee5c h\u1ed3i th\u1ea3m h\u1ecda, \u0111\u00e0o t\u1ea1o v\u00e0 kh\u1ea3 n\u0103ng ph\u00e1t tri\u1ec3n d\u00e0i h\u1ea1n.</p> <p>To\u00e0n b\u1ed9 c\u00e1c ph\u1ea3n h\u1ed3i chi\u1ebfn l\u01b0\u1ee3c t\u1eeb anh Bill \u0111\u00e3 \u0111\u01b0\u1ee3c \u0111\u01b0a v\u00e0o k\u1ebf ho\u1ea1ch h\u00e0nh \u0111\u1ed9ng v\u00e0 roadmap tri\u1ec3n khai \u2013 \u0111\u1eb7c bi\u1ec7t c\u00e1c kh\u00eda c\u1ea1nh RBAC UI, Data Sync, OTP Security, Offline PWA, DR Planning v\u00e0 Data Migration \u0111\u00e3 \u0111\u01b0\u1ee3c chu\u1ea9n b\u1ecb c\u1ee5 th\u1ec3 v\u00e0 ghi nh\u1eadn trong README.md n\u00e0y nh\u01b0 m\u1ed9t t\u00e0i li\u1ec7u trung t\u00e2m s\u1ed1ng c\u1ee7a d\u1ef1 \u00e1n.</p>"},{"location":"#phu-luc-a-danh-sach-quyet-inh-kien-truc-adrs","title":"Ph\u1ee5 l\u1ee5c A \u2013 Danh s\u00e1ch Quy\u1ebft \u0111\u1ecbnh Ki\u1ebfn tr\u00fac (ADRs)","text":"<p>D\u1ef1 \u00e1n dx-vas s\u1eed d\u1ee5ng c\u00e1c Quy\u1ebft \u0111\u1ecbnh Ki\u1ebfn tr\u00fac (Architecture Decision Records - ADRs) \u0111\u1ec3 ghi l\u1ea1i nh\u1eefng l\u1ef1a ch\u1ecdn thi\u1ebft k\u1ebf quan tr\u1ecdng v\u1ec1 m\u1eb7t ki\u1ebfn tr\u00fac, bao g\u1ed3m l\u00fd do, b\u1ed1i c\u1ea3nh v\u00e0 c\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 \u0111\u01b0\u1ee3c c\u00e2n nh\u1eafc.</p> <p>\ud83d\udcd8 \u0110\u1ec3 xem danh s\u00e1ch \u0111\u1ea7y \u0111\u1ee7 v\u00e0 chi ti\u1ebft c\u00e1c ADRs \u0111\u00e3 \u0111\u01b0\u1ee3c ph\u00ea duy\u1ec7t, vui l\u00f2ng truy c\u1eadp: \ud83d\udc49 Danh s\u00e1ch ADRs c\u1ee7a d\u1ef1 \u00e1n</p>"},{"location":"#phu-luc-b-nguyen-tac-kien-truc-cot-loi","title":"Ph\u1ee5 l\u1ee5c B \u2013 Nguy\u00ean t\u1eafc Ki\u1ebfn tr\u00fac C\u1ed1t l\u00f5i","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf theo c\u00e1c nguy\u00ean t\u1eafc n\u1ec1n t\u1ea3ng \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o m\u1edf r\u1ed9ng linh ho\u1ea1t, b\u1ea3o m\u1eadt, t\u1ed1i \u01b0u tr\u1ea3i nghi\u1ec7m ng\u01b0\u1eddi d\u00f9ng v\u00e0 v\u1eadn h\u00e0nh b\u1ec1n v\u1eefng:</p> <ul> <li>UX-first: \u01afu ti\u00ean tr\u1ea3i nghi\u1ec7m ng\u01b0\u1eddi d\u00f9ng (\u0111\u1eb7c bi\u1ec7t ph\u1ee5 huynh kh\u00f4ng r\u00e0nh c\u00f4ng ngh\u1ec7)</li> <li>Modular-first: Thi\u1ebft k\u1ebf h\u1ec7 th\u1ed1ng d\u1ea1ng microservice \u2013 d\u1ec5 thay th\u1ebf, tri\u1ec3n khai ri\u00eang r\u1ebd</li> <li>Security-by-Design: T\u00edch h\u1ee3p b\u1ea3o m\u1eadt t\u1eeb \u0111\u1ea7u v\u00e0o thi\u1ebft k\u1ebf (CSRF, RBAC, MFA, k\u00fd \u0111\u1ecbnh danh)</li> <li>Data Consistency &gt; Availability: Trong m\u00f4i tr\u01b0\u1eddng gi\u00e1o d\u1ee5c, d\u1eef li\u1ec7u \u0111\u00fang quan tr\u1ecdng h\u01a1n ph\u1ea3n h\u1ed3i nhanh</li> <li>Infra-as-Code: H\u1ea1 t\u1ea7ng v\u00e0 CI/CD \u0111\u1ec1u \u0111\u01b0\u1ee3c m\u00f4 h\u00ecnh h\u00f3a, ki\u1ec3m so\u00e1t b\u1eb1ng m\u00e3 ngu\u1ed3n</li> </ul>"},{"location":"#bo-sung-nguyen-tac-cho-multi-tenant","title":"\u2728 B\u1ed5 sung nguy\u00ean t\u1eafc cho Multi-Tenant","text":"<ul> <li>Multi-Tenant by Isolation:</li> <li>M\u1ed7i tenant c\u00f3 frontend, adapters, auth v\u00e0 user service ri\u00eang</li> <li>Kh\u00f4ng chia s\u1ebb database n\u1ebfu kh\u00f4ng c\u00f3 c\u01a1 ch\u1ebf ph\u00e2n v\u00f9ng/tenant ID r\u00f5 r\u00e0ng</li> <li> <p>Cho ph\u00e9p m\u00f4 h\u00ecnh t\u00e1ch stack theo tenant, \u0111\u1ed3ng th\u1eddi t\u1eadn d\u1ee5ng t\u00e0i nguy\u00ean shared core</p> </li> <li> <p>Centralized Identity &amp; Governance:</p> </li> <li>M\u1ed9t User Service Master duy nh\u1ea5t l\u00e0 n\u01a1i ki\u1ec3m so\u00e1t \u0111\u1ecbnh danh ng\u01b0\u1eddi d\u00f9ng</li> <li>Superadmin c\u00f3 to\u00e0n quy\u1ec1n \u0111i\u1ec1u ph\u1ed1i, g\u00e1n ng\u01b0\u1eddi d\u00f9ng v\u00e0o c\u00e1c tenant, qu\u1ea3n l\u00fd templates RBAC</li> <li> <p>M\u1ecdi stack tenant ph\u1ea3i tu\u00e2n theo chu\u1ea9n JWT, RBAC schema v\u00e0 audit \u0111\u1ecbnh danh</p> </li> <li> <p>Pluggable Tenant Stack:</p> </li> <li>M\u1ed7i tenant l\u00e0 m\u1ed9t kh\u1ed1i \u0111\u1ed9c l\u1eadp c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c b\u1eadt/t\u1eaft/destroy m\u00e0 kh\u00f4ng \u1ea3nh h\u01b0\u1edfng h\u1ec7 th\u1ed1ng c\u00f2n l\u1ea1i</li> <li> <p>D\u1ec5 d\u00e0ng onboarding tenant m\u1edbi b\u1eb1ng quy tr\u00ecnh t\u1ef1 \u0111\u1ed9ng h\u00f3a Terraform + CI/CD</p> </li> <li> <p>Auditability &amp; Traceability Across Tenants:</p> </li> <li>M\u1ecdi action ph\u00e2n quy\u1ec1n, truy c\u1eadp, login ph\u1ea3i \u0111\u01b0\u1ee3c log theo <code>tenant_id</code> + <code>user_id</code></li> <li>C\u00e1c thay \u0111\u1ed5i RBAC, k\u00edch ho\u1ea1t/deactivate ng\u01b0\u1eddi d\u00f9ng \u0111\u01b0\u1ee3c trace to\u00e0n h\u1ec7 th\u1ed1ng</li> </ul> <p>\ud83d\udcd8 C\u00e1c quy\u1ebft \u0111\u1ecbnh ki\u1ebfn tr\u00fac li\u00ean quan \u0111\u01b0\u1ee3c m\u00f4 t\u1ea3 trong: - ADR-007: RBAC Strategy - ADR-006: Auth Strategy - ADR-019: GCP Project Layout - ADR-015: Deployment Strategy</p>"},{"location":"#phu-luc-c-so-o-kien-truc","title":"Ph\u1ee5 l\u1ee5c C \u2013 S\u01a1 \u0111\u1ed3 Ki\u1ebfn tr\u00fac","text":"<p>\ud83d\udcc1 C\u00e1c s\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac h\u1ec7 th\u1ed1ng \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef v\u00e0 c\u1eadp nh\u1eadt chi ti\u1ebft t\u1ea1i: \ud83d\udc49 System Diagrams</p> <p>T\u00e0i li\u1ec7u n\u00e0y bao g\u1ed3m: - S\u01a1 \u0111\u1ed3 t\u1ed5ng quan h\u1ec7 th\u1ed1ng - S\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac multi-tenant - C\u00e1c lu\u1ed3ng nghi\u1ec7p v\u1ee5 ch\u00ednh (tuy\u1ec3n sinh, th\u00f4ng b\u00e1o, ph\u00e2n quy\u1ec1n, x\u00e1c th\u1ef1c\u2026) - S\u01a1 \u0111\u1ed3 v\u00f2ng \u0111\u1eddi t\u00e0i kho\u1ea3n - S\u01a1 \u0111\u1ed3 tri\u1ec3n khai h\u1ea1 t\u1ea7ng tr\u00ean Google Cloud - Ch\u00fa gi\u1ea3i v\u00e0 h\u01b0\u1edbng d\u1eabn \u0111\u1ecdc s\u01a1 \u0111\u1ed3</p>"},{"location":"#so-o-tong-quan-kien-truc-multi-tenant","title":"\ud83e\udded S\u01a1 \u0111\u1ed3 t\u1ed5ng quan ki\u1ebfn tr\u00fac multi-tenant","text":"<pre><code>flowchart TD\n  subgraph Tenant_A[\"Tenant A Stack\"]\n    A_PWA[PWA A]\n    A_Admin[Admin SPA A]\n    A_Auth[Sub Auth A]\n    A_User[Sub User A]\n    A_CRM[CRM Adapter A]\n    A_SIS[SIS Adapter A]\n    A_LMS[LMS Adapter A]\n  end\n\n  subgraph Tenant_B[\"Tenant B Stack\"]\n    B_PWA[PWA B]\n    B_Admin[Admin SPA B]\n    B_Auth[Sub Auth B]\n    B_User[Sub User B]\n    B_CRM[CRM Adapter B]\n    B_SIS[SIS Adapter B]\n    B_LMS[LMS Adapter B]\n  end\n\n  subgraph Master[\"Shared Core Services\"]\n    Gateway[API Gateway]\n    AuthMaster[Auth Service Master]\n    UserMaster[User Service Master]\n    Superadmin[Superadmin Webapp]\n    Redis[Redis Cache]\n    PubSub[Pub/Sub]\n    Logging[Monitoring &amp; Audit]\n  end\n\n  A_PWA --&gt; Gateway\n  A_Admin --&gt; Gateway\n  B_PWA --&gt; Gateway\n  B_Admin --&gt; Gateway\n\n  Gateway --&gt; AuthMaster\n  Gateway --&gt; UserMaster\n  Gateway --&gt; Redis\n  Gateway --&gt; Logging\n\n  Gateway --&gt; A_Auth\n  Gateway --&gt; A_User\n  Gateway --&gt; A_CRM\n  Gateway --&gt; A_SIS\n  Gateway --&gt; A_LMS\n\n  Gateway --&gt; B_Auth\n  Gateway --&gt; B_User\n  Gateway --&gt; B_CRM\n  Gateway --&gt; B_SIS\n  Gateway --&gt; B_LMS\n\n  AuthMaster --&gt; UserMaster\n  A_Auth --&gt; UserMaster\n  B_Auth --&gt; UserMaster\n\n  Superadmin --&gt; UserMaster\n</code></pre> <p>\ud83d\udccc \u00dd ngh\u0129a s\u01a1 \u0111\u1ed3:</p> <ul> <li>Gateway l\u00e0 trung t\u00e2m \u0111i\u1ec1u ph\u1ed1i, ph\u00e2n quy\u1ec1n v\u00e0 \u0111\u1ecbnh tuy\u1ebfn theo <code>tenant_id</code>.</li> <li>M\u1ed7i tenant c\u00f3 stack ri\u00eang bi\u1ec7t ho\u00e0n to\u00e0n, \u0111\u1ed9c l\u1eadp v\u1ec1 frontend, adapters v\u00e0 ph\u00e2n quy\u1ec1n n\u1ed9i b\u1ed9.</li> <li>C\u00e1c kh\u1ed1i Master l\u00e0 d\u1ecbch v\u1ee5 d\u00f9ng chung, duy tr\u00ec t\u1eadp trung danh t\u00ednh, ph\u00e2n quy\u1ec1n m\u1eabu v\u00e0 \u0111i\u1ec1u ph\u1ed1i to\u00e0n h\u1ec7 th\u1ed1ng.</li> <li>Superadmin Webapp t\u01b0\u01a1ng t\u00e1c tr\u1ef1c ti\u1ebfp v\u1edbi c\u00e1c d\u1ecbch v\u1ee5 Master \u0111\u1ec3 \u0111i\u1ec1u h\u00e0nh to\u00e0n b\u1ed9 ki\u1ebfn tr\u00fac.</li> </ul> <p>\ud83d\udcd8 \u0110\u1ec3 xem \u0111\u1ea7y \u0111\u1ee7 c\u00e1c s\u01a1 \u0111\u1ed3 chi ti\u1ebft h\u01a1n (RBAC, Auth, Lifecycle, Sync...), truy c\u1eadp: system-diagrams.md</p>"},{"location":"#phu-luc-d-interface-contracts-ics","title":"Ph\u1ee5 l\u1ee5c D \u2013 Interface Contracts (ICs)","text":"<p>T\u1ea5t c\u1ea3 c\u00e1c d\u1ecbch v\u1ee5 trong h\u1ec7 th\u1ed1ng dx-vas \u0111\u1ec1u c\u00f3 t\u00e0i li\u1ec7u \u0111\u1ecbnh ngh\u0129a giao ti\u1ebfp (Interface Contracts), s\u1eed d\u1ee5ng \u0111\u1ecbnh d\u1ea1ng Markdown m\u00f4 t\u1ea3 OpenAPI ho\u1eb7c UI behavior.</p> <p>\ud83d\udcc1 C\u00e1c t\u00e0i li\u1ec7u IC \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef t\u1ea1i th\u01b0 m\u1ee5c: <code>interfaces</code></p> D\u1ecbch v\u1ee5 M\u00f4 t\u1ea3 File IC API Gateway C\u1ed5ng v\u00e0o trung t\u00e2m c\u1ee7a h\u1ec7 th\u1ed1ng, x\u1eed l\u00fd x\u00e1c th\u1ef1c v\u00e0 ki\u1ec3m tra RBAC <code>ic-01-api-gateway.md</code> Admin Webapp \u1ee8ng d\u1ee5ng qu\u1ea3n tr\u1ecb n\u1ed9i b\u1ed9 cho nh\u00e2n vi\u00ean v\u00e0 gi\u00e1o vi\u00ean <code>ic-02-admin-webapp.md</code> Customer Portal PWA d\u00e0nh cho ph\u1ee5 huynh v\u00e0 h\u1ecdc sinh <code>ic-03-customer-portal.md</code> Notification Service D\u1ecbch v\u1ee5 g\u1eedi th\u00f4ng b\u00e1o \u0111a k\u00eanh (Web, Email, Zalo, Chat) <code>ic-04-notification.md</code> CRM Adapter Giao ti\u1ebfp v\u1edbi SuiteCRM trong qu\u00e1 tr\u00ecnh tuy\u1ec3n sinh <code>ic-05-crm.md</code> SIS Adapter Giao ti\u1ebfp v\u1edbi h\u1ec7 th\u1ed1ng Gibbon SIS <code>ic-06-sis.md</code> LMS Adapter Giao ti\u1ebfp v\u1edbi h\u1ec7 th\u1ed1ng Moodle LMS <code>ic-07-lms.md</code> Auth Service D\u1ecbch v\u1ee5 x\u00e1c th\u1ef1c v\u00e0 ph\u00e1t h\u00e0nh token (OAuth2, OTP) <code>ic-08-auth-service.md</code> User Service Qu\u1ea3n l\u00fd ng\u01b0\u1eddi d\u00f9ng, ph\u00e2n quy\u1ec1n \u0111\u1ed9ng RBAC, tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng <code>ic-09-user-service.md</code> <p>\ud83d\udccc M\u1ed7i IC c\u00f3 th\u1ec3 bao g\u1ed3m: - M\u00f4 t\u1ea3 c\u00e1c API endpoint ho\u1eb7c UI behavior ch\u00ednh - C\u00e1c schema (request/response) - Quy t\u1eafc RBAC \u00e1p d\u1ee5ng n\u1ebfu c\u00f3 - Link tham chi\u1ebfu \u0111\u1ebfn c\u00e1c ADR ho\u1eb7c schema d\u00f9ng chung</p>"},{"location":"#phu-luc-e-huong-dan-ong-gop-phat-trien","title":"Ph\u1ee5 l\u1ee5c E \u2013 H\u01b0\u1edbng d\u1eabn \u0111\u00f3ng g\u00f3p &amp; ph\u00e1t tri\u1ec3n","text":"<ul> <li>Quy tr\u00ecnh pull request &amp; review code t\u1ea1i: <code>CONTRIBUTING.md</code></li> <li>Coding style: theo PEP8 + Black (Python), ESLint (JS)</li> <li>Test coverage y\u00eau c\u1ea7u: \u2265 85% unit, \u2265 70% integration</li> <li> <p>Lu\u1ed3ng CI/CD:</p> </li> <li> <p>Push code \u2192 CI ch\u1ea1y lint/test/scan</p> </li> <li>Merge v\u00e0o <code>dev</code> \u2192 Deploy Staging</li> <li>Merge v\u00e0o <code>main</code> \u2192 Require approval \u2192 Deploy Production</li> </ul>"},{"location":"ADR/","title":"\ud83d\udcd8 ADR Index \u2013 dx-vas","text":"<p>Danh s\u00e1ch v\u00e0 ph\u1ea1m vi \u00e1p d\u1ee5ng c\u1ee7a c\u00e1c Architecture Decision Records (ADR) cho h\u1ec7 th\u1ed1ng dx-vas. B\u1ea3ng d\u01b0\u1edbi \u0111\u00e2y li\u1ec7t k\u00ea t\u1eebng ADR, c\u00e1c service b\u1ecb \u1ea3nh h\u01b0\u1edfng v\u00e0 vai tr\u00f2/\u0111i\u1ec3m nh\u1ea5n tri\u1ec3n khai \u0111\u1eb7c bi\u1ec7t n\u1ebfu c\u00f3.</p> ADR \u00c1p d\u1ee5ng cho Service Vai tr\u00f2/\u0110i\u1ec3m nh\u1ea5n tri\u1ec3n khai ADR-001: CI/CD T\u1ea5t c\u1ea3 services \u2013 ADR-002: IaC T\u1ea5t c\u1ea3 services \u2013 ADR-003: Secrets T\u1ea5t c\u1ea3 services \u2013 ADR-004: Security T\u1ea5t c\u1ea3 services \u2705 API Gateway: rate-limiting, WAF; \u2705 Backend: sanitize input, secure dependencies ADR-005: Env Config T\u1ea5t c\u1ea3 services \u2013 ADR-006: Auth Strategy Auth Service, API Gateway \u2705 Auth Service: OTP &amp; OAuth flow; \u2705 API Gateway: validate &amp; inject header ADR-007: RBAC User Service, API Gateway \u2705 API Gateway: evaluate RBAC at runtime; \u2705 User Service: qu\u1ea3n l\u00fd d\u1eef li\u1ec7u RBAC ADR-008: Audit Logging T\u1ea5t c\u1ea3 services \u2705 User Service: expose /audit/logs; \u2705 Gateway &amp; Backend: log h\u00e0nh vi c\u00f3 side-effect ADR-009: API Governance T\u1ea5t c\u1ea3 services ph\u01a1i API \u2705 M\u1ed7i service ph\u1ea3i cung c\u1ea5p OpenAPI schema, \u0111\u01b0\u1ee3c ki\u1ec3m tra qua CI ADR-010: Contract Testing T\u1ea5t c\u1ea3 services ph\u01a1i API \u2013 ADR-011: API Error Format T\u1ea5t c\u1ea3 services ph\u01a1i API \u2013 ADR-012: Response Structure T\u1ea5t c\u1ea3 services ph\u01a1i API \u2013 ADR-013: Path Naming Convention T\u1ea5t c\u1ea3 services ph\u01a1i API \u2013 ADR-014: Zero Downtime Deployment T\u1ea5t c\u1ea3 services \u2705 Y\u00eau c\u1ea7u Backward Compatible schema, t\u00e1ch deploy &amp; migration ADR-015: Deployment Strategy T\u1ea5t c\u1ea3 services \u2013 ADR-016: Auto Scaling T\u1ea5t c\u1ea3 services \u2013 ADR-017: Env Deploy Boundary T\u1ea5t c\u1ea3 services \u2013 ADR-018: Release Approval Policy T\u1ea5t c\u1ea3 services \u2013 ADR-019: Project Layout T\u1ea5t c\u1ea3 services \u2013 ADR-020: Cost Observability T\u1ea5t c\u1ea3 services \u2013 ADR-021: External Observability T\u1ea5t c\u1ea3 services \u2013 ADR-022: SLA, SLO, Monitoring T\u1ea5t c\u1ea3 services \u2013 ADR-023: Schema Migration Strategy C\u00e1c service c\u00f3 qu\u1ea3n l\u00fd DB schema (User, Auth, SIS, LMS, CRM...) \u2705 Tu\u00e2n th\u1ee7 chi\u1ebfn l\u01b0\u1ee3c 3 b\u01b0\u1edbc (Prepare \u2013 Transition \u2013 Cleanup) v\u00e0 rollbackable ADR-024: Data Anonymization &amp; Retention T\u1ea5t c\u1ea3 services x\u1eed l\u00fd PII (User, Auth, SIS, LMS, CRM, Gateway...) \u2705 TTL policy, masking PII logs, anonymize sandbox <p>\ud83d\udd0e G\u1ee3i \u00fd s\u1eed d\u1ee5ng: N\u1ebfu b\u1ea1n tri\u1ec3n khai service m\u1edbi, h\u00e3y r\u00e0 so\u00e1t b\u1ea3ng n\u00e0y \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o service tu\u00e2n th\u1ee7 \u0111\u1ea7y \u0111\u1ee7 c\u00e1c ADR t\u01b0\u01a1ng \u1ee9ng v\u00e0 ghi r\u00f5 m\u1ecdi \u0111i\u1ec3m tri\u1ec3n khai \u0111\u1eb7c bi\u1ec7t (n\u1ebfu c\u00f3) trong Interface Contract.</p>"},{"location":"ADR/adr-001-ci-cd/","title":"Adr 001 ci cd","text":"<p>id: adr-001-ci-cd title: ADR-001: Chi\u1ebfn l\u01b0\u1ee3c CI/CD chung cho to\u00e0n h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS DevOps Team date: 2025-06-22 tags: [ci, cd, github-actions, cloud-run, dx-vas]</p>"},{"location":"ADR/adr-001-ci-cd/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS (dx-vas) bao g\u1ed3m nhi\u1ec1u th\u00e0nh ph\u1ea7n: - API Gateway - C\u00e1c backend service t\u00edch h\u1ee3p (CRM Adapter, SIS Adapter, Notification Service, LMS Proxy...) - Frontend (Admin Webapp, Customer Portal)</p> <p>C\u00e1c th\u00e0nh ph\u1ea7n n\u00e0y \u0111\u1ec1u \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\u00ean n\u1ec1n t\u1ea3ng Google Cloud Run, y\u00eau c\u1ea7u CI/CD: - T\u1ef1 \u0111\u1ed9ng build, test, scan b\u1ea3o m\u1eadt tr\u01b0\u1edbc khi deploy - Ph\u00e2n bi\u1ec7t r\u00f5 m\u00f4i tr\u01b0\u1eddng <code>dev</code>, <code>staging</code>, <code>production</code> - H\u1ea1n ch\u1ebf l\u1ed7i th\u1ee7 c\u00f4ng khi deploy th\u1ee7 c\u00f4ng ho\u1eb7c thi\u1ebfu test</p>"},{"location":"ADR/adr-001-ci-cd/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c CI/CD t\u1eadp trung s\u1eed d\u1ee5ng GitHub Actions, deploy c\u00e1c service dx-vas l\u00ean Cloud Run, ph\u00e2n t\u00e1ch branch theo m\u00f4i tr\u01b0\u1eddng v\u00e0 enforce ki\u1ec3m tra b\u1ea3o m\u1eadt/t\u00e0i li\u1ec7u tr\u01b0\u1edbc khi release.</p>"},{"location":"ADR/adr-001-ci-cd/#chi-tiet-thiet-ke","title":"\ud83d\udee0 Chi ti\u1ebft thi\u1ebft k\u1ebf","text":""},{"location":"ADR/adr-001-ci-cd/#1-branching-strategy","title":"1. Branching Strategy","text":"Branch M\u00f4i tr\u01b0\u1eddng Deploy t\u1ef1 \u0111\u1ed9ng <code>dev</code> Staging \u2705 C\u00f3 <code>main</code> Production \u2705 C\u00f3 (sau approval) <code>feature/*</code> Dev local/test \u274c Kh\u00f4ng"},{"location":"ADR/adr-001-ci-cd/#2-workflow-cicd-chuan","title":"2. Workflow CI/CD chu\u1ea9n","text":"<pre><code>on:\n  push:\n    branches: [dev, main]\n\njobs:\n  ci:\n    steps:\n      - Checkout, setup Python/NodeJS\n      - C\u00e0i \u0111\u1eb7t ph\u1ee5 thu\u1ed9c:\n        - N\u1ebfu d\u00f9ng `requirements.txt`: `pip install -r requirements.txt`\n        - N\u1ebfu d\u00f9ng Poetry: `poetry install`\n        - N\u1ebfu d\u00f9ng Pipenv: `pipenv install --dev`\n      - Ch\u1ea1y lint: `black`, `flake8`, `eslint`, `prettier`\n      - Ch\u1ea1y test + coverage: `pytest`, `jest`\n      - Ch\u1ea1y scan b\u1ea3o m\u1eadt: `bandit`, `safety`, `trivy`\n\n  cd:\n    needs: ci\n    steps:\n      - Build Docker image, tag theo `env`, `git_sha`\n      - Deploy Cloud Run b\u1eb1ng `gcloud deploy` ho\u1eb7c `google-github-actions`\n      - \u0110\u1eb7t `min-instances`, `concurrency`, `env var`, secret (qua Secret Manager)\n</code></pre>"},{"location":"ADR/adr-001-ci-cd/#3-secrets","title":"3. Secrets","text":"Lo\u1ea1i L\u01b0u \u1edf \u0111\u00e2u CI/CD secrets GitHub Secrets Runtime secrets Google Secret Manager"},{"location":"ADR/adr-001-ci-cd/#4-rule-bat-buoc","title":"4. Rule b\u1eaft bu\u1ed9c","text":"<ul> <li>\u2705 Pull Request ph\u1ea3i \u0111\u01b0\u1ee3c review</li> <li>\u2705 Ch\u1ea1y CI t\u1ef1 \u0111\u1ed9ng tr\u01b0\u1edbc merge</li> <li>\u2705 L\u1ed7i lint/test/security \u0111\u1ec1u ch\u1eb7n merge</li> <li>\u2705 Production deploy c\u1ea7n manual approval ho\u1eb7c protected branch</li> <li>\u2705 M\u1ecdi thay \u0111\u1ed5i h\u1ea1 t\u1ea7ng (Terraform) ph\u1ea3i ch\u1ea1y <code>terraform plan</code> qua CI v\u00e0 \u0111\u01b0\u1ee3c review tr\u01b0\u1edbc khi <code>apply</code></li> </ul>"},{"location":"ADR/adr-001-ci-cd/#5-template-thu-muc-ci-trong-moi-repo","title":"5. Template th\u01b0 m\u1ee5c CI trong m\u1ed7i repo","text":"<pre><code>.github/workflows/\n  ci.yml\n  deploy.yml\n  lint.yml (optional)\n</code></pre>"},{"location":"ADR/adr-001-ci-cd/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>T\u1ef1 \u0111\u1ed9ng ho\u00e1 quy tr\u00ecnh build/deploy to\u00e0n h\u1ec7 th\u1ed1ng</li> <li>Ph\u00e1t hi\u1ec7n l\u1ed7i s\u1edbm ngay khi commit</li> <li>Th\u1ed1ng nh\u1ea5t convention gi\u1eefa c\u00e1c team backend/frontend</li> <li>Gi\u1ea3m r\u1ee7i ro b\u1ea3o m\u1eadt v\u00e0 l\u1ed7i tri\u1ec3n khai production</li> </ul>"},{"location":"ADR/adr-001-ci-cd/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Qu\u00ean ch\u1ea1y test tr\u01b0\u1edbc khi merge CI t\u1ef1 \u0111\u1ed9ng enforce L\u1ed9 secrets qua log B\u1eadt masking, kh\u00f4ng echo gi\u00e1 tr\u1ecb nh\u1ea1y c\u1ea3m Deploy nh\u1ea7m m\u00f4i tr\u01b0\u1eddng T\u00e1ch r\u00f5 <code>dev</code>, <code>main</code>, y\u00eau c\u1ea7u approval cho <code>main</code>"},{"location":"ADR/adr-001-ci-cd/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Deploy th\u1ee7 c\u00f4ng: d\u1ec5 sai, kh\u00f4ng rollback</li> <li>Jenkins/GitLab CI: kh\u00f4ng \u0111\u1ed3ng b\u1ed9 v\u1edbi GitHub codebase</li> </ul>"},{"location":"ADR/adr-001-ci-cd/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Terraform module: <code>infra/modules/cloud_run_service</code></li> <li>IaC Terraform Strategy: ADR-002</li> </ul> <p>\"M\u1ed7i l\u1ea7n commit l\u00e0 m\u1ed9t l\u1eddi h\u1ee9a \u2013 CI/CD gi\u00fap \u0111\u1ea3m b\u1ea3o l\u1eddi h\u1ee9a \u0111\u00f3 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n.\"</p>"},{"location":"ADR/adr-002-iac/","title":"Adr 002 iac","text":"<p>id: adr-002-iac title: ADR-002: Chi\u1ebfn l\u01b0\u1ee3c H\u1ea1 t\u1ea7ng d\u01b0\u1edbi d\u1ea1ng M\u00e3 ngu\u1ed3n (Infrastructure as Code) cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS DevOps Team date: 2025-06-22 tags: [iac, terraform, infrastructure, dx-vas]</p>"},{"location":"ADR/adr-002-iac/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas bao g\u1ed3m nhi\u1ec1u th\u00e0nh ph\u1ea7n tri\u1ec3n khai tr\u00ean Google Cloud Platform (GCP):</p> <ul> <li>API Gateway</li> <li>Backend service (LMS Adapter, CRM Adapter, Notification Service)</li> <li>Frontend (Admin Webapp, Customer Portal)</li> <li>Database, Redis, Secret Manager, IAM, Monitoring</li> </ul> <p>Vi\u1ec7c tri\u1ec3n khai v\u00e0 c\u1ea5u h\u00ecnh c\u00e1c t\u00e0i nguy\u00ean h\u1ea1 t\u1ea7ng c\u1ea7n \u0111\u01b0\u1ee3c:</p> <ul> <li>T\u00e1i s\u1eed d\u1ee5ng v\u00e0 l\u1eb7p l\u1ea1i \u0111\u01b0\u1ee3c (reproducible)</li> <li>Theo d\u00f5i thay \u0111\u1ed5i qua Git (version control)</li> <li>T\u1ef1 \u0111\u1ed9ng h\u00f3a, ki\u1ec3m th\u1eed \u0111\u01b0\u1ee3c trong CI/CD</li> <li>Chia t\u00e1ch theo m\u00f4i tr\u01b0\u1eddng (<code>dev</code>, <code>staging</code>, <code>production</code>, <code>sandbox</code>)</li> </ul>"},{"location":"ADR/adr-002-iac/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng Terraform l\u00e0m c\u00f4ng c\u1ee5 ch\u00ednh qu\u1ea3n l\u00fd h\u1ea1 t\u1ea7ng dx-vas, v\u1edbi m\u00f4 h\u00ecnh t\u00e1ch module + m\u00f4i tr\u01b0\u1eddng, s\u1eed d\u1ee5ng th\u01b0 m\u1ee5c <code>envs/</code> \u0111\u1ec3 ch\u1ee9a c\u1ea5u h\u00ecnh theo m\u00f4i tr\u01b0\u1eddng, v\u00e0 CI pipeline ki\u1ec3m so\u00e1t apply, state v\u00e0 secrets an to\u00e0n.</p>"},{"location":"ADR/adr-002-iac/#cau-truc-e-xuat","title":"\ud83e\uddf1 C\u1ea5u tr\u00fac \u0111\u1ec1 xu\u1ea5t","text":"<pre><code>dx-vas/infrastructure/\n\u251c\u2500\u2500 modules/\n\u2502   \u251c\u2500\u2500 cloud_run_service/\n\u2502   \u251c\u2500\u2500 cloud_sql_instance/\n\u2502   \u251c\u2500\u2500 redis_instance/\n\u2502   \u251c\u2500\u2500 iam_roles/\n\u2502   \u251c\u2500\u2500 monitoring/\n\u2502   \u2514\u2500\u2500 storage/\n\u2502\n\u251c\u2500\u2500 envs/\n\u2502   \u251c\u2500\u2500 dev/\n\u2502   \u251c\u2500\u2500 staging/\n\u2502   \u251c\u2500\u2500 production/\n\u2502   \u2514\u2500\u2500 sandbox/\n\u2502\n\u251c\u2500\u2500 shared/\n\u2502   \u251c\u2500\u2500 dx-vas-network/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf           # Shared VPC, subnet, firewall, NAT\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf\n\u2502   \u251c\u2500\u2500 dx-vas-logging/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf           # Logging sinks, audit config, BigQuery export\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf\n\u2502   \u251c\u2500\u2500 dx-vas-data/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf           # Redis, Cloud SQL, BigQuery dataset\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf\n\u2502   \u251c\u2500\u2500 dns.tf                # DNS zones chung\n\u2502   \u2514\u2500\u2500 README.md\n\u2502\n\u251c\u2500\u2500 backend.tf     # c\u1ea5u h\u00ecnh state backend\n\u2514\u2500\u2500 README.md\n</code></pre> <p>\ud83d\udd01 M\u1ed7i th\u01b0 m\u1ee5c trong <code>envs/</code> g\u1ed3m <code>main.tf</code>, <code>variables.tf</code>, <code>outputs.tf</code>, v\u00e0 <code>*.tfvars</code>. Th\u01b0 m\u1ee5c <code>shared/</code> qu\u1ea3n l\u00fd h\u1ea1 t\u1ea7ng chia s\u1ebb \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng b\u1edfi nhi\u1ec1u m\u00f4i tr\u01b0\u1eddng ho\u1eb7c service, nh\u1ea5t qu\u00e1n v\u1edbi ADR-019.</p>"},{"location":"ADR/adr-002-iac/#nguyen-tac-su-dung","title":"\u2699\ufe0f Nguy\u00ean t\u1eafc s\u1eed d\u1ee5ng","text":"<ul> <li>T\u00e1ch module d\u00f9ng chung: c\u00e1c service ch\u1ec9 c\u1ea7n g\u1ecdi l\u1ea1i module v\u1edbi bi\u1ebfn ri\u00eang</li> <li>State file l\u01b0u GCS bucket (per env), c\u00f3 versioning v\u00e0 encryption</li> <li>Secrets kh\u00f4ng hard-code, \u0111\u01b0\u1ee3c inject qua CI/CD ho\u1eb7c GCP Secret Manager</li> <li>Terraform workspace \u0111\u01b0\u1ee3c d\u00f9ng th\u00eam n\u1ebfu m\u00f4i tr\u01b0\u1eddng c\u00f3 nhi\u1ec1u bi\u1ebfn t\u1ea1m</li> </ul>"},{"location":"ADR/adr-002-iac/#quan-ly-secrets","title":"\ud83d\udd10 Qu\u1ea3n l\u00fd secrets","text":"Lo\u1ea1i secret L\u01b0u \u1edf \u0111\u00e2u Truy c\u1eadp t\u1eeb Runtime token, DB URL GCP Secret Manager Cloud Run Service CI/CD secret GitHub Secrets Terraform apply CI"},{"location":"ADR/adr-002-iac/#quy-trinh-cicd","title":"\ud83d\udd04 Quy tr\u00ecnh CI/CD","text":"<ul> <li>Ch\u1ea1y <code>terraform validate</code>, <code>plan</code> \u2192 t\u1ea1o PR</li> <li>Artifact <code>.tfplan</code> \u0111\u01b0\u1ee3c l\u01b0u \u0111\u1ec3 review</li> <li><code>apply</code> t\u1ef1 \u0111\u1ed9ng cho <code>dev</code>, c\u1ea7n approval v\u1edbi <code>production</code></li> <li>Lint Terraform v\u1edbi <code>tflint</code>, ki\u1ec3m tra drift v\u1edbi <code>infracost</code>, <code>terraform-docs</code></li> </ul>"},{"location":"ADR/adr-002-iac/#chinh-sach-an-toan","title":"\ud83d\udccc Ch\u00ednh s\u00e1ch an to\u00e0n","text":"<ul> <li>\u2705 M\u1ecdi thay \u0111\u1ed5i h\u1ea1 t\u1ea7ng ph\u1ea3i \u0111\u01b0\u1ee3c review qua Pull Request</li> <li>\u2705 Kh\u00f4ng deploy th\u1eb3ng t\u1eeb m\u00e1y local l\u00ean production</li> <li>\u2705 C\u00f3 policy check v\u00e0 scan drift tr\u01b0\u1edbc apply (s\u1eed d\u1ee5ng <code>OPA</code> ho\u1eb7c <code>checkov</code> n\u1ebfu c\u1ea7n)</li> <li>\u2705 CI s\u1ebd b\u00e1o l\u1ed7i n\u1ebfu thi\u1ebfu tag/label quan tr\u1ecdng (<code>env</code>, <code>owner</code>, <code>component</code>...)</li> </ul>"},{"location":"ADR/adr-002-iac/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>T\u00e1i s\u1eed d\u1ee5ng \u0111\u01b0\u1ee3c h\u1ea1 t\u1ea7ng cho nhi\u1ec1u service</li> <li>Qu\u1ea3n l\u00fd r\u00f5 r\u00e0ng theo m\u00f4i tr\u01b0\u1eddng (c\u1ea5u h\u00ecnh, chi ph\u00ed, bi\u1ebfn runtime)</li> <li>Ki\u1ec3m so\u00e1t, rollback, v\u00e0 ki\u1ec3m to\u00e1n h\u1ea1 t\u1ea7ng nh\u01b0 code</li> <li>K\u1ebft n\u1ed1i CI/CD an to\u00e0n, tr\u00e1nh deploy sai c\u1ea5u h\u00ecnh</li> </ul>"},{"location":"ADR/adr-002-iac/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Qu\u00ean c\u1eadp nh\u1eadt <code>tfvars</code> cho m\u00f4i tr\u01b0\u1eddng m\u1edbi C\u00f3 template <code>.example.tfvars</code> v\u00e0 validate trong CI State b\u1ecb kho\u00e1 ho\u1eb7c m\u1ea5t \u0111\u1ed3ng b\u1ed9 Enable state lock, versioning trong GCS Drift do ch\u1ec9nh tay trong Console <code>terraform plan</code> + check drift + policy check CI"},{"location":"ADR/adr-002-iac/#phuong-an-khac-a-loai-bo","title":"\ud83d\udd04 Ph\u01b0\u01a1ng \u00e1n kh\u00e1c \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn GCP Console th\u1ee7 c\u00f4ng Kh\u00f4ng version control, d\u1ec5 sai l\u1ec7ch gi\u1eefa env Deployment Manager \u00cdt ph\u1ed5 bi\u1ebfn, h\u1ea1n ch\u1ebf c\u1ed9ng \u0111\u1ed3ng v\u00e0 t\u00e0i li\u1ec7u Pulumi M\u1ea1nh nh\u01b0ng y\u00eau c\u1ea7u h\u1ecdc SDK + kh\u00f4ng \u0111\u1ed3ng nh\u1ea5t trong team"},{"location":"ADR/adr-002-iac/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>CI/CD Strategy: ADR-001</li> <li>Secret Management: ADR-003</li> <li>Project Layout: ADR-019</li> </ul> <p>\u201cIaC kh\u00f4ng ch\u1ec9 l\u00e0 c\u00e1ch vi\u1ebft h\u1ea1 t\u1ea7ng \u2013 n\u00f3 l\u00e0 c\u00e1ch l\u00e0m ch\u1ee7 s\u1ef1 ph\u00e1t tri\u1ec3n c\u1ee7a to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-003-secrets/","title":"Adr 003 secrets","text":"<p>id: adr-003-secrets title: ADR-003: Chi\u1ebfn l\u01b0\u1ee3c Qu\u1ea3n l\u00fd v\u00e0 Xoay v\u00f2ng Secrets cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Security &amp; DevOps Team date: 2025-06-22 tags: [secrets, security, secret-rotation, dx-vas]</p>"},{"location":"ADR/adr-003-secrets/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas bao g\u1ed3m nhi\u1ec1u d\u1ecbch v\u1ee5 tri\u1ec3n khai tr\u00ean GCP nh\u01b0: - API Gateway - Backend Service (CRM Adapter, LMS Proxy, Notification Service, v.v.) - Frontend Webapp (Admin, Customer Portal) - CI/CD Pipeline (GitHub Actions)</p> <p>C\u00e1c d\u1ecbch v\u1ee5 n\u00e0y c\u1ea7n s\u1eed d\u1ee5ng secrets \u0111\u1ec3 k\u1ebft n\u1ed1i v\u1edbi: - Database (Cloud SQL), Redis - 3rd-party API (Zalo, Google OAuth, Firebase...) - H\u1ec7 th\u1ed1ng n\u1ed9i b\u1ed9 (SSO, webhook)</p> <p>N\u1ebfu secrets kh\u00f4ng \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd \u0111\u00fang c\u00e1ch (hardcoded, kh\u00f4ng xoay v\u00f2ng), h\u1ec7 th\u1ed1ng c\u00f3 th\u1ec3 g\u1eb7p r\u1ee7i ro b\u1ea3o m\u1eadt nghi\u00eam tr\u1ecdng.</p>"},{"location":"ADR/adr-003-secrets/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c qu\u1ea3n l\u00fd v\u00e0 xoay v\u00f2ng secrets t\u1eadp trung b\u1eb1ng Google Secret Manager v\u00e0 GitHub Secrets, ph\u00e2n t\u00e1ch r\u00f5 gi\u1eefa secrets runtime v\u00e0 CI/CD, \u0111\u1ecbnh k\u1ef3 rotate v\u00e0 ki\u1ec3m so\u00e1t audit.</p>"},{"location":"ADR/adr-003-secrets/#loai-secrets-va-noi-luu-tru","title":"\ud83d\udd10 Lo\u1ea1i secrets v\u00e0 n\u01a1i l\u01b0u tr\u1eef","text":"Lo\u1ea1i secrets V\u00ed d\u1ee5 L\u01b0u t\u1ea1i Runtime secrets DB password, JWT key, OAuth client ID/secret Google Secret Manager (per env) CI/CD secrets Terraform SA key, GitHub token, WIF config GitHub Secrets"},{"location":"ADR/adr-003-secrets/#cach-su-dung-secrets","title":"\ud83d\udce6 C\u00e1ch s\u1eed d\u1ee5ng secrets","text":""},{"location":"ADR/adr-003-secrets/#1-runtime-secrets-trong-cloud-run","title":"1. Runtime secrets trong Cloud Run","text":"<ul> <li>Inject t\u1eeb Google Secret Manager v\u00e0o bi\u1ebfn m\u00f4i tr\u01b0\u1eddng ho\u1eb7c file</li> <li>S\u1eed d\u1ee5ng Terraform \u0111\u1ec3 c\u1ea5u h\u00ecnh binding IAM v\u00e0 mount</li> <li>Cloud Run t\u1ef1 \u0111\u1ed9ng mount phi\u00ean b\u1ea3n m\u1edbi n\u1ebfu c\u00f3 update (optional warm reload logic)</li> </ul>"},{"location":"ADR/adr-003-secrets/#2-cicd-su-dung-secrets","title":"2. CI/CD s\u1eed d\u1ee5ng secrets","text":"<ul> <li>GitHub Actions \u0111\u1ecdc t\u1eeb GitHub Secrets:</li> <li><code>WIF_PROVIDER</code>, <code>WIF_SERVICE_ACCOUNT</code></li> <li><code>JWT_SIGNING_KEY</code>, <code>SLACK_WEBHOOK_URL</code></li> <li>Secrets kh\u00f4ng bao gi\u1edd \u0111\u01b0\u1ee3c ghi log ho\u1eb7c in ra output CI</li> </ul>"},{"location":"ADR/adr-003-secrets/#chinh-sach-xoay-vong-rotation-policy","title":"\ud83d\udd01 Ch\u00ednh s\u00e1ch xoay v\u00f2ng (Rotation Policy)","text":"Lo\u1ea1i secrets Chu k\u1ef3 xoay Ghi ch\u00fa DB password 90 ng\u00e0y Qua script t\u1ef1 \u0111\u1ed9ng ho\u1eb7c Cloud SQL IAM JWT signing key 30 ng\u00e0y H\u1ed7 tr\u1ee3 multiple keys &amp; forward compatibility OAuth/Zalo key 60\u201390 ng\u00e0y ho\u1eb7c khi revoke GitHub token 90 ng\u00e0y ho\u1eb7c khi b\u1ecb rotate b\u1edfi GitHub <ul> <li>Xoay v\u00f2ng \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n qua:</li> <li><code>gcloud secrets versions add</code></li> <li>Terraform apply m\u1edbi (chuy\u1ec3n secret version)</li> <li>G\u1eedi deploy m\u1edbi \u0111\u1ec3 mount l\u1ea1i secrets v\u00e0o Cloud Run</li> </ul>"},{"location":"ADR/adr-003-secrets/#tu-ong-hoa","title":"\u2795 T\u1ef1 \u0111\u1ed9ng ho\u00e1","text":"<ul> <li>S\u1eed d\u1ee5ng Cloud Scheduler + Pub/Sub \u0111\u1ec3 xoay \u0111\u1ecbnh k\u1ef3</li> <li>C\u00f3 th\u1ec3 vi\u1ebft bot CI t\u1ef1 \u0111\u1ed9ng rotate m\u1ed9t s\u1ed1 token OAuth expiring</li> </ul>"},{"location":"ADR/adr-003-secrets/#kiem-soat-audit","title":"\ud83d\udd0e Ki\u1ec3m so\u00e1t &amp; Audit","text":"<ul> <li>Audit access qua Cloud Audit Logs v\u00e0 <code>access logs</code> c\u1ee7a GitHub</li> <li>G\u1eafn tag secret theo: <code>env</code>, <code>application</code>, <code>rotation_policy</code></li> <li>CI/CD scan check trong pre-commit/CI:</li> <li>Kh\u00f4ng cho ph\u00e9p push hardcoded secret (d\u00f9ng <code>gitleaks</code>, <code>truffleHog</code>)</li> </ul>"},{"location":"ADR/adr-003-secrets/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>B\u1ea3o m\u1eadt t\u1eadp trung, d\u1ec5 ki\u1ec3m so\u00e1t quy\u1ec1n truy c\u1eadp theo m\u00f4i tr\u01b0\u1eddng</li> <li>D\u1ec5 d\u00e0ng thay th\u1ebf/revoke n\u1ebfu r\u00f2 r\u1ec9</li> <li>T\u0103ng kh\u1ea3 n\u0103ng tu\u00e2n th\u1ee7 c\u00e1c ti\u00eau chu\u1ea9n (OWASP, Google Cloud best practices)</li> <li>G\u1eafn ch\u1eb7t quy tr\u00ecnh security v\u1edbi CI/CD pipeline</li> </ul>"},{"location":"ADR/adr-003-secrets/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Qu\u00ean rotate secrets Alert sau 90 ng\u00e0y qua CI ho\u1eb7c secret label + audit log Secret b\u1ecb ghi log D\u00f9ng middleware log masking, CI block output ch\u1ee9a <code>TOKEN</code>, <code>SECRET</code> Secret b\u1ecb revoke nh\u01b0ng ch\u01b0a update Deploy m\u1ed7i l\u1ea7n rotate, h\u1ed7 tr\u1ee3 rollback version c\u0169 trong Secret Manager"},{"location":"ADR/adr-003-secrets/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn <code>.env</code> file trong Git repo R\u00f2 r\u1ec9 b\u1ea3o m\u1eadt, kh\u00f4ng ki\u1ec3m so\u00e1t ph\u00e2n quy\u1ec1n L\u01b0u t\u1ea5t c\u1ea3 secrets trong GitHub Secrets Kh\u00f4ng ph\u00f9 h\u1ee3p cho runtime GCP, kh\u00f4ng h\u1ed7 tr\u1ee3 IAM ri\u00eang theo env Kh\u00f4ng rotate Kh\u00f4ng tu\u00e2n th\u1ee7 zero-trust, r\u1ee7i ro khi credential b\u1ecb l\u1ed9"},{"location":"ADR/adr-003-secrets/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>CI/CD Strategy: ADR-001</li> <li>IaC Terraform Strategy: ADR-002</li> </ul> <p>\u201cKh\u00f4ng c\u00f3 secret n\u00e0o n\u00ean t\u1ed3n t\u1ea1i m\u00e3i m\u00e3i \u2013 rotate l\u00e0 c\u00e1ch b\u1ea1n b\u1ea3o v\u1ec7 h\u1ec7 th\u1ed1ng khi b\u1ea1n qu\u00ean r\u1eb1ng \u0111\u00e3 t\u1eebng \u0111\u1ec3 l\u1ed9 n\u00f3.\u201d</p>"},{"location":"ADR/adr-004-security/","title":"Adr 004 security","text":"<p>id: adr-004-security title: ADR-004: Chi\u1ebfn l\u01b0\u1ee3c B\u1ea3o m\u1eadt t\u1ed5ng th\u1ec3 cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Security Team date: 2025-06-22 tags: [security, hardening, dx-vas, cloud-run, jwt, rate-limiting]</p>"},{"location":"ADR/adr-004-security/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas g\u1ed3m nhi\u1ec1u th\u00e0nh ph\u1ea7n x\u1eed l\u00fd d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m nh\u01b0: - H\u1ecdc sinh, gi\u00e1o vi\u00ean, \u0111i\u1ec3m s\u1ed1, h\u1ecdc ph\u00ed (qua SIS, CRM, LMS) - D\u1eef li\u1ec7u c\u00e1 nh\u00e2n v\u00e0 h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng (qua frontend v\u00e0 API Gateway) - Giao ti\u1ebfp v\u1edbi b\u00ean th\u1ee9 ba (Zalo, OAuth, \u0111\u1ed1i t\u00e1c CRM)</p> <p>M\u1ecdi giao ti\u1ebfp \u0111\u1ec1u \u0111i qua c\u00e1c t\u1ea7ng public nh\u01b0 Cloud Run, Redis, frontend web, API Gateway\u2026 n\u00ean c\u1ea7n thi\u1ebft k\u1ebf chi\u1ebfn l\u01b0\u1ee3c b\u1ea3o m\u1eadt to\u00e0n di\u1ec7n, \u0111a l\u1edbp.</p>"},{"location":"ADR/adr-004-security/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c security hardening \u0111a t\u1ea7ng (transport, application, token, headers, logging, dependency, CI/CD), theo chu\u1ea9n OWASP v\u00e0 best practice c\u1ee7a Google Cloud.</p>"},{"location":"ADR/adr-004-security/#cac-lop-bao-ve","title":"\ud83d\udd10 C\u00e1c l\u1edbp b\u1ea3o v\u1ec7","text":""},{"location":"ADR/adr-004-security/#1-transport-layer","title":"1. Transport Layer","text":"<ul> <li>B\u1eaft bu\u1ed9c HTTPS tr\u00ean t\u1ea5t c\u1ea3 Cloud Run endpoint</li> <li>D\u00f9ng TLS 1.2+ v\u1edbi cert c\u1ee7a Google Managed</li> <li>Ch\u1eb7n HTTP fallback n\u1ebfu d\u00f9ng Cloud Load Balancer</li> </ul>"},{"location":"ADR/adr-004-security/#2-application-layer","title":"2. Application Layer","text":"<ul> <li>Sanitize input to\u00e0n b\u1ed9 qua Pydantic / frontend validator</li> <li>Gi\u1edbi h\u1ea1n k\u00edch th\u01b0\u1edbc request (body, file upload)</li> <li>T\u1eeb ch\u1ed1i content-type kh\u00f4ng h\u1ee3p l\u1ec7</li> <li>D\u00f9ng CSRF token n\u1ebfu c\u00f3 cookie-based auth (VD: frontend admin panel c\u00f3 form)</li> </ul>"},{"location":"ADR/adr-004-security/#3-token-session","title":"3. Token &amp; Session","text":"<ul> <li>S\u1eed d\u1ee5ng JWT v\u1edbi expiry ng\u1eafn (<code>15 ph\u00fat</code>)</li> <li>Refresh token l\u01b0u trong Secret Manager ho\u1eb7c DB, m\u00e3 ho\u00e1 tr\u01b0\u1edbc khi l\u01b0u</li> <li>Frontend kh\u00f4ng d\u00f9ng <code>localStorage</code> \u0111\u1ec3 l\u01b0u token \u2192 \u01b0u ti\u00ean <code>HttpOnly cookie</code> ho\u1eb7c <code>sessionStorage</code></li> <li>K\u00fd JWT b\u1eb1ng <code>HS256</code> ho\u1eb7c <code>ES256</code> v\u1edbi secret/key \u0111\u01b0\u1ee3c rotate \u0111\u1ecbnh k\u1ef3 (xem adr-003-secrets.md)</li> </ul>"},{"location":"ADR/adr-004-security/#4-rate-limiting-dos-protection","title":"4. Rate Limiting &amp; DoS protection","text":"<ul> <li>\u00c1p d\u1ee5ng rate limit theo user_id/IP b\u1eb1ng Redis (<code>slowapi</code> middleware)</li> <li>Cloud Armor b\u1ea3o v\u1ec7 \u1edf layer IP + Geo-based block</li> <li>C\u00f3 logic ph\u00e2n bi\u1ec7t gi\u1eefa role admin/internal v\u00e0 client</li> <li>Alert n\u1ebfu rate limit tr\u1ea3 429 &gt; 5% trong 5 ph\u00fat</li> </ul>"},{"location":"ADR/adr-004-security/#5-security-headers-qua-gateway-frontend","title":"5. Security Headers (qua Gateway / frontend)","text":"<ul> <li><code>Strict-Transport-Security</code></li> <li><code>X-Frame-Options: DENY</code></li> <li><code>X-Content-Type-Options: nosniff</code></li> <li><code>Referrer-Policy: no-referrer</code></li> <li><code>Permissions-Policy: geolocation=()</code></li> <li>(Optional n\u1ebfu HTML render): <code>Content-Security-Policy</code></li> </ul>"},{"location":"ADR/adr-004-security/#6-dependency-management","title":"6. Dependency Management","text":"<ul> <li>Lock phi\u00ean b\u1ea3n deps (<code>requirements.txt</code>, <code>package-lock.json</code>, <code>poetry.lock</code>)</li> <li>Scan b\u1ea3o m\u1eadt CI b\u1eb1ng <code>safety</code>, <code>bandit</code>, <code>npm audit</code>, <code>trivy</code></li> <li>Alert n\u1ebfu c\u00f3 CVE n\u1eb7ng qua Dependabot ho\u1eb7c GitHub CodeQL</li> </ul>"},{"location":"ADR/adr-004-security/#7-logging-monitoring","title":"7. Logging &amp; Monitoring","text":"<ul> <li>Tuy\u1ec7t \u0111\u1ed1i kh\u00f4ng log access token/refresh token</li> <li>Log structured c\u00f3 <code>request_id</code>, <code>user_id</code>, <code>path</code>, <code>latency</code>, <code>status</code></li> <li>D\u00f9ng masking v\u1edbi regex <code>.*(token|secret|key).*</code> \u0111\u1ec3 tr\u00e1nh r\u00f2 r\u1ec9</li> <li>Alert khi c\u00f3:</li> <li>\u0110\u0103ng nh\u1eadp th\u1ea5t b\u1ea1i nhi\u1ec1u l\u1ea7n</li> <li>Truy c\u1eadp tr\u00e1i ph\u00e9p RBAC</li> <li>T\u0103ng \u0111\u1ed9t bi\u1ebfn status 403/429/5xx</li> </ul>"},{"location":"ADR/adr-004-security/#8-cicd-pipeline","title":"8. CI/CD Pipeline","text":"<ul> <li>T\u1ea5t c\u1ea3 secrets qua <code>GitHub Secrets</code> v\u00e0 <code>Secret Manager</code></li> <li>Pre-commit ki\u1ec3m tra <code>TODO</code>, <code>print()</code>, debug, file <code>.env</code></li> <li>M\u1ecdi PR ph\u1ea3i pass lint + test + scan</li> <li>Production deploy y\u00eau c\u1ea7u approval manual</li> </ul>"},{"location":"ADR/adr-004-security/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>B\u1ea3o v\u1ec7 to\u00e0n b\u1ed9 d\u1eef li\u1ec7u h\u1ecdc sinh, ng\u01b0\u1eddi d\u00f9ng kh\u1ecfi r\u00f2 r\u1ec9 ho\u1eb7c t\u1ea5n c\u00f4ng</li> <li>\u0110\u00e1p \u1ee9ng y\u00eau c\u1ea7u b\u1ea3o m\u1eadt n\u1ed9i b\u1ed9, audit, v\u00e0 ti\u00eau chu\u1ea9n ng\u00e0nh</li> <li>Ph\u00e1t hi\u1ec7n s\u1edbm v\u00e0 ng\u0103n ch\u1eb7n h\u00e0nh vi \u0111\u00e1ng ng\u1edd</li> <li>\u0110\u1ed3ng b\u1ed9 h\u00f3a b\u1ea3o m\u1eadt gi\u1eefa backend, frontend v\u00e0 h\u1ea1 t\u1ea7ng</li> </ul>"},{"location":"ADR/adr-004-security/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p B\u1ecf s\u00f3t layer security trong service m\u1edbi Template <code>security.md</code> + checklist b\u1eaft bu\u1ed9c CI Token b\u1ecb leak qua log/debug Middleware masking + test CI block log l\u1ed7i ch\u1ee9a sensitive data Config b\u1ea3o m\u1eadt b\u1ecb override b\u1edfi dev Apply default via Terraform/Env, enforce trong review CI"},{"location":"ADR/adr-004-security/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn Kh\u00f4ng enforce rate limit D\u1ec5 b\u1ecb abuse ho\u1eb7c DDoS nh\u1eb9 Kh\u00f4ng rotate JWT secret Kh\u00f4ng tu\u00e2n th\u1ee7 zero-trust, risk n\u1ebfu secret b\u1ecb leak L\u01b0u token frontend b\u1eb1ng <code>localStorage</code> D\u1ec5 b\u1ecb XSS t\u1ea5n c\u00f4ng"},{"location":"ADR/adr-004-security/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Secrets: ADR-003</li> <li>IaC Terraform Strategy: ADR-002</li> <li>CI/CD Strategy: ADR-001</li> </ul> <p>\u201cSecurity kh\u00f4ng ph\u1ea3i l\u00e0 m\u1ed9t module \u2013 m\u00e0 l\u00e0 mindset to\u00e0n h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-005-env-config/","title":"Adr 005 env config","text":"<p>id: adr-005-env-config title: ADR-005: Chi\u1ebfn l\u01b0\u1ee3c C\u1ea5u h\u00ecnh \u0111a m\u00f4i tr\u01b0\u1eddng (Environment Configuration) cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS DevOps Team date: 2025-06-22 tags: [configuration, environment, dotenv, ci-cd, secrets, dx-vas]</p>"},{"location":"ADR/adr-005-env-config/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas v\u1eadn h\u00e0nh tr\u00ean nhi\u1ec1u m\u00f4i tr\u01b0\u1eddng:</p> <ul> <li><code>dev</code>: ph\u00e1t tri\u1ec3n t\u00ednh n\u0103ng, ki\u1ec3m th\u1eed local</li> <li><code>staging</code>: ki\u1ec3m th\u1eed t\u00edch h\u1ee3p, demo n\u1ed9i b\u1ed9</li> <li><code>production</code>: m\u00f4i tr\u01b0\u1eddng ch\u00ednh th\u1ee9c v\u1edbi ng\u01b0\u1eddi d\u00f9ng th\u1ef1c</li> <li><code>sandbox</code>: th\u1eed nghi\u1ec7m \u0111\u1ed9c l\u1eadp, testing API c\u00f4ng khai</li> </ul> <p>M\u1ed7i m\u00f4i tr\u01b0\u1eddng y\u00eau c\u1ea7u c\u1ea5u h\u00ecnh ri\u00eang bi\u1ec7t cho:</p> <ul> <li>Bi\u1ebfn m\u00f4i tr\u01b0\u1eddng: URL backend, CORS, log level, feature flag</li> <li>Secrets: DB password, API token, JWT key</li> <li>Qu\u1ea3n l\u00fd trong CI/CD v\u00e0 Terraform r\u00f5 r\u00e0ng</li> </ul>"},{"location":"ADR/adr-005-env-config/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c c\u1ea5u h\u00ecnh theo m\u00f4i tr\u01b0\u1eddng s\u1eed d\u1ee5ng file <code>.env</code>, bi\u1ebfn h\u1ec7 th\u1ed1ng, v\u00e0 secrets t\u1eeb Secret Manager/GitHub Secrets, \u0111\u1ea3m b\u1ea3o t\u00e1ch bi\u1ec7t, d\u1ec5 ki\u1ec3m so\u00e1t v\u00e0 t\u1ef1 \u0111\u1ed9ng ho\u00e1.</p>"},{"location":"ADR/adr-005-env-config/#cau-truc-e-xuat","title":"\ud83d\udcc1 C\u1ea5u tr\u00fac \u0111\u1ec1 xu\u1ea5t","text":"<p>Chi\u1ebfn l\u01b0\u1ee3c qu\u1ea3n l\u00fd file c\u1ea5u h\u00ecnh \u0111\u01b0\u1ee3c \u00e1p d\u1ee5ng cho t\u1eebng repository c\u1ee7a m\u1ed7i service/\u1ee9ng d\u1ee5ng con:</p> <p>Ph\u01b0\u01a1ng \u00e1n: S\u1eed d\u1ee5ng th\u01b0 m\u1ee5c con <code>config/</code> b\u00ean trong m\u1ed7i service (\u0111\u01b0\u1ee3c \u01b0u ti\u00ean \u0111\u1ec3 gi\u1eef th\u01b0 m\u1ee5c g\u1ed1c s\u1ea1ch s\u1ebd v\u00e0 d\u1ec5 m\u1edf r\u1ed9ng khi s\u1ed1 l\u01b0\u1ee3ng file c\u1ea5u h\u00ecnh t\u0103ng):</p> <pre><code># V\u00ed d\u1ee5, trong repo c\u1ee7a API Gateway (api_gateway/):\nconfig/\n  \u251c\u2500\u2500 base.env       # Bi\u1ebfn chung cho service (kh\u00f4ng nh\u1ea1y c\u1ea3m)\n  \u251c\u2500\u2500 dev.env        # Override cho dev (kh\u00f4ng commit n\u1ebfu ch\u1ee9a secret)\n  \u251c\u2500\u2500 staging.env    # Override cho staging (kh\u00f4ng commit n\u1ebfu ch\u1ee9a secret)\n  \u2514\u2500\u2500 production.env # Override cho production (kh\u00f4ng commit n\u1ebfu ch\u1ee9a secret)\n.env.example          # Template \u1edf g\u1ed1c\n</code></pre> <ul> <li><code>base.env</code>: ch\u1ee9a c\u00e1c bi\u1ebfn c\u1ea5u h\u00ecnh chung cho service \u0111\u00f3, kh\u00f4ng ph\u1ea3i to\u00e0n h\u1ec7 th\u1ed1ng dx-vas</li> <li>C\u00e1c file <code>.env.{ENVIRONMENT}</code> ho\u1eb7c <code>{environment}.env</code>: ch\u1ee9a c\u00e1c gi\u00e1 tr\u1ecb override c\u1ee5 th\u1ec3 cho t\u1eebng m\u00f4i tr\u01b0\u1eddng</li> <li>D\u00f9ng v\u1edbi <code>python-dotenv</code>, <code>pydantic-settings</code>, ho\u1eb7c <code>dotenv</code> c\u1ee7a NodeJS</li> <li>Kh\u00f4ng commit <code>.env</code> ch\u1ee9a secrets \u2013 s\u1eed d\u1ee5ng placeholder ho\u1eb7c <code>.example.env</code></li> </ul>"},{"location":"ADR/adr-005-env-config/#bien-moi-truong-quan-trong","title":"\ud83d\udce6 Bi\u1ebfn m\u00f4i tr\u01b0\u1eddng quan tr\u1ecdng","text":"Bi\u1ebfn \u00dd ngh\u0129a <code>ENV</code> <code>dev</code>, <code>staging</code>, <code>production</code>, <code>sandbox</code> <code>BACKEND_URL_CRM</code> endpoint t\u00edch h\u1ee3p CRM <code>JWT_SECRET</code> key k\u00fd access token (inject t\u1eeb Secret Manager) <code>LOG_LEVEL</code> <code>debug</code> / <code>info</code> / <code>warning</code> <code>FEATURE_X_ENABLED</code> <code>true/false</code> \u2013 b\u1eadt feature theo env"},{"location":"ADR/adr-005-env-config/#cach-nap-cau-hinh","title":"\ud83d\udd27 C\u00e1ch n\u1ea1p c\u1ea5u h\u00ecnh","text":"<p>Th\u1ee9 t\u1ef1 \u01b0u ti\u00ean khi load config:</p> <ol> <li>Bi\u1ebfn m\u00f4i tr\u01b0\u1eddng t\u1eeb h\u1ec7 th\u1ed1ng (<code>os.environ</code>) ho\u1eb7c CI/CD inject</li> <li>File <code>config/{ENV}.env</code> n\u1ebfu ch\u1ea1y local</li> <li>M\u1eb7c \u0111\u1ecbnh trong m\u00e3 ngu\u1ed3n (n\u1ebfu kh\u00f4ng ph\u1ea3i secret)</li> </ol> <p>Khi l\u1eadp tr\u00ecnh vi\u00ean ch\u1ea1y local t\u1eeb nh\u00e1nh <code>feature/*</code> ho\u1eb7c <code>dev</code>, c\u00f3 th\u1ec3 \u0111\u1eb7t <code>ENV=dev</code> \u0111\u1ec3 s\u1eed d\u1ee5ng c\u1ea5u h\u00ecnh trong <code>config/dev.env</code>. N\u1ebfu mu\u1ed1n m\u00f4 ph\u1ecfng g\u1ea7n v\u1edbi m\u00f4i tr\u01b0\u1eddng staging, c\u00f3 th\u1ec3 \u0111\u1eb7t <code>ENV=staging</code> \u0111\u1ec3 ki\u1ec3m th\u1eed v\u1edbi c\u1ea5u h\u00ecnh staging.</p> <p>Framework \u0111\u1ec1 xu\u1ea5t:</p> <ul> <li>Python: <code>pydantic.BaseSettings</code></li> <li>NodeJS: <code>dotenv</code> + <code>envsafe</code></li> <li>Frontend: Next.js d\u00f9ng <code>.env.local</code>, <code>.env.production</code></li> </ul>"},{"location":"ADR/adr-005-env-config/#secrets-tach-biet-khoi-env","title":"\ud83d\udd10 Secrets t\u00e1ch bi\u1ec7t kh\u1ecfi <code>.env</code>","text":"<ul> <li> <p>Secrets nh\u1ea1y c\u1ea3m kh\u00f4ng l\u01b0u trong <code>.env</code> m\u00e0 \u0111\u01b0\u1ee3c mount t\u1eeb:</p> </li> <li> <p>GCP Secret Manager (runtime)</p> </li> <li>GitHub Secrets (CI/CD)</li> <li>Terraform <code>TF_VAR_</code> inject</li> </ul>"},{"location":"ADR/adr-005-env-config/#trong-cicd","title":"\ud83d\udee0 Trong CI/CD","text":"<ul> <li> <p>CI x\u00e1c \u0111\u1ecbnh gi\u00e1 tr\u1ecb cho bi\u1ebfn <code>ENV</code> (\u0111\u1ec3 load \u0111\u00fang file c\u1ea5u h\u00ecnh) v\u00e0 m\u00f4i tr\u01b0\u1eddng tri\u1ec3n khai d\u1ef1a tr\u00ean nh\u00e1nh:</p> </li> <li> <p>Khi CI ch\u1ea1y tr\u00ean nh\u00e1nh <code>dev</code>:</p> <ul> <li>S\u1ebd deploy l\u00ean m\u00f4i tr\u01b0\u1eddng Staging.</li> <li>Bi\u1ebfn <code>ENV</code> \u0111\u01b0\u1ee3c thi\u1ebft l\u1eadp l\u00e0 <code>staging</code> \u0111\u1ec3 load <code>config/staging.env</code>.</li> <li> <p>Khi CI ch\u1ea1y tr\u00ean nh\u00e1nh <code>main</code>:</p> </li> <li> <p>S\u1ebd deploy l\u00ean m\u00f4i tr\u01b0\u1eddng Production (sau khi c\u00f3 ph\u00ea duy\u1ec7t).</p> </li> <li>Bi\u1ebfn <code>ENV</code> \u0111\u01b0\u1ee3c thi\u1ebft l\u1eadp l\u00e0 <code>production</code> \u0111\u1ec3 load <code>config/production.env</code>.</li> <li> <p>Khi ch\u1ea1y local tr\u00ean m\u00e1y l\u1eadp tr\u00ecnh vi\u00ean (v\u00ed d\u1ee5 t\u1eeb nh\u00e1nh <code>feature/*</code> ho\u1eb7c <code>dev</code>):</p> </li> <li> <p>Bi\u1ebfn <code>ENV</code> c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c \u0111\u1eb7t l\u00e0 <code>dev</code> \u0111\u1ec3 load <code>config/dev.env</code> ph\u1ee5c v\u1ee5 ph\u00e1t tri\u1ec3n v\u00e0 ki\u1ec3m th\u1eed c\u1ee5c b\u1ed9.</p> </li> </ul> </li> <li> <p>CI s\u1ebd inject c\u00e1c bi\u1ebfn c\u1ea5u h\u00ecnh v\u00e0o m\u00f4i tr\u01b0\u1eddng Cloud Run d\u1ef1a tr\u00ean gi\u00e1 tr\u1ecb <code>ENV</code>, \u01b0u ti\u00ean secrets t\u1eeb Secret Manager v\u00e0 c\u00e1c bi\u1ebfn m\u00f4i tr\u01b0\u1eddng t\u1eeb pipeline.</p> </li> </ul>"},{"location":"ADR/adr-005-env-config/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>C\u1ea5u h\u00ecnh r\u00f5 r\u00e0ng theo m\u00f4i tr\u01b0\u1eddng</li> <li>D\u1ec5 debug v\u00e0 ch\u1ea1y local gi\u1ed1ng production</li> <li>Kh\u00f4ng r\u00f2 r\u1ec9 secrets nh\u1ea1y c\u1ea3m</li> <li>D\u1ec5 t\u00edch h\u1ee3p v\u00e0o Terraform v\u00e0 Cloud Run deployment</li> </ul>"},{"location":"ADR/adr-005-env-config/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Commit nh\u1ea7m file <code>.env</code> D\u00f9ng <code>.gitignore</code>, CI scan block file Thi\u1ebfu key c\u1ea5u h\u00ecnh g\u00e2y l\u1ed7i runtime Script validate schema + fallback m\u1eb7c \u0111\u1ecbnh an to\u00e0n Config b\u1ecb leak qua log CI Mask bi\u1ebfn m\u00f4i tr\u01b0\u1eddng ch\u1ee9a <code>SECRET</code>, <code>TOKEN</code>, <code>KEY</code>"},{"location":"ADR/adr-005-env-config/#cac-phuong-an-a-loai-bo","title":"\ud83d\udd04 C\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn Hardcode config trong code Kh\u00f3 thay \u0111\u1ed5i, kh\u00f4ng ph\u00f9 h\u1ee3p CI/CD D\u00f9ng chung <code>.env</code> m\u1ecdi m\u00f4i tr\u01b0\u1eddng D\u1ec5 ghi \u0111\u00e8 sai env, thi\u1ebfu t\u00e1ch bi\u1ec7t Config to\u00e0n b\u1ed9 qua Terraform Kh\u00f4ng ph\u00f9 h\u1ee3p frontend, kh\u00f3 debug local"},{"location":"ADR/adr-005-env-config/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Secrets: ADR-003</li> <li>IaC Terraform Strategy: ADR-002</li> <li>CI/CD Strategy: ADR-001</li> </ul> <p>\u201cM\u1ed9t h\u1ec7 th\u1ed1ng ch\u1ea1y t\u1ed1t tr\u00ean production \u2013 l\u00e0 h\u1ec7 th\u1ed1ng c\u00f3 c\u1ea5u h\u00ecnh r\u00f5 r\u00e0ng t\u1eeb \u0111\u1ea7u.\u201d</p>"},{"location":"ADR/adr-006-auth-strategy/","title":"Adr 006 auth strategy","text":"<p>id: adr-006-auth-strategy title: ADR-006: Chi\u1ebfn l\u01b0\u1ee3c x\u00e1c th\u1ef1c ng\u01b0\u1eddi d\u00f9ng (Authentication) cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [auth, security, dx-vas, oauth2, otp]</p>"},{"location":"ADR/adr-006-auth-strategy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas ph\u1ee5c v\u1ee5 nhi\u1ec1u nh\u00f3m ng\u01b0\u1eddi d\u00f9ng: - Gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean tr\u01b0\u1eddng h\u1ecdc (n\u1ed9i b\u1ed9 VAS) - H\u1ecdc sinh (s\u1eed d\u1ee5ng d\u1ecbch v\u1ee5 h\u1ecdc t\u1eadp) - Ph\u1ee5 huynh (theo d\u00f5i k\u1ebft qu\u1ea3 h\u1ecdc t\u1eadp, nh\u1eadn th\u00f4ng b\u00e1o)</p> <p>Google Workspace for Education hi\u1ec7n \u0111\u01b0\u1ee3c c\u1ea5p cho h\u1ecdc sinh, gi\u00e1o vi\u00ean v\u00e0 nh\u00e2n vi\u00ean, nh\u01b0ng kh\u00f4ng c\u1ea5p cho ph\u1ee5 huynh. Do \u0111\u00f3, c\u1ea7n c\u00f3 c\u01a1 ch\u1ebf x\u00e1c th\u1ef1c ph\u00f9 h\u1ee3p cho t\u1eebng nh\u00f3m ng\u01b0\u1eddi d\u00f9ng.</p>"},{"location":"ADR/adr-006-auth-strategy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u00e1p d\u1ee5ng c\u01a1 ch\u1ebf x\u00e1c th\u1ef1c ph\u00e2n bi\u1ec7t theo nh\u00f3m ng\u01b0\u1eddi d\u00f9ng: - OAuth2 (Google) cho h\u1ecdc sinh, gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean n\u1ed9i b\u1ed9 - Email ho\u1eb7c S\u0110T + OTP (Firebase ho\u1eb7c custom OTP backend) cho ph\u1ee5 huynh</p> <p>Quy\u1ebft \u0111\u1ecbnh kh\u00f4ng embed <code>permissions</code> v\u00e0o JWT access token \u0111\u1ec3 tr\u00e1nh t\u0103ng k\u00edch th\u01b0\u1edbc v\u00e0 r\u1ee7i ro stale data. C\u00e1c quy\u1ec1n \u0111\u01b0\u1ee3c tra c\u1ee9u t\u1eeb Redis ho\u1eb7c DB trong m\u1ed7i request n\u1ebfu c\u1ea7n, v\u00e0 \u0111\u01b0\u1ee3c forward d\u01b0\u1edbi d\u1ea1ng <code>X-Permissions</code> t\u1eeb API Gateway.</p>"},{"location":"ADR/adr-006-auth-strategy/#chi-tiet-chien-luoc-xac-thuc","title":"\ud83d\udd10 Chi ti\u1ebft chi\u1ebfn l\u01b0\u1ee3c x\u00e1c th\u1ef1c","text":""},{"location":"ADR/adr-006-auth-strategy/#1-oauth2-google-workspace-education-lam-identity-provider","title":"1. OAuth2 (Google Workspace Education) l\u00e0m Identity Provider","text":"<ul> <li>\u00c1p d\u1ee5ng cho: h\u1ecdc sinh, gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean</li> <li>S\u1eed d\u1ee5ng OAuth2 standard flow</li> <li>M\u1ed7i l\u1ea7n \u0111\u0103ng nh\u1eadp t\u1ea1o JWT access token + refresh token</li> <li>Refresh token TTL: 30\u201390 ng\u00e0y t\u00f9y lo\u1ea1i user, l\u01b0u Redis ho\u1eb7c DB (theo adr-024)</li> </ul>"},{"location":"ADR/adr-006-auth-strategy/#2-xac-thuc-phu-huynh-khong-dung-google","title":"2. X\u00e1c th\u1ef1c ph\u1ee5 huynh (Kh\u00f4ng d\u00f9ng Google)","text":"<ul> <li>\u00c1p d\u1ee5ng cho: ph\u1ee5 huynh</li> <li>Do kh\u00f4ng c\u00f3 Google Workspace Account \u2192 s\u1eed d\u1ee5ng Email ho\u1eb7c Phone + OTP</li> <li>T\u00f9y ch\u1ecdn provider:</li> <li>Firebase Auth (email OTP, phone OTP)</li> <li>Custom OTP API t\u00edch h\u1ee3p Zalo OA ho\u1eb7c SMS Gateway</li> <li>Sau x\u00e1c th\u1ef1c OTP th\u00e0nh c\u00f4ng \u2192 t\u1ea1o JWT gi\u1ed1ng nh\u01b0 OAuth2 (g\u1eafn claim <code>auth_method=otp</code>, <code>role=parent</code>)</li> <li>Refresh token TTL: 30\u201390 ng\u00e0y t\u00f9y lo\u1ea1i user (quy \u0111\u1ecbnh c\u1ee5 th\u1ec3 cho <code>parent</code> s\u1ebd \u0111\u01b0\u1ee3c config theo ch\u00ednh s\u00e1ch n\u1ed9i b\u1ed9)</li> </ul>"},{"location":"ADR/adr-006-auth-strategy/#3-common-jwt-structure","title":"3. Common JWT Structure","text":"<p><pre><code>{\n  \"sub\": \"user_id\",\n  \"email\": \"parent@example.com\",\n  \"role\": \"parent\",\n  \"auth_method\": \"otp\",\n  \"iat\": 1710000000,\n  \"exp\": 1710003600\n}\n</code></pre> - <code>role</code>: chu\u1ed7i \u0111\u01a1n (not array), ph\u1ea3n \u00e1nh vai tr\u00f2 ch\u00ednh c\u1ee7a user: <code>student</code>, <code>teacher</code>, <code>parent</code>, <code>admin</code>... - <code>auth_method</code>: ch\u1ec9 r\u00f5 ph\u01b0\u01a1ng th\u1ee9c x\u00e1c th\u1ef1c, v\u00ed d\u1ee5: <code>oauth2</code>, <code>otp</code>, <code>internal</code></p>"},{"location":"ADR/adr-006-auth-strategy/#frontend-nhan-token","title":"\ud83d\udce4 Frontend nh\u1eadn token","text":"<ul> <li>Frontend nh\u1eadn access token t\u1eeb backend sau khi x\u00e1c th\u1ef1c th\u00e0nh c\u00f4ng</li> <li>Kh\u00f4ng n\u00ean l\u01b0u token trong localStorage. Thay v\u00e0o \u0111\u00f3:</li> <li>SPA: l\u01b0u trong <code>sessionStorage</code></li> <li>SSR ho\u1eb7c frontend truy\u1ec1n th\u1ed1ng: l\u01b0u trong <code>HttpOnly Cookie</code></li> <li>Frontend KH\u00d4NG t\u1ef1 th\u00eam c\u00e1c header <code>X-Role</code>, <code>X-User-ID</code>, <code>X-Permissions</code>. Nh\u1eefng header n\u00e0y s\u1ebd \u0111\u01b0\u1ee3c sinh ra b\u1edfi API Gateway sau khi JWT \u0111\u01b0\u1ee3c x\u00e1c th\u1ef1c.</li> </ul>"},{"location":"ADR/adr-006-auth-strategy/#tich-hop-rbac-service-header-forwarding","title":"\ud83e\udde9 T\u00edch h\u1ee3p RBAC &amp; Service header forwarding","text":"<ul> <li>API Gateway x\u00e1c th\u1ef1c JWT, sau \u0111\u00f3:</li> <li>Tra <code>role</code> v\u00e0 <code>permissions</code> (t\u1eeb DB ho\u1eb7c Redis)</li> <li>Forward c\u00e1c header sau: <pre><code>X-User-ID: user_id\nX-Role: parent\nX-Auth-Method: otp\nX-Permissions: read:score, receive:notification\n</code></pre></li> <li>C\u00e1c service backend c\u00f3 th\u1ec3 tin c\u1eady v\u00e0o c\u00e1c header n\u00e0y v\u00e0 ph\u00e2n quy\u1ec1n theo RBAC (ADR-007), kh\u00f4ng c\u1ea7n decode l\u1ea1i JWT.</li> </ul>"},{"location":"ADR/adr-006-auth-strategy/#anonymous-internal-service-auth","title":"\ud83d\udd10 Anonymous &amp; Internal Service Auth","text":"<ul> <li>M\u1ed9t s\u1ed1 API public cho ph\u00e9p truy c\u1eadp anonymous (c\u00f3 quota/rate-limit ri\u00eang)</li> <li>C\u00e1c internal service (e.g. Notification Service, Cron) s\u1eed d\u1ee5ng service account JWT v\u1edbi <code>auth_method=internal</code>, <code>role=system</code> ho\u1eb7c <code>cron</code> \u0111\u1ec3 ph\u00e2n bi\u1ec7t RBAC</li> </ul>"},{"location":"ADR/adr-006-auth-strategy/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ph\u00e2n t\u00e1ch r\u00f5 lo\u1ea1i ng\u01b0\u1eddi d\u00f9ng v\u00e0 h\u00ecnh th\u1ee9c x\u00e1c th\u1ef1c</li> <li>Cho ph\u00e9p m\u1edf r\u1ed9ng d\u1ec5 d\u00e0ng th\u00eam c\u00e1c provider kh\u00e1c</li> <li>Ph\u1ee5 huynh c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng h\u1ec7 th\u1ed1ng m\u00e0 kh\u00f4ng c\u1ea7n t\u1ea1o t\u00e0i kho\u1ea3n Google ri\u00eang</li> </ul>"},{"location":"ADR/adr-006-auth-strategy/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p OTP spam ho\u1eb7c brute force Limit rate + CAPTCHA Google OAuth2 token b\u1ecb l\u1ed9 Ch\u1ec9 ch\u1ea5p nh\u1eadn domain <code>@truongvietanh.edu.vn</code> + refresh token c\u00f3 TTL r\u00f5 r\u00e0ng JWT reuse t\u1eeb ph\u1ee5 huynh sang h\u1ecdc sinh Check <code>role</code>, <code>auth_method</code> strict \u1edf API Gateway + audit"},{"location":"ADR/adr-006-auth-strategy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>RBAC Strategy: ADR-007</li> <li>Security Hardening: ADR-004</li> <li>Secrets Management: ADR-003</li> <li>Audit Logging: ADR-008</li> <li>Token TTL &amp; Data policy: ADR-024</li> </ul> <p>\u201cX\u00e1c th\u1ef1c kh\u00f4ng ch\u1ec9 l\u00e0 c\u00e1nh c\u1eeda \u2014 \u0111\u00f3 l\u00e0 c\u00e1ch b\u1ea1n ki\u1ec3m so\u00e1t ai b\u01b0\u1edbc v\u00e0o h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-007-rbac/","title":"Adr 007 rbac","text":"<p>id: adr-007-rbac status: accepted title: ADR-007: Chi\u1ebfn l\u01b0\u1ee3c ph\u00e2n quy\u1ec1n RBAC \u0111\u1ed9ng cho to\u00e0n h\u1ec7 th\u1ed1ng dx-vas author: DX VAS Platform Team date: 2025-06-22 tags: [rbac, security, auth, dx-vas]</p>"},{"location":"ADR/adr-007-rbac/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng <code>dx-vas</code> ph\u1ee5c v\u1ee5 nhi\u1ec1u lo\u1ea1i ng\u01b0\u1eddi d\u00f9ng (h\u1ecdc sinh, gi\u00e1o vi\u00ean, ph\u1ee5 huynh, qu\u1ea3n tr\u1ecb vi\u00ean), m\u1ed7i nh\u00f3m c\u00f3 quy\u1ec1n kh\u00e1c nhau tr\u00ean c\u00e1c t\u00e0i nguy\u00ean. C\u00e1c d\u1ecbch v\u1ee5 API ho\u1ea1t \u0111\u1ed9ng theo m\u00f4 h\u00ecnh microservice n\u00ean c\u1ea7n c\u01a1 ch\u1ebf ph\u00e2n quy\u1ec1n \u0111\u1ed3ng b\u1ed9 v\u00e0 linh ho\u1ea1t gi\u1eefa c\u00e1c service.</p>"},{"location":"ADR/adr-007-rbac/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng m\u00f4 h\u00ecnh RBAC \u0111\u1ed9ng:</p> <ul> <li>M\u1ed7i user c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c g\u00e1n m\u1ed9t ho\u1eb7c nhi\u1ec1u role</li> <li>M\u1ed7i role \u00e1nh x\u1ea1 t\u1edbi m\u1ed9t danh s\u00e1ch permission (theo \u0111\u1ecbnh d\u1ea1ng <code>resource:action</code> + <code>condition</code>)</li> <li>Permission \u0111\u01b0\u1ee3c l\u01b0u trong DB v\u00e0 cache t\u1ea1i Redis</li> <li>Quy\u1ec1n truy c\u1eadp \u0111\u01b0\u1ee3c ki\u1ec3m tra d\u1ef1a tr\u00ean c\u1eb7p <code>(user_id, path:method)</code> t\u1ea1i API Gateway ho\u1eb7c Backend</li> </ul> <p>JWT KH\u00d4NG ch\u1ee9a danh s\u00e1ch <code>permissions</code>. Gateway s\u1ebd l\u1ea5y <code>role</code> t\u1eeb JWT, tra <code>permissions</code> t\u1eeb Redis ho\u1eb7c DB, evaluate \u0111i\u1ec1u ki\u1ec7n d\u1ef1a tr\u00ean context, v\u00e0 ch\u1ec9 forward c\u00e1c permission h\u1ee3p l\u1ec7 (\u0111\u00e3 evaluate) qua header <code>X-Permissions</code> d\u01b0\u1edbi d\u1ea1ng danh s\u00e1ch c\u00e1c permission code.</p>"},{"location":"ADR/adr-007-rbac/#cach-hoat-ong","title":"\ud83d\udd10 C\u00e1ch ho\u1ea1t \u0111\u1ed9ng","text":"<ol> <li>User \u0111\u0103ng nh\u1eadp \u2192 nh\u1eadn JWT ch\u1ee9a <code>sub</code>, <code>role</code>, <code>auth_method</code></li> <li> <p>Khi request \u0111\u1ebfn API Gateway:</p> </li> <li> <p>JWT \u0111\u01b0\u1ee3c x\u00e1c th\u1ef1c (ADR-006)</p> </li> <li><code>role</code> v\u00e0 <code>user_id</code> \u0111\u01b0\u1ee3c extract t\u1eeb JWT</li> <li>Gateway tra <code>permissions</code> t\u1eeb Redis ho\u1eb7c DB (g\u1ed3m c\u1ea3 <code>condition</code>)</li> <li>Gateway ki\u1ec3m tra <code>resource</code>, <code>action</code> v\u00e0 evaluate <code>condition</code> theo context request hi\u1ec7n t\u1ea1i</li> <li>N\u1ebfu pass, Gateway forward header:</li> </ol> <pre><code>X-User-ID: u123\nX-Role: parent\nX-Auth-Method: otp\nX-Permissions: VIEW_STUDENT_SCORE_OWN_CHILD, CREATE_COURSE_GLOBAL\n</code></pre> <p><code>X-Permissions</code> l\u00e0 danh s\u00e1ch permission code \u0111\u00e3 \u0111\u01b0\u1ee3c Gateway evaluate v\u00e0 x\u00e1c \u0111\u1ecbnh l\u00e0 h\u1ee3p l\u1ec7 cho request hi\u1ec7n t\u1ea1i. \u0110\u00e2y l\u00e0 \u0111\u1ecbnh danh duy nh\u1ea5t, ng\u1eafn g\u1ecdn v\u00e0 d\u1ec5 x\u1eed l\u00fd t\u1ea1i backend.</p>"},{"location":"ADR/adr-007-rbac/#mo-hinh-du-lieu-rbac","title":"\ud83e\udde9 M\u00f4 h\u00ecnh d\u1eef li\u1ec7u RBAC","text":"<ul> <li><code>users</code>: \u0111\u1ea1i di\u1ec7n cho t\u00e0i kho\u1ea3n h\u1ec7 th\u1ed1ng, \u0111\u01b0\u1ee3c li\u00ean k\u1ebft v\u1edbi actor (gi\u00e1o vi\u00ean, ph\u1ee5 huynh...)</li> <li><code>roles</code>: nh\u00f3m quy\u1ec1n, c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c g\u00e1n cho user</li> <li><code>permissions</code>: quy\u1ec1n c\u1ee5 th\u1ec3, \u0111\u1ecbnh danh duy nh\u1ea5t b\u1edfi <code>code</code>, c\u00f3 th\u1ec3 k\u00e8m \u0111i\u1ec1u ki\u1ec7n JSONB</li> <li><code>user_roles</code>: \u00e1nh x\u1ea1 gi\u1eefa user v\u00e0 role</li> <li><code>role_permissions</code>: \u00e1nh x\u1ea1 gi\u1eefa role v\u00e0 permission</li> </ul>"},{"location":"ADR/adr-007-rbac/#cau-truc-permission","title":"\ud83e\uddf1 C\u1ea5u tr\u00fac permission","text":"<pre><code>{\n  \"code\": \"VIEW_STUDENT_SCORE_OWN_CHILD\",\n  \"resource\": \"student\",\n  \"action\": \"view\",\n  \"condition\": {\n    \"accessible_student_ids\": [\"student_id_con\"]\n  },\n  \"description\": \"Cho ph\u00e9p xem \u0111i\u1ec3m s\u1ed1 c\u1ee7a con m\u00ecnh\"\n}\n</code></pre>"},{"location":"ADR/adr-007-rbac/#gateway-evaluate-flow","title":"\ud83e\udde9 Gateway Evaluate Flow","text":"<ol> <li>X\u00e1c th\u1ef1c JWT (ho\u1eb7c OTP) \u2192 l\u1ea5y <code>user_id</code></li> <li>Ki\u1ec3m tra <code>is_active</code> t\u1eeb b\u1ea3ng <code>users</code> \u2192 n\u1ebfu <code>false</code> \u2192 t\u1eeb ch\u1ed1i truy c\u1eadp (<code>IS_INACTIVE_USER</code>)</li> <li>L\u1ea5y role, g\u00e1n permission t\u1eeb Redis cache (<code>RBAC:{user_id}</code>) \u2192 n\u1ebfu miss cache th\u00ec fallback DB</li> <li>Evaluate condition trong permission (n\u1ebfu c\u00f3)</li> <li> <p>Forward header:</p> </li> <li> <p><code>X-User-ID</code></p> </li> <li><code>X-Role</code></li> <li><code>X-Permissions</code>: danh s\u00e1ch c\u00e1c permission <code>code</code> \u0111\u00e3 evaluate pass</li> <li><code>Trace-ID</code></li> </ol> <p>Gateway kh\u00f4ng c\u1ea7n bi\u1ebft actor l\u00e0 ai \u2013 ch\u1ec9 d\u00f9ng <code>user_id</code>, v\u00e0 permission code \u0111\u00e3 \u0111\u01b0\u1ee3c x\u1eed l\u00fd t\u1eeb User Service.</p>"},{"location":"ADR/adr-007-rbac/#co-che-propagate-rbac","title":"\ud83d\udd27 C\u01a1 ch\u1ebf propagate RBAC","text":"<ul> <li> <p>C\u00e1c s\u1ef1 ki\u1ec7n sau s\u1ebd k\u00edch ho\u1ea1t propagate:</p> </li> <li> <p>User b\u1ecb kho\u00e1 (<code>is_active = false</code>)</p> </li> <li>G\u00e1n/thu h\u1ed3i role</li> <li>G\u00e1n/thu h\u1ed3i permission</li> <li>Gateway s\u1eed d\u1ee5ng Redis Pub/Sub ho\u1eb7c message queue \u0111\u1ec3 nh\u1eadn event c\u1eadp nh\u1eadt cache RBAC</li> <li>TTL c\u1ee7a Redis cache: 5\u201315 ph\u00fat ho\u1eb7c l\u00e0m m\u1edbi theo push event</li> <li>Trong tr\u01b0\u1eddng h\u1ee3p \u0111\u1eb7c bi\u1ec7t, backend c\u00f3 th\u1ec3 force-refresh RBAC b\u1eb1ng header debug</li> </ul>"},{"location":"ADR/adr-007-rbac/#quan-tri-rbac-thong-qua-user-service","title":"\ud83e\udde9 Qu\u1ea3n tr\u1ecb RBAC th\u00f4ng qua User Service","text":"<ul> <li>T\u1ea5t c\u1ea3 th\u1ef1c th\u1ec3 <code>users</code>, <code>roles</code>, <code>permissions</code> \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd b\u1edfi User Service</li> <li> <p>C\u00e1c API qu\u1ea3n tr\u1ecb bao g\u1ed3m:</p> </li> <li> <p><code>/users</code>, <code>/users/{id}/roles</code>, <code>/users/{id}/status</code></p> </li> <li><code>/roles</code>, <code>/roles/{id}/permissions</code></li> <li><code>/permissions</code> (read-only)</li> <li>Permissions \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a t\u0129nh, load v\u00e0o DB qua migration \u2013 kh\u00f4ng cho ph\u00e9p t\u1ea1o/s\u1eeda/xo\u00e1 permission qua API (ch\u1ec9 <code>GET /permissions</code> \u0111\u01b0\u1ee3c expose)</li> </ul>"},{"location":"ADR/adr-007-rbac/#service-to-service-rbac","title":"\ud83e\udded Service-to-Service RBAC","text":"<ul> <li>C\u00e1c service nh\u01b0 CRM Adapter c\u00f3 th\u1ec3 d\u00f9ng JWT ri\u00eang ho\u1eb7c credential \u0111\u1eb7c bi\u1ec7t</li> <li>\u0110\u01b0\u1ee3c g\u00e1n <code>X-Role: system</code> v\u00e0 permission nh\u01b0 user th\u01b0\u1eddng</li> <li>Gateway evaluate nh\u01b0 user b\u00ecnh th\u01b0\u1eddng nh\u01b0ng v\u1edbi role l\u00e0 <code>system</code></li> <li>Permission c\u1ea7n \u0111\u01b0\u1ee3c c\u1ea5p c\u1ee5 th\u1ec3 cho service \u0111\u00f3 trong b\u1ea3ng RBAC (user_id \u0111\u1ea1i di\u1ec7n cho service identity)</li> </ul>"},{"location":"ADR/adr-007-rbac/#rui-ro-giai-phap","title":"\u26a0\ufe0f R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p D\u1eef li\u1ec7u RBAC thay \u0111\u1ed5i nh\u01b0ng Gateway v\u1eabn d\u00f9ng cache c\u0169 S\u1eed d\u1ee5ng TTL + push event qua Redis Pub/Sub Permission evaluate sai do condition ph\u1ee9c t\u1ea1p Chu\u1ea9n ho\u00e1 schema \u0111i\u1ec1u ki\u1ec7n v\u00e0 test b\u1eb1ng unit test + integration test Ng\u01b0\u1eddi d\u00f9ng b\u1ecb kho\u00e1 nh\u01b0ng token v\u1eabn h\u1ee3p l\u1ec7 Check <code>is_active</code> t\u1ea1i b\u01b0\u1edbc evaluate, invalidate RBAC n\u1ebfu c\u1ea7n Service-to-service kh\u00f4ng \u0111\u01b0\u1ee3c ki\u1ec3m so\u00e1t ph\u00e2n quy\u1ec1n Ph\u00e2n bi\u1ec7t r\u00f5 role system, v\u00e0 permission c\u1ee7a service c\u0169ng c\u1ea7n \u0111\u01b0\u1ee3c c\u1ea5u h\u00ecnh r\u00f5 r\u00e0ng"},{"location":"ADR/adr-007-rbac/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>User Service \u2013 Interface Contract</li> <li>Auth Strategy: ADR-006</li> <li>Audit Logging: ADR-008</li> <li>Security Strategy: ADR-004</li> </ul> <p>\u201cRBAC \u0111\u1ed9ng kh\u00f4ng ch\u1ec9 l\u00e0 quy\u1ec1n \u2013 m\u00e0 l\u00e0 b\u1ee9c tranh to\u00e0n c\u1ea3nh v\u1ec1 vai tr\u00f2, \u0111i\u1ec1u ki\u1ec7n, v\u00e0 h\u00e0nh vi h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-008-audit-logging/","title":"Adr 008 audit logging","text":"<p>id: adr-008-audit-logging title: ADR-008: Chi\u1ebfn l\u01b0\u1ee3c Audit Logging cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Security &amp; Platform Team date: 2025-06-22 tags: [audit, logging, observability, dx-vas, security]</p>"},{"location":"ADR/adr-008-audit-logging/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas x\u1eed l\u00fd d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m v\u00e0 h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng: - Qu\u1ea3n l\u00fd th\u00f4ng tin h\u1ecdc sinh, gi\u00e1o vi\u00ean, \u0111i\u1ec3m s\u1ed1 (SIS, LMS) - T\u00e1c v\u1ee5 ph\u00e2n quy\u1ec1n, \u0111\u0103ng nh\u1eadp, c\u1eadp nh\u1eadt h\u1ed3 s\u01a1 (CRM, Gateway) - G\u1eedi th\u00f4ng b\u00e1o, g\u1ecdi API t\u00edch h\u1ee3p (Notification, External Services)</p> <p>\u0110\u1ec3 ph\u1ee5c v\u1ee5 ki\u1ec3m to\u00e1n (audit), b\u1ea3o m\u1eadt, truy v\u1ebft h\u00e0nh vi v\u00e0 \u0111i\u1ec1u tra s\u1ef1 c\u1ed1, c\u1ea7n h\u1ec7 th\u1ed1ng Audit Logging t\u1eadp trung v\u00e0 chu\u1ea9n ho\u00e1 tr\u00ean to\u00e0n b\u1ed9 c\u00e1c service.</p>"},{"location":"ADR/adr-008-audit-logging/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c Audit Logging chu\u1ea9n ho\u00e1, g\u1eedi log d\u1ea1ng JSON t\u1edbi Cloud Logging, ph\u00e2n lo\u1ea1i theo <code>audit_level</code>, l\u01b0u d\u00e0i h\u1ea1n v\u00e0 gi\u1edbi h\u1ea1n truy c\u1eadp. \u00c1p d\u1ee5ng cho c\u1ea3 Gateway v\u00e0 c\u00e1c backend service.</p>"},{"location":"ADR/adr-008-audit-logging/#cau-truc-log-audit-chuan","title":"\ud83e\udde9 C\u1ea5u tr\u00fac log audit chu\u1ea9n","text":"<pre><code>{\n  \"timestamp\": \"2025-06-22T14:00:00Z\",\n  \"request_id\": \"abc-123\",\n  \"user_id\": \"u_567\",\n  \"role\": \"admin\",\n  \"ip\": \"203.113.1.5\",\n  \"action\": \"update_student\",\n  \"resource\": \"student/102\",\n  \"method\": \"PUT\",\n  \"status_code\": 200,\n  \"latency_ms\": 147,\n  \"source\": \"gateway|crm_adapter|lms_proxy\",\n  \"actor_type\": \"human|service|system\",\n  \"audit_level\": \"critical|info|debug\"\n}\n</code></pre> <ul> <li><code>resource</code>: d\u1ea1ng <code>{type}/{id}</code></li> <li><code>source</code>: \u0111\u1ecbnh danh service</li> <li><code>audit_level</code>:</li> <li><code>critical</code>: thao t\u00e1c ghi nh\u1ea1y c\u1ea3m (PUT/DELETE/role change)</li> <li><code>info</code>: xem d\u1eef li\u1ec7u quan tr\u1ecdng (GET student/grades)</li> <li><code>debug</code>: m\u1eb7c \u0111\u1ecbnh off, ch\u1ec9 d\u00f9ng dev/test</li> </ul>"},{"location":"ADR/adr-008-audit-logging/#luong-tich-hop","title":"\ud83d\udd04 Lu\u1ed3ng t\u00edch h\u1ee3p","text":""},{"location":"ADR/adr-008-audit-logging/#tai-api-gateway","title":"T\u1ea1i API Gateway","text":"<ul> <li>Log m\u1ecdi h\u00e0nh \u0111\u1ed9ng c\u1ea7n ph\u00e2n quy\u1ec1n \u2192 log sau khi x\u00e1c th\u1ef1c v\u00e0 ki\u1ec3m tra RBAC</li> <li>Vi\u1ebft middleware <code>audit_logger.py</code></li> <li>G\u1eedi log qua stdout \u2192 Cloud Logging</li> </ul>"},{"location":"ADR/adr-008-audit-logging/#tai-backend-services","title":"T\u1ea1i Backend Services","text":"<ul> <li>Cung c\u1ea5p SDK ho\u1eb7c decorator <code>@audit_event</code></li> <li>G\u1ecdi <code>audit_logger.log(...)</code> t\u1ea1i c\u00e1c API c\u00f3 side-effect</li> <li>C\u00f3 th\u1ec3 g\u1eedi v\u1ec1 chung 1 topic Pub/Sub ho\u1eb7c stdout ri\u00eang c\u1ee7a t\u1eebng service</li> </ul>"},{"location":"ADR/adr-008-audit-logging/#luu-tru-truy-van","title":"\ud83d\udce6 L\u01b0u tr\u1eef &amp; Truy v\u1ea5n","text":"<ul> <li>D\u1eef li\u1ec7u log l\u01b0u t\u1ea1i Cloud Logging (180 ng\u00e0y)</li> <li>Export sang BigQuery \u2192 t\u1ea1o b\u1ea3ng <code>audit_logs_dxvas</code></li> <li>Query theo:</li> <li><code>user_id</code>, <code>action</code>, <code>role</code>, <code>source</code>, <code>audit_level</code></li> <li>Th\u1ed1ng k\u00ea theo ng\u00e0y/th\u00e1ng/qu\u00fd \u0111\u1ec3 ph\u1ee5c v\u1ee5 audit n\u1ed9i b\u1ed9</li> </ul>"},{"location":"ADR/adr-008-audit-logging/#kiem-soat-truy-cap-bao-mat","title":"\ud83d\udd10 Ki\u1ec3m so\u00e1t truy c\u1eadp &amp; b\u1ea3o m\u1eadt","text":"<ul> <li>Ch\u1ec9 nh\u00f3m <code>Platform Admin</code> v\u00e0 <code>Security Team</code> \u0111\u01b0\u1ee3c xem full audit log</li> <li>Ph\u00e2n quy\u1ec1n chi ti\u1ebft theo log type: <code>system</code>, <code>user</code>, <code>security</code></li> <li>Ghi log h\u00e0nh vi \u0111\u1ecdc audit log n\u1ebfu c\u1ea7n (meta-audit)</li> <li>Mask th\u00f4ng tin nh\u1ea1y c\u1ea3m: kh\u00f4ng log full payload, ch\u1ec9 log ID ho\u1eb7c field x\u00e1c \u0111\u1ecbnh</li> </ul>"},{"location":"ADR/adr-008-audit-logging/#tich-hop-ci-kiem-thu","title":"\ud83d\udee0 T\u00edch h\u1ee3p CI &amp; Ki\u1ec3m th\u1eed","text":"<ul> <li>Ki\u1ec3m th\u1eed middleware t\u1ea1o log \u0111\u00fang schema</li> <li>Ki\u1ec3m tra CI reject n\u1ebfu thi\u1ebfu audit log cho API ghi nh\u1ea1y c\u1ea3m</li> <li>C\u00f3 th\u1ec3 mock <code>audit_logger.log()</code> trong unit test</li> </ul>"},{"location":"ADR/adr-008-audit-logging/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>T\u0103ng kh\u1ea3 n\u0103ng ki\u1ec3m so\u00e1t h\u00e0nh vi h\u1ec7 th\u1ed1ng</li> <li>H\u1ed7 tr\u1ee3 \u0111i\u1ec1u tra s\u1ef1 c\u1ed1, ph\u1ea3n \u1ee9ng nhanh khi b\u1ecb t\u1ea5n c\u00f4ng</li> <li>\u0110\u00e1p \u1ee9ng y\u00eau c\u1ea7u ki\u1ec3m to\u00e1n n\u1ed9i b\u1ed9, tu\u00e2n th\u1ee7 d\u1eef li\u1ec7u</li> <li>D\u1ec5 th\u1ed1ng k\u00ea ho\u1ea1t \u0111\u1ed9ng quan tr\u1ecdng theo ng\u01b0\u1eddi d\u00f9ng v\u00e0 th\u1eddi gian</li> </ul>"},{"location":"ADR/adr-008-audit-logging/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Ghi log qu\u00e1 m\u1ee9c g\u00e2y overload Ch\u1ec9 log h\u00e0nh \u0111\u1ed9ng r\u00f5 r\u00e0ng trong danh s\u00e1ch cho ph\u00e9p Log ch\u1ee9a d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m Mask ho\u1eb7c log field \u0111\u1ecbnh danh thay v\u00ec full object B\u1ecf s\u00f3t h\u00e0nh \u0111\u1ed9ng nh\u1ea1y c\u1ea3m CI/CD ki\u1ec3m tra + checklist t\u1ea1i PR + middleware b\u1eaft bu\u1ed9c"},{"location":"ADR/adr-008-audit-logging/#cac-phuong-an-a-loai-bo","title":"\ud83d\udd04 C\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn Ch\u1ec9 log l\u1ed7i h\u1ec7 th\u1ed1ng Kh\u00f4ng \u0111\u1ee7 \u0111\u1ec3 audit h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng Log chung l\u1eabn access/error log Kh\u00f3 t\u00e1ch, ph\u00e2n quy\u1ec1n, v\u00e0 ph\u00e2n t\u00edch Log t\u1ea1i backend ri\u00eang bi\u1ec7t, kh\u00f4ng \u0111\u1ed3ng b\u1ed9 schema Kh\u00f4ng query \u0111\u01b0\u1ee3c t\u1eadp trung, thi\u1ebfu chu\u1ea9n h\u00f3a"},{"location":"ADR/adr-008-audit-logging/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>RBAC Strategy: ADR-007</li> <li>Auth Strategy: ADR-006</li> <li>Security Hardening: ADR-004</li> </ul> <p>\u201cN\u1ebfu b\u1ea1n kh\u00f4ng ghi l\u1ea1i h\u00e0nh vi c\u1ee7a h\u1ec7 th\u1ed1ng \u2013 b\u1ea1n s\u1ebd kh\u00f4ng bao gi\u1edd bi\u1ebft \u0111i\u1ec1u g\u00ec \u0111\u00e3 x\u1ea3y ra khi n\u00f3 x\u1ea3y ra.\u201d</p>"},{"location":"ADR/adr-009-api-governance/","title":"Adr 009 api governance","text":"<p>id: adr-009-api-governance title: ADR-009: Ch\u00ednh s\u00e1ch Qu\u1ea3n tr\u1ecb API (API Governance) cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Architecture Team date: 2025-06-22 tags: [api, governance, versioning, standards, dx-vas]</p>"},{"location":"ADR/adr-009-api-governance/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas bao g\u1ed3m nhi\u1ec1u d\u1ecbch v\u1ee5 cung c\u1ea5p v\u00e0 ti\u00eau th\u1ee5 API: - API Gateway (\u0111i\u1ec3m v\u00e0o trung t\u00e2m) - C\u00e1c backend: CRM Adapter, LMS Proxy, Notification Service, SIS Adapter... - Frontend webapp (Portal, Admin) - D\u1ecbch v\u1ee5 b\u00ean ngo\u00e0i (Zalo, Google OAuth, Firebase...)</p> <p>\u0110\u1ec3 \u0111\u1ea3m b\u1ea3o s\u1ef1 th\u1ed1ng nh\u1ea5t, b\u1ea3o tr\u00ec l\u00e2u d\u00e0i v\u00e0 kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng, to\u00e0n h\u1ec7 th\u1ed1ng c\u1ea7n c\u00f3 ch\u00ednh s\u00e1ch qu\u1ea3n tr\u1ecb API (API Governance) chung.</p>"},{"location":"ADR/adr-009-api-governance/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng ch\u00ednh s\u00e1ch API Governance chu\u1ea9n, bao g\u1ed3m versioning, linting, schema h\u00f3a OpenAPI, quy tr\u00ecnh review, v\u00e0 t\u00e0i li\u1ec7u ho\u00e1 t\u1ef1 \u0111\u1ed9ng. \u00c1p d\u1ee5ng cho t\u1ea5t c\u1ea3 c\u00e1c API n\u1ed9i b\u1ed9 v\u00e0 external-facing trong dx-vas.</p>"},{"location":"ADR/adr-009-api-governance/#nguyen-tac-chung","title":"\ud83d\udcd0 Nguy\u00ean t\u1eafc chung","text":""},{"location":"ADR/adr-009-api-governance/#1-api-phai-co-version-ro-rang","title":"1. API ph\u1ea3i c\u00f3 version r\u00f5 r\u00e0ng","text":"<ul> <li>S\u1eed d\u1ee5ng prefix trong path: <code>/api/v1/...</code></li> <li>Thay \u0111\u1ed5i breaking \u2192 t\u1ea1o version m\u1edbi (<code>v2</code>)</li> <li>C\u00e1c version song song \u0111\u01b0\u1ee3c duy tr\u00ec trong th\u1eddi gian chuy\u1ec3n ti\u1ebfp (6\u201312 th\u00e1ng)</li> </ul>"},{"location":"ADR/adr-009-api-governance/#2-api-phai-co-tai-lieu-openapi","title":"2. API ph\u1ea3i c\u00f3 t\u00e0i li\u1ec7u OpenAPI","text":"<ul> <li>Vi\u1ebft OpenAPI schema (YAML/JSON) theo chu\u1ea9n 3.x</li> <li>M\u1ed7i service c\u1ea7n expose <code>GET /openapi.json</code></li> <li>D\u00f9ng Swagger UI ho\u1eb7c Redoc \u0111\u1ec3 render trong CI ho\u1eb7c Docs</li> </ul>"},{"location":"ADR/adr-009-api-governance/#3-linting-kiem-tra-tu-ong","title":"3. Linting &amp; ki\u1ec3m tra t\u1ef1 \u0111\u1ed9ng","text":"<ul> <li>D\u00f9ng <code>speccy</code>, <code>spectral</code>, ho\u1eb7c <code>oas-linter</code> \u0111\u1ec3:</li> <li>B\u1eaft l\u1ed7i thi\u1ebfu description, type</li> <li>Ki\u1ec3m tra naming convention, security scheme, 2xx/4xx \u0111\u1ea7y \u0111\u1ee7</li> <li>T\u00edch h\u1ee3p trong CI/CD:</li> <li>Fail build n\u1ebfu OpenAPI c\u00f3 l\u1ed7i n\u1eb7ng</li> </ul>"},{"location":"ADR/adr-009-api-governance/#4-ten-endpoint-va-schema-co-quy-tac","title":"4. T\u00ean endpoint v\u00e0 schema c\u00f3 quy t\u1eafc","text":"<ul> <li>T\u00ean endpoint RESTful: <code>/students/{id}</code>, <code>/grades/{student_id}</code></li> <li>Tham s\u1ed1 \u0111\u01b0\u1eddng d\u1eabn <code>snake_case</code>, danh t\u1eeb s\u1ed1 nhi\u1ec1u</li> <li>D\u1eef li\u1ec7u tr\u1ea3 v\u1ec1 d\u1ea1ng JSON, response chu\u1ea9n ho\u00e1 <code>{data, error, meta}</code></li> </ul>"},{"location":"ADR/adr-009-api-governance/#5-versioning-deprecation-policy","title":"5. Versioning &amp; Deprecation Policy","text":"<ul> <li>M\u1ed7i version API \u0111\u01b0\u1ee3c ghi r\u00f5 ng\u00e0y ph\u00e1t h\u00e0nh v\u00e0 ng\u00e0y d\u1ef1 ki\u1ebfn ng\u01b0ng h\u1ed7 tr\u1ee3 (sunset date)</li> <li>Endpoint c\u0169 \u0111\u01b0\u1ee3c th\u00eam header:   <pre><code>Deprecation: true\nSunset: Wed, 31 Dec 2025 23:59:59 GMT\nLink: &lt;/api/v2/...&gt;; rel=\"successor-version\"\n</code></pre></li> <li>C\u00f3 endpoint <code>/api/docs/deprecation</code> \u0111\u1ec3 li\u1ec7t k\u00ea API s\u1eafp ng\u01b0ng h\u1ed7 tr\u1ee3</li> </ul>"},{"location":"ADR/adr-009-api-governance/#6-quy-trinh-review-va-phe-duyet","title":"6. Quy tr\u00ecnh review v\u00e0 ph\u00ea duy\u1ec7t","text":"<ul> <li>M\u1ed7i thay \u0111\u1ed5i schema c\u1ea7n m\u1edf Pull Request v\u1edbi:</li> <li>File OpenAPI m\u1edbi ho\u1eb7c diff</li> <li>Ghi r\u00f5 breaking / non-breaking</li> <li>Ch\u1ea1y pass linter + test contract (xem ADR-010)</li> <li>Review b\u1edfi team ki\u1ebfn tr\u00fac v\u00e0 \u0111\u1ea1i di\u1ec7n frontend/backend li\u00ean quan</li> </ul>"},{"location":"ADR/adr-009-api-governance/#7-gan-metadata-cho-moi-api","title":"7. G\u1eafn metadata cho m\u1ed7i API","text":"<ul> <li>Th\u00eam tag, owner, description trong OpenAPI</li> <li>M\u1ee5c ti\u00eau: gi\u00fap team ph\u00e2n t\u00edch v\u00e0 hi\u1ec3u r\u00f5 t\u1eebng API endpoint</li> </ul> <pre><code>x-metadata:\n  owner: lms_team\n  tier: critical\n  service: lms_proxy\n</code></pre>"},{"location":"ADR/adr-009-api-governance/#cong-cu-e-xuat","title":"\ud83d\udee0 C\u00f4ng c\u1ee5 \u0111\u1ec1 xu\u1ea5t","text":"M\u1ee5c ti\u00eau C\u00f4ng c\u1ee5 Lint &amp; ki\u1ec3m tra schema Spectral, Speccy, oasdiff So s\u00e1nh version <code>oasdiff</code>, <code>schemathesis diff</code> Render docs Redoc, Swagger UI, Stoplight CI/CD t\u00edch h\u1ee3p GitHub Actions (<code>lint-openapi.yml</code>)"},{"location":"ADR/adr-009-api-governance/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>API d\u1ec5 hi\u1ec3u, d\u1ec5 t\u00edch h\u1ee3p v\u00e0 m\u1edf r\u1ed9ng</li> <li>Gi\u1ea3m l\u1ed7i khi t\u00edch h\u1ee3p \u0111a d\u1ecbch v\u1ee5 / frontend</li> <li>T\u0103ng kh\u1ea3 n\u0103ng tu\u00e2n th\u1ee7, ki\u1ec3m so\u00e1t thay \u0111\u1ed5i API</li> <li>Gi\u00fap c\u00e1c team l\u00e0m vi\u1ec7c tr\u01a1n tru h\u01a1n nh\u1edd t\u00e0i li\u1ec7u t\u1ef1 \u0111\u1ed9ng v\u00e0 th\u1ed1ng nh\u1ea5t</li> </ul>"},{"location":"ADR/adr-009-api-governance/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p API kh\u00f4ng c\u00f3 schema r\u00f5 r\u00e0ng \u2192 l\u1ed7i t\u00edch h\u1ee3p B\u1eaft bu\u1ed9c check trong CI/CD, fail n\u1ebfu thi\u1ebfu OpenAPI Kh\u00f4ng qu\u1ea3n l\u00fd version t\u1ed1t \u2192 ph\u00e1 v\u1ee1 t\u00edch h\u1ee3p G\u1eafn version, \u00e1p d\u1ee5ng ch\u00ednh s\u00e1ch deprecation r\u00f5 r\u00e0ng Review b\u1ecb ch\u1eadm C\u00f3 checklist PR + ph\u00e2n quy\u1ec1n ng\u01b0\u1eddi duy\u1ec7t theo module"},{"location":"ADR/adr-009-api-governance/#cac-phuong-an-a-loai-bo","title":"\ud83d\udd04 C\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn Kh\u00f4ng d\u00f9ng version prefix D\u1ec5 g\u00e2y breaking change ng\u1ea7m Ch\u1ec9 vi\u1ebft t\u00e0i li\u1ec7u Markdown Kh\u00f4ng t\u1ef1 sinh schema, kh\u00f3 check t\u1ef1 \u0111\u1ed9ng Qu\u1ea3n l\u00fd API t\u1ef1 do theo t\u1eebng team Thi\u1ebfu chu\u1ea9n ho\u00e1, kh\u00f3 maintain h\u1ec7 th\u1ed1ng l\u1edbn"},{"location":"ADR/adr-009-api-governance/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Contract Testing: ADR-010</li> <li>Deployment Strategy: ADR-010</li> <li>CI/CD Strategy: ADR-001</li> </ul> <p>\u201cAPI t\u1ed1t l\u00e0 t\u00e0i li\u1ec7u \u2013 nh\u01b0ng API c\u00f3 governance t\u1ed1t l\u00e0 t\u00e0i s\u1ea3n c\u1ee7a c\u1ea3 t\u1ed5 ch\u1ee9c.\u201d</p>"},{"location":"ADR/adr-010-contract-testing/","title":"Adr 010 contract testing","text":"<p>id: adr-010-contract-testing title: ADR-010: Chi\u1ebfn l\u01b0\u1ee3c Contract Testing cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Architecture Team date: 2025-06-22 tags: [contract-testing, pact, integration, api, dx-vas]</p>"},{"location":"ADR/adr-010-contract-testing/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>Trong h\u1ec7 th\u1ed1ng dx-vas, nhi\u1ec1u d\u1ecbch v\u1ee5 \u0111\u1ed9c l\u1eadp giao ti\u1ebfp v\u1edbi nhau qua API: - Frontend (Portal/Admin) \u2194 API Gateway - API Gateway \u2194 LMS Adapter, CRM Adapter, Notification Service - API Gateway \u2194 External systems (SSO, tuy\u1ec3n sinh...)</p> <p>C\u00e1c d\u1ecbch v\u1ee5 \u0111\u01b0\u1ee3c ph\u00e1t tri\u1ec3n b\u1edfi c\u00e1c \u0111\u1ed9i kh\u00e1c nhau, thay \u0111\u1ed5i \u0111\u1ed9c l\u1eadp. \u0110i\u1ec1u n\u00e0y d\u1eabn \u0111\u1ebfn nguy c\u01a1 breaking change n\u1ebfu m\u1ed9t producer thay \u0111\u1ed5i API m\u00e0 consumer ch\u01b0a k\u1ecbp th\u00edch nghi. Contract Testing l\u00e0 gi\u1ea3i ph\u00e1p \u0111\u1ea3m b\u1ea3o s\u1ef1 t\u01b0\u01a1ng th\u00edch \u0111\u00f3.</p>"},{"location":"ADR/adr-010-contract-testing/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng Consumer-Driven Contract Testing b\u1eb1ng c\u00f4ng c\u1ee5 Pact, v\u1edbi h\u1ed7 tr\u1ee3 Pact Broker \u0111\u1ec3 qu\u1ea3n l\u00fd contracts gi\u1eefa c\u00e1c d\u1ecbch v\u1ee5 trong dx-vas. T\u00edch h\u1ee3p contract testing v\u00e0o CI/CD c\u1ea3 ph\u00eda consumer v\u00e0 producer.</p>"},{"location":"ADR/adr-010-contract-testing/#khai-niem-chinh","title":"\ud83d\udcd6 Kh\u00e1i ni\u1ec7m ch\u00ednh","text":"<ul> <li>Producer: D\u1ecbch v\u1ee5 cung c\u1ea5p API (Gateway, Adapter)</li> <li>Consumer: D\u1ecbch v\u1ee5 g\u1ecdi API (Frontend, API Gateway g\u1ecdi backend...)</li> <li>Contract: M\u1ed9t t\u1ec7p JSON \u0111\u1ecbnh ngh\u0129a k\u1ef3 v\u1ecdng c\u1ee7a consumer v\u1edbi response t\u1eeb producer</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#cap-producerconsumer-ap-dung-contract-testing","title":"\ud83e\udde9 C\u1eb7p producer\u2013consumer \u00e1p d\u1ee5ng contract testing","text":"Producer Consumer API Gateway Frontend (Portal, Admin Webapp) LMS Adapter API Gateway CRM Adapter API Gateway Notification Service API Gateway Public API H\u1ec7 th\u1ed1ng tuy\u1ec3n sinh (external consumer)"},{"location":"ADR/adr-010-contract-testing/#quy-trinh-lam-viec","title":"\ud83d\udd04 Quy tr\u00ecnh l\u00e0m vi\u1ec7c","text":""},{"location":"ADR/adr-010-contract-testing/#1-consumer-side","title":"1. Consumer side","text":"<ul> <li>Vi\u1ebft test gi\u1ea3 l\u1eadp g\u1ecdi API c\u1ee7a producer b\u1eb1ng <code>pact-js</code>, <code>pact-python</code>, <code>pact-go</code>...</li> <li>Sinh Pact file (JSON) th\u1ec3 hi\u1ec7n request/response k\u1ef3 v\u1ecdng</li> <li>G\u1eedi Pact file l\u00ean Pact Broker (ho\u1eb7c commit v\u00e0o repo producer n\u1ebfu ch\u01b0a c\u00f3 Broker)</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#2-producer-side","title":"2. Producer side","text":"<ul> <li>C\u00e0i provider verifier (<code>pact-provider-verifier</code>)</li> <li>L\u1ea5y pact t\u1eeb Broker/repo \u2192 ch\u1ea1y test th\u1ef1c t\u1ebf</li> <li>\u0110\u1ea3m b\u1ea3o API th\u1ef1c t\u1ebf \u0111\u00e1p \u1ee9ng \u0111\u00fang contract c\u1ee7a consumer</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#3-cicd-tich-hop","title":"3. CI/CD t\u00edch h\u1ee3p","text":"<ul> <li>Consumer CI:</li> <li>T\u1ea1o Pact file sau m\u1ed7i build</li> <li>Upload Pact file l\u00ean Broker (ho\u1eb7c Git)</li> <li>Producer CI:</li> <li>T\u1ef1 \u0111\u1ed9ng verify contract v\u1edbi m\u1ed7i commit</li> <li>Fail n\u1ebfu c\u00f3 breaking change (kh\u00e1c contract)</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#4-pact-broker","title":"4. Pact Broker","text":"<ul> <li>L\u01b0u tr\u1eef Pact theo phi\u00ean b\u1ea3n consumer</li> <li>Theo d\u00f5i t\u01b0\u01a1ng th\u00edch gi\u1eefa c\u00e1c phi\u00ean b\u1ea3n API</li> <li>H\u1ed7 tr\u1ee3 webhook \u2192 t\u1ef1 \u0111\u1ed9ng trigger CI b\u00ean producer khi consumer c\u1eadp nh\u1eadt contract</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#provider-states","title":"\ud83e\uddea Provider States","text":"<ul> <li>Cho ph\u00e9p producer set up data ph\u00f9 h\u1ee3p tr\u01b0\u1edbc khi verify m\u1ed9t interaction</li> <li>\u0110\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a b\u1edfi consumer trong contract</li> <li>Producer mapping c\u00e1c state \u2192 data setup t\u01b0\u01a1ng \u1ee9ng trong test</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#ap-dung-trong-dx-vas","title":"\ud83d\udccc \u00c1p d\u1ee5ng trong dx-vas","text":"<ul> <li>B\u1eaft bu\u1ed9c contract test v\u1edbi t\u1ea5t c\u1ea3 API public ho\u1eb7c shared</li> <li>L\u00e0 m\u1ed9t b\u01b0\u1edbc trong checklist review OpenAPI (xem <code>adr-009-api-governance.md</code>)</li> <li>Pact file ph\u1ea3i \u0111\u01b0\u1ee3c duy\u1ec7t n\u1ebfu l\u00e0 breaking change \u2192 th\u00eam tag <code>breaking</code> v\u00e0o commit/pull request</li> <li>Producer \u0111\u01b0\u1ee3c ph\u00e9p t\u1eeb ch\u1ed1i contract kh\u00f4ng h\u1ee3p l\u1ec7 ho\u1eb7c ch\u01b0a h\u1ed7 tr\u1ee3</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#cong-cu-e-xuat","title":"\ud83d\udee0 C\u00f4ng c\u1ee5 \u0111\u1ec1 xu\u1ea5t","text":"M\u1ee5c ti\u00eau C\u00f4ng c\u1ee5 Vi\u1ebft contract (consumer) <code>pact-js</code>, <code>pact-python</code>, <code>pact-go</code>, <code>pact-net</code> Verify contract (producer) <code>pact-provider-verifier</code> Broker Pactflow (SaaS) ho\u1eb7c self-hosted Pact Broker CI/CD GitHub Actions, GitLab CI, webhook t\u1eeb Broker"},{"location":"ADR/adr-010-contract-testing/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ph\u00e1t hi\u1ec7n breaking change tr\u01b0\u1edbc khi deploy</li> <li>T\u0103ng \u0111\u1ed9 tin c\u1eady v\u00e0 kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng gi\u1eefa c\u00e1c service</li> <li>\u0110\u1ea3m b\u1ea3o frontend/backend ph\u00e1t tri\u1ec3n \u0111\u1ed9c l\u1eadp nh\u01b0ng nh\u1ea5t qu\u00e1n</li> <li>Gi\u1ea3m l\u1ed7i runtime do thi\u1ebfu \u0111\u1ed3ng b\u1ed9 API</li> </ul>"},{"location":"ADR/adr-010-contract-testing/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Pact file c\u0169/l\u1ed7i b\u1ecb verify sai T\u00edch h\u1ee3p schema validator + version tag Kh\u00f4ng c\u00f3 test cho interaction edge case B\u1eaft bu\u1ed9c coverage cho API critical Producer kh\u00f4ng mu\u1ed1n verify m\u1ecdi contract Gi\u1edbi h\u1ea1n contract scope theo <code>provider_tag</code>"},{"location":"ADR/adr-010-contract-testing/#cac-phuong-an-a-loai-bo","title":"\ud83d\udd04 C\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn Manual integration test gi\u1eefa c\u00e1c service Kh\u00f4ng scale, ch\u1eadm, kh\u00f3 t\u1ef1 \u0111\u1ed9ng ho\u00e1 Ch\u1ec9 d\u00f9ng test frontend \u0111\u1ec3 ph\u00e1t hi\u1ec7n API bug Kh\u00f4ng b\u1ea3o v\u1ec7 producer tr\u01b0\u1edbc thay \u0111\u1ed5i silent"},{"location":"ADR/adr-010-contract-testing/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>API Governance: ADR-009</li> <li>CI/CD Strategy: ADR-001</li> </ul> <p>\u201cContract testing l\u00e0 c\u00e1ch \u0111\u1ec3 c\u00e1c d\u1ecbch v\u1ee5 giao ti\u1ebfp b\u1eb1ng s\u1ef1 tin c\u1eady \u2013 ch\u1ee9 kh\u00f4ng ph\u1ea3i ni\u1ec1m tin m\u00f9 qu\u00e1ng.\u201d</p>"},{"location":"ADR/adr-011-api-error-format/","title":"Adr 011 api error format","text":"<p>id: adr-011-api-error-format title: ADR-011: Chu\u1ea9n h\u00f3a \u0111\u1ecbnh d\u1ea1ng l\u1ed7i API trong h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [api, error, format, dx-vas]</p>"},{"location":"ADR/adr-011-api-error-format/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>C\u00e1c d\u1ecbch v\u1ee5 API trong h\u1ec7 th\u1ed1ng dx-vas ph\u1ee5c v\u1ee5 nhi\u1ec1u lo\u1ea1i client: frontend web, mobile app, admin dashboard, service-to-service. \u0110\u1ec3 \u0111\u1ea3m b\u1ea3o nh\u1ea5t qu\u00e1n, d\u1ec5 debug v\u00e0 d\u1ec5 hi\u1ec3n th\u1ecb th\u00f4ng b\u00e1o l\u1ed7i cho ng\u01b0\u1eddi d\u00f9ng, c\u1ea7n m\u1ed9t \u0111\u1ecbnh d\u1ea1ng l\u1ed7i chu\u1ea9n h\u00f3a tr\u00ean to\u00e0n h\u1ec7 th\u1ed1ng.</p> <p>\ud83d\udd04 Quy\u1ebft \u0111\u1ecbnh s\u1eed d\u1ee5ng <code>trace_id</code> (thay v\u00ec <code>request_id</code>) \u0111\u1ec3 \u0111\u1ed3ng b\u1ed9 v\u1edbi h\u1ec7 th\u1ed1ng quan s\u00e1t ph\u00e2n t\u00e1n (tracing), th\u1ed1ng nh\u1ea5t v\u1edbi ADR-005 (Observability) v\u00e0 ADR-008 (Audit Logging).</p>"},{"location":"ADR/adr-011-api-error-format/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>T\u1ea5t c\u1ea3 l\u1ed7i API s\u1ebd tr\u1ea3 v\u1ec1 response JSON th\u1ed1ng nh\u1ea5t theo c\u1ea5u tr\u00fac: <pre><code>{\n  \"error\": {\n    \"code\": \"&lt;ERROR_CODE&gt;\",\n    \"message\": \"&lt;Human-readable message&gt;\",\n    \"details\": {\n      // optional, context ph\u1ee5 tr\u1ee3 cho dev/debug\n    }\n  },\n  \"meta\": {\n    \"timestamp\": \"2025-06-22T12:34:56Z\",\n    \"trace_id\": \"trace-12345\"\n  }\n}\n</code></pre> - HTTP status code v\u1eabn tr\u1ea3 v\u1ec1 \u0111\u00fang chu\u1ea9n REST (<code>400</code>, <code>401</code>, <code>403</code>, <code>404</code>, <code>500</code>...) - <code>error.code</code>: m\u00e3 l\u1ed7i t\u0129nh, \u0111\u1ec3 frontend ho\u1eb7c h\u1ec7 th\u1ed1ng kh\u00e1c d\u1ec5 b\u1eaft &amp; d\u1ecbch - <code>error.message</code>: m\u00f4 t\u1ea3 d\u1ec5 hi\u1ec3u v\u1edbi ng\u01b0\u1eddi d\u00f9ng - <code>error.details</code>: c\u00f3 th\u1ec3 bao g\u1ed3m field c\u1ee5 th\u1ec3 sai, ho\u1eb7c context th\u00eam - <code>meta.trace_id</code>: ID duy nh\u1ea5t cho m\u1ed7i request d\u00f9ng trong trace/log ph\u00e2n t\u00e1n</p>"},{"location":"ADR/adr-011-api-error-format/#danh-sach-ma-loi-chuan-hoa","title":"\ud83e\uddfe Danh s\u00e1ch m\u00e3 l\u1ed7i chu\u1ea9n h\u00f3a","text":"error.code HTTP code \u00dd ngh\u0129a <code>INVALID_INPUT</code> 400 D\u1eef li\u1ec7u \u0111\u1ea7u v\u00e0o kh\u00f4ng h\u1ee3p l\u1ec7 <code>UNAUTHORIZED</code> 401 Ch\u01b0a \u0111\u0103ng nh\u1eadp ho\u1eb7c token sai <code>FORBIDDEN</code> 403 Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n <code>NOT_FOUND</code> 404 T\u00e0i nguy\u00ean kh\u00f4ng t\u1ed3n t\u1ea1i <code>INTERNAL_ERROR</code> 500 L\u1ed7i h\u1ec7 th\u1ed1ng n\u1ed9i b\u1ed9 <code>VALIDATION_FAILED</code> 422 D\u1eef li\u1ec7u h\u1ee3p l\u1ec7 v\u1ec1 schema nh\u01b0ng sai logic <code>OTP_EXPIRED</code> 400 M\u00e3 OTP \u0111\u00e3 h\u1ebft h\u1ea1n (d\u00f9ng trong login ph\u1ee5 huynh) <code>OTP_INVALID</code> 400 M\u00e3 OTP sai ho\u1eb7c kh\u00f4ng kh\u1edbp <code>RATE_LIMITED</code> 429 G\u1ecdi API qu\u00e1 nhi\u1ec1u trong th\u1eddi gian ng\u1eafn"},{"location":"ADR/adr-011-api-error-format/#mau-phan-hoi-chi-tiet","title":"\ud83d\udce6 M\u1eabu ph\u1ea3n h\u1ed3i chi ti\u1ebft","text":""},{"location":"ADR/adr-011-api-error-format/#truong-hop-loi-http-400-otp-het-han","title":"\u274c Tr\u01b0\u1eddng h\u1ee3p l\u1ed7i (HTTP 400 \u2013 OTP h\u1ebft h\u1ea1n)","text":"<pre><code>{\n  \"error\": {\n    \"code\": \"OTP_EXPIRED\",\n    \"message\": \"M\u00e3 x\u00e1c nh\u1eadn \u0111\u00e3 h\u1ebft h\u1ea1n. Vui l\u00f2ng th\u1eed l\u1ea1i.\"\n  },\n  \"meta\": {\n    \"timestamp\": \"2025-06-22T14:01:02Z\",\n    \"trace_id\": \"trace-otp-abcd123\"\n  }\n}\n</code></pre>"},{"location":"ADR/adr-011-api-error-format/#truong-hop-thanh-cong","title":"\u2705 Tr\u01b0\u1eddng h\u1ee3p th\u00e0nh c\u00f4ng","text":"<pre><code>{\n  \"data\": {\n    \"user\": {\n      \"id\": \"u123\",\n      \"role\": \"parent\"\n    },\n    \"token\": \"&lt;JWT token&gt;\"\n  },\n  \"meta\": {\n    \"timestamp\": \"2025-06-22T14:01:02Z\",\n    \"trace_id\": \"trace-otp-abcd123\"\n  }\n}\n</code></pre>"},{"location":"ADR/adr-011-api-error-format/#inh-nghia-openapi-schema-ap-dung-tu-adr-012","title":"\ud83e\uddf0 \u0110\u1ecbnh ngh\u0129a OpenAPI Schema (\u00e1p d\u1ee5ng t\u1eeb ADR-012)","text":"<ul> <li><code>ApiErrorInternal</code>: ph\u1ea7n b\u00ean trong <code>error</code> <pre><code>ApiErrorInternal:\n  type: object\n  required:\n    - code\n    - message\n  properties:\n    code:\n      type: string\n      example: OTP_EXPIRED\n    message:\n      type: string\n      example: M\u00e3 x\u00e1c nh\u1eadn \u0111\u00e3 h\u1ebft h\u1ea1n\n    details:\n      type: object\n      additionalProperties: true\n</code></pre></li> <li><code>ApiErrorResponse</code>: <pre><code>ApiErrorResponse:\n  type: object\n  properties:\n    error:\n      $ref: '#/components/schemas/ApiErrorInternal'\n    meta:\n      $ref: '#/components/schemas/ResponseMeta'\n</code></pre></li> <li><code>ResponseMeta</code>: <pre><code>ResponseMeta:\n  type: object\n  properties:\n    timestamp:\n      type: string\n      format: date-time\n    trace_id:\n      type: string\n</code></pre></li> </ul>"},{"location":"ADR/adr-011-api-error-format/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Giao ti\u1ebfp API nh\u1ea5t qu\u00e1n, d\u1ec5 x\u1eed l\u00fd \u1edf client</li> <li>Gi\u00fap debug nhanh th\u00f4ng qua <code>trace_id</code></li> <li>Frontend d\u1ec5 hi\u1ec3n th\u1ecb th\u00f4ng b\u00e1o l\u1ed7i c\u00f3 ng\u1eef ngh\u0129a</li> </ul>"},{"location":"ADR/adr-011-api-error-format/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Qu\u00ean kh\u00f4ng d\u00f9ng chu\u1ea9n CI rule check, middleware ki\u1ec3m chu\u1ea9n L\u1ed7i \u1ea9n d\u01b0\u1edbi 200 OK Ph\u1ea3i throw r\u00f5 r\u00e0ng trong controller/service"},{"location":"ADR/adr-011-api-error-format/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Observability: ADR-005</li> <li>Auth Strategy: ADR-006</li> <li>RBAC &amp; Permission: ADR-007</li> <li>API Governance: ADR-009</li> <li>API Response Structure: ADR-012</li> <li>Audit Logging: ADR-008</li> </ul> <p>\u201cL\u1ed7i l\u00e0 \u0111i\u1ec1u kh\u00f4ng th\u1ec3 tr\u00e1nh \u2014 nh\u01b0ng chu\u1ea9n h\u00f3a gi\u00fap ta ph\u1ea3n h\u1ed3i \u0111\u00fang v\u00e0 k\u1ecbp th\u1eddi.\u201d</p>"},{"location":"ADR/adr-012-response-structure/","title":"Adr 012 response structure","text":"<p>id: adr-012-response-structure title: ADR-012: Chu\u1ea9n h\u00f3a c\u1ea5u tr\u00fac ph\u1ea3n h\u1ed3i (API Response Structure) cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Architecture Team date: 2025-06-22 tags: [api, design, response, standard, dx-vas]</p>"},{"location":"ADR/adr-012-response-structure/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>C\u00e1c API trong h\u1ec7 th\u1ed1ng dx-vas c\u1ea7n \u0111\u1ea3m b\u1ea3o:</p> <ul> <li>Frontend c\u00f3 th\u1ec3 x\u1eed l\u00fd response d\u1ec5 d\u00e0ng v\u00e0 \u0111\u1ed3ng nh\u1ea5t</li> <li>C\u00e1c service c\u00f3 th\u1ec3 t\u00edch h\u1ee3p v\u1edbi nhau v\u1edbi \u00edt c\u00f4ng s\u1ee9c chuy\u1ec3n \u0111\u1ed5i \u0111\u1ecbnh d\u1ea1ng</li> <li>D\u1eef li\u1ec7u, l\u1ed7i, v\u00e0 th\u00f4ng tin ph\u1ee5 tr\u1ee3 (metadata) \u0111\u01b0\u1ee3c t\u00e1ch b\u1ea1ch r\u00f5 r\u00e0ng</li> </ul> <p>Hi\u1ec7n t\u1ea1i, m\u1ed9t s\u1ed1 API tr\u1ea3 v\u1ec1:</p> <ul> <li>D\u1eef li\u1ec7u g\u1ed1c (list, object)</li> <li>D\u1eef li\u1ec7u g\u00f3i trong <code>{data: ...}</code></li> <li>M\u1ed9t s\u1ed1 c\u00f3 th\u00eam <code>{meta}</code>, s\u1ed1 kh\u00e1c th\u00ec kh\u00f4ng</li> </ul> <p>\u0110i\u1ec1u n\u00e0y g\u00e2y kh\u00f3 kh\u0103n khi th\u1ed1ng nh\u1ea5t v\u00e0 t\u00edch h\u1ee3p \u0111a h\u1ec7 th\u1ed1ng (API Gateway, CRM Adapter, LMS Proxy, Notification Service...).</p>"},{"location":"ADR/adr-012-response-structure/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Chu\u1ea9n h\u00f3a t\u1ea5t c\u1ea3 API tr\u1ea3 v\u1ec1 c\u1ea5u tr\u00fac ph\u1ea3n h\u1ed3i d\u1ea1ng JSON:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {...}\n}\n</code></pre> <ul> <li><code>data</code>: n\u1ed9i dung ch\u00ednh m\u00e0 API tr\u1ea3 v\u1ec1 (c\u00f3 th\u1ec3 l\u00e0 object, list, null)</li> <li><code>error</code>: null n\u1ebfu th\u00e0nh c\u00f4ng, ho\u1eb7c object l\u1ed7i tu\u00e2n th\u1ee7 ho\u00e0n to\u00e0n theo ADR-011, g\u1ed3m <code>code</code>, <code>message</code>, <code>details</code></li> <li><code>meta</code>: th\u00f4ng tin ph\u1ee5 tr\u1ee3 c\u1ee7a response, lu\u00f4n bao g\u1ed3m <code>timestamp</code> v\u00e0 <code>trace_id</code> nh\u01b0 trong ADR-011, c\u00f3 th\u1ec3 m\u1edf r\u1ed9ng th\u00eam nh\u01b0 <code>pagination</code>, <code>version</code>, <code>source</code>, <code>duration_ms</code>...</li> </ul>"},{"location":"ADR/adr-012-response-structure/#mau-phan-hoi-chi-tiet","title":"\ud83d\udce6 M\u1eabu ph\u1ea3n h\u1ed3i chi ti\u1ebft","text":""},{"location":"ADR/adr-012-response-structure/#truong-hop-thanh-cong-http-200","title":"\u2705 Tr\u01b0\u1eddng h\u1ee3p th\u00e0nh c\u00f4ng (HTTP 200)","text":"<pre><code>{\n  \"data\": {\n    \"student_id\": \"s_123\",\n    \"name\": \"Nguy\u1ec5n V\u0103n A\",\n    \"class\": \"5A\"\n  },\n  \"error\": null,\n  \"meta\": {\n    \"timestamp\": \"2025-06-22T12:00:00Z\",\n    \"trace_id\": \"trace-success-xyz789\",\n    \"version\": \"v1\",\n    \"source\": \"lms_proxy\"\n  }\n}\n</code></pre>"},{"location":"ADR/adr-012-response-structure/#truong-hop-loi-http-404","title":"\u274c Tr\u01b0\u1eddng h\u1ee3p l\u1ed7i (HTTP 404)","text":"<pre><code>{\n  \"data\": null,\n  \"error\": {\n    \"code\": \"STUDENT_NOT_FOUND\",\n    \"message\": \"Kh\u00f4ng t\u00ecm th\u1ea5y h\u1ecdc sinh v\u1edbi ID s_999\",\n    \"details\": {\n      \"student_id\": \"s_999\"\n    }\n  },\n  \"meta\": {\n    \"timestamp\": \"2025-06-22T12:01:00Z\",\n    \"trace_id\": \"abc-1234\",\n    \"source\": \"lms_proxy\"\n  }\n}\n</code></pre>"},{"location":"ADR/adr-012-response-structure/#nguyen-tac-ap-dung","title":"\ud83d\udd27 Nguy\u00ean t\u1eafc \u00e1p d\u1ee5ng","text":"<ul> <li>Lu\u00f4n c\u00f3 \u0111\u1ee7 3 tr\u01b0\u1eddng <code>data</code>, <code>error</code>, <code>meta</code> trong m\u1ecdi response</li> <li>N\u1ebfu l\u1ed7i x\u1ea3y ra, <code>data = null</code>, <code>error</code> ch\u1ee9a th\u00f4ng tin l\u1ed7i chu\u1ea9n \u2192 tham chi\u1ebfu <code>adr-011</code></li> <li>N\u1ebfu th\u00e0nh c\u00f4ng, <code>error = null</code></li> <li><code>meta</code> lu\u00f4n bao g\u1ed3m <code>timestamp</code>, <code>trace_id</code>, v\u00e0 c\u00f3 th\u1ec3 m\u1edf r\u1ed9ng th\u00eam c\u00e1c tr\u01b0\u1eddng nh\u01b0: <code>pagination</code>, <code>version</code>, <code>source</code>, <code>duration_ms</code></li> </ul>"},{"location":"ADR/adr-012-response-structure/#tich-hop-ci-openapi","title":"\ud83d\udee0 T\u00edch h\u1ee3p CI &amp; OpenAPI","text":"<pre><code>ApiResponse:\n  type: object\n  required:\n    - data\n    - error\n    - meta\n  properties:\n    data: {}\n    error:\n      type: object\n      nullable: true\n      required:\n        - code\n        - message\n      properties:\n        code:\n          type: string\n          description: M\u00e3 l\u1ed7i t\u0129nh.\n        message:\n          type: string\n          description: M\u00f4 t\u1ea3 l\u1ed7i d\u00e0nh cho ng\u01b0\u1eddi d\u00f9ng.\n        details:\n          type: object\n          nullable: true\n          description: Th\u00f4ng tin chi ti\u1ebft b\u1ed5 sung cho vi\u1ec7c g\u1ee1 l\u1ed7i (t\u00f9y ch\u1ecdn).\n          additionalProperties: true\n    meta:\n      $ref: '#/components/schemas/ResponseMeta'\n\nResponseMeta:\n  type: object\n  required:\n    - timestamp\n    - trace_id\n  properties:\n    timestamp:\n      type: string\n      format: date-time\n      description: Th\u1eddi \u0111i\u1ec3m t\u1ea1o response.\n    trace_id:\n      type: string\n      description: ID duy nh\u1ea5t \u0111\u1ec3 theo d\u00f5i request qua c\u00e1c h\u1ec7 th\u1ed1ng.\n    source:\n      type: string\n      description: T\u00ean service t\u1ea1o ra response.\n    version:\n      type: string\n      description: Phi\u00ean b\u1ea3n c\u1ee7a API.\n    duration_ms:\n      type: integer\n      description: Th\u1eddi gian x\u1eed l\u00fd request (n\u1ebfu c\u00f3)\n</code></pre> <ul> <li>Check trong CI linter: endpoint n\u00e0o kh\u00f4ng tr\u1ea3 v\u1ec1 \u0111\u1ee7 3 field s\u1ebd b\u1ecb c\u1ea3nh b\u00e1o</li> <li>M\u1eabu response chu\u1ea9n \u0111\u01b0\u1ee3c render trong Swagger / Redoc cho t\u1ea5t c\u1ea3 d\u1ecbch v\u1ee5</li> </ul>"},{"location":"ADR/adr-012-response-structure/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Frontend d\u1ec5 d\u00e0ng x\u00e2y d\u1ef1ng handler cho response chung</li> <li>D\u1ec5 log, th\u1ed1ng k\u00ea, ph\u00e2n t\u00edch request/response to\u00e0n h\u1ec7 th\u1ed1ng</li> <li>Giao ti\u1ebfp service-to-service r\u00f5 r\u00e0ng, d\u1ec5 test v\u00e0 mock</li> <li>\u0110\u1ed3ng b\u1ed9 v\u1edbi error handling (<code>adr-011</code>) v\u00e0 API Governance (<code>adr-009</code>)</li> </ul>"},{"location":"ADR/adr-012-response-structure/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p M\u1ed9t s\u1ed1 service legacy ch\u01b0a chuy\u1ec3n \u0111\u1ed5i Cung c\u1ea5p wrapper chu\u1ea9n \u0111\u1ec3 h\u1ed7 tr\u1ee3 nhanh chuy\u1ec3n \u0111\u1ed5i D\u1eef li\u1ec7u qu\u00e1 l\u1edbn d\u1eabn \u0111\u1ebfn response n\u1eb7ng S\u1eed d\u1ee5ng paging, limit, lazy loading ho\u1eb7c exclude <code>meta</code> n\u1ebfu kh\u00f4ng c\u1ea7n Frontend qu\u00ean ki\u1ec3m tra <code>error</code> v\u00e0 d\u00f9ng tr\u1ef1c ti\u1ebfp <code>data</code> Lint ho\u1eb7c wrapper \u1edf client \u0111\u1ec3 enforce quy t\u1eafc x\u1eed l\u00fd response"},{"location":"ADR/adr-012-response-structure/#cac-phuong-an-a-loai-bo","title":"\ud83d\udd04 C\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn Tr\u1ea3 tr\u1ef1c ti\u1ebfp object ho\u1eb7c list Kh\u00f4ng ph\u00e2n bi\u1ec7t r\u00f5 th\u00e0nh c\u00f4ng/th\u1ea5t b\u1ea1i Tr\u1ea3 ri\u00eang c\u1ea5u tr\u00fac cho t\u1eebng API G\u00e2y r\u1ed1i lo\u1ea1n, kh\u00f3 b\u1ea3o tr\u00ec v\u00e0 t\u00edch h\u1ee3p"},{"location":"ADR/adr-012-response-structure/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>API Error format: ADR-011</li> <li>API Governance: ADR-009</li> <li>CI/CD Strategy: ADR-001</li> </ul> <p>\"API kh\u00f4ng ch\u1ec9 c\u1ea7n \u0111\u00fang d\u1eef li\u1ec7u \u2013 m\u00e0 c\u00f2n c\u1ea7n \u0111\u00fang \u0111\u1ecbnh d\u1ea1ng.\"</p>"},{"location":"ADR/adr-013-path-naming-convention/","title":"Adr 013 path naming convention","text":"<p>id: adr-013-path-naming-convention title: ADR-013: Quy \u01b0\u1edbc \u0111\u1eb7t t\u00ean endpoint, method v\u00e0 tham s\u1ed1 cho API h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Architecture Team date: 2025-06-22 tags: [api, naming, path, rest, dx-vas]</p>"},{"location":"ADR/adr-013-path-naming-convention/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>Trong h\u1ec7 th\u1ed1ng dx-vas, nhi\u1ec1u API \u0111\u01b0\u1ee3c ph\u00e1t tri\u1ec3n b\u1edfi c\u00e1c \u0111\u1ed9i kh\u00e1c nhau. M\u1ed9t s\u1ed1 inconsistency ph\u1ed5 bi\u1ebfn \u0111\u00e3 x\u1ea3y ra: - Endpoint d\u1ea1ng <code>/getAllStudents</code>, <code>/updateCourse</code>, kh\u00f4ng tu\u00e2n theo chu\u1ea9n REST - Tham s\u1ed1 c\u00f3 l\u00fac l\u00e0 <code>snake_case</code>, l\u00fac l\u1ea1i <code>camelCase</code> - \u0110\u00f4i khi action \u0111\u01b0\u1ee3c encode v\u00e0o t\u00ean path thay v\u00ec d\u00f9ng HTTP method \u0111\u00fang c\u00e1ch</p> <p>\u0110i\u1ec1u n\u00e0y g\u00e2y kh\u00f3 kh\u0103n cho: - Ng\u01b0\u1eddi d\u00f9ng API (frontend, mobile, service kh\u00e1c) - Vi\u1ec7c sinh t\u00e0i li\u1ec7u t\u1ef1 \u0111\u1ed9ng t\u1eeb OpenAPI - Kh\u1ea3 n\u0103ng ph\u00e2n t\u00edch logs v\u00e0 theo d\u00f5i endpoint</p>"},{"location":"ADR/adr-013-path-naming-convention/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chu\u1ea9n RESTful + \u0111\u1eb7t t\u00ean nh\u1ea5t qu\u00e1n cho path, method v\u00e0 tham s\u1ed1 API to\u00e0n h\u1ec7 th\u1ed1ng, tu\u00e2n theo quy \u01b0\u1edbc c\u1ee5 th\u1ec3 sau.</p>"},{"location":"ADR/adr-013-path-naming-convention/#quy-uoc-at-ten-path","title":"\ud83d\udccf Quy \u01b0\u1edbc \u0111\u1eb7t t\u00ean path","text":""},{"location":"ADR/adr-013-path-naming-convention/#ten-tai-nguyen-dung-so-nhieu-snake_case-tieng-anh","title":"\u2705 T\u00ean t\u00e0i nguy\u00ean d\u00f9ng s\u1ed1 nhi\u1ec1u, <code>snake_case</code>, ti\u1ebfng Anh","text":"<ul> <li>V\u00ed d\u1ee5: <code>/students</code>, <code>/courses</code>, <code>/teachers</code></li> <li>N\u1ebfu truy c\u1eadp 1 ph\u1ea7n t\u1eed: <code>/students/{student_id}</code></li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#dung-tien-to-version-apiv1","title":"\u2705 D\u00f9ng ti\u1ec1n t\u1ed1 version: <code>/api/v1/...</code>","text":""},{"location":"ADR/adr-013-path-naming-convention/#khong-encode-hanh-ong-vao-ten-path","title":"\u2705 Kh\u00f4ng encode h\u00e0nh \u0111\u1ed9ng v\u00e0o t\u00ean path","text":"<ul> <li>\u274c Kh\u00f4ng d\u00f9ng: <code>/createStudent</code>, <code>/getAllCourses</code>, <code>/deleteUser</code></li> <li>\u2705 Thay b\u1eb1ng:</li> <li><code>POST /students</code></li> <li><code>GET /courses</code></li> <li><code>DELETE /users/{id}</code></li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#hanh-ong-ac-biet-dung-sub-path-dang-ong-tu","title":"\u2705 H\u00e0nh \u0111\u1ed9ng \u0111\u1eb7c bi\u1ec7t d\u00f9ng sub-path d\u1ea1ng \u0111\u1ed9ng t\u1eeb","text":"<ul> <li><code>POST /students/{id}/deactivate</code></li> <li><code>POST /classes/{id}/assign</code></li> <li>Lu\u00f4n document r\u00f5 action n\u00e0y l\u00e0 \u201ccustom\u201d</li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#tham-so-path-dung-snake_case","title":"\u2705 Tham s\u1ed1 path d\u00f9ng <code>snake_case</code>","text":"<ul> <li><code>GET /students/{student_id}</code> (not <code>studentId</code> or <code>StudentId</code>)</li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#quy-uoc-http-method","title":"\u2699\ufe0f Quy \u01b0\u1edbc HTTP Method","text":"Method M\u1ee5c \u0111\u00edch V\u00ed d\u1ee5 <code>GET</code> L\u1ea5y d\u1eef li\u1ec7u <code>GET /students</code>, <code>GET /students/{id}</code> <code>POST</code> T\u1ea1o m\u1edbi <code>POST /students</code> <code>PUT</code> Ghi \u0111\u00e8 to\u00e0n b\u1ed9 <code>PUT /students/{id}</code> <code>PATCH</code> C\u1eadp nh\u1eadt m\u1ed9t ph\u1ea7n <code>PATCH /students/{id}</code> <code>DELETE</code> Xo\u00e1 <code>DELETE /students/{id}</code>"},{"location":"ADR/adr-013-path-naming-convention/#quy-uoc-tham-so-truy-van-query-param","title":"\ud83d\udd0d Quy \u01b0\u1edbc tham s\u1ed1 truy v\u1ea5n (query param)","text":""},{"location":"ADR/adr-013-path-naming-convention/#ten-tham-so-snake_case-ro-nghia","title":"\u2705 T\u00ean tham s\u1ed1 <code>snake_case</code>, r\u00f5 ngh\u0129a","text":"<ul> <li><code>?class_id=5A&amp;page=2&amp;limit=20</code></li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#paging-su-dung-page-limit","title":"\u2705 Paging: s\u1eed d\u1ee5ng <code>page</code>, <code>limit</code>","text":"<ul> <li><code>page</code>: s\u1ed1 trang b\u1eaft \u0111\u1ea7u t\u1eeb 1</li> <li><code>limit</code>: s\u1ed1 ph\u1ea7n t\u1eed t\u1ed1i \u0111a m\u1ed7i trang</li> <li>V\u00ed d\u1ee5: <code>?page=2&amp;limit=10</code> \u2192 l\u1ea5y ph\u1ea7n t\u1eed th\u1ee9 11 \u0111\u1ebfn 20</li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#sap-xep-dung-sort_by-order","title":"\u2705 S\u1eafp x\u1ebfp: d\u00f9ng <code>sort_by</code>, <code>order</code>","text":"<ul> <li><code>sort_by</code>: t\u00ean field \u0111\u1ec3 s\u1eafp x\u1ebfp (v\u00ed d\u1ee5: <code>created_at</code>, <code>score</code>)</li> <li><code>order</code>: h\u01b0\u1edbng s\u1eafp x\u1ebfp, nh\u1eadn gi\u00e1 tr\u1ecb <code>asc</code> ho\u1eb7c <code>desc</code> (m\u1eb7c \u0111\u1ecbnh l\u00e0 <code>asc</code> n\u1ebfu kh\u00f4ng c\u00f3)</li> <li>Quy \u01b0\u1edbc \u00e1p d\u1ee5ng khi s\u1eafp x\u1ebfp nhi\u1ec1u tr\u01b0\u1eddng:</li> <li>D\u00f9ng ti\u1ec1n t\u1ed1 <code>-</code> tr\u01b0\u1edbc t\u00ean field \u0111\u1ec3 ch\u1ec9 <code>desc</code>, kh\u00f4ng c\u00f3 ti\u1ec1n t\u1ed1 l\u00e0 <code>asc</code></li> <li>V\u00ed d\u1ee5: <code>?sort_by=-created_at,name</code> \u2192 s\u1eafp x\u1ebfp <code>created_at DESC, name ASC</code></li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#kiem-tra-tu-ong","title":"\ud83e\uddea Ki\u1ec3m tra t\u1ef1 \u0111\u1ed9ng","text":"<ul> <li>T\u00edch h\u1ee3p linter v\u00e0o CI/CD \u0111\u1ec3 b\u1eaft endpoint sai \u0111\u1ecbnh d\u1ea1ng</li> <li>Lint rule cho OpenAPI generator \u0111\u1ec3 enforce path/method/param \u0111\u00fang</li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Gi\u1ea3m chi ph\u00ed h\u1ecdc API cho dev m\u1edbi, client</li> <li>T\u0103ng kh\u1ea3 n\u0103ng sinh docs, test, mock t\u1ef1 \u0111\u1ed9ng</li> <li>Th\u1ed1ng nh\u1ea5t khi log v\u00e0 monitor endpoint API</li> </ul>"},{"location":"ADR/adr-013-path-naming-convention/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p C\u00e1c API legacy kh\u00f4ng theo chu\u1ea9n C\u00f3 layer chuy\u1ec3n \u0111\u1ed5i t\u1ea1m (alias route), ho\u1eb7c b\u1ed5 sung docs c\u1ea3nh b\u00e1o M\u1ed9t s\u1ed1 action \u0111\u1eb7c bi\u1ec7t kh\u00f4ng th\u1ec3 bi\u1ec3u di\u1ec5n b\u1eb1ng REST Cho ph\u00e9p d\u00f9ng <code>/resource/{id}/action</code> d\u1ea1ng POST, nh\u01b0ng ph\u1ea3i document r\u00f5"},{"location":"ADR/adr-013-path-naming-convention/#cac-phuong-an-a-loai-bo","title":"\ud83d\udd04 C\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn \u0110\u1eb7t t\u00ean tu\u1ef3 \u00fd theo h\u00e0nh \u0111\u1ed9ng (get, create...) Vi ph\u1ea1m chu\u1ea9n REST, kh\u00f3 sinh tool/docs D\u00f9ng camelCase trong path/params Kh\u00f4ng th\u1ed1ng nh\u1ea5t v\u1edbi ph\u1ea7n c\u00f2n l\u1ea1i (\u0111a s\u1ed1 codebase snake_case)"},{"location":"ADR/adr-013-path-naming-convention/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>API Error format: ADR-011</li> <li>API Governance: ADR-009</li> <li>CI/CD Strategy: ADR-001</li> </ul> <p>\"M\u1ed9t API t\u1ed1t \u0111\u01b0\u1ee3c nh\u1eadn bi\u1ebft kh\u00f4ng ch\u1ec9 qua d\u1eef li\u1ec7u n\u00f3 tr\u1ea3 \u2013 m\u00e0 qua c\u00e1ch n\u00f3 \u0111\u1eb7t t\u00ean.\"</p>"},{"location":"ADR/adr-014-zero-downtime/","title":"Adr 014 zero downtime","text":"<p>id: adr-014-zero-downtime title: ADR-014: Chi\u1ebfn l\u01b0\u1ee3c Tri\u1ec3n khai Kh\u00f4ng Gi\u00e1n \u0110o\u1ea1n (Zero-Downtime Deployment) cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [deployment, cloud-run, traffic-split, dx-vas]</p>"},{"location":"ADR/adr-014-zero-downtime/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas bao g\u1ed3m nhi\u1ec1u lo\u1ea1i d\u1ecbch v\u1ee5: - API Gateway (critical) - C\u00e1c backend adapters (LMS, CRM, Notification) - Frontend WebApp (Admin, Portal)</p> <p>C\u00e1c d\u1ecbch v\u1ee5 n\u00e0y \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\u00ean n\u1ec1n t\u1ea3ng Google Cloud Run, v\u1ed1n h\u1ed7 tr\u1ee3 rolling update v\u00e0 traffic splitting qua revision. Tuy nhi\u00ean, n\u1ebfu tri\u1ec3n khai kh\u00f4ng \u0111\u00fang c\u00e1ch, v\u1eabn c\u00f3 th\u1ec3 g\u00e2y: - M\u1ea5t phi\u00ean l\u00e0m vi\u1ec7c (session/token invalid) - L\u1ed7i b\u1ea5t t\u01b0\u01a1ng th\u00edch schema khi database ho\u1eb7c contract kh\u00f4ng backward-compatible - Tr\u1ea1ng th\u00e1i t\u1ea1m th\u1eddi \"n\u1eeda version n\u00e0y, n\u1eeda version kh\u00e1c\" g\u00e2y l\u1ed7i frontend/backend</p>"},{"location":"ADR/adr-014-zero-downtime/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai kh\u00f4ng gi\u00e1n \u0111o\u1ea1n (zero-downtime) cho to\u00e0n h\u1ec7 th\u1ed1ng dx-vas, b\u1eb1ng c\u00e1ch s\u1eed d\u1ee5ng Cloud Run revision, ki\u1ec3m so\u00e1t traffic shifting, \u0111\u1ea3m b\u1ea3o backward compatibility v\u00e0 ki\u1ec3m th\u1eed k\u1ef9 tr\u01b0\u1edbc khi full rollout.</p>"},{"location":"ADR/adr-014-zero-downtime/#nguyen-tac-trien-khai-an-toan","title":"\ud83e\udde9 Nguy\u00ean t\u1eafc tri\u1ec3n khai an to\u00e0n","text":""},{"location":"ADR/adr-014-zero-downtime/#1-su-dung-revision-trong-cloud-run","title":"1. S\u1eed d\u1ee5ng Revision trong Cloud Run","text":"<ul> <li>M\u1ed7i deploy t\u1ea1o ra 1 revision m\u1edbi \u2192 kh\u00f4ng ghi \u0111\u00e8</li> <li>Revisions \u0111\u01b0\u1ee3c \u0111\u1ecbnh danh theo Git SHA ho\u1eb7c <code>app_version</code></li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#2-traffic-splitting-canary","title":"2. Traffic Splitting / Canary","text":"<ul> <li>B\u1eaft \u0111\u1ea7u v\u1edbi <code>1%</code>, <code>10%</code>, <code>25%</code>, <code>50%</code> \u2192 ki\u1ec3m tra log, error rate, latency</li> <li>Sau \u0111\u00f3 m\u1edbi <code>100%</code> \u2192 stable rollout</li> <li>C\u00f3 th\u1ec3 rollback ngay v\u1ec1 revision c\u0169 n\u1ebfu l\u1ed7i xu\u1ea5t hi\u1ec7n</li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#3-backward-compatibility-bc","title":"3. Backward Compatibility (BC)","text":"<ul> <li>M\u1ecdi API m\u1edbi ph\u1ea3i:</li> <li>Gi\u1eef nguy\u00ean format response c\u0169</li> <li>Kh\u00f4ng b\u1eaft bu\u1ed9c c\u00e1c field m\u1edbi khi deserialize (frontend, consumer)</li> <li>\u0110\u1ea3m b\u1ea3o DB migration l\u00e0 additive (<code>ADD COLUMN</code>, kh\u00f4ng <code>DROP</code>/<code>RENAME</code> ngay)</li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#4-db-migration-an-toan","title":"4. DB Migration an to\u00e0n","text":"<ul> <li>Migration t\u00e1ch bi\u1ec7t kh\u1ecfi deploy (ch\u1ea1y tr\u01b0\u1edbc)</li> <li>Add field tr\u01b0\u1edbc \u2013 app d\u00f9ng field sau</li> <li>Sau khi deploy \u1ed5n \u0111\u1ecbnh \u2192 cleanup field c\u0169 (qua release sau)</li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#5-health-check-startup-readiness","title":"5. Health Check &amp; Startup Readiness","text":"<ul> <li>S\u1eed d\u1ee5ng <code>startup probe</code> ho\u1eb7c <code>readiness probe</code> \u0111\u1ec3 tr\u00e1nh nh\u1eadn traffic qu\u00e1 s\u1edbm</li> <li>B\u1eaft bu\u1ed9c tr\u1ea3 HTTP 200 t\u1ea1i <code>/healthz</code>, <code>/readyz</code> tr\u01b0\u1edbc khi nh\u1eadn request th\u1eadt</li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#6-sessiontoken-stability","title":"6. Session/Token Stability","text":"<ul> <li>JWT k\u00fd v\u1edbi key ch\u01b0a thay \u0111\u1ed5i \u2192 client kh\u00f4ng b\u1ecb logout</li> <li>Kh\u00f4ng x\u00f3a refresh token / session store trong qu\u00e1 tr\u00ecnh deploy</li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#tich-hop-cicd","title":"\ud83e\uddea T\u00edch h\u1ee3p CI/CD","text":"<ul> <li>Tri\u1ec3n khai staging auto 100% traffic khi merge v\u00e0o <code>dev</code></li> <li>Tri\u1ec3n khai production manual + canary khi merge v\u00e0o <code>main</code></li> <li>Canary theo tag: <code>--tag canary-v1</code></li> <li>Rollback qua UI ho\u1eb7c <code>gcloud run services update-traffic</code></li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#ap-dung-linh-hoat-theo-dich-vu","title":"\ud83d\udd27 \u00c1p d\u1ee5ng linh ho\u1ea1t theo d\u1ecbch v\u1ee5","text":"Lo\u1ea1i service Chi\u1ebfn l\u01b0\u1ee3c c\u1ee5 th\u1ec3 API Gateway Canary + rollout ch\u1eb7t, BC nghi\u00eam ng\u1eb7t LMS/CRM Adapter C\u00f3 th\u1ec3 rollout nhanh h\u01a1n, mi\u1ec5n kh\u00f4ng vi ph\u1ea1m contract Frontend Webapp Tri\u1ec3n khai SSR Cloud Run \u2192 n\u00ean d\u00f9ng Canary n\u1ebfu g\u1eafn session/token Notification Service \u00cdt critical h\u01a1n \u2192 rollout nhanh, test k\u1ef9 queue retry"},{"location":"ADR/adr-014-zero-downtime/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Tr\u00e1nh downtime g\u00e2y gi\u00e1n \u0111o\u1ea1n cho ng\u01b0\u1eddi d\u00f9ng</li> <li>Tri\u1ec3n khai c\u00f3 th\u1ec3 rollback nhanh ch\u00f3ng</li> <li>\u0110\u1ea3m b\u1ea3o \u1ed5n \u0111\u1ecbnh h\u1ec7 th\u1ed1ng d\u00f9 \u0111ang n\u00e2ng c\u1ea5p</li> </ul>"},{"location":"ADR/adr-014-zero-downtime/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p \u0110\u1ea9y traffic qu\u00e1 nhanh \u2192 kh\u00f4ng ph\u00e1t hi\u1ec7n l\u1ed7i k\u1ecbp Chia nh\u1ecf canary, theo d\u00f5i error rate, latency B\u1ea5t t\u01b0\u01a1ng th\u00edch DB \u2192 l\u1ed7i runtime Lu\u00f4n ch\u1ea1y migration t\u00e1ch bi\u1ec7t, forward-compatible tr\u01b0\u1edbc Version mismatch gi\u1eefa frontend/backend D\u00f9ng header <code>X-App-Version</code>, log mismatch, tr\u00e1nh breaking change"},{"location":"ADR/adr-014-zero-downtime/#cac-phuong-an-a-loai-bo","title":"\ud83d\udd04 C\u00e1c ph\u01b0\u01a1ng \u00e1n \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"Ph\u01b0\u01a1ng \u00e1n L\u00fd do kh\u00f4ng ch\u1ecdn Redeploy \u0111\u00e8 revision (default) Kh\u00f4ng rollback \u0111\u01b0\u1ee3c, d\u1ec5 m\u1ea5t session, kh\u00f3 trace l\u1ed7i Manual rollout kh\u00f4ng ki\u1ec3m so\u00e1t traffic Kh\u00f4ng ph\u00f9 h\u1ee3p h\u1ec7 th\u1ed1ng c\u1ea7n SLA cao"},{"location":"ADR/adr-014-zero-downtime/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>API Governance: ADR-009</li> <li>CI/CD Strategy: ADR-001</li> <li>Env Config: ADR-005</li> </ul> <p>\u201cTri\u1ec3n khai kh\u00f4ng gi\u00e1n \u0111o\u1ea1n kh\u00f4ng ph\u1ea3i l\u00e0 may m\u1eafn \u2013 m\u00e0 l\u00e0 k\u1ef9 thu\u1eadt.\u201d</p>"},{"location":"ADR/adr-015-deployment-strategy/","title":"Adr 015 deployment strategy","text":"<p>id: adr-015-deployment-strategy title: ADR-015: Chi\u1ebfn l\u01b0\u1ee3c Tri\u1ec3n khai cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [deployment, strategy, cloud-run, ci-cd, dx-vas]</p>"},{"location":"ADR/adr-015-deployment-strategy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 sinh th\u00e1i dx-vas bao g\u1ed3m nhi\u1ec1u lo\u1ea1i d\u1ecbch v\u1ee5: - D\u1ecbch v\u1ee5 frontend (SSR App Portal, Admin) - D\u1ecbch v\u1ee5 backend (API Gateway, LMS/CRM Adapter, Notification) - D\u1ecbch v\u1ee5 batch/ng\u1ea7m ho\u1eb7c t\u00edch h\u1ee3p b\u00ean ngo\u00e0i</p> <p>M\u1ed7i lo\u1ea1i d\u1ecbch v\u1ee5 c\u00f3 \u0111\u1eb7c th\u00f9 kh\u00e1c nhau v\u1ec1: - \u0110\u1ed9 critical (\u1ea3nh h\u01b0\u1edfng ng\u01b0\u1eddi d\u00f9ng th\u1ef1c, backend n\u1ed9i b\u1ed9...) - Kh\u1ea3 n\u0103ng rollback - T\u1ea7n su\u1ea5t release</p> <p>Vi\u1ec7c chu\u1ea9n ho\u00e1 c\u00e1c chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai ph\u00f9 h\u1ee3p cho t\u1eebng lo\u1ea1i l\u00e0 c\u1ea7n thi\u1ebft \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o: - Tr\u00e1nh downtime, sai l\u1ec7ch version - C\u00f3 rollback r\u00f5 r\u00e0ng n\u1ebfu x\u1ea3y ra l\u1ed7i - T\u1ed1i \u01b0u chi ph\u00ed v\u00e0 th\u1eddi gian tri\u1ec3n khai</p>"},{"location":"ADR/adr-015-deployment-strategy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng t\u1eadp h\u1ee3p c\u00e1c chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai chu\u1ea9n (manual, auto, canary, blue/green, progressive, rolling) cho h\u1ec7 th\u1ed1ng dx-vas. CI/CD s\u1ebd h\u1ed7 tr\u1ee3 l\u1ef1a ch\u1ecdn \u0111\u1ed9ng t\u00f9y v\u00e0o service v\u00e0 m\u00f4i tr\u01b0\u1eddng.</p>"},{"location":"ADR/adr-015-deployment-strategy/#chi-tiet-cac-chien-luoc-trien-khai","title":"\ud83d\udee0 Chi ti\u1ebft c\u00e1c chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai","text":""},{"location":"ADR/adr-015-deployment-strategy/#1-manual-deployment","title":"1. Manual Deployment","text":"<ul> <li>M\u00f4 t\u1ea3: Deploy th\u1ee7 c\u00f4ng b\u1eb1ng tay (UI/CLI) c\u00f3 ki\u1ec3m so\u00e1t ng\u01b0\u1eddi th\u1ef1c hi\u1ec7n</li> <li>S\u1eed d\u1ee5ng cho:</li> <li>Production critical service c\u00f3 release l\u1edbn</li> <li>Tr\u01b0\u1eddng h\u1ee3p kh\u1ea9n c\u1ea5p c\u1ea7n ki\u1ec3m so\u00e1t cao</li> <li>\u01afu \u0111i\u1ec3m: Ki\u1ec3m so\u00e1t k\u1ef9, an to\u00e0n h\u01a1n</li> <li>Nh\u01b0\u1ee3c \u0111i\u1ec3m: D\u1ec5 qu\u00ean b\u01b0\u1edbc, kh\u00f4ng l\u1eb7p l\u1ea1i \u0111\u01b0\u1ee3c, d\u1ec5 l\u1ed7i ng\u01b0\u1eddi</li> </ul>"},{"location":"ADR/adr-015-deployment-strategy/#2-automated-deployment-to-staging","title":"2. Automated Deployment (to Staging)","text":"<ul> <li>M\u00f4 t\u1ea3: Deploy t\u1ef1 \u0111\u1ed9ng khi CI pass tr\u00ean nh\u00e1nh <code>dev</code></li> <li>S\u1eed d\u1ee5ng cho:</li> <li>Staging c\u1ee7a m\u1ecdi service</li> <li>\u01afu \u0111i\u1ec3m: Nhanh, li\u00ean t\u1ee5c, ph\u00e1t hi\u1ec7n l\u1ed7i s\u1edbm</li> <li>Nh\u01b0\u1ee3c \u0111i\u1ec3m: Kh\u00f4ng ki\u1ec3m so\u00e1t production release</li> </ul>"},{"location":"ADR/adr-015-deployment-strategy/#3-rolling-update-cloud-run-default","title":"3. Rolling Update (Cloud Run Default)","text":"<ul> <li>M\u00f4 t\u1ea3: C\u1eadp nh\u1eadt revision m\u1edbi \u2192 t\u1eebng request chuy\u1ec3n d\u1ea7n sang revision m\u1edbi</li> <li>S\u1eed d\u1ee5ng cho:</li> <li>Service \u00edt critical, kh\u00f4ng gi\u1eef state</li> <li>\u01afu \u0111i\u1ec3m: \u0110\u01a1n gi\u1ea3n, kh\u00f4ng c\u1ea5u h\u00ecnh th\u00eam</li> <li>Nh\u01b0\u1ee3c \u0111i\u1ec3m: Kh\u00f4ng c\u00f3 b\u01b0\u1edbc ki\u1ec3m so\u00e1t traffic nh\u01b0 Canary</li> <li>Kh\u1ea3 n\u0103ng rollback:</li> <li>Cloud Run lu\u00f4n t\u1ea1o revision m\u1edbi \u2192 rollback = update traffic v\u1ec1 revision c\u0169</li> <li>Nh\u01b0ng rolling kh\u00f4ng c\u00f3 c\u00e1c b\u01b0\u1edbc chia traffic tinh vi nh\u01b0 Canary hay m\u00f4i tr\u01b0\u1eddng song song nh\u01b0 Blue/Green</li> </ul>"},{"location":"ADR/adr-015-deployment-strategy/#4-canary-release","title":"4. Canary Release","text":"<ul> <li>M\u00f4 t\u1ea3: Tri\u1ec3n khai phi\u00ean b\u1ea3n m\u1edbi t\u1edbi 1%/10% traffic \u2192 gi\u00e1m s\u00e1t \u2192 t\u0103ng d\u1ea7n</li> <li>S\u1eed d\u1ee5ng cho:</li> <li>API Gateway, Frontend SSR, LMS Adapter</li> <li>\u01afu \u0111i\u1ec3m: Ph\u00e1t hi\u1ec7n s\u1edbm l\u1ed7i, rollback nhanh</li> <li>Nh\u01b0\u1ee3c \u0111i\u1ec3m: Ph\u1ee9c t\u1ea1p h\u01a1n trong CI/CD, c\u1ea7n alert/metric</li> <li>Chi ti\u1ebft rollout:</li> <li><code>10%</code> \u2192 <code>25%</code> \u2192 <code>50%</code> \u2192 <code>100%</code></li> <li>Gi\u00e1m s\u00e1t <code>error_rate</code>, <code>latency</code>, <code>availability</code></li> <li>Rollback b\u1eb1ng <code>update-traffic</code> v\u1ec1 revision tr\u01b0\u1edbc</li> <li>Li\u00ean k\u1ebft k\u1ef9 thu\u1eadt: <code>adr-014-zero-downtime.md</code></li> </ul>"},{"location":"ADR/adr-015-deployment-strategy/#5-bluegreen-deployment","title":"5. Blue/Green Deployment","text":"<ul> <li>M\u00f4 t\u1ea3: Tri\u1ec3n khai v\u00e0o m\u00f4i tr\u01b0\u1eddng t\u00e1ch bi\u1ec7t (green), ki\u1ec3m th\u1eed \u2192 chuy\u1ec3n traffic to\u00e0n b\u1ed9 t\u1eeb blue \u2192 green n\u1ebfu OK</li> <li>S\u1eed d\u1ee5ng cho:</li> <li>Thay \u0111\u1ed5i l\u1edbn, c\u00f3 th\u1ec3 g\u00e2y m\u1ea5t t\u01b0\u01a1ng th\u00edch</li> <li>Khi c\u1ea7n ki\u1ec3m th\u1eed th\u1ef1c t\u1ebf nh\u01b0ng kh\u00f4ng \u1ea3nh h\u01b0\u1edfng ng\u01b0\u1eddi d\u00f9ng</li> <li>\u01afu \u0111i\u1ec3m: Rollback nhanh b\u1eb1ng c\u00e1ch switch l\u1ea1i blue</li> <li>Nh\u01b0\u1ee3c \u0111i\u1ec3m: T\u1ed1n t\u00e0i nguy\u00ean (2 m\u00f4i tr\u01b0\u1eddng), kh\u00f3 duy tr\u00ec state \u0111\u1ed3ng b\u1ed9</li> <li>Tri\u1ec3n khai tr\u00ean Cloud Run:</li> <li>D\u00f9ng <code>tag</code>: <code>blue</code>, <code>green</code></li> <li>Chuy\u1ec3n traffic b\u1eb1ng <code>gcloud run services update-traffic --to-tags</code></li> </ul>"},{"location":"ADR/adr-015-deployment-strategy/#6-progressive-rollout-gate-driven","title":"6. Progressive Rollout (Gate-driven)","text":"<ul> <li>M\u00f4 t\u1ea3: T\u0103ng d\u1ea7n traffic + trigger b\u1edfi review ho\u1eb7c metric</li> <li>S\u1eed d\u1ee5ng cho:</li> <li>C\u00e1c service c\u00f3 SLA cao, kh\u00f4ng th\u1ec3 ch\u1ecbu downtime</li> <li>\u01afu \u0111i\u1ec3m: Ki\u1ec3m so\u00e1t c\u1ef1c t\u1ed1t, rollback t\u1eebng b\u01b0\u1edbc</li> <li>Nh\u01b0\u1ee3c \u0111i\u1ec3m: R\u1ea5t ph\u1ee9c t\u1ea1p, ch\u1ec9 \u00e1p d\u1ee5ng khi c\u1ea7n nghi\u00eam ng\u1eb7t</li> <li>V\u00ed d\u1ee5:</li> <li><code>5%</code> \u2192 review \u2705</li> <li><code>25%</code> \u2192 monitor \u2705</li> <li><code>100%</code></li> </ul>"},{"location":"ADR/adr-015-deployment-strategy/#huong-dan-lua-chon-chien-luoc","title":"\ud83e\udded H\u01b0\u1edbng d\u1eabn l\u1ef1a ch\u1ecdn chi\u1ebfn l\u01b0\u1ee3c","text":"Ti\u00eau ch\u00ed Manual Auto Rolling Canary Blue/Green Progressive Critical service \u2705 \u274c \u274c \u2705 \u2705 \u2705\u2705 Backend kh\u00f4ng gi\u1eef state \u2705 \u2705 \u2705 \u2705 \u2705 \u274c C\u00f3 schema migration \u2705 \u274c \u274c \u2705 \u2705 \u2705 Y\u00eau c\u1ea7u rollback nhanh \u274c \u274c \u2705 \u2705 \u2705 \u2705 Nh\u1ecf, internal, low risk \u274c \u2705 \u2705 \u2705 \u274c \u274c"},{"location":"ADR/adr-015-deployment-strategy/#chien-luoc-rollback","title":"\ud83d\udd01 Chi\u1ebfn l\u01b0\u1ee3c rollback","text":"Chi\u1ebfn l\u01b0\u1ee3c C\u00e1ch rollback Manual Revert th\u1ee7 c\u00f4ng t\u1eeb Git/Cloud Run UI Auto Revert commit + re-trigger CI/CD Rolling Update traffic v\u1ec1 revision tr\u01b0\u1edbc (pin l\u1ea1i revision c\u0169) Canary Update traffic v\u1ec1 revision tr\u01b0\u1edbc Blue/Green Switch l\u1ea1i tag <code>blue</code> Progressive Ng\u1eebng rollout + rollback traffic <p>M\u1ecdi rollback production ph\u1ea3i c\u00f3 ph\u00ea duy\u1ec7t theo [<code>adr-018-release-approval-policy.md</code>]</p>"},{"location":"ADR/adr-015-deployment-strategy/#tich-hop-cicd","title":"\ud83d\udd04 T\u00edch h\u1ee3p CI/CD","text":"<ul> <li>GitHub Actions pipeline:</li> <li><code>dev</code> branch \u2192 auto deploy staging</li> <li><code>main</code> branch \u2192 deploy production theo chi\u1ebfn l\u01b0\u1ee3c:<ul> <li>C\u00f3 file <code>.deployment-strategy.yml</code></li> <li>CI quy\u1ebft \u0111\u1ecbnh: rolling / canary / blue/green</li> </ul> </li> <li>Canary monitor metric t\u1eeb <code>Cloud Monitoring</code></li> <li>Terraform modules h\u1ed7 tr\u1ee3 traffic split/tag Cloud Run revision</li> </ul>"},{"location":"ADR/adr-015-deployment-strategy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>CI/CD Strategy: ADR-001</li> <li>Env Config: ADR-005</li> <li>Zero downtime: ADR-014</li> <li>Release Approval Policy: ADR-018</li> </ul> <p>\"Tri\u1ec3n khai \u0111\u00fang kh\u00f4ng ch\u1ec9 l\u00e0 push code \u2013 m\u00e0 l\u00e0 ki\u1ec3m so\u00e1t r\u1ee7i ro v\u00e0 t\u1ea1o ni\u1ec1m tin.\"</p>"},{"location":"ADR/adr-016-auto-scaling/","title":"Adr 016 auto scaling","text":"<p>id: adr-016-auto-scaling title: ADR-016: Chi\u1ebfn l\u01b0\u1ee3c Auto Scaling cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [scaling, cloud-run, performance, cost, dx-vas]</p>"},{"location":"ADR/adr-016-auto-scaling/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>C\u00e1c d\u1ecbch v\u1ee5 trong h\u1ec7 th\u1ed1ng dx-vas (API Gateway, LMS Adapter, CRM Proxy, SSR frontend...) \u0111\u1ec1u tri\u1ec3n khai tr\u00ean Google Cloud Run, n\u01a1i m\u1ed7i service c\u00f3 th\u1ec3 scale \u0111\u1ed9c l\u1eadp. Vi\u1ec7c kh\u00f4ng t\u1ed1i \u01b0u h\u00f3a auto scaling s\u1ebd d\u1eabn \u0111\u1ebfn: - Ch\u1eadm ph\u1ea3n h\u1ed3i ho\u1eb7c timeout khi traffic t\u0103ng cao \u0111\u1ed9t ng\u1ed9t - T\u1ed1n chi ph\u00ed khi duy tr\u00ec qu\u00e1 nhi\u1ec1u instance kh\u00f4ng c\u1ea7n thi\u1ebft - D\u1ec5 v\u01b0\u1ee3t quota ho\u1eb7c b\u1ecb rate-limit n\u1ebfu concurrency kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5u h\u00ecnh \u0111\u00fang</p>"},{"location":"ADR/adr-016-auto-scaling/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c auto scaling t\u1ed1i \u01b0u cho t\u1eebng lo\u1ea1i service trong h\u1ec7 th\u1ed1ng dx-vas, s\u1eed d\u1ee5ng Cloud Run concurrency, min/max instance v\u00e0 metric-based scaling \u0111\u1ec3 c\u00e2n b\u1eb1ng chi ph\u00ed \u2013 hi\u1ec7u n\u0103ng \u2013 \u0111\u1ed9 tin c\u1eady.</p>"},{"location":"ADR/adr-016-auto-scaling/#cau-hinh-cloud-run-e-xuat","title":"\u2699\ufe0f C\u1ea5u h\u00ecnh Cloud Run \u0111\u1ec1 xu\u1ea5t","text":"Lo\u1ea1i service Concurrency Min instance Max instance Kh\u00e1c API Gateway 1 2 (always warm) 10 latency-sensitive LMS/CRM Adapter 10 0 20 x\u1eed l\u00fd IO/batch t\u1ed1t Frontend SSR 2 1 5 c\u1ea7n warm start \u0111\u1ec3 SSR nhanh Notification Service 20 0 5 background burst"},{"location":"ADR/adr-016-auto-scaling/#giai-thich","title":"\u2705 Gi\u1ea3i th\u00edch:","text":"<ul> <li>Concurrency:</li> <li>API Gateway \u0111\u01b0\u1ee3c c\u1ea5u h\u00ecnh <code>concurrency = 1</code> do \u0111\u1eb7c t\u00ednh latency-sensitive v\u00e0 \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o m\u1ed7i request \u0111\u01b0\u1ee3c x\u1eed l\u00fd nhanh nh\u1ea5t c\u00f3 th\u1ec3 tr\u00ean m\u1ed9t instance, tr\u00e1nh \u1ea3nh h\u01b0\u1edfng l\u1eabn nhau gi\u1eefa c\u00e1c request song song. \u0110i\u1ec1u n\u00e0y gi\u00fap gi\u1ea3m \u0111\u1ed9 tr\u1ec5 t\u1eebng request, nh\u01b0ng c\u00f3 th\u1ec3 d\u1eabn \u0111\u1ebfn c\u1ea7n nhi\u1ec1u instance h\u01a1n khi traffic cao. Gi\u00e1 tr\u1ecb n\u00e0y s\u1ebd \u0111\u01b0\u1ee3c theo d\u00f5i v\u00e0 tinh ch\u1ec9nh d\u1ef1a tr\u00ean k\u1ebft qu\u1ea3 load testing v\u00e0 d\u1eef li\u1ec7u v\u1eadn h\u00e0nh th\u1ef1c t\u1ebf.</li> <li> <p><code>10\u201320</code> cho service IO-bound (adapter, notification)</p> </li> <li> <p>Min instance:</p> </li> <li><code>&gt;0</code> n\u1ebfu mu\u1ed1n warm start (frontend SSR, Gateway)</li> <li> <p><code>0</code> cho service kh\u00f4ng c\u1ea7n s\u1eb5n s\u00e0ng li\u00ean t\u1ee5c (adapter, batch)</p> </li> <li> <p>Max instance:</p> </li> <li>T\u00f9y v\u00e0o quota, chi ph\u00ed v\u00e0 SLA</li> </ul>"},{"location":"ADR/adr-016-auto-scaling/#auto-scaling-theo-metric","title":"\ud83d\udd0d Auto Scaling theo Metric","text":"<p>Cloud Run scale d\u1ef1a tr\u00ean: - CPU utilization - Request latency / concurrency - Traffic volume (HTTP request rate)</p> <p>Ghi ch\u00fa: h\u00e0nh vi \"scale out n\u1ebfu error rate t\u0103ng cao + concurrency &gt; ng\u01b0\u1ee1ng\" l\u00e0 quan s\u00e1t t\u1eeb behavior m\u1eb7c \u0111\u1ecbnh c\u1ee7a Cloud Run, ch\u1ee9 kh\u00f4ng ph\u1ea3i m\u1ed9t h\u00e0nh \u0111\u1ed9ng ch\u1ee7 \u0111\u1ed9ng t\u1ef1 \u0111\u1ed9ng ho\u00e1. Tuy nhi\u00ean, c\u00e1c alert n\u00e0y c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c d\u00f9ng \u0111\u1ec3 trigger h\u00e0nh \u0111\u1ed9ng nh\u01b0 t\u0103ng <code>min_instances</code> t\u1ea1m th\u1eddi ho\u1eb7c ki\u1ec3m tra l\u1ea1i c\u1ea5u h\u00ecnh autoscaling.</p> <p>S\u1ebd t\u00edch h\u1ee3p alert qua: - Cloud Monitoring: alert n\u1ebfu request latency &gt; 2s - Scale out behavior \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 t\u1ef1 \u0111\u1ed9ng, nh\u01b0ng c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c k\u1ebft h\u1ee3p v\u1edbi script \u0111i\u1ec1u ch\u1ec9nh th\u1ee7 c\u00f4ng n\u1ebfu c\u1ea7n</p>"},{"location":"ADR/adr-016-auto-scaling/#tich-hop-cicd-terraform","title":"\ud83d\udee0 T\u00edch h\u1ee3p CI/CD &amp; Terraform","text":"<ul> <li>M\u1ed7i service c\u00f3 file <code>infra.tf</code> \u0111\u1ecbnh ngh\u0129a: <pre><code>resource \"google_cloud_run_service\" \"service_name\" {\n  template {\n    spec {\n      container_concurrency = 10\n      min_instances = 0\n      max_instances = 20\n    }\n  }\n}\n</code></pre></li> <li>GitHub Actions s\u1ebd validate scaling config tr\u01b0\u1edbc deploy (check hard limit, quota)</li> <li>C\u00f3 th\u1ec3 t\u00e1ch autoscaling policy ra file ri\u00eang (module reusable)</li> </ul>"},{"location":"ADR/adr-016-auto-scaling/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>T\u0103ng hi\u1ec7u n\u0103ng khi c\u1ea7n, ti\u1ebft ki\u1ec7m khi idle</li> <li>Tr\u00e1nh cold start v\u1edbi d\u1ecbch v\u1ee5 c\u1ea7n ph\u1ea3n h\u1ed3i nhanh (gateway, frontend SSR)</li> <li>Ch\u1ee7 \u0111\u1ed9ng ki\u1ec3m so\u00e1t chi ph\u00ed Cloud Run</li> </ul>"},{"location":"ADR/adr-016-auto-scaling/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Scale qu\u00e1 nhanh \u2192 backend overload Gi\u1edbi h\u1ea1n <code>max_instance</code> + alert precondition Cold start g\u00e2y ch\u1eadm cho user \u0111\u1ea7u ti\u00ean Gi\u1eef <code>min_instance &gt; 0</code> cho service critical Thay \u0111\u1ed5i concurrency kh\u00f4ng \u0111\u1ed3ng b\u1ed9 v\u1edbi logic service Document r\u00f5 r\u00e0ng, enforced qua CI review v\u00e0 th\u00f4ng qua load testing k\u1ef9 l\u01b0\u1ee1ng"},{"location":"ADR/adr-016-auto-scaling/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>CI/CD Strategy: ADR-001</li> <li>Zero downtime: ADR-014</li> <li>Deployment Strategy: ADR-015</li> </ul> <p>\u201cAuto Scaling kh\u00f4ng ch\u1ec9 \u0111\u1ec3 ti\u1ebft ki\u1ec7m \u2013 m\u00e0 l\u00e0 \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o b\u1ea1n lu\u00f4n s\u1eb5n s\u00e0ng.\u201d</p>"},{"location":"ADR/adr-017-env-deploy-boundary/","title":"Adr 017 env deploy boundary","text":"<p>id: adr-017-env-deploy-boundary title: ADR-017: Quy t\u1eafc tri\u1ec3n khai theo m\u00f4i tr\u01b0\u1eddng cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [environment, deployment, boundary, dx-vas, config]</p>"},{"location":"ADR/adr-017-env-deploy-boundary/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas v\u1eadn h\u00e0nh qua nhi\u1ec1u m\u00f4i tr\u01b0\u1eddng: - <code>dev</code>: ph\u00e1t tri\u1ec3n, test c\u00e1 nh\u00e2n, staging n\u1ed9i b\u1ed9 - <code>staging</code>: ki\u1ec3m th\u1eed t\u00edch h\u1ee3p, pre-prod, tr\u00ecnh di\u1ec5n - <code>production</code>: m\u00f4i tr\u01b0\u1eddng ch\u00ednh th\u1ee9c ph\u1ee5c v\u1ee5 ng\u01b0\u1eddi d\u00f9ng th\u1ef1c - <code>sandbox</code>: d\u00f9ng cho API c\u00f4ng khai b\u00ean ngo\u00e0i</p> <p>C\u00e1c l\u1ed7i tri\u1ec3n khai th\u01b0\u1eddng \u0111\u1ebfn t\u1eeb: - Deploy sai config m\u00f4i tr\u01b0\u1eddng - Rollback nh\u1ea7m gi\u1eefa staging v\u00e0 production - Kh\u00f4ng c\u00f3 quy t\u1eafc r\u00f5 r\u00e0ng v\u1ec1 quy tr\u00ecnh release / \u0111i\u1ec1u ki\u1ec7n cho m\u1ed7i m\u00f4i tr\u01b0\u1eddng</p>"},{"location":"ADR/adr-017-env-deploy-boundary/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>X\u00e1c \u0111\u1ecbnh r\u00f5 r\u00e0ng boundary v\u00e0 \u0111i\u1ec1u ki\u1ec7n tri\u1ec3n khai cho t\u1eebng m\u00f4i tr\u01b0\u1eddng trong h\u1ec7 th\u1ed1ng dx-vas, bao g\u1ed3m quy\u1ec1n h\u1ea1n, lu\u1ed3ng CI/CD, c\u1ea5u h\u00ecnh, v\u00e0 c\u00e1c y\u00eau c\u1ea7u ki\u1ec3m th\u1eed / ph\u00ea duy\u1ec7t.</p>"},{"location":"ADR/adr-017-env-deploy-boundary/#quy-tac-trien-khai-theo-moi-truong","title":"\ud83e\udde9 Quy t\u1eafc tri\u1ec3n khai theo m\u00f4i tr\u01b0\u1eddng","text":"M\u00f4i tr\u01b0\u1eddng M\u1ee5c \u0111\u00edch Tri\u1ec3n khai t\u1eeb branch \u0110i\u1ec1u ki\u1ec7n deploy Ph\u00ea duy\u1ec7t c\u1ea7n thi\u1ebft <code>dev</code> Ph\u00e1t tri\u1ec3n &amp; test <code>feature/*</code>, <code>dev</code> CI pass Kh\u00f4ng <code>staging</code> Ki\u1ec3m th\u1eed t\u00edch h\u1ee3p <code>dev</code>, <code>release/*</code> CI pass + contract test pass Kh\u00f4ng <code>production</code> Public release ch\u00ednh th\u1ee9c <code>main</code> CI pass + manual approval + monitoring ready \u2705 Theo <code>adr-018-release-approval-policy.md</code> <code>sandbox</code> Th\u1eed nghi\u1ec7m API public <code>sandbox</code> ho\u1eb7c t\u00e1ch ri\u00eang t\u1eeb <code>main</code> CI pass \u2705 \u0110\u1ed9i h\u1ea1 t\u1ea7ng approve"},{"location":"ADR/adr-017-env-deploy-boundary/#quy-tac-bao-ve-moi-truong-production","title":"\ud83d\udd12 Quy t\u1eafc b\u1ea3o v\u1ec7 m\u00f4i tr\u01b0\u1eddng production","text":"<ul> <li>Ch\u1ec9 nh\u00f3m <code>Platform</code> ho\u1eb7c ng\u01b0\u1eddi c\u00f3 quy\u1ec1n release m\u1edbi \u0111\u01b0\u1ee3c merge v\u00e0o <code>main</code></li> <li>Pipeline deploy production y\u00eau c\u1ea7u:</li> <li>Check list \u0111\u1ea7y \u0111\u1ee7:<ul> <li>\u2705 Migration \u0111\u00e3 ch\u1ea1y t\u00e1ch bi\u1ec7t</li> <li>\u2705 Contract test pass</li> <li>\u2705 Canary OK (n\u1ebfu \u00e1p d\u1ee5ng)</li> <li>\u2705 Alert \u0111\u00e3 thi\u1ebft l\u1eadp v\u00e0 theo d\u00f5i</li> <li>\u2705 T\u00e0i li\u1ec7u release note</li> </ul> </li> <li>Ph\u00ea duy\u1ec7t ng\u01b0\u1eddi c\u00f3 vai tr\u00f2 <code>release approver</code></li> <li>Sau deploy ph\u1ea3i c\u00f3:</li> <li>Tag version (<code>v1.4.0</code>, ...) trong Git</li> <li>Rollback script kh\u1ea3 d\u1ee5ng (n\u1ebfu c\u1ea7n), theo h\u01b0\u1edbng d\u1eabn rollback trong <code>adr-015-deployment-strategy.md</code></li> </ul>"},{"location":"ADR/adr-017-env-deploy-boundary/#cau-hinh-runtime-theo-moi-truong","title":"\ud83d\udd27 C\u1ea5u h\u00ecnh runtime theo m\u00f4i tr\u01b0\u1eddng","text":"<ul> <li>D\u00f9ng file <code>.env</code>, <code>config.json</code> ho\u1eb7c bi\u1ebfn m\u00f4i tr\u01b0\u1eddng</li> <li>C\u1ea5u h\u00ecnh s\u1ebd kh\u00e1c theo env:</li> <li>DB endpoint</li> <li>JWT signing key</li> <li>Email, webhook, storage bucket</li> <li>External API key (Zalo, Firebase...)</li> <li>File v\u00ed d\u1ee5: <pre><code>.env.development\n.env.staging\n.env.production\n</code></pre></li> <li>\u0110\u01b0\u1ee3c load b\u1eb1ng <code>pydantic-settings</code>, <code>dotenv</code>, ho\u1eb7c config server</li> <li>Xem th\u00eam h\u01b0\u1edbng d\u1eabn chi ti\u1ebft trong <code>adr-005-env-config.md</code></li> </ul>"},{"location":"ADR/adr-017-env-deploy-boundary/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>H\u1ea1n ch\u1ebf l\u1ed7i do tri\u1ec3n khai nh\u1ea7m m\u00f4i tr\u01b0\u1eddng</li> <li>R\u00f5 r\u00e0ng quy\u1ec1n v\u00e0 tr\u00e1ch nhi\u1ec7m theo t\u1eebng env</li> <li>D\u1ec5 thi\u1ebft l\u1eadp CI/CD pipeline ri\u00eang cho t\u1eebng giai \u0111o\u1ea1n</li> <li>Chu\u1ea9n b\u1ecb t\u1ed1t h\u01a1n cho audit, rollback, tracking release</li> </ul>"},{"location":"ADR/adr-017-env-deploy-boundary/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Nh\u1ea7m m\u00f4i tr\u01b0\u1eddng khi deploy Pipeline enforce branch-env mapping Rollback kh\u00f4ng chu\u1ea9n gi\u1eefa env C\u00f3 file rollback ri\u00eang + tag r\u00f5 r\u00e0ng version, tham kh\u1ea3o <code>adr-015</code> Kh\u00f4ng t\u00e1ch bi\u1ec7t d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m gi\u1eefa env D\u00f9ng secrets ri\u00eang, Cloud Secret Manager theo env, tham kh\u1ea3o <code>adr-003-secrets.md</code>"},{"location":"ADR/adr-017-env-deploy-boundary/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>CI/CD Strategy: ADR-001</li> <li>Env Config: ADR-005</li> <li>Secrets: ADR-003</li> <li>Deployment Strategy: ADR-015</li> <li>Release Approval Policy: ADR-018</li> </ul> <p>\u201cM\u1ed9t m\u00f4i tr\u01b0\u1eddng \u0111\u01b0\u1ee3c b\u1ea3o v\u1ec7 t\u1ed1t ch\u00ednh l\u00e0 l\u1edbp ph\u00f2ng th\u1ee7 \u0111\u1ea7u ti\u00ean cho h\u1ec7 th\u1ed1ng production.\u201d</p>"},{"location":"ADR/adr-018-release-approval-policy/","title":"Adr 018 release approval policy","text":"<p>id: adr-018-release-approval-policy title: ADR-018: Ch\u00ednh s\u00e1ch ph\u00ea duy\u1ec7t v\u00e0 rollback release cho m\u00f4i tr\u01b0\u1eddng production c\u1ee7a dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [release, approval, rollback, dx-vas, production]</p>"},{"location":"ADR/adr-018-release-approval-policy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>Vi\u1ec7c release d\u1ecbch v\u1ee5 m\u1edbi v\u00e0o m\u00f4i tr\u01b0\u1eddng production c\u1ee7a dx-vas l\u00e0 h\u00e0nh \u0111\u1ed9ng c\u00f3 r\u1ee7i ro cao, \u0111\u1eb7c bi\u1ec7t v\u1edbi c\u00e1c h\u1ec7 th\u1ed1ng nh\u01b0 API Gateway, LMS Adapter, CRM Proxy v\u00e0 frontend SSR. Trong m\u1ed9t s\u1ed1 tr\u01b0\u1eddng h\u1ee3p tr\u01b0\u1edbc \u0111\u00e2y, vi\u1ec7c thi\u1ebfu ki\u1ec3m tra ch\u00e9o ho\u1eb7c rollback k\u1ecbp th\u1eddi \u0111\u00e3 g\u00e2y: - Downtime cho ng\u01b0\u1eddi d\u00f9ng th\u1ef1c - M\u1ea5t session do JWT/token thay \u0111\u1ed5i kh\u00f4ng backward-compatible - Conflict d\u1eef li\u1ec7u do schema kh\u00f4ng \u0111\u1ed3ng b\u1ed9</p> <p>\u0110\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh \u1ed5n \u0111\u1ecbnh v\u00e0 \u0111\u1ed9 tin c\u1eady, c\u1ea7n c\u00f3 c\u01a1 ch\u1ebf ph\u00ea duy\u1ec7t b\u1eaft bu\u1ed9c tr\u01b0\u1edbc khi release production, c\u0169ng nh\u01b0 chi\u1ebfn l\u01b0\u1ee3c rollback r\u00f5 r\u00e0ng.</p>"},{"location":"ADR/adr-018-release-approval-policy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng ch\u00ednh s\u00e1ch ph\u00ea duy\u1ec7t b\u1eaft bu\u1ed9c v\u00e0 k\u1ebf ho\u1ea1ch rollback chu\u1ea9n ho\u00e1 cho m\u1ecdi b\u1ea3n release l\u00ean production trong h\u1ec7 th\u1ed1ng dx-vas.</p>"},{"location":"ADR/adr-018-release-approval-policy/#chinh-sach-phe-duyet-release","title":"\ud83d\udd10 Ch\u00ednh s\u00e1ch ph\u00ea duy\u1ec7t release","text":""},{"location":"ADR/adr-018-release-approval-policy/#ap-dung-cho","title":"\u2705 \u00c1p d\u1ee5ng cho:","text":"<ul> <li>M\u1ecdi service trong m\u00f4i tr\u01b0\u1eddng <code>production</code></li> <li>Bao g\u1ed3m c\u1ea3 backend (API Gateway, Adapter) v\u00e0 frontend (SSR WebApp)</li> </ul>"},{"location":"ADR/adr-018-release-approval-policy/#nguoi-uoc-phep-approve","title":"\u2705 Ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ph\u00e9p approve:","text":"<ul> <li>Th\u00e0nh vi\u00ean thu\u1ed9c nh\u00f3m <code>Platform</code></li> <li>Ho\u1eb7c ng\u01b0\u1eddi \u0111\u01b0\u1ee3c g\u00e1n quy\u1ec1n <code>release approver</code></li> <li>Ph\u1ea3i kh\u00e1c ng\u01b0\u1eddi v\u1edbi ng\u01b0\u1eddi tr\u1ef1c ti\u1ebfp merge ho\u1eb7c th\u1ef1c hi\u1ec7n deploy (require 4-eyes)</li> </ul>"},{"location":"ADR/adr-018-release-approval-policy/#co-che-phe-duyet","title":"\u2705 C\u01a1 ch\u1ebf ph\u00ea duy\u1ec7t:","text":"<ul> <li>Th\u1ef1c hi\u1ec7n qua GitHub Pull Request:</li> <li>Merge v\u00e0o nh\u00e1nh <code>main</code> s\u1ebd trigger release production</li> <li>Ph\u1ea3i c\u00f3 t\u1ed1i thi\u1ec3u 1 approve t\u1eeb ng\u01b0\u1eddi thu\u1ed9c nh\u00f3m <code>release approver</code></li> <li>Check CI/CD pass + checklist ho\u00e0n t\u1ea5t</li> <li>B\u1eaft bu\u1ed9c checklist tr\u01b0\u1edbc khi ph\u00ea duy\u1ec7t:</li> <li>\u2705 Migration \u0111\u00e3 ch\u1ea1y (ho\u1eb7c t\u00e1ch ri\u00eang)</li> <li>\u2705 \u0110\u00e3 test staging xong</li> <li>\u2705 Canary ho\u1eb7c QA OK (n\u1ebfu d\u00f9ng)</li> <li>\u2705 T\u00e0i li\u1ec7u release note r\u00f5 r\u00e0ng</li> <li>\u2705 C\u00f3 h\u01b0\u1edbng d\u1eabn rollback c\u1ee5 th\u1ec3 k\u00e8m theo (link \u0111\u1ebfn script ho\u1eb7c m\u00f4 t\u1ea3)</li> </ul>"},{"location":"ADR/adr-018-release-approval-policy/#chinh-sach-rollback","title":"\u267b\ufe0f Ch\u00ednh s\u00e1ch rollback","text":"Chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai C\u00e1ch rollback Rolling Re-route traffic v\u1ec1 revision c\u0169 (Cloud Run) Canary Update traffic v\u1ec1 revision \u1ed5n \u0111\u1ecbnh tr\u01b0\u1edbc \u0111\u00f3 Blue/Green Switch l\u1ea1i tag/m\u00f4i tr\u01b0\u1eddng <code>blue</code> Manual Revert Git commit + redeploy b\u1ea3n tr\u01b0\u1edbc <p>M\u1ecdi rollback c\u1ea7n ghi l\u1ea1i l\u00fd do v\u00e0 g\u1eedi b\u00e1o c\u00e1o post-mortem n\u1ebfu \u1ea3nh h\u01b0\u1edfng production.</p>"},{"location":"ADR/adr-018-release-approval-policy/#cong-cu-ho-tro","title":"C\u00f4ng c\u1ee5 h\u1ed7 tr\u1ee3:","text":"<ul> <li><code>gcloud run services update-traffic</code></li> <li>Tag version c\u0169: <code>git tag v1.2.3</code></li> <li>Rollback script n\u1eb1m trong <code>/scripts/rollback/</code></li> <li>CI/CD h\u1ed7 tr\u1ee3 <code>rollback.yml</code> workflow (n\u1ebfu \u0111\u01b0\u1ee3c trigger)</li> </ul>"},{"location":"ADR/adr-018-release-approval-policy/#audit-logging","title":"\ud83d\udee1\ufe0f Audit &amp; Logging","text":"<ul> <li>T\u1ea5t c\u1ea3 h\u00e0nh \u0111\u1ed9ng release &amp; rollback ph\u1ea3i \u0111\u01b0\u1ee3c:</li> <li>Ghi log v\u00e0o h\u1ec7 th\u1ed1ng audit (Cloud Logging ho\u1eb7c GitHub Audit Log)</li> <li>G\u1eafn trace ID v\u00e0 th\u00f4ng tin ng\u01b0\u1eddi th\u1ef1c hi\u1ec7n</li> <li>C\u00e1c thay \u0111\u1ed5i c\u00f3 \u1ea3nh h\u01b0\u1edfng d\u1eef li\u1ec7u ph\u1ea3i ghi ch\u00fa r\u00f5 ph\u1ea1m vi trong PR</li> </ul>"},{"location":"ADR/adr-018-release-approval-policy/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ng\u0103n release v\u00f4 t\u00ecnh ho\u1eb7c kh\u00f4ng ki\u1ec3m so\u00e1t</li> <li>Gi\u1ea3m r\u1ee7i ro khi deploy v\u00e0o production</li> <li>T\u0103ng t\u00ednh minh b\u1ea1ch, tr\u00e1ch nhi\u1ec7m v\u00e0 kh\u1ea3 n\u0103ng truy v\u1ebft</li> </ul>"},{"location":"ADR/adr-018-release-approval-policy/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Approval ch\u1eadm g\u00e2y ch\u1eb7n lu\u1ed3ng release C\u00f3 danh s\u00e1ch ng\u01b0\u1eddi duy\u1ec7t d\u1ef1 ph\u00f2ng, ph\u00e2n c\u00f4ng r\u00f5 theo t\u1eebng module B\u1ecf qua rollback ho\u1eb7c rollback sai c\u00e1ch Checklist b\u1eaft bu\u1ed9c, CI c\u1ea3nh b\u00e1o n\u1ebfu kh\u00f4ng c\u00f3 h\u01b0\u1edbng d\u1eabn rollback Ng\u01b0\u1eddi duy\u1ec7t kh\u00f4ng hi\u1ec3u thay \u0111\u1ed5i \u0110\u00ednh k\u00e8m link m\u00f4 t\u1ea3, PR summary, \u1ea3nh ch\u1ee5p m\u00e0n h\u00ecnh ho\u1eb7c demo"},{"location":"ADR/adr-018-release-approval-policy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Deployment Strategy: ADR-015</li> <li>Environment Policy: ADR-017</li> <li>CI/CD Strategy: ADR-001</li> <li>Zero Downtime: ADR-014</li> </ul> <p>\"M\u1ed9t b\u1ea3n release t\u1ed1t b\u1eaft \u0111\u1ea7u t\u1eeb s\u1ef1 chu\u1ea9n b\u1ecb k\u1ef9 v\u00e0 k\u1ebft th\u00fac b\u1eb1ng kh\u1ea3 n\u0103ng rollback t\u1ed1t h\u01a1n.\"</p>"},{"location":"ADR/adr-019-project-layout/","title":"Adr 019 project layout","text":"<p>id: adr-019-project-layout title: ADR-019: Chi\u1ebfn l\u01b0\u1ee3c t\u1ed5 ch\u1ee9c GCP Project, Network &amp; Quy\u1ec1n h\u1ea1n cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [iac, gcp, terraform, networking, multi-project, dx-vas]</p>"},{"location":"ADR/adr-019-project-layout/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u0111ang ph\u00e1t tri\u1ec3n v\u1edbi nhi\u1ec1u d\u1ecbch v\u1ee5 microservice, tri\u1ec3n khai qua nhi\u1ec1u m\u00f4i tr\u01b0\u1eddng (<code>dev</code>, <code>staging</code>, <code>production</code>) v\u00e0 c\u1ea7n t\u00e1ch bi\u1ec7t r\u00f5 r\u00e0ng \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o:</p> <ul> <li>An to\u00e0n khi th\u1eed nghi\u1ec7m t\u00ednh n\u0103ng m\u1edbi</li> <li>Ki\u1ec3m so\u00e1t chi ph\u00ed v\u00e0 quy\u1ec1n truy c\u1eadp theo m\u00f4i tr\u01b0\u1eddng</li> <li>Qu\u1ea3n tr\u1ecb h\u1ea1 t\u1ea7ng ph\u1ee9c t\u1ea1p v\u1edbi Shared VPC, CI/CD, logging, observability</li> </ul> <p>Do \u0111\u00f3, c\u1ea7n m\u1ed9t chi\u1ebfn l\u01b0\u1ee3c t\u1ed5 ch\u1ee9c GCP project v\u00e0 network r\u00f5 r\u00e0ng, h\u1ed7 tr\u1ee3 IaC, RBAC, gi\u00e1m s\u00e1t v\u00e0 scale t\u1ed1t.</p>"},{"location":"ADR/adr-019-project-layout/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng m\u00f4 h\u00ecnh multi-project theo m\u00f4i tr\u01b0\u1eddng (<code>dev</code>, <code>staging</code>, <code>prod</code>) v\u00e0 module h\u1ea1 t\u1ea7ng d\u00f9ng chung, v\u1edbi ph\u00e2n quy\u1ec1n IAM t\u00e1ch bi\u1ec7t, Shared VPC, v\u00e0 t\u00edch h\u1ee3p CI/CD + cost tracking chu\u1ea9n h\u00f3a.</p>"},{"location":"ADR/adr-019-project-layout/#cau-truc-project-e-xuat","title":"\ud83e\udded C\u1ea5u tr\u00fac Project \u0111\u1ec1 xu\u1ea5t","text":""},{"location":"ADR/adr-019-project-layout/#gcp-project-per-environment","title":"\ud83c\udf0d GCP Project per environment","text":"Project ID M\u00f4i tr\u01b0\u1eddng M\u1ee5c \u0111\u00edch <code>dx-vas-dev</code> dev Local test, staging feature, CI/CD <code>dx-vas-staging</code> staging T\u00edch h\u1ee3p li\u00ean d\u1ecbch v\u1ee5, QA tr\u01b0\u1edbc release <code>dx-vas-prod</code> production V\u1eadn h\u00e0nh ch\u00ednh th\u1ee9c, SLA cao <p>M\u1ed7i project c\u00f3 billing ri\u00eang, secret ri\u00eang, IAM policy ri\u00eang.</p>"},{"location":"ADR/adr-019-project-layout/#module-ha-tang-chung","title":"\ud83e\uddf1 Module h\u1ea1 t\u1ea7ng chung","text":"Project ID M\u1ee5c \u0111\u00edch <code>dx-vas-network</code> Shared VPC, Cloud DNS, NAT gateway <code>dx-vas-logging</code> Centralized logging + audit <code>dx-vas-data</code> Shared Redis, Cloud SQL, BigQuery <p>C\u00e1c project n\u00e0y \u0111\u01b0\u1ee3c d\u00f9ng chung b\u1edfi m\u00f4i tr\u01b0\u1eddng <code>dev/staging/prod</code> qua Shared VPC ho\u1eb7c VPC Peering.</p>"},{"location":"ADR/adr-019-project-layout/#iam-cicd","title":"\ud83d\udd10 IAM &amp; CI/CD","text":"<ul> <li> <p>CI/CD ph\u00e2n t\u00e1ch r\u00f5 quy\u1ec1n deploy:</p> </li> <li> <p><code>ci-deploy-dev@</code> \u2192 ch\u1ec9 c\u00f3 role deploy v\u00e0o <code>dx-vas-dev</code></p> </li> <li><code>ci-deploy-staging@</code> \u2192 ch\u1ec9 staging</li> <li> <p><code>ci-deploy-prod@</code> \u2192 c\u1ea7n ph\u00ea duy\u1ec7t theo [ADR-018]</p> </li> <li> <p>Terraform t\u00e1ch <code>provider.tf</code> theo <code>project_id</code>, bi\u1ebfn m\u00f4i tr\u01b0\u1eddng x\u00e1c \u0111\u1ecbnh <code>env</code></p> </li> <li> <p>D\u00f9ng Workload Identity Federation \u0111\u1ec3 tr\u00e1nh d\u00f9ng key t\u0129nh</p> </li> </ul>"},{"location":"ADR/adr-019-project-layout/#mang-dns","title":"\ud83d\udce1 M\u1ea1ng &amp; DNS","text":"<ul> <li>S\u1eed d\u1ee5ng Shared VPC t\u1eeb <code>dx-vas-network</code></li> <li>VPC Subnet theo env (<code>10.10.0.0/16</code>, <code>10.20.0.0/16</code>, ...)</li> <li>DNS zone n\u1ed9i b\u1ed9: <code>internal.dxvas.local.</code></li> <li>D\u00f9ng Private Google Access \u0111\u1ec3 kh\u00f4ng c\u1ea7n IP public</li> </ul>"},{"location":"ADR/adr-019-project-layout/#terraform-layout","title":"\ud83d\udee0 Terraform Layout","text":"<pre><code>infrastructure/\n\u251c\u2500\u2500 modules/\n\u2502   \u251c\u2500\u2500 cloud_run_service/\n\u2502   \u251c\u2500\u2500 redis_instance/\n\u2502   \u251c\u2500\u2500 cloud_sql_instance/\n\u2502   \u2514\u2500\u2500 iam_roles/\n\u251c\u2500\u2500 envs/\n\u2502   \u251c\u2500\u2500 dev/\n\u2502   \u251c\u2500\u2500 staging/\n\u2502   \u2514\u2500\u2500 prod/\n\u251c\u2500\u2500 shared/\n\u2502   \u251c\u2500\u2500 network/\n\u2502   \u251c\u2500\u2500 dns.tf\n\u2502   \u2514\u2500\u2500 logging.tf\n\u2514\u2500\u2500 backend.tf / README.md\n</code></pre> <p>T\u1ea5t c\u1ea3 <code>envs/</code> \u0111\u1ec1u ch\u1ee9a <code>main.tf</code>, <code>variables.tf</code>, <code>outputs.tf</code>, v\u00e0 <code>.tfvars</code></p>"},{"location":"ADR/adr-019-project-layout/#tag-cost-tracking","title":"\ud83c\udff7\ufe0f Tag &amp; Cost Tracking","text":"<ul> <li> <p>G\u1eafn label cho m\u1ecdi t\u00e0i nguy\u00ean:</p> </li> <li> <p><code>dx-vas_service</code>, <code>env</code>, <code>owner</code>, <code>critical</code></p> </li> <li>D\u00f9ng label cho Cloud Billing + BigQuery export (ADR-020)</li> <li>Dashboard chi ph\u00ed chia theo project, env, module</li> </ul>"},{"location":"ADR/adr-019-project-layout/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ph\u00e2n t\u00e1ch r\u00f5 r\u00e0ng gi\u1eefa c\u00e1c m\u00f4i tr\u01b0\u1eddng gi\u00fap deploy an to\u00e0n h\u01a1n</li> <li>D\u1ec5 ki\u1ec3m so\u00e1t quy\u1ec1n, truy c\u1eadp, v\u00e0 trace chi ph\u00ed</li> <li>H\u1ea1 t\u1ea7ng m\u1edf r\u1ed9ng \u0111\u01b0\u1ee3c theo module: network, log, storage</li> <li>Ph\u00f9 h\u1ee3p v\u1edbi CI/CD, Terraform, Shared VPC</li> </ul>"},{"location":"ADR/adr-019-project-layout/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p IAM ph\u1ee9c t\u1ea1p S\u1eed d\u1ee5ng module Terraform + group IAM r\u00f5 r\u00e0ng G\u1ecdi ch\u00e9o project kh\u00f4ng \u0111\u01b0\u1ee3c Ki\u1ec3m so\u00e1t <code>Service Account</code>, VPC Peering, Shared VPC Cost ph\u00e2n t\u00e1n kh\u00f3 theo d\u00f5i G\u1eafn label chu\u1ea9n h\u00f3a + dashboard BI t\u1eeb BigQuery"},{"location":"ADR/adr-019-project-layout/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>IaC Strategy: ADR-002</li> <li>CI/CD: ADR-001</li> <li>Cost Observability: ADR-020</li> <li>Env Deploy Boundary: ADR-017</li> <li>Release Approval: ADR-018</li> </ul> <p>\u201cKi\u1ebfn tr\u00fac t\u1ed1t b\u1eaft \u0111\u1ea7u t\u1eeb m\u1ed9t n\u1ec1n m\u00f3ng project r\u00f5 r\u00e0ng.\u201d</p>"},{"location":"ADR/adr-020-cost-observability/","title":"Adr 020 cost observability","text":"<p>id: adr-020-cost-observability title: ADR-020: Theo d\u00f5i v\u00e0 t\u1ed1i \u01b0u chi ph\u00ed v\u1eadn h\u00e0nh cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [observability, cost, monitoring, cloud-run, dx-vas]</p>"},{"location":"ADR/adr-020-cost-observability/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>Chi ph\u00ed v\u1eadn h\u00e0nh h\u1ec7 th\u1ed1ng dx-vas bao g\u1ed3m: - D\u1ecbch v\u1ee5 Cloud Run (API Gateway, adapters, frontend SSR...) - Cloud Storage, Firestore, Redis (MemoryStore), BigQuery - Logging &amp; Monitoring (Cloud Logging, Cloud Monitoring) - Traffic egress (khi g\u1ecdi external API ho\u1eb7c frontend SSR qua CDN)</p> <p>Trong qu\u00e1 kh\u1ee9 \u0111\u00e3 x\u1ea3y ra c\u00e1c v\u1ea5n \u0111\u1ec1 nh\u01b0: - Cloud Run scale qu\u00e1 m\u1ee9c \u2192 t\u0103ng \u0111\u1ed9t bi\u1ebfn chi ph\u00ed h\u00e0ng th\u00e1ng - Logging qu\u00e1 chi ti\u1ebft \u2192 t\u0103ng chi ph\u00ed Cloud Logging - Redis gi\u1eef session kh\u00f4ng x\u00f3a \u2192 billing t\u0103ng kh\u00f4ng ki\u1ec3m so\u00e1t</p> <p>C\u1ea7n m\u1ed9t chi\u1ebfn l\u01b0\u1ee3c ch\u1ee7 \u0111\u1ed9ng \u0111\u1ec3 gi\u00e1m s\u00e1t, d\u1ef1 \u0111o\u00e1n v\u00e0 t\u1ed1i \u01b0u chi ph\u00ed cloud, v\u1eeba \u0111\u1ec3 ti\u1ebft ki\u1ec7m, v\u1eeba \u0111\u1ec3 s\u1edbm ph\u00e1t hi\u1ec7n b\u1ea5t th\u01b0\u1eddng.</p>"},{"location":"ADR/adr-020-cost-observability/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng h\u1ec7 th\u1ed1ng quan s\u00e1t v\u00e0 c\u1ea3nh b\u00e1o chi ph\u00ed theo t\u1eebng d\u1ecbch v\u1ee5 v\u00e0 t\u00e0i nguy\u00ean ch\u00ednh c\u1ee7a h\u1ec7 th\u1ed1ng dx-vas. T\u00edch h\u1ee3p v\u1edbi dashboard theo d\u00f5i real-time, b\u00e1o c\u00e1o \u0111\u1ecbnh k\u1ef3, v\u00e0 c\u1ea3nh b\u00e1o v\u01b0\u1ee3t ng\u01b0\u1ee1ng.</p>"},{"location":"ADR/adr-020-cost-observability/#cac-nguon-chi-phi-chinh","title":"\ud83d\udcb0 C\u00e1c ngu\u1ed3n chi ph\u00ed ch\u00ednh","text":"Ngu\u1ed3n C\u00f4ng c\u1ee5 \u0110\u01a1n v\u1ecb C\u1ea3nh b\u00e1o \u0111\u1ec1 xu\u1ea5t Cloud Run Google Cloud Billing VND/hour &gt; 300K/ng\u00e0y/service Redis MemoryStore billing GB RAM/hour &gt; 4 GB ho\u1eb7c &gt; 100K ops/min Cloud Logging Logging bytes GB/ng\u00e0y &gt; 1GB/ng\u00e0y/service BigQuery Storage &amp; Query GB scanned &gt; 5GB/ng\u00e0y Cloud Monitoring Uptime/Alerting API calls Kh\u00f4ng c\u1ea7n alert, nh\u01b0ng log usage Firestore / Storage GB stored + reads GB &amp; IOPS Theo d\u00f5i xu h\u01b0\u1edbng t\u0103ng li\u00ean t\u1ee5c"},{"location":"ADR/adr-020-cost-observability/#dashboard-phan-nhom-chi-phi","title":"\ud83d\udcca Dashboard &amp; Ph\u00e2n nh\u00f3m chi ph\u00ed","text":"<p>T\u1ea1o dashboard chi ph\u00ed trong Cloud Billing &gt; Budgets &amp; reports: - Nh\u00f3m theo <code>service.label</code>, <code>resource.name</code>, <code>project</code> - G\u00e1n tag: <code>env=prod|staging|dev</code>, <code>owner=platform|lms|crm</code>, <code>critical=true</code> - G\u1eafn cost attribution qua label: <code>dx-vas_service</code>, <code>env</code>, <code>module</code></p> <p>M\u1ed7i service Cloud Run n\u00ean c\u00f3 \u00edt nh\u1ea5t: - <code>cloud.googleapis.com/run/container/start_count</code> - <code>cloud.googleapis.com/run/request_count</code> - <code>billing/cost</code> metric qua Cloud Monitoring + BigQuery export</p>"},{"location":"ADR/adr-020-cost-observability/#alerting-noti","title":"\ud83d\udea8 Alerting &amp; Noti","text":"<ul> <li>Thi\u1ebft l\u1eadp Cloud Budget alert:</li> <li> <p>90% monthly quota \u2192 g\u1eedi email/slack</p> </li> <li> <p>110% week-over-week cost \u2192 Slack + log</p> </li> <li>Alert rule (Monitoring):</li> <li>Redis memory &gt; 80%</li> <li>Logging usage &gt; 1GB/day/service</li> <li>Cloud Run instance spike &gt; 3x b\u00ecnh th\u01b0\u1eddng trong 15 ph\u00fat</li> </ul>"},{"location":"ADR/adr-020-cost-observability/#tich-hop-ky-thuat","title":"\ud83d\udee0 T\u00edch h\u1ee3p k\u1ef9 thu\u1eadt","text":"<ul> <li>T\u1ef1 \u0111\u1ed9ng export billing \u2192 BigQuery</li> <li>Giao di\u1ec7n dashboard qua Looker Studio ho\u1eb7c Metabase (n\u1ebfu private)</li> <li>Script cron ph\u00e2n t\u00edch log: log traffic v\u01b0\u1ee3t 100K req/day/service \u2192 g\u1eedi c\u1ea3nh b\u00e1o</li> <li>G\u1eafn cost estimator v\u00e0o CI/CD (Terraform plan \u2192 \u01b0\u1edbc l\u01b0\u1ee3ng chi ph\u00ed)</li> </ul>"},{"location":"ADR/adr-020-cost-observability/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>D\u1ef1 b\u00e1o chi ph\u00ed theo th\u1eddi gian th\u1ef1c</li> <li>Ph\u00e1t hi\u1ec7n s\u1edbm b\u1ea5t th\u01b0\u1eddng do c\u1ea5u h\u00ecnh sai (scale, cache, logging)</li> <li>T\u1ed1i \u01b0u billing t\u1eebng microservice r\u00f5 r\u00e0ng</li> <li>Ph\u00e2n b\u1ed5 chi ph\u00ed c\u00f4ng b\u1eb1ng theo team/module</li> </ul>"},{"location":"ADR/adr-020-cost-observability/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Qu\u00e1 nhi\u1ec1u alert g\u00e2y nhi\u1ec5u G\u1ed9p alert theo nh\u00f3m, alert only trend not spikes Kh\u00f4ng g\u00e1n tag cost \u2192 kh\u00f4ng trace \u0111\u01b0\u1ee3c CI enforce label &amp; billing tag tr\u00ean resource Cloud Billing export b\u1ecb ng\u1eaft C\u00f3 job ki\u1ec3m tra cron export ho\u1ea1t \u0111\u1ed9ng li\u00ean t\u1ee5c"},{"location":"ADR/adr-020-cost-observability/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Auto Scaling: ADR-016</li> <li>CI/CD Strategy: ADR-001</li> <li>IaC Strategy: ADR-002</li> </ul> <p>\u201cKh\u00f4ng quan s\u00e1t \u0111\u01b0\u1ee3c chi ph\u00ed, s\u1edbm mu\u1ed9n s\u1ebd v\u01b0\u1ee3t ng\u00e2n s\u00e1ch.\u201d</p>"},{"location":"ADR/adr-021-external-observability/","title":"Adr 021 external observability","text":"<p>id: adr-021-external-observability title: ADR-021: Ch\u00ednh s\u00e1ch t\u00edch h\u1ee3p Observability v\u1edbi h\u1ec7 th\u1ed1ng b\u00ean ngo\u00e0i cho dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [observability, logging, metrics, tracing, dx-vas, external, otlp]</p>"},{"location":"ADR/adr-021-external-observability/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>Trong h\u1ec7 th\u1ed1ng dx-vas, ph\u1ea7n l\u1edbn d\u1eef li\u1ec7u log, metric v\u00e0 trace \u0111ang \u0111\u01b0\u1ee3c thu th\u1eadp v\u00e0 gi\u00e1m s\u00e1t qua Google Cloud Platform (Cloud Logging, Cloud Monitoring, Cloud Trace). Tuy nhi\u00ean, t\u1ed5 ch\u1ee9c c\u00f3 th\u1ec3 c\u00f3 nhu c\u1ea7u: - T\u1eadp trung h\u00f3a d\u1eef li\u1ec7u v\u00e0o m\u1ed9t h\u1ec7 th\u1ed1ng gi\u00e1m s\u00e1t hi\u1ec7n c\u00f3 nh\u01b0 Datadog, Grafana Cloud, ELK, Sentry, ho\u1eb7c New Relic - T\u00edch h\u1ee3p d\u1eef li\u1ec7u c\u1ea3nh b\u00e1o v\u1edbi h\u1ec7 th\u1ed1ng incident management ho\u1eb7c Security Operations Center (SOC) hi\u1ec7n t\u1ea1i - Ph\u00e2n t\u00edch log/metric theo c\u00e1ch Google Cloud kh\u00f4ng h\u1ed7 tr\u1ee3 t\u1ed1t</p> <p>Vi\u1ec7c t\u00edch h\u1ee3p external observability n\u00e0y c\u1ea7n \u0111\u01b0\u1ee3c chu\u1ea9n h\u00f3a v\u00e0 b\u1ea3o v\u1ec7 \u0111\u1ec3: - \u0110\u1ea3m b\u1ea3o b\u1ea3o m\u1eadt v\u00e0 tu\u00e2n th\u1ee7 d\u1eef li\u1ec7u - Ki\u1ec3m so\u00e1t chi ph\u00ed egress traffic v\u00e0 licensing - Gi\u1eef nguy\u00ean trace ID v\u00e0 context \u0111\u1ec3 ph\u00e2n t\u00edch li\u00ean h\u1ec7 gi\u1eefa h\u1ec7 th\u1ed1ng n\u1ed9i b\u1ed9 v\u00e0 b\u00ean ngo\u00e0i</p>"},{"location":"ADR/adr-021-external-observability/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas cho ph\u00e9p v\u00e0 h\u1ed7 tr\u1ee3 t\u00edch h\u1ee3p v\u1edbi c\u00e1c h\u1ec7 th\u1ed1ng observability b\u00ean ngo\u00e0i khi c\u00f3 nhu c\u1ea7u ch\u00ednh \u0111\u00e1ng, theo c\u00e1c ti\u00eau chu\u1ea9n k\u1ef9 thu\u1eadt, b\u1ea3o m\u1eadt v\u00e0 chi ph\u00ed \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong t\u00e0i li\u1ec7u n\u00e0y.</p>"},{"location":"ADR/adr-021-external-observability/#khi-nao-nen-tich-hop-voi-he-thong-ben-ngoai","title":"\ud83d\udd0d Khi n\u00e0o n\u00ean t\u00edch h\u1ee3p v\u1edbi h\u1ec7 th\u1ed1ng b\u00ean ngo\u00e0i?","text":"<ul> <li>C\u00f3 h\u1ec7 th\u1ed1ng SOC, SIEM ho\u1eb7c centralized monitoring ngo\u00e0i GCP</li> <li>C\u1ea7n t\u00ednh n\u0103ng m\u00e0 Cloud Monitoring kh\u00f4ng \u0111\u00e1p \u1ee9ng \u0111\u01b0\u1ee3c (alert logic ph\u1ee9c t\u1ea1p, correlation, SLO dashboard tu\u1ef3 ch\u1ec9nh...)</li> <li>Y\u00eau c\u1ea7u tu\u00e2n th\u1ee7 t\u1ed5 ch\u1ee9c (log ph\u1ea3i l\u01b0u tr\u1eef t\u1eadp trung)</li> <li>D\u1eef li\u1ec7u ph\u1ee5c v\u1ee5 cross-system analysis (backend t\u1eeb nhi\u1ec1u n\u1ec1n t\u1ea3ng)</li> </ul>"},{"location":"ADR/adr-021-external-observability/#loai-du-lieu-uoc-export","title":"\ud83d\udce6 Lo\u1ea1i d\u1eef li\u1ec7u \u0111\u01b0\u1ee3c export","text":"Lo\u1ea1i V\u00ed d\u1ee5 \u0110i\u1ec1u ki\u1ec7n Logs error logs, audit logs Mask nh\u1ea1y c\u1ea3m, gi\u1eef trace_id Metrics latency, request count, memory C\u00f3 label <code>dx-vas_service</code> v\u00e0 <code>env</code> Traces Cloud Trace \u2192 OTLP span Mapping span name, attributes chu\u1ea9n Alerts/Events Deployment alert, billing alert Webhook ho\u1eb7c Pub/Sub stream"},{"location":"ADR/adr-021-external-observability/#giao-thuc-phuong-thuc-tich-hop-chuan","title":"\ud83d\udd17 Giao th\u1ee9c &amp; ph\u01b0\u01a1ng th\u1ee9c t\u00edch h\u1ee3p chu\u1ea9n","text":"D\u1eef li\u1ec7u Giao th\u1ee9c Ph\u01b0\u01a1ng ph\u00e1p Ghi ch\u00fa Logs Pub/Sub, OTLP, HTTPS Logging Sink \u2192 Pub/Sub \u2192 forwarder Forward t\u1eeb Pub/Sub \u0111\u1ebfn Fluent Bit / Logstash agent Metrics OTLP, Prometheus remote write OpenTelemetry Collector \u2192 Backend Expose metrics n\u1ebfu c\u1ea7n pull Traces OTLP OTEL Collector H\u1ed7 tr\u1ee3 span enrich + mapping Alerts Webhook Cloud Monitoring \u2192 Webhook T\u1edbi Slack, PagerDuty, external API"},{"location":"ADR/adr-021-external-observability/#cac-he-thong-external-co-the-tich-hop","title":"\u2705 C\u00e1c h\u1ec7 th\u1ed1ng external c\u00f3 th\u1ec3 t\u00edch h\u1ee3p","text":"H\u1ec7 th\u1ed1ng Lo\u1ea1i Ghi ch\u00fa Datadog Log, Metric, APM C\u00f3 agent + API push Grafana Cloud Metric, Logs Qua OTLP ho\u1eb7c Prometheus remote write Sentry Error tracking SDK ho\u1eb7c forwarding log v\u1edbi context New Relic Metric, APM T\u00edch h\u1ee3p OTLP chu\u1ea9n ELK / OpenSearch Logs Qua Fluent Bit ho\u1eb7c Logstash"},{"location":"ADR/adr-021-external-observability/#nguyen-tac-lua-chon-he-thong","title":"Nguy\u00ean t\u1eafc l\u1ef1a ch\u1ecdn h\u1ec7 th\u1ed1ng:","text":"<ul> <li>H\u1ed7 tr\u1ee3 chu\u1ea9n m\u1edf (OTLP, Prometheus, OpenTracing)</li> <li>C\u00f3 c\u01a1 ch\u1ebf b\u1ea3o v\u1ec7, x\u00e1c th\u1ef1c, gi\u1edbi h\u1ea1n truy c\u1eadp</li> <li>T\u00ednh n\u0103ng v\u01b0\u1ee3t tr\u1ed9i so v\u1edbi GCP n\u1ebfu d\u00f9ng song song</li> <li>C\u00f3 c\u1ea3nh b\u00e1o n\u1ebfu chi ph\u00ed v\u01b0\u1ee3t d\u1ef1 \u0111o\u00e1n</li> </ul>"},{"location":"ADR/adr-021-external-observability/#tagging-metadata-chuan-hoa","title":"\ud83e\uddfe Tagging &amp; Metadata chu\u1ea9n ho\u00e1","text":"<p>M\u1ecdi d\u1eef li\u1ec7u g\u1eedi ra ph\u1ea3i c\u00f3 c\u00e1c metadata sau: <pre><code>trace_id: ...\ncorrelation_id: ...\nenv: production|staging|dev\nservice: api_gateway | lms_adapter | ...\nmodule: auth | user | crm\nteam: platform | lms | frontend\n</code></pre></p>"},{"location":"ADR/adr-021-external-observability/#bao-mat-tuan-thu","title":"\ud83d\udd10 B\u1ea3o m\u1eadt &amp; tu\u00e2n th\u1ee7","text":"<ul> <li>M\u1ecdi log ch\u1ee9a d\u1eef li\u1ec7u ng\u01b0\u1eddi d\u00f9ng ph\u1ea3i \u0111\u01b0\u1ee3c mask tr\u01b0\u1edbc khi export</li> <li>Ch\u1ec9 export t\u1eeb m\u00f4i tr\u01b0\u1eddng <code>staging</code>, <code>prod</code>, kh\u00f4ng t\u1eeb <code>dev</code> n\u1ebfu kh\u00f4ng c\u00f3 nhu c\u1ea7u gi\u00e1m s\u00e1t</li> <li>D\u00f9ng HTTPS ho\u1eb7c mTLS cho webhook/API endpoint</li> <li>\u0110\u1eb7t rule IAM r\u00f5 r\u00e0ng cho b\u00ean nh\u1eadn d\u1eef li\u1ec7u</li> <li>\u0110\u1ea3m b\u1ea3o region residency n\u1ebfu c\u00f3 r\u00e0ng bu\u1ed9c ch\u1ee7 quy\u1ec1n d\u1eef li\u1ec7u</li> </ul>"},{"location":"ADR/adr-021-external-observability/#kiem-soat-chi-phi","title":"\ud83d\udcb5 Ki\u1ec3m so\u00e1t chi ph\u00ed","text":"Chi ph\u00ed Qu\u1ea3n l\u00fd Egress traffic G\u1eafn label trace/log \u0111\u1ec3 t\u00ednh theo team External licensing T\u00e1ch bill theo project/module Volume logs/traces \u00c1p d\u1ee5ng sampling ho\u1eb7c filter logs t\u1eeb Cloud Logging"},{"location":"ADR/adr-021-external-observability/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Cho ph\u00e9p \u0111\u1ed9i DevOps/SOC t\u00edch h\u1ee3p gi\u00e1m s\u00e1t linh ho\u1ea1t</li> <li>\u0110\u1ea3m b\u1ea3o compliance v\u00e0 kh\u1ea3 n\u0103ng \u0111i\u1ec1u tra t\u1ed1t h\u01a1n</li> <li>D\u1ec5 t\u00edch h\u1ee3p v\u1edbi quy tr\u00ecnh v\u1eadn h\u00e0nh/ph\u00e2n t\u00edch s\u1ef1 c\u1ed1 c\u1ee7a t\u1ed5 ch\u1ee9c</li> </ul>"},{"location":"ADR/adr-021-external-observability/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p D\u1eef li\u1ec7u r\u00f2 r\u1ec9 ho\u1eb7c export sai Masking, ki\u1ec3m tra \u0111\u1ecbnh k\u1ef3, trace log outbound Egress traffic v\u01b0\u1ee3t ki\u1ec3m so\u00e1t Sampling, alert tr\u00ean volume log D\u1eef li\u1ec7u export kh\u00f4ng li\u00ean k\u1ebft \u0111\u01b0\u1ee3c v\u1edbi trong GCP G\u1eafn <code>trace_id</code>, <code>correlation_id</code> \u0111\u1ea7y \u0111\u1ee7"},{"location":"ADR/adr-021-external-observability/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Cost Observability: ADR-020</li> <li>Auto Scaling: ADR-016</li> <li>CI/CD Strategy: ADR-001</li> <li>Security: ADR-004</li> <li>Secrets: ADR-003</li> </ul> <p>\"Observability kh\u00f4ng n\u00ean b\u1ecb gi\u1edbi h\u1ea1n trong n\u1ed9i b\u1ed9 \u2013 n\u1ebfu vi\u1ec7c nh\u00ecn xa gi\u00fap b\u1ea1n ph\u1ea3n \u1ee9ng nhanh h\u01a1n.\"</p>"},{"location":"ADR/adr-022-sla-slo-monitoring/","title":"Adr 022 sla slo monitoring","text":"<p>id: adr-022-sla-slo-monitoring title: ADR-022: Chi\u1ebfn l\u01b0\u1ee3c SLA, SLO v\u00e0 Monitoring cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [sla, slo, monitoring, observability, reliability, dx-vas]</p>"},{"location":"ADR/adr-022-sla-slo-monitoring/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas ph\u1ee5c v\u1ee5 nhi\u1ec1u nh\u00f3m ng\u01b0\u1eddi d\u00f9ng: h\u1ecdc sinh, ph\u1ee5 huynh, gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean nh\u00e0 tr\u01b0\u1eddng. M\u1ed9t s\u1ed1 d\u1ecbch v\u1ee5 l\u00e0 business-critical nh\u01b0 API Gateway, LMS Adapter, Frontend SSR. \u0110\u1ec3 \u0111\u1ea3m b\u1ea3o ch\u1ea5t l\u01b0\u1ee3ng d\u1ecbch v\u1ee5, c\u1ea7n: - \u0110\u1ecbnh ngh\u0129a r\u00f5 r\u00e0ng SLA/SLO cho t\u1eebng nh\u00f3m d\u1ecbch v\u1ee5 - Gi\u00e1m s\u00e1t li\u00ean t\u1ee5c d\u1ef1a tr\u00ean SLI th\u1ef1c t\u1ebf - C\u00f3 alert n\u1ebfu v\u01b0\u1ee3t error budget ho\u1eb7c vi ph\u1ea1m ng\u01b0\u1ee1ng SLO</p>"},{"location":"ADR/adr-022-sla-slo-monitoring/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Thi\u1ebft l\u1eadp khung SLA, SLO, SLI v\u00e0 c\u01a1 ch\u1ebf gi\u00e1m s\u00e1t tu\u00e2n th\u1ee7 cho to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng dx-vas, v\u1edbi vi\u1ec7c ph\u00e2n nh\u00f3m d\u1ecbch v\u1ee5, \u0111\u1ecbnh ngh\u0129a m\u1ee5c ti\u00eau \u0111o l\u01b0\u1eddng v\u00e0 t\u00edch h\u1ee3p c\u1ea3nh b\u00e1o theo SLO.</p>"},{"location":"ADR/adr-022-sla-slo-monitoring/#inh-nghia","title":"\ud83e\udde9 \u0110\u1ecbnh ngh\u0129a","text":"<ul> <li>SLA: Cam k\u1ebft ch\u00ednh th\u1ee9c (cho stakeholder, ng\u01b0\u1eddi d\u00f9ng cu\u1ed1i)</li> <li>SLO: M\u1ee5c ti\u00eau n\u1ed9i b\u1ed9 \u0111\u1ec3 \u0111o l\u01b0\u1eddng \u0111\u1ed9 tin c\u1eady</li> <li>SLI: Metric d\u00f9ng \u0111\u1ec3 t\u00ednh to\u00e1n SLO</li> </ul>"},{"location":"ADR/adr-022-sla-slo-monitoring/#phan-nhom-dich-vu-slo-e-xuat","title":"\ud83d\udcca Ph\u00e2n nh\u00f3m d\u1ecbch v\u1ee5 &amp; SLO \u0111\u1ec1 xu\u1ea5t","text":"D\u1ecbch v\u1ee5 M\u1ee9c \u0111\u1ed9 SLO uptime SLI latency (p95) Error rate max API Gateway Critical 99.9% (&gt;= 43.2 mins/month downtime allowed) &lt; 500ms &lt; 0.1% LMS Adapter High 99.5% (&lt;= 3.6h downtime/month) &lt; 800ms &lt; 0.5% Frontend SSR Critical 99.9% &lt; 600ms &lt; 0.2% Notification Medium 99% &lt; 1s &lt; 1% Sandbox API Low 95% &lt; 2s &lt; 5% <p>Ghi ch\u00fa: SLO uptime \u0111\u01b0\u1ee3c t\u00ednh theo th\u1eddi gian ho\u1ea1t \u0111\u1ed9ng kh\u00f4ng l\u1ed7i chia cho t\u1ed5ng th\u1eddi gian trong th\u00e1ng. V\u00ed d\u1ee5: 99.9% uptime t\u01b0\u01a1ng \u0111\u01b0\u01a1ng t\u1ed1i \u0111a 43.2 ph\u00fat downtime m\u1ed7i th\u00e1ng (t\u1ee9c 0.1% c\u1ee7a 30 ng\u00e0y).</p>"},{"location":"ADR/adr-022-sla-slo-monitoring/#metric-o-luong-chinh-sli","title":"\ud83d\udccf Metric \u0111o l\u01b0\u1eddng ch\u00ednh (SLI)","text":"Metric \u0110\u1ecbnh ngh\u0129a <code>availability</code> % request th\u00e0nh c\u00f4ng / t\u1ed5ng request (d\u1ef1a tr\u00ean 2xx + 3xx) <code>latency_p95</code> Th\u1eddi gian ph\u1ea3n h\u1ed3i c\u1ee7a 95% request <code>error_rate_5xx</code> T\u1ef7 l\u1ec7 request tr\u1ea3 v\u1ec1 5xx (server error) <code>error_rate_4xx</code> T\u1ef7 l\u1ec7 request tr\u1ea3 v\u1ec1 4xx kh\u00f4ng h\u1ee3p l\u1ec7 (kh\u00f4ng t\u00ednh authentication fail h\u1ee3p l\u1ec7) <code>uptime</code> Tr\u1ea1ng th\u00e1i revision Healthy (Cloud Run), \u0111o m\u1ed7i ph\u00fat <p>S\u1ef1 kh\u00e1c bi\u1ec7t gi\u1eefa uptime v\u00e0 availability: - <code>uptime</code>: \u0111o \u1edf m\u1ee9c infrastructure (v\u00ed d\u1ee5: container healthy, Cloud Run tr\u1ea3 200 t\u1ea1i /healthz) - <code>availability</code>: \u0111o \u1edf m\u1ee9c \u1ee9ng d\u1ee5ng (ng\u01b0\u1eddi d\u00f9ng nh\u1eadn \u0111\u01b0\u1ee3c response \u0111\u00fang v\u00e0 th\u00e0nh c\u00f4ng) \u2192 c\u1ea3 hai n\u00ean \u0111\u01b0\u1ee3c d\u00f9ng k\u1ebft h\u1ee3p: uptime \u0111\u1ec3 ph\u00e1t hi\u1ec7n s\u1ef1 c\u1ed1 h\u1ec7 th\u1ed1ng, availability \u0111\u1ec3 ph\u1ea3n \u00e1nh tr\u1ea3i nghi\u1ec7m ng\u01b0\u1eddi d\u00f9ng.</p>"},{"location":"ADR/adr-022-sla-slo-monitoring/#monitoring-alerting","title":"\ud83d\udea8 Monitoring &amp; Alerting","text":"<ul> <li>D\u00f9ng Cloud Monitoring SLO dashboard</li> <li>\u0110\u1eb7t alert khi:</li> <li><code>error_rate_5xx</code> v\u01b0\u1ee3t ng\u01b0\u1ee1ng 3 l\u1ea7n trong 5 ph\u00fat</li> <li><code>latency_p95</code> &gt; ng\u01b0\u1ee1ng trong 10 ph\u00fat li\u00ean t\u1ee5c</li> <li> <p><code>availability</code> &lt; SLO trong rolling window 30 ph\u00fat</p> </li> <li> <p>T\u00edch h\u1ee3p alert:</p> </li> <li>Slack, Email, PagerDuty (qua webhook)</li> <li>\u0110\u1ea9y s\u1ef1 ki\u1ec7n v\u00e0o BigQuery \u0111\u1ec3 audit/review sau</li> </ul>"},{"location":"ADR/adr-022-sla-slo-monitoring/#chinh-sach-phan-hoi-anh-gia","title":"\ud83d\udcbc Ch\u00ednh s\u00e1ch ph\u1ea3n h\u1ed3i &amp; \u0111\u00e1nh gi\u00e1","text":"<ul> <li>N\u1ebfu v\u01b0\u1ee3t error budget:</li> <li>C\u1ea7n freeze release trong v\u00f2ng 24h</li> <li> <p>L\u00e0m postmortem n\u1ebfu \u1ea3nh h\u01b0\u1edfng user th\u1ef1c &gt; 1 ph\u00fat downtime ho\u1eb7c &gt; 100 l\u1ed7i</p> </li> <li> <p>M\u1ed7i qu\u00fd review l\u1ea1i:</p> </li> <li>SLO c\u00f3 th\u1ef1c t\u1ebf v\u00e0 \u0111\u1ee7 tham v\u1ecdng ch\u01b0a?</li> <li>C\u00f3 c\u1ea7n ph\u00e2n t\u00e1ch SLO theo <code>env=staging</code>, <code>user_type</code>, <code>endpoint group</code> kh\u00f4ng?</li> <li>C\u00f3 c\u1ea7n x\u00e2y d\u1ef1ng SLO ri\u00eang cho m\u00f4i tr\u01b0\u1eddng <code>dev</code> v\u00e0 <code>prod</code>, trong \u0111\u00f3:<ul> <li><code>prod</code>: kh\u1eaft khe h\u01a1n, ph\u1ee5c v\u1ee5 ng\u01b0\u1eddi d\u00f9ng th\u1ef1c</li> <li><code>dev/staging</code>: d\u00f9ng \u0111\u1ec3 ph\u00e1t hi\u1ec7n l\u1ed7i s\u1edbm, kh\u00f4ng c\u1ea3nh b\u00e1o production</li> </ul> </li> </ul>"},{"location":"ADR/adr-022-sla-slo-monitoring/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>\u0110\u1ecbnh h\u01b0\u1edbng r\u00f5 r\u00e0ng cho vi\u1ec7c v\u1eadn h\u00e0nh theo \u0111\u1ed9 tin c\u1eady</li> <li>G\u1eafn reliability v\u1edbi vi\u1ec7c ra quy\u1ebft \u0111\u1ecbnh release</li> <li>Ph\u00e1t hi\u1ec7n s\u1edbm s\u1ef1 c\u1ed1 tr\u01b0\u1edbc khi ng\u01b0\u1eddi d\u00f9ng b\u1ecb \u1ea3nh h\u01b0\u1edfng l\u1edbn</li> </ul>"},{"location":"ADR/adr-022-sla-slo-monitoring/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Alert sai nhi\u1ec1u, g\u00e2y m\u00f9 nhi\u1ec5u Th\u00eam deadman switch, silence th\u00f4ng minh Thi\u1ebfu SLI cho 1 s\u1ed1 service D\u00f9ng proxy (gateway) \u0111\u1ec3 \u0111o t\u1eeb outside-in SLO qu\u00e1 ch\u1eb7t g\u00e2y c\u1ea3n release \u0110\u1ecbnh k\u1ef3 \u0111\u00e1nh gi\u00e1, t\u00e1ch SLO gi\u1eefa dev &amp; prod"},{"location":"ADR/adr-022-sla-slo-monitoring/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Observability: ADR-005</li> <li>External Observability: ADR-021</li> <li>CI/CD: ADR-001</li> <li>Auto Scaling: ADR-016</li> </ul> <p>\u201cSLA l\u00e0 l\u1eddi h\u1ee9a. SLO l\u00e0 la b\u00e0n. SLI l\u00e0 chi\u1ebfc g\u01b0\u01a1ng s\u1ef1 th\u1eadt.\u201d</p>"},{"location":"ADR/adr-023-schema-migration-strategy/","title":"Adr 023 schema migration strategy","text":"<p>id: adr-023-schema-migration-strategy title: ADR-023: Chi\u1ebfn l\u01b0\u1ee3c thay \u0111\u1ed5i schema d\u1eef li\u1ec7u an to\u00e0n v\u00e0 c\u00f3 th\u1ec3 rollback cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [schema, database, migration, compatibility, dx-vas]</p>"},{"location":"ADR/adr-023-schema-migration-strategy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>Nhi\u1ec1u th\u00e0nh ph\u1ea7n trong h\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng c\u01a1 s\u1edf d\u1eef li\u1ec7u quan h\u1ec7 ho\u1eb7c NoSQL (PostgreSQL, Firestore, Redis). Khi tri\u1ec3n khai t\u00ednh n\u0103ng m\u1edbi ho\u1eb7c refactor, thay \u0111\u1ed5i schema l\u00e0 \u0111i\u1ec1u kh\u00f4ng th\u1ec3 tr\u00e1nh kh\u1ecfi. Tuy nhi\u00ean, n\u1ebfu l\u00e0m kh\u00f4ng c\u1ea9n th\u1eadn, migration c\u00f3 th\u1ec3 g\u00e2y: - M\u1ea5t d\u1eef li\u1ec7u ho\u1eb7c m\u1ea5t t\u01b0\u01a1ng th\u00edch ng\u01b0\u1ee3c (breaking change) - Downtime n\u1ebfu migration qu\u00e1 n\u1eb7ng ho\u1eb7c x\u1ea3y ra khi h\u1ec7 th\u1ed1ng \u0111ang online - Kh\u00f4ng rollback \u0111\u01b0\u1ee3c n\u1ebfu kh\u00f4ng c\u00f3 chi\u1ebfn l\u01b0\u1ee3c t\u00e1ch bi\u1ec7t v\u00e0 ki\u1ec3m so\u00e1t t\u1ed1t</p>"},{"location":"ADR/adr-023-schema-migration-strategy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c migration an to\u00e0n theo h\u01b0\u1edbng forward-compatible, rollbackable v\u00e0 kh\u00f4ng g\u00e2y downtime cho h\u1ec7 th\u1ed1ng dx-vas. Migration ph\u1ea3i \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd \u0111\u1ed9c l\u1eadp v\u1edbi code deploy.</p>"},{"location":"ADR/adr-023-schema-migration-strategy/#chien-luoc-trien-khai-migration-theo-3-buoc","title":"\ud83e\uddf1 Chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai migration theo 3 b\u01b0\u1edbc","text":""},{"location":"ADR/adr-023-schema-migration-strategy/#1-prepare-add-khong-thay-the","title":"1. Prepare \u2013 Add, kh\u00f4ng thay th\u1ebf","text":"<ul> <li>Th\u00eam tr\u01b0\u1eddng m\u1edbi (nullable, optional), KH\u00d4NG \u0111\u1ed5i t\u00ean ho\u1eb7c x\u00f3a tr\u1ef1c ti\u1ebfp</li> <li>Kh\u00f4ng thay \u0111\u1ed5i ki\u1ec3u d\u1eef li\u1ec7u \u0111\u1ed9t ng\u1ed9t</li> <li>N\u1ebfu c\u1ea7n chuy\u1ec3n \u0111\u1ed5i d\u1eef li\u1ec7u, th\u00eam c\u1ed9t m\u1edbi v\u00e0 chuy\u1ec3n d\u1ea7n sang (shadow field)</li> </ul>"},{"location":"ADR/adr-023-schema-migration-strategy/#2-transition-ung-dung-ho-tro-ca-schema-cu-moi","title":"2. Transition \u2013 \u1ee8ng d\u1ee5ng h\u1ed7 tr\u1ee3 c\u1ea3 schema c\u0169 &amp; m\u1edbi","text":"<ul> <li>Code ph\u1ea3i t\u01b0\u01a1ng th\u00edch c\u1ea3 hai schema (\u0111\u1ecdc c\u1ea3 field c\u0169 v\u00e0 m\u1edbi)</li> <li>T\u1ea1o flag/toggle \u0111\u1ec3 ki\u1ec3m so\u00e1t h\u00e0nh vi migration (t\u1ed1t h\u01a1n n\u1ebfu c\u00f3 experiment rollout)</li> <li>Ch\u1ea1y migration script ri\u00eang bi\u1ec7t, kh\u00f4ng g\u1eafn v\u00e0o code deploy</li> </ul>"},{"location":"ADR/adr-023-schema-migration-strategy/#3-cleanup-chi-sau-khi-a-hoan-tat-rollout-va-verify","title":"3. Cleanup \u2013 Ch\u1ec9 sau khi \u0111\u00e3 ho\u00e0n t\u1ea5t rollout v\u00e0 verify","text":"<ul> <li>Ch\u1ec9 x\u00f3a/rename schema c\u0169 khi:</li> <li>Kh\u00f4ng c\u00f2n service n\u00e0o s\u1eed d\u1ee5ng</li> <li>Monitoring x\u00e1c nh\u1eadn kh\u00f4ng c\u00f3 traffic d\u00f9ng field c\u0169</li> <li>\u0110\u00e3 rollback \u0111\u01b0\u1ee3c migration data n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"ADR/adr-023-schema-migration-strategy/#cong-cu-quy-trinh-ky-thuat","title":"\ud83e\uddf0 C\u00f4ng c\u1ee5 &amp; Quy tr\u00ecnh k\u1ef9 thu\u1eadt","text":"<ul> <li>Migration script n\u00ean s\u1eed d\u1ee5ng:</li> <li>Alembic (PostgreSQL)</li> <li>Firebase Admin SDK (Firestore)</li> <li>Custom script Python/NodeJS (Redis, Mongo, etc.)</li> <li>M\u1ed7i migration c\u00f3:</li> <li>ID duy nh\u1ea5t, version h\u00f3a theo timestamp</li> <li>Ch\u1ea1y qua <code>pre-release checklist</code></li> <li>C\u00f3 tr\u1ea1ng th\u00e1i: <code>pending</code>, <code>running</code>, <code>done</code>, <code>rolled_back</code></li> <li>Script l\u01b0u log t\u1ea1i Cloud Logging + BigQuery \u0111\u1ec3 audit</li> <li>Rollback script \u0111i k\u00e8m migration (n\u1ebfu destructive)</li> </ul>"},{"location":"ADR/adr-023-schema-migration-strategy/#thoi-iem-chay-migration","title":"\u23f1 Th\u1eddi \u0111i\u1ec3m ch\u1ea1y migration","text":"Lo\u1ea1i migration Th\u1eddi \u0111i\u1ec3m ch\u1ea1y Ghi ch\u00fa Add column/index Tr\u01b0\u1edbc deploy Kh\u00f4ng \u1ea3nh h\u01b0\u1edfng code c\u0169 Populate data m\u1edbi Sau deploy Code m\u1edbi c\u00f3 th\u1ec3 \u0111\u1ecdc field \u0111\u00f3 Drop/rename field Sau nhi\u1ec1u ng\u00e0y Ph\u1ea3i ch\u1eafc ch\u1eafn backward compat \u0111\u00e3 \u0111\u01b0\u1ee3c lo\u1ea1i b\u1ecf"},{"location":"ADR/adr-023-schema-migration-strategy/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Migration kh\u00f4ng l\u00e0m gi\u00e1n \u0111o\u1ea1n h\u1ec7 th\u1ed1ng</li> <li>C\u00f3 kh\u1ea3 n\u0103ng rollback n\u1ebfu deployment th\u1ea5t b\u1ea1i</li> <li>Cho ph\u00e9p rollout thay \u0111\u1ed5i l\u1edbn theo t\u1eebng giai \u0111o\u1ea1n, kh\u00f4ng bu\u1ed9c all-or-nothing</li> </ul>"},{"location":"ADR/adr-023-schema-migration-strategy/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Ch\u1ea1y migration qu\u00e1 l\u00e2u g\u00e2y lock Batch + timeout h\u1ee3p l\u00fd, ch\u1ea1y n\u1ec1n (async worker) Migration l\u00e9n g\u1eafn v\u00e0o code deploy CI/CD enforce separation, checklist b\u1eaft bu\u1ed9c Kh\u00f4ng rollback \u0111\u01b0\u1ee3c khi rename/drop D\u00f9ng shadow field + delay cleanup + backup tr\u01b0\u1edbc khi drop"},{"location":"ADR/adr-023-schema-migration-strategy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>CI/CD Strategy: ADR-001</li> <li>Release Approval: ADR-018</li> <li>Deployment Strategy: ADR-015</li> <li>Schema versioning (n\u1ebfu c\u00f3): S\u1ebd b\u1ed5 sung n\u1ebfu d\u00f9ng Proto ho\u1eb7c GraphQL schema</li> </ul> <p>\u201cM\u1ed9t h\u1ec7 th\u1ed1ng t\u1ed1t kh\u00f4ng ch\u1ec9 deploy nhanh \u2013 m\u00e0 rollback \u0111\u01b0\u1ee3c c\u1ea3 khi thay \u0111\u1ed5i schema.\u201d</p>"},{"location":"ADR/adr-024-data-anonymization-retention/","title":"Adr 024 data anonymization retention","text":"<p>id: adr-024-data-anonymization-retention title: ADR-024: Ch\u00ednh s\u00e1ch \u1ea9n danh h\u00f3a v\u00e0 l\u01b0u tr\u1eef d\u1eef li\u1ec7u cho h\u1ec7 th\u1ed1ng dx-vas status: accepted author: DX VAS Platform Team date: 2025-06-22 tags: [privacy, anonymization, retention, data-governance, dx-vas]</p>"},{"location":"ADR/adr-024-data-anonymization-retention/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas l\u01b0u tr\u1eef v\u00e0 x\u1eed l\u00fd nhi\u1ec1u lo\u1ea1i d\u1eef li\u1ec7u c\u00f3 kh\u1ea3 n\u0103ng nh\u1eadn d\u1ea1ng c\u00e1 nh\u00e2n (PII): - Th\u00f4ng tin h\u1ecdc sinh, ph\u1ee5 huynh, gi\u00e1o vi\u00ean (h\u1ecd t\u00ean, s\u1ed1 \u0111i\u1ec7n tho\u1ea1i, email) - Nh\u1eadt k\u00fd h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng (logs, trace) - Th\u00f4ng tin c\u1ea5u h\u00ecnh t\u00e0i kho\u1ea3n, l\u1ecbch s\u1eed thao t\u00e1c h\u1ec7 th\u1ed1ng</p> <p>Ngo\u00e0i ra, h\u1ec7 th\u1ed1ng c\u00f2n c\u1ea7n sao l\u01b0u, t\u1ea1o m\u00f4i tr\u01b0\u1eddng th\u1eed nghi\u1ec7m (sandbox/dev), v\u00e0 ph\u00e2n t\u00edch s\u1ef1 ki\u1ec7n ph\u1ee5c v\u1ee5 c\u1ea3i ti\u1ebfn. N\u1ebfu kh\u00f4ng ki\u1ec3m so\u00e1t t\u1ed1t: - D\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m c\u00f3 th\u1ec3 b\u1ecb r\u00f2 r\u1ec9 ra m\u00f4i tr\u01b0\u1eddng kh\u00f4ng b\u1ea3o m\u1eadt - Log c\u00f3 th\u1ec3 ch\u1ee9a th\u00f4ng tin PII kh\u00f4ng c\u1ea7n thi\u1ebft - Th\u00f4ng tin c\u00e1 nh\u00e2n c\u00f3 th\u1ec3 b\u1ecb l\u01b0u tr\u1eef qu\u00e1 l\u00e2u m\u00e0 kh\u00f4ng c\u00f3 l\u00fd do h\u1ee3p l\u1ec7</p>"},{"location":"ADR/adr-024-data-anonymization-retention/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Thi\u1ebft l\u1eadp ch\u00ednh s\u00e1ch ph\u00e2n lo\u1ea1i, \u1ea9n danh h\u00f3a v\u00e0 l\u01b0u tr\u1eef d\u1eef li\u1ec7u chu\u1ea9n ho\u00e1 tr\u00ean to\u00e0n h\u1ec7 th\u1ed1ng dx-vas \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o an to\u00e0n, tu\u00e2n th\u1ee7, v\u00e0 d\u1ec5 d\u00e0ng \u00e1p d\u1ee5ng sandbox ho\u1eb7c audit.</p>"},{"location":"ADR/adr-024-data-anonymization-retention/#phan-loai-du-lieu","title":"\ud83e\udde9 Ph\u00e2n lo\u1ea1i d\u1eef li\u1ec7u","text":"Lo\u1ea1i d\u1eef li\u1ec7u V\u00ed d\u1ee5 Ph\u00e2n lo\u1ea1i PII H\u1ecd t\u00ean, email, S\u0110T, IP Nh\u1ea1y c\u1ea3m \u2013 c\u1ea7n \u1ea9n danh ho\u1eb7c h\u1ea1n ch\u1ebf truy c\u1eadp Technical log API path, trace ID, latency C\u00f3 th\u1ec3 ch\u1ee9a PII n\u1ebfu bao g\u1ed3m IP \u0111\u1ea7y \u0111\u1ee7 \u2013 c\u1ea7n ki\u1ec3m so\u00e1t v\u00e0 l\u1ecdc Audit trail Ai l\u00e0m g\u00ec, l\u00fac n\u00e0o Nh\u1ea1y c\u1ea3m m\u1ee9c v\u1eeba \u2013 c\u1ea7n gi\u1eef nguy\u00ean nh\u01b0ng b\u1ea3o v\u1ec7 truy c\u1eadp Business metrics s\u1ed1 h\u1ecdc sinh \u0111\u0103ng k\u00fd, doanh thu T\u1ed5ng h\u1ee3p, kh\u00f4ng c\u1ea7n \u1ea9n danh"},{"location":"ADR/adr-024-data-anonymization-retention/#chinh-sach-an-danh-hoa-anonymization","title":"\ud83d\udd10 Ch\u00ednh s\u00e1ch \u1ea9n danh h\u00f3a (Anonymization)","text":"Tr\u01b0\u1eddng Ph\u01b0\u01a1ng ph\u00e1p Email, t\u00ean Mask (<code>n***@gmail.com</code>), randomize, fake data IP address Hash (SHA256) ho\u1eb7c c\u1eaft b\u1edbt (e.g., /24 subnet) \u2013 coi l\u00e0 PII n\u1ebfu \u0111\u1ea7y \u0111\u1ee7 M\u00e3 h\u1ecdc sinh T\u1ea1o mapping t\u1ea1m th\u1eddi (UUID \u2194 student_id) Logs ch\u1ee9a PII D\u00f9ng l\u1edbp middleware/log filter \u0111\u1ec3 l\u1ecdc/mask tr\u01b0\u1edbc khi ghi. Kh\u00f4ng log tr\u1ef1c ti\u1ebfp PII d\u00f9 \u1edf m\u1ee9c debug/info. <p>T\u1ea5t c\u1ea3 log ph\u1ea3i \u0111i qua l\u1edbp filter tr\u01b0\u1edbc khi g\u1eedi ra ngo\u00e0i (GCP Logging, Datadog...)</p>"},{"location":"ADR/adr-024-data-anonymization-retention/#sandbox-test-environment","title":"\ud83d\udce6 Sandbox &amp; Test Environment","text":"<ul> <li>Clone d\u1eef li\u1ec7u th\u1eadt \u2192 ch\u1ea1y script <code>anonymize_dataset.py</code></li> <li>D\u1eef li\u1ec7u sau khi \u1ea9n danh:</li> <li>Kh\u00f4ng c\u00f2n truy ng\u01b0\u1ee3c h\u1ecdc sinh th\u1ef1c t\u1ebf</li> <li>Kh\u00f4ng ch\u1ee9a th\u00f4ng tin li\u00ean l\u1ea1c th\u1eadt</li> <li> <p>C\u00f3 th\u1ec3 d\u00f9ng trong dev/test/demo/public QA</p> </li> <li> <p>M\u1ecdi m\u00f4i tr\u01b0\u1eddng ngo\u00e0i production b\u1eaft bu\u1ed9c d\u00f9ng d\u1eef li\u1ec7u \u0111\u00e3 \u1ea9n danh</p> </li> </ul>"},{"location":"ADR/adr-024-data-anonymization-retention/#chinh-sach-luu-tru-du-lieu-retention","title":"\ud83d\uddc2 Ch\u00ednh s\u00e1ch l\u01b0u tr\u1eef d\u1eef li\u1ec7u (Retention)","text":"Lo\u1ea1i d\u1eef li\u1ec7u Retention Ghi ch\u00fa Logs h\u1ec7 th\u1ed1ng 30 ng\u00e0y (default) C\u00f3 th\u1ec3 archive 6 th\u00e1ng v\u1edbi BigQuery Audit logs 180 ng\u00e0y (prod), 30 ng\u00e0y (dev) Tu\u00e2n th\u1ee7 audit n\u1ed9i b\u1ed9 D\u1eef li\u1ec7u h\u1ecdc sinh kh\u00f4ng c\u00f2n ho\u1ea1t \u0111\u1ed9ng 365 ng\u00e0y Tu\u00e2n th\u1ee7 theo th\u00f4ng t\u01b0 ng\u00e0nh gi\u00e1o d\u1ee5c v\u1ec1 l\u01b0u tr\u1eef h\u1ed3 s\u01a1 h\u1ecdc sinh Access token 15 ph\u00fat Theo <code>adr-006</code> \u2013 d\u00f9ng cho phi\u00ean ho\u1ea1t \u0111\u1ed9ng Refresh token 30\u201390 ng\u00e0y t\u00f9y lo\u1ea1i user Theo <code>adr-006</code> \u2013 l\u01b0u trong Redis ho\u1eb7c encrypted store <p>T\u1ea5t c\u1ea3 retention s\u1ebd \u0111\u01b0\u1ee3c ki\u1ec3m so\u00e1t qua lifecycle rule (Cloud Storage), TTL (Firestore/Redis), ho\u1eb7c job cleanup t\u1ef1 \u0111\u1ed9ng (batch script)</p>"},{"location":"ADR/adr-024-data-anonymization-retention/#bao-mat-quyen-truy-cap","title":"\ud83d\udee1\ufe0f B\u1ea3o m\u1eadt &amp; Quy\u1ec1n truy c\u1eadp","text":"<ul> <li>Ch\u1ec9 nh\u00f3m Platform/Data c\u00f3 quy\u1ec1n truy c\u1eadp d\u1eef li\u1ec7u g\u1ed1c</li> <li>M\u1ecdi export d\u1eef li\u1ec7u ph\u1ea3i:</li> <li>\u0110\u01b0\u1ee3c ghi nh\u1eadn trong audit log</li> <li>C\u00f3 l\u00fd do c\u1ee5 th\u1ec3 (debug, incident, product research)</li> <li>N\u1ebfu ch\u1ee9a PII \u2192 ph\u1ea3i x\u1eed l\u00fd \u1ea9n danh tr\u01b0\u1edbc khi chia s\u1ebb</li> </ul>"},{"location":"ADR/adr-024-data-anonymization-retention/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>\u0110\u1ea3m b\u1ea3o compliance n\u1ebfu \u00e1p d\u1ee5ng ch\u00ednh s\u00e1ch nh\u01b0 GDPR, FERPA</li> <li>H\u1ea1n ch\u1ebf r\u1ee7i ro l\u1ed9 d\u1eef li\u1ec7u qua log, demo, testing</li> <li>D\u1ec5 d\u00e0ng t\u1ea1o sandbox \u0111\u1ec3 hu\u1ea5n luy\u1ec7n AI, ki\u1ec3m th\u1eed s\u1ea3n ph\u1ea9m</li> </ul>"},{"location":"ADR/adr-024-data-anonymization-retention/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Developer v\u00f4 t\u00ecnh log th\u00f4ng tin nh\u1ea1y c\u1ea3m Filter log + CI/CD linter check log string D\u1eef li\u1ec7u th\u1eadt l\u1ecdt ra m\u00f4i tr\u01b0\u1eddng staging Anonymize b\u1eaft bu\u1ed9c + ki\u1ec3m tra sau deploy Retention config b\u1ecb b\u1ecf qu\u00ean C\u00f3 cron job + dashboard ki\u1ec3m tra TTL, storage usage"},{"location":"ADR/adr-024-data-anonymization-retention/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Secrets: ADR-003</li> <li>Security:ADR-004</li> <li>Observability: ADR-005</li> <li>External Observability: ADR-021</li> <li>Audit Logging: ADR-008</li> <li>Schema Migration: ADR-023</li> <li>Auth Strategy: ADR-006</li> </ul> <p>\u201cD\u1eef li\u1ec7u th\u1eadt r\u1ea5t gi\u00e1 tr\u1ecb \u2013 v\u00e0 c\u00e0ng ph\u1ea3i \u0111\u01b0\u1ee3c b\u1ea3o v\u1ec7 nghi\u00eam ng\u1eb7t h\u01a1n khi d\u00f9ng sai m\u1ee5c \u0111\u00edch.\u201d</p>"},{"location":"architecture/rbac-deep-dive/","title":"Ph\u00e2n t\u00edch Chuy\u00ean s\u00e2u: Ki\u1ebfn tr\u00fac Ph\u00e2n quy\u1ec1n \u0110\u1ed9ng (RBAC) trong H\u1ec7 th\u1ed1ng dx-vas","text":""},{"location":"architecture/rbac-deep-dive/#1-tong-quan-inh-nghia-rbac","title":"1. T\u1ed5ng quan &amp; \u0110\u1ecbnh ngh\u0129a RBAC","text":"<p>RBAC (Role-Based Access Control) trong h\u1ec7 th\u1ed1ng dx-vas cho ph\u00e9p ki\u1ec3m so\u00e1t quy\u1ec1n truy c\u1eadp m\u1ed9t c\u00e1ch linh ho\u1ea1t v\u00e0 c\u00f3 th\u1ec3 m\u1edf r\u1ed9ng, d\u1ef1a tr\u00ean:</p> <ul> <li>Vai tr\u00f2 ng\u01b0\u1eddi d\u00f9ng (Role) trong t\u1eebng tr\u01b0\u1eddng th\u00e0nh vi\u00ean (tenant)</li> <li>T\u1eadp h\u1ee3p quy\u1ec1n (Permission) \u0111\u01b0\u1ee3c g\u00e1n cho m\u1ed7i role</li> <li>\u0110i\u1ec1u ki\u1ec7n th\u1ef1c thi (Condition, n\u1ebfu c\u00f3) \u00e1p d\u1ee5ng \u1edf c\u1ea5p permission</li> </ul> <p>M\u00f4 h\u00ecnh RBAC n\u00e0y ho\u1ea1t \u0111\u1ed9ng trong b\u1ed1i c\u1ea3nh multi-tenant, n\u01a1i m\u1ed7i tenant (tr\u01b0\u1eddng th\u00e0nh vi\u00ean) c\u00f3 RBAC \u0111\u1ed9c l\u1eadp, nh\u01b0ng v\u1eabn k\u1ebf th\u1eeba m\u1ed9t ph\u1ea7n t\u1eeb template to\u00e0n h\u1ec7 th\u1ed1ng do User Service Master cung c\u1ea5p.</p>"},{"location":"architecture/rbac-deep-dive/#2-phan-tang-quan-ly-inh-danh-phan-quyen","title":"2. Ph\u00e2n t\u1ea7ng Qu\u1ea3n l\u00fd \u0110\u1ecbnh danh &amp; Ph\u00e2n quy\u1ec1n","text":""},{"location":"architecture/rbac-deep-dive/#user-service-master","title":"\ud83e\udde0 User Service Master","text":"<ul> <li>L\u00e0 ngu\u1ed3n ch\u00e2n l\u00fd duy nh\u1ea5t cho to\u00e0n b\u1ed9 ng\u01b0\u1eddi d\u00f9ng (<code>users_global</code>)</li> <li>Qu\u1ea3n l\u00fd:</li> <li>Danh s\u00e1ch tenant (<code>tenants</code>)</li> <li>M\u1ed1i quan h\u1ec7 user \u2194 tenant (<code>user_tenant_assignments</code>)</li> <li>C\u00e1c template vai tr\u00f2 v\u00e0 quy\u1ec1n to\u00e0n h\u1ec7 th\u1ed1ng:<ul> <li><code>global_roles_templates</code></li> <li><code>global_permissions_templates</code></li> </ul> </li> <li>Kh\u00f4ng tr\u1ef1c ti\u1ebfp \u0111\u00e1nh gi\u00e1 RBAC, m\u00e0 cung c\u1ea5p \u0111\u1ecbnh danh v\u00e0 template cho Sub Services</li> </ul>"},{"location":"architecture/rbac-deep-dive/#sub-user-service-per-tenant","title":"\ud83e\udde9 Sub User Service (per Tenant)","text":"<ul> <li>M\u1ed7i tenant c\u00f3 1 instance ri\u00eang, qu\u1ea3n l\u00fd:</li> <li>Ng\u01b0\u1eddi d\u00f9ng thu\u1ed9c tenant (<code>users_in_tenant</code>) \u2013 \u00e1nh x\u1ea1 \u0111\u1ebfn <code>user_id_global</code></li> <li>Tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng n\u1ed9i b\u1ed9: <code>is_active_in_tenant</code></li> <li>Vai tr\u00f2 (<code>roles_in_tenant</code>), quy\u1ec1n (<code>permissions_in_tenant</code>)</li> <li>Mapping:<ul> <li><code>user_role_in_tenant</code></li> <li><code>role_permission_in_tenant</code></li> </ul> </li> <li>Cho ph\u00e9p k\u1ebf th\u1eeba t\u1eeb template Master ho\u1eb7c t\u1ef1 \u0111\u1ecbnh ngh\u0129a</li> </ul>"},{"location":"architecture/rbac-deep-dive/#3-luong-xac-thuc-phan-quyen-multi-tenant","title":"3. Lu\u1ed3ng X\u00e1c th\u1ef1c &amp; Ph\u00e2n quy\u1ec1n (Multi-Tenant)","text":""},{"location":"architecture/rbac-deep-dive/#luong-phat-hanh-jwt","title":"\ud83d\udd10 Lu\u1ed3ng ph\u00e1t h\u00e0nh JWT","text":"<ol> <li>Ng\u01b0\u1eddi d\u00f9ng \u0111\u0103ng nh\u1eadp qua:</li> <li>Google OAuth2 \u2192 Auth Master</li> <li>OTP/Local \u2192 Sub Auth Service</li> <li>Sau khi x\u00e1c th\u1ef1c:</li> <li><code>tenant_id</code> \u0111\u01b0\u1ee3c ch\u1ecdn (n\u1ebfu ng\u01b0\u1eddi d\u00f9ng thu\u1ed9c nhi\u1ec1u tenant)</li> <li>Auth Service g\u1ecdi User Service Master \u2192 ki\u1ec3m tra <code>user_id_global</code> + quy\u1ec1n truy c\u1eadp tenant</li> <li>G\u1ecdi Sub User Service \u2192 l\u1ea5y <code>roles</code>, <code>permissions</code></li> <li>JWT \u0111\u01b0\u1ee3c ph\u00e1t h\u00e0nh v\u1edbi:</li> <li><code>user_id</code>, <code>tenant_id</code>, <code>roles</code>, <code>permissions</code>, <code>auth_provider</code></li> </ol>"},{"location":"architecture/rbac-deep-dive/#api-gateway-anh-gia-rbac","title":"\ud83d\udee1\ufe0f API Gateway \u0111\u00e1nh gi\u00e1 RBAC","text":"<ul> <li>Tr\u00edch xu\u1ea5t <code>tenant_id</code> t\u1eeb JWT</li> <li>Ki\u1ec3m tra <code>is_active</code> + <code>is_active_in_tenant</code></li> <li>Truy v\u1ea5n Redis cache: <code>rbac:{user_id}:{tenant_id}</code></li> <li>N\u1ebfu kh\u00f4ng c\u00f3 cache, g\u1ecdi Sub User Service \u0111\u1ec3 load l\u1ea1i RBAC</li> <li>\u0110\u00e1nh gi\u00e1 <code>condition</code> n\u1ebfu permission c\u00f3 r\u00e0ng bu\u1ed9c \u0111\u1ed9ng</li> </ul>"},{"location":"architecture/rbac-deep-dive/#4-mo-hinh-du-lieu-rbac-master-vs-sub","title":"4. M\u00f4 h\u00ecnh D\u1eef li\u1ec7u RBAC (Master vs Sub)","text":""},{"location":"architecture/rbac-deep-dive/#tai-user-service-master","title":"\ud83d\udce6 T\u1ea1i User Service Master","text":"<pre><code>-- Danh s\u00e1ch ng\u01b0\u1eddi d\u00f9ng to\u00e0n h\u1ec7 th\u1ed1ng\nCREATE TABLE users_global (\n  user_id UUID PRIMARY KEY,\n  full_name TEXT NOT NULL,\n  email TEXT NOT NULL,\n  phone TEXT,\n  auth_provider TEXT NOT NULL CHECK (auth_provider IN ('google', 'local')),\n  local_auth_tenant_id UUID NULL,\n  is_active BOOLEAN DEFAULT TRUE,\n  UNIQUE (email, auth_provider) -- \u0111\u1ea3m b\u1ea3o kh\u00f4ng tr\u00f9ng email gi\u1eefa c\u00e1c lo\u1ea1i \u0111\u0103ng nh\u1eadp\n);\n\n-- Danh s\u00e1ch tenant\nCREATE TABLE tenants (\n  tenant_id UUID PRIMARY KEY,\n  tenant_name TEXT NOT NULL,\n  status TEXT NOT NULL CHECK (status IN ('active', 'inactive'))\n);\n\n-- G\u00e1n user v\u00e0o tenant\nCREATE TABLE user_tenant_assignments (\n  user_id UUID REFERENCES users_global(user_id),\n  tenant_id UUID REFERENCES tenants(tenant_id),\n  assigned_by UUID,\n  assigned_at TIMESTAMP,\n  PRIMARY KEY (user_id, tenant_id)\n);\n\n-- Template vai tr\u00f2 to\u00e0n h\u1ec7 th\u1ed1ng\nCREATE TABLE global_roles_templates (\n  template_id UUID PRIMARY KEY,\n  template_code TEXT UNIQUE NOT NULL,\n  description TEXT\n);\n\n-- Template quy\u1ec1n to\u00e0n h\u1ec7 th\u1ed1ng\nCREATE TABLE global_permissions_templates (\n  template_id UUID PRIMARY KEY,\n  permission_code TEXT UNIQUE NOT NULL,\n  action TEXT NOT NULL,\n  resource TEXT NOT NULL,\n  default_condition JSONB\n);\n</code></pre>"},{"location":"architecture/rbac-deep-dive/#tai-sub-user-service-moi-tenant","title":"\ud83d\udce6 T\u1ea1i Sub User Service (m\u1ed7i tenant)","text":"<pre><code>-- Ng\u01b0\u1eddi d\u00f9ng n\u1ed9i b\u1ed9 tenant (d\u00f9ng user_id to\u00e0n c\u1ee5c l\u00e0m PK)\nCREATE TABLE users_in_tenant (\n  user_id UUID PRIMARY KEY REFERENCES users_global(user_id),\n  is_active_in_tenant BOOLEAN DEFAULT TRUE\n);\n\n-- Vai tr\u00f2 trong tenant\nCREATE TABLE roles_in_tenant (\n  role_id UUID PRIMARY KEY,\n  role_code TEXT UNIQUE NOT NULL,\n  role_name TEXT NOT NULL\n);\n\n-- Quy\u1ec1n trong tenant\nCREATE TABLE permissions_in_tenant (\n  permission_id UUID PRIMARY KEY,\n  permission_code TEXT UNIQUE NOT NULL,\n  action TEXT NOT NULL,\n  resource TEXT NOT NULL,\n  condition JSONB -- v\u00ed d\u1ee5: { \"class_id\": \"$user.class_id\" }\n);\n\n-- Mapping vai tr\u00f2 \u2194 ng\u01b0\u1eddi d\u00f9ng\nCREATE TABLE user_role_in_tenant (\n  user_id UUID REFERENCES users_in_tenant(user_id),\n  role_id UUID REFERENCES roles_in_tenant(role_id),\n  PRIMARY KEY (user_id, role_id)\n);\n\n-- Mapping quy\u1ec1n \u2194 vai tr\u00f2\nCREATE TABLE role_permission_in_tenant (\n  role_id UUID REFERENCES roles_in_tenant(role_id),\n  permission_id UUID REFERENCES permissions_in_tenant(permission_id),\n  PRIMARY KEY (role_id, permission_id)\n);\n</code></pre> <p>\ud83d\udcd8 M\u00f4 h\u00ecnh d\u1eef li\u1ec7u n\u00e0y gi\u00fap t\u00e1ch bi\u1ec7t r\u00f5 r\u00e0ng gi\u1eefa \u0111\u1ecbnh danh to\u00e0n c\u1ee5c v\u00e0 RBAC c\u1ee5c b\u1ed9 theo t\u1eebng tenant. T\u00e0i li\u1ec7u chi ti\u1ebft h\u01a1n \u0111\u01b0\u1ee3c tr\u00ecnh b\u00e0y t\u1ea1i:</p> <ul> <li><code>user-service/master/data-model.md</code></li> <li><code>user-service/tenant/data-model.md</code></li> </ul>"},{"location":"architecture/rbac-deep-dive/#5-permission-co-ieu-kien-condition-jsonb","title":"5. Permission c\u00f3 \u0111i\u1ec1u ki\u1ec7n (Condition JSONB)","text":"<p>H\u1ec7 th\u1ed1ng dx-vas h\u1ed7 tr\u1ee3 permission c\u00f3 \u0111i\u1ec1u ki\u1ec7n \u2013 cho ph\u00e9p ki\u1ec3m so\u00e1t truy c\u1eadp \u0111\u1ed9ng d\u1ef1a tr\u00ean ng\u1eef c\u1ea3nh request v\u00e0 \u0111\u1eb7c t\u00ednh c\u1ee7a ng\u01b0\u1eddi d\u00f9ng. M\u1ed7i permission c\u00f3 th\u1ec3 khai b\u00e1o m\u1ed9t <code>condition</code> d\u01b0\u1edbi d\u1ea1ng JSONB.</p>"},{"location":"architecture/rbac-deep-dive/#vi-du-ve-permission-co-ieu-kien","title":"\ud83d\udccc V\u00ed d\u1ee5 v\u1ec1 permission c\u00f3 \u0111i\u1ec1u ki\u1ec7n:","text":"<pre><code>{\n  \"class_id\": \"$user.class_id\"\n}\n</code></pre> <p>\u00dd ngh\u0129a: Ch\u1ec9 cho ph\u00e9p truy c\u1eadp khi <code>class_id</code> trong request tr\u00f9ng kh\u1edbp v\u1edbi <code>class_id</code> c\u1ee7a user hi\u1ec7n t\u1ea1i (do Sub User Service cung c\u1ea5p trong JWT).</p>"},{"location":"architecture/rbac-deep-dive/#context-ho-tro-khi-evaluate","title":"\ud83d\udee0 Context h\u1ed7 tr\u1ee3 khi evaluate:","text":"<ul> <li>User context: <code>$user.{field}</code> \u2013 \u0111\u1ebfn t\u1eeb <code>users_in_tenant</code></li> <li>Request context: <code>$request.{field}</code> \u2013 t\u1eeb body/query/header</li> <li>Tenant context: <code>$tenant.{field}</code> \u2013 n\u1ebfu c\u00f3 metadata</li> </ul>"},{"location":"architecture/rbac-deep-dive/#anh-gia-ieu-kien","title":"\ud83e\udde0 \u0110\u00e1nh gi\u00e1 \u0111i\u1ec1u ki\u1ec7n:","text":"<ul> <li>\u0110\u01b0\u1ee3c th\u1ef1c hi\u1ec7n t\u1ea1i API Gateway</li> <li>Engine so s\u00e1nh gi\u00e1 tr\u1ecb th\u1ef1c t\u1ebf trong request v\u1edbi \u0111i\u1ec1u ki\u1ec7n JSONB</li> <li>N\u1ebfu m\u1ed9t permission c\u00f3 <code>condition = null</code> \u2192 lu\u00f4n \u0111\u00fang</li> </ul> <p>\ud83d\udcd8 C\u00e1c tenant c\u00f3 th\u1ec3 t\u1ef1 \u0111\u1ecbnh ngh\u0129a \u0111i\u1ec1u ki\u1ec7n ri\u00eang theo logic \u0111\u1eb7c th\u00f9.</p>"},{"location":"architecture/rbac-deep-dive/#6-chien-luoc-cache-rbac-tai-api-gateway","title":"6. Chi\u1ebfn l\u01b0\u1ee3c Cache RBAC t\u1ea1i API Gateway","text":"<p>\u0110\u1ec3 gi\u1ea3m t\u1ea3i truy v\u1ea5n RBAC th\u01b0\u1eddng xuy\u00ean, h\u1ec7 th\u1ed1ng s\u1eed d\u1ee5ng cache RBAC t\u1ea1i API Gateway v\u1edbi chi\u1ebfn l\u01b0\u1ee3c sau:</p>"},{"location":"architecture/rbac-deep-dive/#key-cache","title":"\ud83d\udd11 Key cache:","text":"<pre><code>rbac:{user_id}:{tenant_id}\n</code></pre>"},{"location":"architecture/rbac-deep-dive/#value-cache","title":"\ud83d\udce6 Value cache:","text":"<pre><code>{\n  \"roles\": [...],\n  \"permissions\": [...],\n  \"issued_at\": \"2025-07-01T12:00:00Z\"\n}\n</code></pre>"},{"location":"architecture/rbac-deep-dive/#ttl-lam-moi","title":"\u23f1 TTL &amp; L\u00e0m m\u1edbi:","text":"<ul> <li>TTL m\u1eb7c \u0111\u1ecbnh: 5\u201315 ph\u00fat t\u00f9y d\u1ecbch v\u1ee5</li> <li>C\u00f3 th\u1ec3 l\u00e0m m\u1edbi th\u1ee7 c\u00f4ng khi g\u00e1n quy\u1ec1n m\u1edbi</li> <li>Cache s\u1ebd t\u1ef1 \u0111\u1ed9ng l\u00e0m m\u1edbi n\u1ebfu JWT m\u1edbi ch\u1ee9a RBAC m\u1edbi</li> </ul>"},{"location":"architecture/rbac-deep-dive/#invalidation-qua-pubsub","title":"\ud83d\udd01 Invalidation qua Pub/Sub:","text":"<ul> <li> <p>Khi Sub User Service c\u1eadp nh\u1eadt RBAC:</p> </li> <li> <p>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>rbac_updated</code> \u2192 Gateway subscribe \u2192 xo\u00e1 cache</p> </li> <li> <p>Khi user b\u1ecb v\u00f4 hi\u1ec7u h\u00f3a:</p> </li> <li> <p>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>user_status_changed</code> (t\u1eeb Master ho\u1eb7c Sub) \u2192 Gateway hu\u1ef7 JWT v\u00e0 cache</p> </li> </ul> <p>\ud83d\udcd8 \u0110\u1ecbnh ngh\u0129a event schema trong <code>rbac-events.md</code></p>"},{"location":"architecture/rbac-deep-dive/#7-chien-luoc-ong-bo-rbac","title":"7. Chi\u1ebfn l\u01b0\u1ee3c \u0110\u1ed3ng b\u1ed9 RBAC","text":"<p>H\u1ec7 th\u1ed1ng h\u1ed7 tr\u1ee3 kh\u1ea3 n\u0103ng k\u1ebf th\u1eeba template t\u1eeb Master, tu\u1ef3 ch\u1ec9nh, v\u00e0 giao di\u1ec7n qu\u1ea3n l\u00fd ph\u00e2n quy\u1ec1n ri\u00eang cho t\u1eebng tenant.</p>"},{"location":"architecture/rbac-deep-dive/#ke-thua-tuy-chinh","title":"\ud83d\udcda K\u1ebf th\u1eeba &amp; t\u00f9y ch\u1ec9nh:","text":"<ul> <li> <p>M\u1ed7i tenant c\u00f3 th\u1ec3:</p> </li> <li> <p>D\u00f9ng <code>global_roles_templates</code> &amp; <code>global_permissions_templates</code> t\u1eeb Master</p> </li> <li>Clone v\u1ec1 l\u00e0m b\u1ea3n ri\u00eang \u2192 \u0111\u1ed5i t\u00ean/logic/condition</li> <li>Ho\u1eb7c t\u1ef1 t\u1ea1o t\u1eeb \u0111\u1ea7u ho\u00e0n to\u00e0n</li> </ul>"},{"location":"architecture/rbac-deep-dive/#gan-role-cho-nguoi-dung","title":"\ud83e\udde9 G\u00e1n role cho ng\u01b0\u1eddi d\u00f9ng:","text":"<ul> <li> <p>Sub User Service cung c\u1ea5p API cho Admin Webapp tenant:</p> </li> <li> <p>G\u00e1n <code>role_id</code> cho <code>user_id</code></p> </li> <li>C\u1eadp nh\u1eadt <code>is_active_in_tenant</code></li> <li>T\u1ea1o vai tr\u00f2 t\u00f9y ch\u1ec9nh (n\u1ebfu \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n)</li> </ul>"},{"location":"architecture/rbac-deep-dive/#ong-bo-inh-ky-tuy-chon","title":"\ud83d\udd01 \u0110\u1ed3ng b\u1ed9 \u0111\u1ecbnh k\u1ef3 (t\u00f9y ch\u1ecdn):","text":"<ul> <li>N\u1ebfu tenant cho ph\u00e9p, c\u00f3 th\u1ec3 \u0111\u1ed3ng b\u1ed9 l\u1ea1i template m\u1ed7i tu\u1ea7n/th\u00e1ng t\u1eeb Master</li> </ul>"},{"location":"architecture/rbac-deep-dive/#8-hieu-nang-kha-nang-mo-rong","title":"8. Hi\u1ec7u n\u0103ng &amp; Kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng","text":"<p>H\u1ec7 th\u1ed1ng RBAC c\u1ee7a dx-vas \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf \u0111\u1ec3 h\u1ed7 tr\u1ee3 s\u1ed1 l\u01b0\u1ee3ng l\u1edbn tenant, m\u1ed7i tenant c\u00f3 th\u1ec3 c\u00f3 h\u00e0ng tr\u0103m vai tr\u00f2 v\u00e0 ng\u01b0\u1eddi d\u00f9ng.</p>"},{"location":"architecture/rbac-deep-dive/#ky-thuat-toi-uu","title":"\ud83d\udd27 K\u1ef9 thu\u1eadt t\u1ed1i \u01b0u:","text":"<ul> <li>Cache t\u1ea1i Gateway \u2192 tr\u00e1nh truy v\u1ea5n Sub Service m\u1ed7i request</li> <li>Fan-out pub/sub invalidate \u2192 t\u1ed1i thi\u1ec3u ho\u00e1 latency c\u1eadp nh\u1eadt RBAC</li> <li>Permission condition JSONB cho ph\u00e9p RBAC m\u1ec1m d\u1ebbo m\u00e0 kh\u00f4ng c\u1ea7n ph\u00e2n m\u1ea3nh b\u1ea3ng</li> </ul>"},{"location":"architecture/rbac-deep-dive/#cloud-scale","title":"\u2601\ufe0f Cloud Scale:","text":"<ul> <li>Redis RBAC cache \u0111\u01b0\u1ee3c chia namespace theo <code>tenant_id</code></li> <li>Sub User Service \u0111\u01b0\u1ee3c autoscale \u0111\u1ed9c l\u1eadp \u2192 ph\u00e2n t\u1ea3i d\u1ec5 d\u00e0ng</li> <li>RBAC API c\u00f3 th\u1ec3 batch (g\u00e1n nhi\u1ec1u role/user c\u00f9ng l\u00fac)</li> </ul>"},{"location":"architecture/rbac-deep-dive/#monitoring","title":"\ud83d\udd0d Monitoring:","text":"<ul> <li>M\u1ed7i l\u1ea7n cache hit/miss \u0111\u01b0\u1ee3c log k\u00e8m <code>tenant_id</code></li> <li>C\u00f3 c\u1ea3nh b\u00e1o n\u1ebfu role mapping b\u1ea5t th\u01b0\u1eddng (VD: user c\u00f3 100+ role)</li> </ul> <p>\ud83d\udcd8 \u0110\u1ec3 t\u1ed1i \u01b0u h\u01a1n n\u1eefa, c\u00f3 th\u1ec3 t\u00edch h\u1ee3p JWT RBAC claims k\u00fd c\u1ee9ng v\u1edbi TTL ng\u1eafn + checksum (\u0111ang \u0111\u01b0\u1ee3c nghi\u00ean c\u1ee9u)</p>"},{"location":"architecture/rbac-deep-dive/#9-bao-mat-chuyen-sau-trong-rbac","title":"9. B\u1ea3o m\u1eadt chuy\u00ean s\u00e2u trong RBAC","text":"<p>RBAC l\u00e0 l\u1edbp ki\u1ec3m so\u00e1t truy c\u1eadp tr\u1ecdng y\u1ebfu, n\u00ean c\u00e1c nguy\u00ean t\u1eafc b\u1ea3o m\u1eadt sau \u0111\u01b0\u1ee3c \u00e1p d\u1ee5ng nghi\u00eam ng\u1eb7t trong h\u1ec7 th\u1ed1ng dx-vas:</p>"},{"location":"architecture/rbac-deep-dive/#isolation-theo-tenant","title":"\ud83d\udd10 Isolation theo Tenant","text":"<ul> <li>M\u1ed7i Sub User Service ch\u1ec9 truy xu\u1ea5t d\u1eef li\u1ec7u ng\u01b0\u1eddi d\u00f9ng v\u00e0 role/permission c\u1ee7a ch\u00ednh tenant \u0111\u00f3</li> <li>Kh\u00f4ng c\u00f3 API cho ph\u00e9p thao t\u00e1c ch\u00e9o tenant</li> </ul>"},{"location":"architecture/rbac-deep-dive/#ten-inh-danh-va-khong-gian-rbac","title":"\ud83d\udd10 T\u00ean \u0111\u1ecbnh danh v\u00e0 kh\u00f4ng gian RBAC","text":"<ul> <li>C\u00e1c vai tr\u00f2 (<code>role_code</code>) v\u00e0 quy\u1ec1n (<code>permission_code</code>) ph\u1ea3i l\u00e0 duy nh\u1ea5t trong ph\u1ea1m vi tenant</li> <li>Kh\u00f4ng cho ph\u00e9p \u201cshadow\u201d vai tr\u00f2 t\u1eeb tenant kh\u00e1c</li> </ul>"},{"location":"architecture/rbac-deep-dive/#chong-gia-mao-jwt","title":"\ud83d\udd10 Ch\u1ed1ng gi\u1ea3 m\u1ea1o JWT","text":"<ul> <li>RBAC trong JWT ph\u1ea3i \u0111\u01b0\u1ee3c k\u00fd v\u00e0 x\u00e1c th\u1ef1c b\u1edfi Gateway</li> <li>Kh\u00f4ng tin t\u01b0\u1edfng RBAC trong request t\u1eeb client frontend</li> </ul>"},{"location":"architecture/rbac-deep-dive/#api-rbac-luon-bao-ve-boi-auth-role","title":"\ud83d\udd10 API RBAC lu\u00f4n b\u1ea3o v\u1ec7 b\u1edfi Auth + Role","text":"<ul> <li>M\u1ecdi thao t\u00e1c g\u00e1n quy\u1ec1n, g\u00e1n vai tr\u00f2, c\u1eadp nh\u1eadt ph\u1ea3i c\u00f3 quy\u1ec1n c\u1ee5 th\u1ec3 (<code>manage_rbac</code>, <code>assign_role</code>, v.v.)</li> </ul>"},{"location":"architecture/rbac-deep-dive/#10-giam-sat-go-loi","title":"10. Gi\u00e1m s\u00e1t &amp; G\u1ee1 l\u1ed7i","text":"<p>\u0110\u1ec3 h\u1ed7 tr\u1ee3 v\u1eadn h\u00e0nh v\u00e0 b\u1ea3o m\u1eadt, c\u00e1c h\u00e0nh \u0111\u1ed9ng li\u00ean quan \u0111\u1ebfn RBAC \u0111\u01b0\u1ee3c log v\u00e0 theo d\u00f5i chi ti\u1ebft:</p>"},{"location":"architecture/rbac-deep-dive/#audit-trail","title":"\ud83e\udeb5 Audit Trail","text":"<ul> <li>M\u1ed7i h\u00e0nh \u0111\u1ed9ng:</li> <li>G\u00e1n vai tr\u00f2</li> <li>T\u1ea1o permission</li> <li>C\u1eadp nh\u1eadt condition</li> <li>\u0110\u01b0\u1ee3c log k\u00e8m:</li> <li><code>user_id</code>, <code>actor_id</code>, <code>tenant_id</code>, <code>timestamp</code>, <code>payload_before</code>, <code>payload_after</code></li> </ul>"},{"location":"architecture/rbac-deep-dive/#debug-flow-tai-gateway","title":"\ud83e\uddea Debug Flow t\u1ea1i Gateway","text":"<ul> <li>G\u1eafn <code>X-RBAC-Trace-ID</code> v\u00e0o m\u1ed7i request n\u1ebfu b\u1eadt debug</li> <li>Log c\u00e1c b\u01b0\u1edbc \u0111\u00e1nh gi\u00e1: permission match, condition eval, cache hit/miss</li> <li>C\u00f3 th\u1ec3 b\u1eadt ch\u1ebf \u0111\u1ed9 \u201cdry-run\u201d RBAC tr\u00ean staging \u0111\u1ec3 ki\u1ec3m tra rule m\u1edbi</li> </ul>"},{"location":"architecture/rbac-deep-dive/#metrics","title":"\ud83d\udcc8 Metrics","text":"<ul> <li>S\u1ed1 l\u01b0\u1ee3ng permission theo tenant</li> <li>T\u1ef7 l\u1ec7 cache hit/miss RBAC</li> <li>C\u1ea3nh b\u00e1o n\u1ebfu user c\u00f3 s\u1ed1 role v\u01b0\u1ee3t ng\u01b0\u1ee1ng</li> </ul>"},{"location":"architecture/rbac-deep-dive/#11-best-practices-cho-quan-tri-rbac","title":"11. Best Practices cho Qu\u1ea3n tr\u1ecb RBAC","text":"<p>M\u1ed9t s\u1ed1 khuy\u1ebfn ngh\u1ecb \u0111\u01b0\u1ee3c \u00e1p d\u1ee5ng v\u00e0 ki\u1ec3m so\u00e1t qua Superadmin Webapp ho\u1eb7c Admin Webapp t\u1ea1i tenant:</p> <ul> <li>\u2705 \u0110\u1eb7t t\u00ean <code>role_code</code>, <code>permission_code</code> r\u00f5 r\u00e0ng, snake_case</li> <li>\u2705 T\u00e1ch vai tr\u00f2 theo domain ch\u1ee9c n\u0103ng: <code>academic_staff</code>, <code>finance_admin</code>, <code>class_teacher</code></li> <li>\u2705 Gi\u1edbi h\u1ea1n s\u1ed1 vai tr\u00f2/user \u2264 10 \u0111\u1ec3 d\u1ec5 ki\u1ec3m so\u00e1t</li> <li>\u2705 \u01afu ti\u00ean d\u00f9ng permission c\u00f3 <code>condition</code> h\u01a1n l\u00e0 t\u1ea1o th\u00eam role m\u1edbi</li> <li>\u2705 D\u00f9ng template n\u1ebfu tenant kh\u00f4ng c\u00f3 nhu c\u1ea7u tu\u1ef3 ch\u1ec9nh</li> <li>\u274c Kh\u00f4ng cho ph\u00e9p s\u1eeda <code>role_code</code> sau khi g\u00e1n cho user</li> <li>\u274c Kh\u00f4ng c\u1ea5p quy\u1ec1n <code>manage_rbac</code> \u0111\u1ea1i tr\u00e0 \u2013 n\u00ean g\u00e1n cho 1\u20132 ng\u01b0\u1eddi c\u00f3 tr\u00e1ch nhi\u1ec7m</li> </ul>"},{"location":"architecture/rbac-deep-dive/#12-cong-cu-tai-lieu-lien-quan","title":"12. C\u00f4ng c\u1ee5 &amp; T\u00e0i li\u1ec7u li\u00ean quan","text":"<p>\ud83d\udcd8 T\u00e0i li\u1ec7u k\u1ef9 thu\u1eadt chi ti\u1ebft li\u00ean quan \u0111\u1ebfn RBAC:</p> M\u1ee5c File Ki\u1ebfn tr\u00fac t\u1ed5ng quan RBAC <code>README.md</code> M\u00f4 h\u00ecnh d\u1eef li\u1ec7u User Master <code>user-service/master/data-model.md</code> M\u00f4 h\u00ecnh d\u1eef li\u1ec7u Sub User Service <code>user-service/tenant/data-model.md</code> Giao di\u1ec7n qu\u1ea3n tr\u1ecb RBAC <code>ic-02-admin-webapp.md</code> Ki\u1ec3m so\u00e1t x\u00e1c th\u1ef1c &amp; JWT <code>adr-006-auth-strategy.md</code> Quy t\u1eafc \u0111i\u1ec1u ki\u1ec7n &amp; JSONB <code>rbac-condition-schema.md</code> S\u1ef1 ki\u1ec7n RBAC &amp; Cache Invalidation <code>rbac-events.md</code> Danh s\u00e1ch role m\u1eabu to\u00e0n h\u1ec7 th\u1ed1ng <code>global-roles-template.yaml</code>"},{"location":"architecture/rbac-deep-dive/#so-o-rbac-phan-tang-user-master-va-sub-user-services","title":"\ud83d\udd0d S\u01a1 \u0111\u1ed3 RBAC Ph\u00e2n t\u1ea7ng \u2013 User Master v\u00e0 Sub User Services","text":"<pre><code>flowchart TD\n\n  subgraph Master[\"User Service Master\"]\n    UGM[users_global]\n    TENTS[tenants]\n    UTA[user_tenant_assignments]\n    GRT[global_roles_templates]\n    GPT[global_permissions_templates]\n  end\n\n  subgraph Tenant_A[\"Sub User Service \u2013 Tenant A\"]\n    UTA1[users_in_tenant]\n    RA1[roles_in_tenant]\n    PA1[permissions_in_tenant]\n    URA1[user_role_in_tenant]\n    RPA1[role_permission_in_tenant]\n  end\n\n  subgraph Tenant_B[\"Sub User Service \u2013 Tenant B\"]\n    UTA2[users_in_tenant]\n    RA2[roles_in_tenant]\n    PA2[permissions_in_tenant]\n    URA2[user_role_in_tenant]\n    RPA2[role_permission_in_tenant]\n  end\n\n  %% Mapping\n  UGM --&gt; UTA\n  TENTS --&gt; UTA\n  UGM --&gt; UTA1\n  UGM --&gt; UTA2\n\n  GRT --&gt; RA1\n  GRT --&gt; RA2\n  GPT --&gt; PA1\n  GPT --&gt; PA2\n\n  UTA1 --&gt; URA1\n  RA1 --&gt; URA1\n  RA1 --&gt; RPA1\n  PA1 --&gt; RPA1\n\n  UTA2 --&gt; URA2\n  RA2 --&gt; URA2\n  RA2 --&gt; RPA2\n  PA2 --&gt; RPA2\n</code></pre> <p>\ud83d\udccc Gi\u1ea3i th\u00edch:</p> <ul> <li><code>users_global</code> l\u00e0 ngu\u1ed3n \u0111\u1ecbnh danh chung, d\u00f9ng cho t\u1ea5t c\u1ea3 c\u00e1c tenant.</li> <li> <p>M\u1ed7i tenant c\u00f3 Sub User Service qu\u1ea3n l\u00fd ri\u00eang:</p> </li> <li> <p><code>users_in_tenant</code> \u00e1nh x\u1ea1 t\u1edbi <code>user_id_global</code></p> </li> <li>Vai tr\u00f2 &amp; quy\u1ec1n c\u1ee5c b\u1ed9, c\u00f3 th\u1ec3 k\u1ebf th\u1eeba t\u1eeb Master ho\u1eb7c t\u1ef1 \u0111\u1ecbnh ngh\u0129a</li> <li>Mapping RBAC (<code>user \u2194 role \u2194 permission</code>) l\u00e0 \u0111\u1ed9c l\u1eadp gi\u1eefa c\u00e1c tenant.</li> </ul> <p>\ud83d\udcd8 S\u01a1 \u0111\u1ed3 n\u00e0y gi\u00fap Superadmin, DevOps v\u00e0 Dev hi\u1ec3u r\u00f5 lu\u1ed3ng ph\u00e2n quy\u1ec1n, v\u1ecb tr\u00ed source of truth, v\u00e0 c\u00e1ch t\u00e1ch bi\u1ec7t b\u1ea3o m\u1eadt gi\u1eefa c\u00e1c tenant.</p>"},{"location":"architecture/rbac-deep-dive/#so-o-luong-kiem-tra-rbac-tai-api-gateway","title":"\ud83d\udd10 S\u01a1 \u0111\u1ed3 Lu\u1ed3ng Ki\u1ec3m tra RBAC t\u1ea1i API Gateway","text":"<pre><code>sequenceDiagram\n    autonumber\n    participant Client as \ud83c\udf10 Client (Frontend)\n    participant Gateway as \ud83d\udee1\ufe0f API Gateway\n    participant Auth as \ud83d\udd10 Auth Service (Master/Sub)\n    participant JWT as \ud83d\udce6 JWT Token\n    participant Redis as \u26a1 RBAC Cache\n    participant SubUser as \ud83e\udde9 Sub User Service (per tenant)\n\n    Client-&gt;&gt;Auth: \u0110\u0103ng nh\u1eadp (OAuth2 / OTP)\n    Auth-&gt;&gt;JWT: Ph\u00e1t h\u00e0nh JWT ch\u1ee9a\\nuser_id, tenant_id, roles, permissions\n    Client-&gt;&gt;Gateway: G\u1eedi request k\u00e8m JWT\n\n    Gateway-&gt;&gt;JWT: Gi\u1ea3i m\u00e3 JWT\n    Gateway-&gt;&gt;JWT: L\u1ea5y user_id, tenant_id, permissions\n    alt Cache Hit\n        Gateway-&gt;&gt;Redis: L\u1ea5y RBAC t\u1eeb cache\\nrbac:{user_id}:{tenant_id}\n    else Cache Miss\n        Gateway-&gt;&gt;SubUser: G\u1ecdi API \u0111\u1ec3 l\u1ea5y roles &amp; permissions\n        SubUser--&gt;&gt;Gateway: Tr\u1ea3 v\u1ec1 roles, permissions\n        Gateway-&gt;&gt;Redis: Ghi cache RBAC\n    end\n\n    alt C\u00f3 permission kh\u1edbp + \u0111i\u1ec1u ki\u1ec7n \u0111\u00fang\n        Gateway--&gt;&gt;Client: \u2705 200 OK (forward t\u1edbi backend)\n    else Kh\u00f4ng c\u00f3 quy\u1ec1n / Sai \u0111i\u1ec1u ki\u1ec7n\n        Gateway--&gt;&gt;Client: \u274c 403 Forbidden\n    end\n</code></pre> <p>\ud83d\udccc Gi\u1ea3i th\u00edch nhanh:</p> <ul> <li>Gateway l\u00e0 n\u01a1i trung t\u00e2m \u0111\u00e1nh gi\u00e1 quy\u1ec1n d\u1ef1a tr\u00ean JWT v\u00e0 RBAC.</li> <li>D\u00f9ng cache Redis \u0111\u1ec3 tr\u00e1nh g\u1ecdi Sub User Service qu\u00e1 th\u01b0\u1eddng xuy\u00ean.</li> <li>H\u1ed7 tr\u1ee3 <code>condition JSONB</code> \u0111\u01b0\u1ee3c \u0111\u00e1nh gi\u00e1 t\u1ea1i Gateway b\u1eb1ng context t\u1eeb JWT v\u00e0 request.</li> </ul> <p>\ud83d\udcd8 RBAC cache invalidation \u0111\u01b0\u1ee3c \u0111i\u1ec1u ph\u1ed1i b\u1edfi Pub/Sub events t\u1eeb Sub User Service nh\u01b0 <code>rbac_updated</code> ho\u1eb7c <code>user_status_changed</code>.</p>"},{"location":"architecture/rbac-deep-dive/#so-o-luong-phat-hanh-jwt-a-tenant","title":"\ud83d\udd11 S\u01a1 \u0111\u1ed3 Lu\u1ed3ng Ph\u00e1t h\u00e0nh JWT \u0110a-Tenant","text":"<pre><code>sequenceDiagram\n    autonumber\n    participant User as \ud83d\udc64 Ng\u01b0\u1eddi d\u00f9ng\n    participant Frontend as \ud83c\udf10 Frontend App\n    participant AuthM as \ud83d\udd10 Auth Service Master\n    participant AuthT as \ud83d\udd10 Sub Auth Service (per tenant)\n    participant UserMaster as \ud83e\udde0 User Service Master\n    participant UserSub as \ud83e\udde9 Sub User Service (per tenant)\n    participant JWT as \ud83d\udce6 JWT Token\n\n    rect rgba(220,220,220,0.1)\n    Note over User, AuthM: \u0110\u0103ng nh\u1eadp Google OAuth2\n    User-&gt;&gt;Frontend: M\u1edf \u1ee9ng d\u1ee5ng\n    Frontend-&gt;&gt;AuthM: Login via Google\n    AuthM-&gt;&gt;Google: OAuth2 Authorization\n    Google--&gt;&gt;AuthM: Access Token\n    AuthM-&gt;&gt;UserMaster: X\u00e1c minh user + l\u1ea5y user_id_global\n    UserMaster--&gt;&gt;AuthM: user_id_global + danh s\u00e1ch tenant\n\n    alt User thu\u1ed9c nhi\u1ec1u tenant\n        AuthM-&gt;&gt;Frontend: Y\u00eau c\u1ea7u ch\u1ecdn tenant\n        Frontend-&gt;&gt;AuthM: tenant_id \u0111\u00e3 ch\u1ecdn\n    else Ch\u1ec9 m\u1ed9t tenant\n        AuthM: B\u1ecf qua b\u01b0\u1edbc ch\u1ecdn\n    end\n\n    AuthM-&gt;&gt;UserSub: L\u1ea5y roles &amp; permissions trong tenant \u0111\u00e3 ch\u1ecdn\n    UserSub--&gt;&gt;AuthM: Tr\u1ea3 danh s\u00e1ch role/permission\n    AuthM-&gt;&gt;JWT: K\u00fd &amp; ph\u00e1t JWT ch\u1ee9a:\\nuser_id, tenant_id, roles, permissions\n    AuthM--&gt;&gt;Frontend: Tr\u1ea3 JWT\n    end\n\n    rect rgba(220,220,220,0.1)\n    Note over User, AuthT: \u0110\u0103ng nh\u1eadp Local/OTP\n    User-&gt;&gt;Frontend: M\u1edf \u1ee9ng d\u1ee5ng (tr\u01b0\u1eddng kh\u00f4ng d\u00f9ng Google)\n    Frontend-&gt;&gt;AuthT: Login OTP\n    AuthT-&gt;&gt;UserMaster: Ki\u1ec3m tra user / \u0111\u0103ng k\u00fd m\u1edbi\n    UserMaster--&gt;&gt;AuthT: user_id_global\n    AuthT-&gt;&gt;UserSub: L\u1ea5y roles &amp; permissions trong tenant\n    UserSub--&gt;&gt;AuthT: Tr\u1ea3 roles, permissions\n    AuthT-&gt;&gt;JWT: Ph\u00e1t JWT \u0111\u1ea7y \u0111\u1ee7\n    AuthT--&gt;&gt;Frontend: Tr\u1ea3 JWT\n    end\n</code></pre> <p>\ud83d\udccc \u0110i\u1ec3m ch\u00ednh:</p> <ul> <li>Auth Master x\u1eed l\u00fd Google OAuth2 + l\u1ef1a ch\u1ecdn tenant.</li> <li>Sub Auth x\u1eed l\u00fd x\u00e1c th\u1ef1c Local/OTP t\u1ea1i tenant.</li> <li>M\u1ecdi JWT ph\u00e1t ra \u0111\u1ec1u ch\u1ee9a <code>user_id_global</code>, <code>tenant_id</code>, <code>roles</code>, <code>permissions</code>.</li> </ul> <p>\ud83d\udcd8 Tham kh\u1ea3o chi ti\u1ebft c\u1ea5u tr\u00fac JWT trong <code>adr-006-auth-strategy.md</code></p>"},{"location":"architecture/system-diagrams/","title":"S\u01a1 \u0111\u1ed3 Ki\u1ebfn tr\u00fac H\u1ec7 th\u1ed1ng dx-vas","text":"<p>T\u00e0i li\u1ec7u n\u00e0y t\u1eadp h\u1ee3p t\u1ea5t c\u1ea3 c\u00e1c s\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac quan tr\u1ecdng c\u1ee7a h\u1ec7 th\u1ed1ng chuy\u1ec3n \u0111\u1ed5i s\u1ed1 dx-vas, bao g\u1ed3m:</p> <ul> <li>S\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac t\u1ed5ng th\u1ec3</li> <li>Di\u1ec5n gi\u1ea3i c\u00e1c kh\u1ed1i ch\u1ee9c n\u0103ng</li> <li>C\u00e1c s\u01a1 \u0111\u1ed3 con chi ti\u1ebft theo t\u1eebng lu\u1ed3ng nghi\u1ec7p v\u1ee5 (v\u00ed d\u1ee5: Tuy\u1ec3n sinh, Th\u00f4ng b\u00e1o, Ph\u00e2n quy\u1ec1n RBAC...)</li> </ul>"},{"location":"architecture/system-diagrams/#muc-luc","title":"\ud83d\udcda M\u1ee5c l\u1ee5c","text":"<ol> <li>S\u01a1 \u0111\u1ed3 t\u1ed5ng quan h\u1ec7 th\u1ed1ng</li> <li>Admission Flow \u2013 Lu\u1ed3ng Tuy\u1ec3n sinh</li> <li>Notification Flow \u2013 Lu\u1ed3ng G\u1eedi Th\u00f4ng b\u00e1o</li> <li>RBAC Evaluation Flow \u2013 Lu\u1ed3ng \u0110\u00e1nh gi\u00e1 Ph\u00e2n quy\u1ec1n \u0110\u1ed9ng</li> <li>Data Synchronization Flow \u2013 \u0110\u1ed3ng b\u1ed9 h\u1ecdc sinh CRM \u2192 SIS \u2192 LMS</li> <li>Service-to-Service Auth Flow \u2013 Giao ti\u1ebfp gi\u1eefa c\u00e1c d\u1ecbch v\u1ee5 n\u1ed9i b\u1ed9</li> <li>User Account Lifecycle Flow \u2013 V\u00f2ng \u0111\u1eddi t\u00e0i kho\u1ea3n ng\u01b0\u1eddi d\u00f9ng</li> <li>Ch\u00fa gi\u1ea3i s\u01a1 \u0111\u1ed3 (Legend) - H\u01b0\u1edbng d\u1eabn \u0111\u1ecdc</li> <li>Deployment Overview Diagram \u2013 S\u01a1 \u0111\u1ed3 tri\u1ec3n khai t\u1ed5ng quan</li> </ol>"},{"location":"architecture/system-diagrams/#1-so-o-tong-quan-he-thong","title":"1. S\u01a1 \u0111\u1ed3 t\u1ed5ng quan h\u1ec7 th\u1ed1ng","text":"<pre><code>flowchart TD\n  subgraph Client_Apps\n    Webform[Public Webform]\n    Parent[PWA - Customer Portal]\n    Staff[SPA - Admin Webapp]\n  end\n\n  subgraph Core_Services\n    Gateway[API Gateway]\n    Auth[Auth Service]\n    User[User Service]\n    Noti[Notification Service]\n  end\n\n  subgraph Business_Adapters\n    CRM[CRM Adapter]\n    SIS[SIS Adapter]\n    LMS[LMS Adapter]\n  end\n\n  subgraph External_Services\n    GSuite[Google OAuth2]\n    Zalo[Zalo OA API]\n    Gmail[Gmail API]\n    Chat[Google Chat API]\n  end\n\n  Webform --&gt;|lead| CRM\n  Parent --&gt; Gateway\n  Staff --&gt; Gateway\n\n  Gateway --&gt;|OAuth2 / OTP| Auth\n  Gateway --&gt;|RBAC check| User\n  Gateway --&gt;|Notify| Noti\n  Gateway --&gt; CRM\n  Gateway --&gt; SIS\n  Gateway --&gt; LMS\n\n  Noti --&gt; Zalo\n  Noti --&gt; Gmail\n  Noti --&gt; Chat\n  Auth --&gt; GSuite\n\n</code></pre> <p>Di\u1ec5n gi\u1ea3i s\u01a1 \u0111\u1ed3 t\u1ed5ng quan</p> <ol> <li>\ud83d\udda5\ufe0f Client Applications (Giao di\u1ec7n ng\u01b0\u1eddi d\u00f9ng)</li> <li>Public Webform: C\u1ed5ng thu lead tuy\u1ec3n sinh.</li> <li>Customer Portal (PWA): Giao di\u1ec7n d\u00e0nh cho ph\u1ee5 huynh &amp; h\u1ecdc sinh \u2013 OTP login, xem \u0111i\u1ec3m, l\u1ecbch h\u1ecdc, th\u00f4ng b\u00e1o...</li> <li>Admin Webapp (SPA): Giao di\u1ec7n d\u00e0nh cho nh\u00e2n vi\u00ean, gi\u00e1o vi\u00ean \u2013 qu\u1ea3n l\u00fd h\u1ecdc sinh, l\u1edbp, RBAC, th\u00f4ng b\u00e1o... <p>Hai \u1ee9ng d\u1ee5ng n\u00e0y (Admin Webapp, Customer Portal) thay th\u1ebf ho\u00e0n to\u00e0n vi\u1ec7c truy c\u1eadp tr\u1ef1c ti\u1ebfp v\u00e0o UI c\u1ee7a SuiteCRM, Gibbon, Moodle.</p> </li> <li>\ud83e\udde0 Core Services</li> <li>API Gateway: \u0110i\u1ec3m ki\u1ec3m so\u00e1t ch\u00ednh, th\u1ef1c hi\u1ec7n x\u00e1c th\u1ef1c, RBAC v\u00e0 \u0111\u1ecbnh tuy\u1ebfn request.</li> <li>Auth Service: X\u00e1c th\u1ef1c Google OAuth2 v\u00e0 OTP.</li> <li>User Service: Qu\u1ea3n l\u00fd th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng, ph\u00e2n quy\u1ec1n.</li> <li>Notification Service: G\u1eedi th\u00f4ng b\u00e1o \u0111a k\u00eanh.</li> <li>\ud83d\udd0c Business Adapters</li> <li>C\u00e1c l\u1edbp t\u00edch h\u1ee3p v\u1edbi h\u1ec7 th\u1ed1ng CRM, SIS, LMS qua API.</li> <li>\ud83c\udf10 External Services</li> <li>C\u00e1c d\u1ecbch v\u1ee5 ngo\u00e0i nh\u01b0 Google OAuth2, Gmail API, Zalo OA, Google Chat API.</li> </ol>"},{"location":"architecture/system-diagrams/#2-admission-flow-luong-tuyen-sinh","title":"2. Admission Flow \u2013 Lu\u1ed3ng Tuy\u1ec3n sinh","text":"<pre><code>flowchart TD\n  A[Public Webform] --&gt; B[CRM Adapter]\n  B --&gt; C[SuiteCRM]\n\n  C --&gt;|Pipeline chuy\u1ec3n \u0111\u1ed5i Lead \u2192 H\u1ecdc sinh| D[SIS Adapter]\n  D --&gt; E[Gibbon SIS]\n\n  E --&gt;|T\u1ea1o user h\u1ecdc sinh + l\u1edbp h\u1ecdc| F[LMS Adapter]\n  F --&gt; G[Moodle LMS]\n\n  subgraph Frontend\n    A\n  end\n\n  subgraph Business Systems\n    C\n    E\n    G\n  end\n\n  subgraph Adapters\n    B\n    D\n    F\n  end\n\n</code></pre> <p>Di\u1ec5n gi\u1ea3i Admission Flow:</p> <ol> <li>Ph\u1ee5 huynh \u0111i\u1ec1n th\u00f4ng tin t\u1ea1i Public Webform \u2192 CRM Adapter ti\u1ebfp nh\u1eadn d\u1eef li\u1ec7u.</li> <li>CRM Adapter chuy\u1ec3n ti\u1ebfp qua API Gateway \u0111\u1ec3 t\u1ea1o b\u1ea3n ghi lead trong SuiteCRM, n\u01a1i qu\u1ea3n l\u00fd pipeline tuy\u1ec3n sinh (v\u00ed d\u1ee5: li\u00ean h\u1ec7, th\u1eed l\u1edbp, \u0111\u00f3ng ph\u00ed...).</li> <li>Khi lead \u0111\u1ee7 \u0111i\u1ec1u ki\u1ec7n nh\u1eadp h\u1ecdc:</li> <li>CRM g\u1eedi th\u00f4ng tin sang SIS Adapter \u0111\u1ec3 t\u1ea1o h\u1ecdc sinh trong Gibbon SIS.</li> <li>SIS x\u1eed l\u00fd:</li> <li>T\u1ea1o h\u1ed3 s\u01a1 h\u1ecdc sinh, g\u00e1n l\u1edbp, m\u00e3 s\u1ed1 \u0111\u1ecbnh danh n\u1ed9i b\u1ed9.</li> <li>\u0110\u1ea9y th\u00f4ng tin sang LMS Adapter \u0111\u1ec3 kh\u1edfi t\u1ea1o t\u00e0i kho\u1ea3n Moodle.</li> <li>H\u1ecdc sinh \u0111\u01b0\u1ee3c kh\u1edfi t\u1ea1o trong Moodle LMS v\u1edbi li\u00ean k\u1ebft SIS-ID, \u0111\u01b0\u1ee3c ph\u00e2n l\u1edbp v\u00e0 k\u00edch ho\u1ea1t l\u1ed9 tr\u00ecnh h\u1ecdc tr\u1ef1c tuy\u1ebfn.</li> </ol> <p>\ud83d\udccc To\u00e0n b\u1ed9 qu\u00e1 tr\u00ecnh n\u00e0y \u0111i qua API Gateway v\u00e0 c\u00e1c adapter, kh\u00f4ng t\u01b0\u01a1ng t\u00e1c tr\u1ef1c ti\u1ebfp v\u1edbi c\u01a1 s\u1edf d\u1eef li\u1ec7u n\u1ed9i b\u1ed9 c\u1ee7a SuiteCRM, Gibbon, Moodle.</p>"},{"location":"architecture/system-diagrams/#3-notification-flow-luong-gui-thong-bao","title":"3. Notification Flow \u2013 Lu\u1ed3ng G\u1eedi Th\u00f4ng b\u00e1o","text":"<pre><code>sequenceDiagram\n  participant Service as H\u1ec7 th\u1ed1ng ph\u00e1t sinh s\u1ef1 ki\u1ec7n (CRM/SIS/LMS)\n  participant Gateway as API Gateway\n  participant Noti as Notification Service\n  participant Zalo as Zalo OA\n  participant Gmail as Gmail API\n  participant Chat as Google Chat\n\n  Service-&gt;&gt;Gateway: G\u1eedi y\u00eau c\u1ea7u g\u1eedi th\u00f4ng b\u00e1o (POST /notifications)\n  Gateway-&gt;&gt;Noti: Forward request + X-User-ID + RBAC check\n\n  Noti-&gt;&gt;Noti: Ki\u1ec3m tra ph\u00e2n quy\u1ec1n + Tra c\u1ea5u h\u00ecnh k\u00eanh \u01b0a th\u00edch\n  alt G\u1eedi qua Zalo OA\n    Noti-&gt;&gt;Zalo: ZNS API\n  end\n  alt G\u1eedi qua Gmail\n    Noti-&gt;&gt;Gmail: Gmail API\n  end\n  alt G\u1eedi qua Google Chat\n    Noti-&gt;&gt;Chat: Chat webhook\n  end\n\n</code></pre> <p>Di\u1ec5n gi\u1ea3i Notification Flow:</p> <ol> <li>M\u1ed9t service nghi\u1ec7p v\u1ee5 (CRM, SIS, LMS...) ph\u00e1t sinh s\u1ef1 ki\u1ec7n \u2013 v\u00ed d\u1ee5:</li> <li>CRM: ph\u1ee5 huynh \u0111\u0103ng k\u00fd th\u00e0nh c\u00f4ng</li> <li>SIS: h\u1ecdc sinh \u0111i\u1ec3m danh tr\u1ec5</li> <li>LMS: b\u00e0i t\u1eadp \u0111\u1ebfn h\u1ea1n</li> <li>Service g\u1ecdi <code>POST /notifications</code> qua API Gateway, \u0111\u00ednh k\u00e8m JWT ho\u1eb7c service token.</li> <li>API Gateway th\u1ef1c hi\u1ec7n ki\u1ec3m tra ph\u00e2n quy\u1ec1n (n\u1ebfu l\u00e0 ng\u01b0\u1eddi d\u00f9ng cu\u1ed1i), r\u1ed3i forward t\u1edbi Notification Service.</li> <li>Notification Service ki\u1ec3m tra:</li> <li>User c\u00f3 quy\u1ec1n nh\u1eadn lo\u1ea1i th\u00f4ng b\u00e1o n\u00e0y kh\u00f4ng?</li> <li>K\u00eanh \u01b0a th\u00edch l\u00e0 g\u00ec? (Zalo / Gmail / Google Chat / WebPush...)</li> <li>Th\u00f4ng b\u00e1o \u0111\u01b0\u1ee3c g\u1eedi \u0111i qua c\u00e1c API t\u01b0\u01a1ng \u1ee9ng, v\u1edbi retry v\u00e0 x\u1eed l\u00fd l\u1ed7i n\u1ebfu c\u1ea7n.</li> </ol> <p>\ud83d\udccc Notification Service h\u1ed7 tr\u1ee3 g\u1eedi \u0111\u1ed3ng th\u1eddi nhi\u1ec1u k\u00eanh v\u00e0 c\u00f3 th\u1ec3 log l\u1ea1i t\u1eebng tr\u1ea1ng th\u00e1i g\u1eedi, cho ph\u00e9p tracking v\u00e0 alert n\u1ebfu g\u1eedi th\u1ea5t b\u1ea1i.</p>"},{"location":"architecture/system-diagrams/#4-rbac-evaluation-flow-luong-anh-gia-phan-quyen-ong","title":"4. RBAC Evaluation Flow \u2013 Lu\u1ed3ng \u0110\u00e1nh gi\u00e1 Ph\u00e2n quy\u1ec1n \u0110\u1ed9ng","text":"<pre><code>sequenceDiagram\n  participant Client as Client App (PWA/SPA)\n  participant Gateway as API Gateway\n  participant Redis as Redis Cache\n  participant UserSvc as User Service\n  participant Backend as Backend Service\n\n  Client-&gt;&gt;Gateway: G\u1eedi request + JWT\n  Gateway-&gt;&gt;Gateway: Gi\u1ea3i m\u00e3 + x\u00e1c th\u1ef1c JWT\n  Gateway-&gt;&gt;UserSvc: Ki\u1ec3m tra is_active (optional)\n  Gateway-&gt;&gt;Redis: Tra RBAC:{user_id} cache\n  alt Cache hit\n    Gateway-&gt;&gt;Gateway: L\u1ea5y danh s\u00e1ch permission + condition\n  else Cache miss\n    Gateway-&gt;&gt;UserSvc: GET /users/{id}/permissions\n    UserSvc--&gt;&gt;Gateway: Tr\u1ea3 v\u1ec1 danh s\u00e1ch role, permission, condition\n    Gateway-&gt;&gt;Redis: Ghi l\u1ea1i cache\n  end\n\n  Gateway-&gt;&gt;Gateway: Evaluate permission + condition theo context\n  alt Pass\n    Gateway-&gt;&gt;Backend: Forward request + X-Permissions + X-User-ID\n  else Fail\n    Gateway--&gt;&gt;Client: 403 Forbidden\n  end\n</code></pre> <p>Di\u1ec5n gi\u1ea3i RBAC Evaluation Flow:</p> <ol> <li>Client App (PWA/SPA) g\u1eedi request REST \u0111\u1ebfn API Gateway, k\u00e8m theo JWT (Bearer token).</li> <li>API Gateway:</li> <li>Gi\u1ea3i m\u00e3 v\u00e0 x\u00e1c th\u1ef1c token (ki\u1ec3m tra ch\u1eef k\u00fd, th\u1eddi h\u1ea1n).</li> <li>Ki\u1ec3m tra tr\u1ea1ng th\u00e1i <code>is_active</code> c\u1ee7a user t\u1eeb User Service (n\u1ebfu c\u1ea7n).</li> <li>Tra Redis: key <code>RBAC:{user_id}</code> \u0111\u1ec3 l\u1ea5y danh s\u00e1ch permissions.</li> <li>N\u1ebfu Redis cache hit:</li> <li>Gateway l\u1ea5y danh s\u00e1ch <code>permission</code> k\u00e8m <code>condition</code> JSONB.</li> <li>N\u1ebfu cache miss:</li> <li>Gateway g\u1ecdi <code>GET /users/{id}/permissions</code> t\u1eeb User Service.</li> <li>Ghi d\u1eef li\u1ec7u RBAC m\u1edbi v\u00e0o Redis v\u1edbi TTL.</li> <li>Evaluate:</li> <li>Gateway so s\u00e1nh t\u1eebng permission + condition v\u1edbi context t\u1eeb request.</li> <li>N\u1ebfu c\u00f3 \u00edt nh\u1ea5t m\u1ed9t permission th\u1ecfa: cho ph\u00e9p request.</li> <li>K\u1ebft qu\u1ea3:</li> <li>N\u1ebfu pass: forward \u0111\u1ebfn Backend Service, k\u00e8m c\u00e1c header:<ul> <li><code>X-Permissions</code>: danh s\u00e1ch m\u00e3 quy\u1ec1n (\u0111\u00e3 pass)</li> <li><code>X-User-ID</code>, <code>X-Role</code>, <code>Trace-ID</code>...</li> </ul> </li> <li>N\u1ebfu fail: tr\u1ea3 v\u1ec1 <code>403 Forbidden</code>.</li> </ol> <p>\ud83d\udccc RBAC \u0111\u01b0\u1ee3c \u0111\u00e1nh gi\u00e1 ho\u00e0n to\u00e0n t\u1ea1i Gateway, backend kh\u00f4ng c\u1ea7n decode JWT hay t\u00e1i ki\u1ec3m tra quy\u1ec1n.</p> <p>\ud83d\udcce Tham kh\u1ea3o chi ti\u1ebft logic ph\u00e2n quy\u1ec1n \u0111\u1ed9ng t\u1ea1i: RBAC Deep Dive</p>"},{"location":"architecture/system-diagrams/#5-data-synchronization-flow-ong-bo-hoc-sinh-crm-sis-lms","title":"5. Data Synchronization Flow \u2013 \u0110\u1ed3ng b\u1ed9 h\u1ecdc sinh CRM \u2192 SIS \u2192 LMS","text":"<pre><code>sequenceDiagram\n  participant CRM as SuiteCRM\n  participant CRMA as CRM Adapter\n  participant Gateway as API Gateway\n  participant SISA as SIS Adapter\n  participant SIS as Gibbon SIS\n  participant LMSA as LMS Adapter\n  participant LMS as Moodle LMS\n\n  CRM-&gt;&gt;CRMA: G\u1eedi s\u1ef1 ki\u1ec7n Lead chuy\u1ec3n th\u00e0nh H\u1ecdc sinh\n  CRMA-&gt;&gt;Gateway: POST /admissions\n  Gateway-&gt;&gt;SISA: Forward request\n\n  SISA-&gt;&gt;SIS: T\u1ea1o h\u1ed3 s\u01a1 h\u1ecdc sinh + g\u00e1n l\u1edbp\n  SIS--&gt;&gt;SISA: Tr\u1ea3 v\u1ec1 m\u00e3 h\u1ecdc sinh (student_id)\n  SISA-&gt;&gt;Gateway: POST /students/{id}/sync-to-lms\n  Gateway-&gt;&gt;LMSA: Forward request\n  LMSA-&gt;&gt;LMS: T\u1ea1o user Moodle + ph\u00e2n l\u1edbp\n\n  LMS--&gt;&gt;LMSA: OK\n  LMSA--&gt;&gt;Gateway: OK\n</code></pre> <p>Di\u1ec5n gi\u1ea3i Data Synchronization Flow (CRM \u2192 SIS \u2192 LMS):</p> <ol> <li>Trong SuiteCRM, khi m\u1ed9t <code>Lead</code> \u0111\u01b0\u1ee3c \u0111\u00e1nh d\u1ea5u l\u00e0 \u201c\u0111\u00e3 tr\u00fang tuy\u1ec3n\u201d, CRM s\u1ebd ph\u00e1t sinh s\u1ef1 ki\u1ec7n chuy\u1ec3n \u0111\u1ed5i.</li> <li>CRM Adapter ti\u1ebfp nh\u1eadn s\u1ef1 ki\u1ec7n v\u00e0 g\u1eedi <code>POST /admissions</code> qua API Gateway.</li> <li>API Gateway forward \u0111\u1ebfn SIS Adapter, n\u01a1i th\u1ef1c hi\u1ec7n:</li> <li>T\u1ea1o h\u1ecdc sinh m\u1edbi trong Gibbon SIS</li> <li>G\u00e1n v\u00e0o l\u1edbp, campus t\u01b0\u01a1ng \u1ee9ng</li> <li>SIS tr\u1ea3 v\u1ec1 <code>student_id</code>, \u0111\u01b0\u1ee3c l\u01b0u t\u1ea1i Adapter.</li> <li>SIS Adapter g\u1ecdi ti\u1ebfp <code>POST /students/{id}/sync-to-lms</code> qua Gateway \u2192 forward \u0111\u1ebfn LMS Adapter.</li> <li>LMS Adapter t\u1ea1o t\u00e0i kho\u1ea3n Moodle cho h\u1ecdc sinh v\u00e0 ph\u00e2n l\u1edbp t\u01b0\u01a1ng \u1ee9ng.</li> <li>Sau khi t\u1ea1o th\u00e0nh c\u00f4ng, ph\u1ea3n h\u1ed3i x\u00e1c nh\u1eadn \u0111\u01b0\u1ee3c g\u1eedi ng\u01b0\u1ee3c v\u1ec1.</li> </ol> <p>\ud83d\udccc M\u1ecdi h\u00e0nh \u0111\u1ed9ng \u0111\u1ec1u \u0111i qua API Gateway v\u00e0 \u0111\u01b0\u1ee3c ki\u1ec3m so\u00e1t ph\u00e2n quy\u1ec1n n\u1ebfu c\u00f3 li\u00ean quan \u0111\u1ebfn user. Qu\u00e1 tr\u00ecnh sync c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c l\u1eb7p l\u1ea1i \u0111\u1ecbnh k\u1ef3 ho\u1eb7c ph\u00e1t \u0111\u1ed9ng theo event.</p>"},{"location":"architecture/system-diagrams/#6-service-to-service-auth-flow-giao-tiep-giua-cac-dich-vu-noi-bo","title":"6. Service-to-Service Auth Flow \u2013 Giao ti\u1ebfp gi\u1eefa c\u00e1c d\u1ecbch v\u1ee5 n\u1ed9i b\u1ed9","text":"<pre><code>sequenceDiagram\n  participant ServiceA as Notification Service\n  participant Gateway as API Gateway\n  participant UserSvc as User Service\n\n  ServiceA-&gt;&gt;Gateway: POST /users/{id}/status + Internal Auth Header\n  Gateway-&gt;&gt;Gateway: X\u00e1c th\u1ef1c token n\u1ed9i b\u1ed9 / mTLS\n  Gateway-&gt;&gt;UserSvc: Forward request + X-Service-Name + X-Signature\n  UserSvc-&gt;&gt;UserSvc: Ki\u1ec3m tra \u0111\u1ecbnh danh service g\u1ecdi\n  UserSvc--&gt;&gt;Gateway: Response\n  Gateway--&gt;&gt;ServiceA: Response\n</code></pre> <p>Di\u1ec5n gi\u1ea3i Service-to-Service Auth Flow:</p> <ol> <li>Service A (v\u00ed d\u1ee5: Notification Service) c\u1ea7n l\u1ea5y th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng, n\u00ean g\u1ecdi <code>POST /users/{id}/status</code> qua API Gateway.</li> <li>Gateway x\u00e1c th\u1ef1c danh t\u00ednh Service A:</li> <li>Th\u00f4ng qua token n\u1ed9i b\u1ed9 (Bearer token d\u00e0nh cho service)</li> <li>Ho\u1eb7c qua c\u01a1 ch\u1ebf mTLS (Mutual TLS)</li> <li>Sau khi x\u00e1c th\u1ef1c, Gateway forward request \u0111\u1ebfn User Service, k\u00e8m theo:</li> <li><code>X-Service-Name</code>: T\u00ean service g\u1ecdi (v\u00ed d\u1ee5: <code>notification-service</code>)</li> <li><code>X-Signature</code>: Ch\u1eef k\u00fd HMAC ho\u1eb7c JWT b\u1ea3o v\u1ec7 integrity</li> <li>User Service ki\u1ec3m tra xem:</li> <li>Request c\u00f3 \u0111\u1ebfn t\u1eeb m\u1ed9t service tin c\u1eady kh\u00f4ng?</li> <li>Header c\u00f3 h\u1ee3p l\u1ec7 v\u00e0 kh\u1edbp c\u1ea5u h\u00ecnh g\u1ecdi n\u1ed9i b\u1ed9 kh\u00f4ng?</li> <li>N\u1ebfu h\u1ee3p l\u1ec7: ti\u1ebfp t\u1ee5c x\u1eed l\u00fd v\u00e0 tr\u1ea3 k\u1ebft qu\u1ea3 v\u1ec1.</li> <li>N\u1ebfu sai \u0111\u1ecbnh danh/m\u1ea5t ch\u1eef k\u00fd: tr\u1ea3 l\u1ed7i <code>403</code> ho\u1eb7c <code>401</code>.</li> </ol> <p>\ud83d\udccc D\u00f9 l\u00e0 service n\u1ed9i b\u1ed9, t\u1ea5t c\u1ea3 l\u1eddi g\u1ecdi \u0111\u1ec1u ph\u1ea3i qua API Gateway \u0111\u1ec3 ki\u1ec3m so\u00e1t, trace v\u00e0 log \u0111\u1ea7y \u0111\u1ee7. Kh\u00f4ng cho ph\u00e9p service g\u1ecdi nhau tr\u1ef1c ti\u1ebfp \u0111\u1ec3 tr\u00e1nh r\u00f2 r\u1ec9 ph\u00e2n quy\u1ec1n ho\u1eb7c bypass gi\u00e1m s\u00e1t.</p>"},{"location":"architecture/system-diagrams/#7-user-account-lifecycle-flow-vong-oi-tai-khoan-nguoi-dung","title":"7. User Account Lifecycle Flow \u2013 V\u00f2ng \u0111\u1eddi t\u00e0i kho\u1ea3n ng\u01b0\u1eddi d\u00f9ng","text":"<pre><code>flowchart LR\n  Create[User \u0111\u01b0\u1ee3c t\u1ea1o\\nPOST /users]\n  Pending[X\u00e1c minh OTP ho\u1eb7c nh\u1eadn OAuth2]\n  Active[is_active = true\\nUser c\u00f3 th\u1ec3 \u0111\u0103ng nh\u1eadp]\n  Inactive[is_active = false\\nT\u00e0i kho\u1ea3n b\u1ecb v\u00f4 hi\u1ec7u h\u00f3a]\n  Deleted[T\u00e0i kho\u1ea3n b\u1ecb x\u00f3a - is_deleted = true]\n\n  Create --&gt; Pending\n  Pending --&gt; Active\n  Active --&gt; Inactive\n  Inactive --&gt; Active\n  Active --&gt; Deleted\n  Inactive --&gt; Deleted\n\n  subgraph Events &amp; Side Effects\n    RBAC[Emit: rbac_updated]\n    STATUS[Emit: user_status_changed]\n    Cache[Invalidate RBAC cache]\n  end\n\n  Active --&gt; RBAC\n  Inactive --&gt; STATUS\n  Deleted --&gt; STATUS\n  RBAC --&gt; Cache\n  STATUS --&gt; Cache\n</code></pre> <p>Di\u1ec5n gi\u1ea3i User Account Lifecycle Flow:</p> <ol> <li>T\u00e0i kho\u1ea3n ng\u01b0\u1eddi d\u00f9ng \u0111\u01b0\u1ee3c t\u1ea1o:</li> <li>Qua <code>POST /users</code> (do nh\u00e2n vi\u00ean t\u1ea1o), ho\u1eb7c</li> <li>T\u1ef1 \u0111\u1ed9ng t\u1ea1o t\u1eeb h\u1ec7 th\u1ed1ng CRM/SIS/LMS</li> <li>Tr\u1ea1ng th\u00e1i ban \u0111\u1ea7u: Pending</li> <li>N\u1ebfu l\u00e0 ph\u1ee5 huynh: ch\u1edd x\u00e1c minh OTP</li> <li>N\u1ebfu l\u00e0 GV/NV/HS: ch\u1edd x\u00e1c th\u1ef1c qua Google OAuth2</li> <li>Khi x\u00e1c minh th\u00e0nh c\u00f4ng:</li> <li>Tr\u1ea1ng th\u00e1i chuy\u1ec3n sang <code>is_active = true</code></li> <li>Ng\u01b0\u1eddi d\u00f9ng c\u00f3 th\u1ec3 \u0111\u0103ng nh\u1eadp, JWT \u0111\u01b0\u1ee3c c\u1ea5p</li> <li>Trong qu\u00e1 tr\u00ecnh v\u1eadn h\u00e0nh:</li> <li>T\u00e0i kho\u1ea3n c\u00f3 th\u1ec3 b\u1ecb kh\u00f3a t\u1ea1m th\u1eddi \u2192 <code>is_active = false</code></li> <li>Khi \u0111\u00f3, m\u1ecdi request b\u1ecb ch\u1eb7n t\u1ea1i Gateway</li> <li>Khi t\u00e0i kho\u1ea3n b\u1ecb x\u00f3a (logic delete):</li> <li>Tr\u1ea1ng th\u00e1i <code>is_deleted = true</code> (n\u1ebfu h\u1ed7 tr\u1ee3)</li> <li>Kh\u00f4ng th\u1ec3 kh\u00f4i ph\u1ee5c n\u1ebfu \u0111\u00e3 x\u00f3a v\u0129nh vi\u1ec5n</li> </ol> <p>S\u1ef1 ki\u1ec7n li\u00ean quan:</p> <ul> <li>Khi tr\u1ea1ng th\u00e1i user thay \u0111\u1ed5i:</li> <li>G\u1eedi s\u1ef1 ki\u1ec7n <code>user_status_changed</code></li> <li>API Gateway ho\u1eb7c c\u00e1c service c\u00f3 th\u1ec3 x\u1eed l\u00fd \u0111\u1ec3 invalidate cache, log b\u1ea3o m\u1eadt...</li> <li>Khi vai tr\u00f2 ho\u1eb7c ph\u00e2n quy\u1ec1n thay \u0111\u1ed5i:</li> <li>G\u1eedi s\u1ef1 ki\u1ec7n <code>rbac_updated</code> \u2192 c\u1eadp nh\u1eadt cache RBAC c\u1ee7a ng\u01b0\u1eddi d\u00f9ng</li> </ul> <p>\ud83d\udccc Vi\u1ec7c ki\u1ec3m so\u00e1t v\u00f2ng \u0111\u1eddi user gi\u00fap h\u1ec7 th\u1ed1ng \u0111\u1ea3m b\u1ea3o b\u1ea3o m\u1eadt, tu\u00e2n th\u1ee7 v\u00e0 gi\u00e1m s\u00e1t ch\u1eb7t ch\u1ebd tr\u1ea1ng th\u00e1i t\u00e0i kho\u1ea3n.</p>"},{"location":"architecture/system-diagrams/#8-chu-giai-so-o-legend-huong-dan-oc","title":"8. Ch\u00fa gi\u1ea3i s\u01a1 \u0111\u1ed3 (Legend) - H\u01b0\u1edbng d\u1eabn \u0111\u1ecdc","text":""},{"location":"architecture/system-diagrams/#ky-hieu-cac-thanh-phan-dung-trong-flowchart-sequencediagram","title":"\ud83e\udde9 K\u00fd hi\u1ec7u c\u00e1c th\u00e0nh ph\u1ea7n (d\u00f9ng trong flowchart &amp; sequenceDiagram):","text":"K\u00fd hi\u1ec7u / Label \u00dd ngh\u0129a H\u00ecnh ch\u1eef nh\u1eadt D\u1ecbch v\u1ee5 l\u00f5i trong h\u1ec7 th\u1ed1ng (Core Service, Adapter) H\u00ecnh ch\u1eef nh\u1eadt bo g\u00f3c Giao di\u1ec7n ng\u01b0\u1eddi d\u00f9ng (SPA, PWA, Webform) ho\u1eb7c h\u1ec7 th\u1ed1ng b\u00ean ngo\u00e0i M\u0169i t\u00ean \u2192 G\u1ecdi API ho\u1eb7c h\u00e0nh \u0111\u1ed9ng ch\u00ednh theo th\u1ee9 t\u1ef1 th\u1eddi gian M\u0169i t\u00ean --&gt;&gt; Tr\u1ea3 k\u1ebft qu\u1ea3 ho\u1eb7c ph\u1ea3n h\u1ed3i Alt (sequence) Nh\u00e1nh \u0111i\u1ec1u ki\u1ec7n (v\u00ed d\u1ee5: cache hit/miss, quy\u1ec1n pass/fail) Subgraph Ph\u00e2n nh\u00f3m logic (Frontend, Adapter, External Service...) <p>\ud83d\udcdd C\u00e1c label nh\u01b0 <code>POST /users</code>, <code>X-Permissions</code>, <code>student_id</code>, v.v. d\u00f9ng \u0111\u1ec3 minh h\u1ecda request c\u1ee5 th\u1ec3 trong s\u01a1 \u0111\u1ed3.</p>"},{"location":"architecture/system-diagrams/#cach-oc-so-o","title":"\ud83e\udded C\u00e1ch \u0111\u1ecdc s\u01a1 \u0111\u1ed3","text":"<ol> <li>Flowchart (lu\u1ed3ng tr\u1ea1ng th\u00e1i, nghi\u1ec7p v\u1ee5):  </li> <li>\u0110\u1ecdc t\u1eeb tr\u00e1i qua ph\u1ea3i ho\u1eb7c tr\u00ean xu\u1ed1ng.</li> <li>Theo d\u00f5i c\u00e1c node th\u1ec3 hi\u1ec7n tr\u1ea1ng th\u00e1i ho\u1eb7c h\u00e0nh \u0111\u1ed9ng ch\u00ednh.</li> <li> <p>C\u00e1c nh\u00f3m <code>subgraph</code> gi\u00fap hi\u1ec3u m\u1ed1i li\u00ean h\u1ec7 gi\u1eefa th\u00e0nh ph\u1ea7n.</p> </li> <li> <p>Sequence Diagram (chu\u1ed7i t\u01b0\u01a1ng t\u00e1c):  </p> </li> <li>\u0110\u1ecdc theo chi\u1ec1u d\u1ecdc t\u1eeb tr\u00ean xu\u1ed1ng.</li> <li>C\u1ed9t l\u00e0 c\u00e1c th\u00e0nh ph\u1ea7n t\u01b0\u01a1ng t\u00e1c (participants).</li> <li>D\u00f2ng l\u00e0 request/response ho\u1eb7c g\u1ecdi API n\u1ed9i b\u1ed9.</li> <li>Nh\u00e1nh <code>alt</code> d\u00f9ng \u0111\u1ec3 ph\u00e2n nh\u00e1nh x\u1eed l\u00fd.</li> </ol>"},{"location":"architecture/system-diagrams/#luu-y-van-hanh","title":"\ud83d\udd10 L\u01b0u \u00fd v\u1eadn h\u00e0nh","text":"<ul> <li>T\u1ea5t c\u1ea3 c\u00e1c s\u01a1 \u0111\u1ed3 \u0111\u1ec1u ph\u1ea3n \u00e1nh ki\u1ebfn tr\u00fac chu\u1ea9n h\u00f3a c\u00f3 API Gateway l\u00e0m trung t\u00e2m \u0111i\u1ec1u ph\u1ed1i.</li> <li>Kh\u00f4ng c\u00f3 t\u01b0\u01a1ng t\u00e1c tr\u1ef1c ti\u1ebfp gi\u1eefa c\u00e1c service v\u1edbi nhau ho\u1eb7c v\u1edbi h\u1ec7 th\u1ed1ng k\u1ebf th\u1eeba.</li> <li>Ph\u00e2n quy\u1ec1n (RBAC), x\u00e1c th\u1ef1c (OAuth2/OTP/mTLS), cache Redis, event-driven \u0111\u1ec1u \u0111\u01b0\u1ee3c m\u00f4 h\u00ecnh h\u00f3a trong s\u01a1 \u0111\u1ed3.</li> </ul>"},{"location":"architecture/system-diagrams/#duy-tri-cap-nhat","title":"\ud83d\udee0 Duy tr\u00ec &amp; c\u1eadp nh\u1eadt","text":"<ul> <li>S\u01a1 \u0111\u1ed3 \u0111\u01b0\u1ee3c vi\u1ebft b\u1eb1ng m\u00e3 Mermaid tr\u1ef1c ti\u1ebfp trong file Markdown.</li> <li>\u0110\u01b0\u1ee3c version control c\u00f9ng source code, gi\u00fap d\u1ec5 ch\u1ec9nh s\u1eeda khi ki\u1ebfn tr\u00fac thay \u0111\u1ed5i.</li> <li>C\u00f3 th\u1ec3 xu\u1ea5t th\u00e0nh \u1ea3nh (SVG/PNG) n\u1ebfu c\u1ea7n \u0111\u01b0a v\u00e0o slide, wiki, ho\u1eb7c t\u00e0i li\u1ec7u PDF.</li> </ul>"},{"location":"architecture/system-diagrams/#9-deployment-overview-diagram-so-o-trien-khai-tong-quan","title":"9. Deployment Overview Diagram \u2013 S\u01a1 \u0111\u1ed3 tri\u1ec3n khai t\u1ed5ng quan","text":"<pre><code>flowchart TD\n  subgraph User Devices\n    Browser[Browser / Mobile App]\n  end\n\n  subgraph Internet\n    HTTPS[HTTPS Entrypoint]\n  end\n\n  subgraph Google Cloud\n    %% Core Services\n    subgraph Core_Services[Core Services - Cloud Run]\n      Gateway[API Gateway]\n      Auth[Auth Service]\n      User[User Service]\n      Noti[Notification Service]\n    end\n\n    %% Adapters\n    subgraph Adapters[Adapters - Cloud Run]\n      CRM[CRM Adapter]\n      SIS[SIS Adapter]\n      LMS[LMS Adapter]\n    end\n\n    %% Infrastructure\n    subgraph Infrastructure[Data Infrastructure]\n      Redis[Redis Cache - MemoryStore]\n      PG[PostgreSQL - Cloud SQL - Core]\n      MySQL[MySQL - Cloud SQL - Adapters]\n      PubSub[Pub/Sub - Event Bus]\n      Storage[GCS - Static Files]\n    end\n  end\n\n  %% External access\n  Browser --&gt; HTTPS --&gt; Gateway\n\n  %% Routing to services\n  Gateway --&gt; Auth\n  Gateway --&gt; User\n  Gateway --&gt; Noti\n  Gateway --&gt; CRM\n  Gateway --&gt; SIS\n  Gateway --&gt; LMS\n\n  %% DB connections\n  Auth --&gt; PG\n  User --&gt; PG\n  Noti --&gt; PG\n  CRM --&gt; MySQL\n  SIS --&gt; MySQL\n  LMS --&gt; MySQL\n\n  %% Event &amp; Cache\n  Gateway --&gt; Redis\n  User --&gt; Redis\n  Gateway --&gt; PubSub\n  Noti --&gt; PubSub\n  SIS --&gt; PubSub\n  LMS --&gt; PubSub\n\n  Gateway --&gt; Storage\n\n</code></pre> <p>Di\u1ec5n gi\u1ea3i s\u01a1 \u0111\u1ed3 tri\u1ec3n khai t\u1ed5ng quan:</p> <ol> <li>Client (Browser/Mobile App) giao ti\u1ebfp qua HTTPS \u2192 truy c\u1eadp v\u00e0o \u0111i\u1ec3m v\u00e0o duy nh\u1ea5t: <code>API Gateway</code>.</li> <li>API Gateway, c\u00f9ng t\u1ea5t c\u1ea3 c\u00e1c service (Auth, User, Notification, CRM/SIS/LMS Adapter), \u0111\u1ec1u \u0111\u01b0\u1ee3c tri\u1ec3n khai d\u01b0\u1edbi d\u1ea1ng container serverless tr\u00ean Google Cloud Run.</li> <li>C\u00e1c Core Services (Auth, User, Notification) s\u1eed d\u1ee5ng PostgreSQL qua Cloud SQL \u0111\u1ec3 t\u1eadn d\u1ee5ng kh\u1ea3 n\u0103ng x\u1eed l\u00fd JSONB, concurrency cao v\u00e0 c\u00e1c t\u00ednh n\u0103ng SQL n\u00e2ng cao.</li> <li>C\u00e1c Adapter (CRM, SIS, LMS) s\u1eed d\u1ee5ng MySQL, t\u01b0\u01a1ng th\u00edch v\u1edbi h\u1ec7 qu\u1ea3n tr\u1ecb m\u1eb7c \u0111\u1ecbnh c\u1ee7a c\u00e1c h\u1ec7 th\u1ed1ng t\u00edch h\u1ee3p (SuiteCRM, Gibbon, Moodle).</li> <li>D\u1eef li\u1ec7u RBAC v\u00e0 token \u0111\u01b0\u1ee3c cache qua Redis (MemoryStore).</li> <li>Giao ti\u1ebfp b\u1ea5t \u0111\u1ed3ng b\u1ed9 (event-driven) s\u1eed d\u1ee5ng Pub/Sub \u2013 c\u00e1c service ph\u00e1t/s\u1eed d\u1ee5ng s\u1ef1 ki\u1ec7n qua event bus n\u00e0y.</li> <li>Static file (\u1ea3nh, logo, config...) \u0111\u01b0\u1ee3c ph\u1ee5c v\u1ee5 qua Google Cloud Storage (GCS).</li> <li>M\u1ecdi l\u1eddi g\u1ecdi gi\u1eefa c\u00e1c service \u0111\u1ec1u ph\u1ea3i qua Gateway (ho\u1eb7c g\u1ecdi n\u1ed9i b\u1ed9 c\u00f3 ki\u1ec3m so\u00e1t qua Envoy/mTLS) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o x\u00e1c th\u1ef1c, ph\u00e2n quy\u1ec1n v\u00e0 kh\u1ea3 n\u0103ng theo d\u00f5i (traceability).</li> </ol> <p>\ud83d\udccc C\u1ea5u tr\u00fac tri\u1ec3n khai n\u00e0y \u0111\u1ea3m b\u1ea3o: - Kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng linh ho\u1ea1t (Cloud Run autoscale) - T\u1ed1i \u01b0u hi\u1ec7u n\u0103ng v\u00e0 t\u00ednh n\u0103ng theo t\u1eebng nh\u00f3m th\u00e0nh ph\u1ea7n - T\u00e1ch bi\u1ec7t logic r\u00f5 r\u00e0ng (each service = 1 container) - B\u1ea3o m\u1eadt ch\u1eb7t ch\u1ebd v\u00e0 d\u1ec5 d\u00e0ng gi\u00e1m s\u00e1t v\u1eadn h\u00e0nh</p> <p>\ud83d\udcce C\u01a1 ch\u1ebf s\u1eed d\u1ee5ng hai CSDL (PostgreSQL &amp; MySQL) \u0111\u01b0\u1ee3c tr\u00ecnh b\u00e0y r\u00f5 t\u1ea1i: README</p>"},{"location":"dev/API_REFERENCE/","title":"\ud83d\udcd8 API Reference \u2013 API Gateway (DX VAS)","text":"<p>T\u00e0i li\u1ec7u n\u00e0y cung c\u1ea5p c\u00e1i nh\u00ecn t\u1ed5ng quan v\u1ec1 c\u00e1c endpoint ch\u00ednh trong h\u1ec7 th\u1ed1ng API Gateway c\u1ee7a d\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS.</p> <p>\ud83d\udca1 T\u00e0i li\u1ec7u n\u00e0y \u0111\u01b0\u1ee3c t\u1ed5ng h\u1ee3p th\u1ee7 c\u00f4ng t\u1eeb c\u00e1c route ch\u00ednh. V\u1edbi c\u00e1c th\u00f4ng tin chi ti\u1ebft nh\u01b0 schema \u0111\u1ea7u v\u00e0o/\u0111\u1ea7u ra, vui l\u00f2ng tham kh\u1ea3o Swagger UI t\u1ea1i <code>/docs</code> ho\u1eb7c ReDoc t\u1ea1i <code>/redoc</code>.</p>"},{"location":"dev/API_REFERENCE/#chuan-rest-headers-chung","title":"\u2705 Chu\u1ea9n REST &amp; Headers chung","text":"<ul> <li>Prefix version: <code>/api/v1/</code></li> <li> <p>Headers b\u1eaft bu\u1ed9c:</p> </li> <li> <p><code>Authorization: Bearer &lt;access_token&gt;</code></p> </li> <li> <p>Forward \u0111\u1ebfn backend s\u1ebd c\u00f3 th\u00eam:</p> <ul> <li><code>X-User-Id</code></li> <li><code>X-Role</code></li> <li><code>X-Permissions</code></li> <li>Response chu\u1ea9n h\u00f3a:</li> </ul> </li> </ul> <pre><code>{\n  \"data\": {...},\n  \"message\": \"Success\",\n  \"status_code\": 200\n}\n</code></pre> <ul> <li> <p>M\u00e3 l\u1ed7i ph\u1ed5 bi\u1ebfn:</p> </li> <li> <p><code>401 Unauthorized</code> \u2013 Thi\u1ebfu ho\u1eb7c sai token</p> </li> <li><code>403 Forbidden</code> \u2013 Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n truy c\u1eadp</li> <li><code>429 Too Many Requests</code> \u2013 V\u01b0\u1ee3t gi\u1edbi h\u1ea1n</li> <li><code>502 Bad Gateway</code> \u2013 L\u1ed7i t\u1eeb backend</li> </ul>"},{"location":"dev/API_REFERENCE/#auth-oauth2-token","title":"\ud83d\udd10 Auth (OAuth2, Token)","text":""},{"location":"dev/API_REFERENCE/#post-authlogin","title":"<code>POST /auth/login</code>","text":"<ul> <li>M\u00f4 t\u1ea3: \u0110\u0103ng nh\u1eadp b\u1eb1ng Google OAuth2, tr\u1ea3 v\u1ec1 token v\u00e0 th\u00f4ng tin user</li> <li>\u0110\u1ea7u v\u00e0o:</li> </ul> <pre><code>{\n  \"code\": \"google_oauth_code\"\n}\n</code></pre> <ul> <li>\u0110\u1ea7u ra (v\u00ed d\u1ee5):</li> </ul> <pre><code>{\n  \"data\": {\n    \"access_token\": \"jwt\",\n    \"refresh_token\": \"string\",\n    \"token_type\": \"bearer\",\n    \"user_info\": {\n      \"id\": \"string\",\n      \"email\": \"string\",\n      \"name\": \"string\"\n    }\n  },\n  \"message\": \"Login successful\",\n  \"status_code\": 200\n}\n</code></pre>"},{"location":"dev/API_REFERENCE/#post-authrefresh","title":"<code>POST /auth/refresh</code>","text":"<ul> <li>M\u00f4 t\u1ea3: C\u1ea5p l\u1ea1i Access Token t\u1eeb Refresh Token</li> <li>\u0110\u1ea7u v\u00e0o:</li> </ul> <pre><code>{\n  \"refresh_token\": \"string\"\n}\n</code></pre>"},{"location":"dev/API_REFERENCE/#get-authme","title":"<code>GET /auth/me</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng hi\u1ec7n t\u1ea1i d\u1ef1a tr\u00ean token \u0111\u00e3 \u0111\u0103ng nh\u1eadp</li> </ul>"},{"location":"dev/API_REFERENCE/#rbac-role-permission","title":"\ud83d\udc64 RBAC \u2013 Role &amp; Permission","text":""},{"location":"dev/API_REFERENCE/#get-rbacroles","title":"<code>GET /rbac/roles</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch role \u0111ang c\u00f3 trong h\u1ec7 th\u1ed1ng</li> </ul>"},{"location":"dev/API_REFERENCE/#post-rbacroles","title":"<code>POST /rbac/roles</code>","text":"<ul> <li>M\u00f4 t\u1ea3: T\u1ea1o role m\u1edbi</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>MANAGE_RBAC</code></li> </ul>"},{"location":"dev/API_REFERENCE/#get-rbacpermissions","title":"<code>GET /rbac/permissions</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch permission hi\u1ec7n t\u1ea1i (code + m\u00f4 t\u1ea3)</li> </ul>"},{"location":"dev/API_REFERENCE/#post-rbacassign","title":"<code>POST /rbac/assign</code>","text":"<ul> <li>M\u00f4 t\u1ea3: G\u00e1n role cho user</li> <li>\u0110\u1ea7u v\u00e0o:</li> </ul> <pre><code>{\n  \"user_id\": \"string\",\n  \"role_id\": \"string\"\n}\n</code></pre>"},{"location":"dev/API_REFERENCE/#post-rbacroute-map","title":"<code>POST /rbac/route-map</code>","text":"<ul> <li>M\u00f4 t\u1ea3: G\u00e1n permission c\u1ee5 th\u1ec3 cho endpoint (method + path)</li> </ul> <p>\ud83d\udd0e Xem m\u00f4 t\u1ea3 c\u00e1c permission t\u1ea1i <code>DEV_GUIDE.md</code></p>"},{"location":"dev/API_REFERENCE/#sis-proxy-en-opensis","title":"\ud83c\udf93 SIS (Proxy \u0111\u1ebfn OpenSIS)","text":""},{"location":"dev/API_REFERENCE/#get-sisstudents","title":"<code>GET /sis/students</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch h\u1ecdc sinh</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>VIEW_STUDENT</code></li> <li> <p>Query params:</p> </li> <li> <p><code>page</code>, <code>limit</code>, <code>search</code></p> </li> </ul>"},{"location":"dev/API_REFERENCE/#get-sisstudentsid","title":"<code>GET /sis/students/{id}</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Xem chi ti\u1ebft m\u1ed9t h\u1ecdc sinh</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>VIEW_STUDENT</code></li> </ul>"},{"location":"dev/API_REFERENCE/#put-sisstudentsid","title":"<code>PUT /sis/students/{id}</code>","text":"<ul> <li>M\u00f4 t\u1ea3: C\u1eadp nh\u1eadt th\u00f4ng tin h\u1ecdc sinh</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>EDIT_STUDENT</code></li> </ul>"},{"location":"dev/API_REFERENCE/#notify","title":"\ud83d\udcde Notify","text":""},{"location":"dev/API_REFERENCE/#post-notifysend","title":"<code>POST /notify/send</code>","text":"<ul> <li>M\u00f4 t\u1ea3: G\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn user qua Web, Zalo ho\u1eb7c Email</li> <li>\u0110\u1ea7u v\u00e0o v\u00ed d\u1ee5:</li> </ul> <pre><code>{\n  \"user_id\": \"abc123\",\n  \"channel\": \"email\",\n  \"message\": \"B\u1ea1n c\u00f3 th\u00f4ng b\u00e1o m\u1edbi.\"\n}\n</code></pre>"},{"location":"dev/API_REFERENCE/#crm-proxy-en-espocrm-neu-ap-dung","title":"\ud83e\uddd1\u200d\ud83d\udcbc CRM (Proxy \u0111\u1ebfn EspoCRM \u2013 n\u1ebfu \u00e1p d\u1ee5ng)","text":""},{"location":"dev/API_REFERENCE/#get-crmleads","title":"<code>GET /crm/leads</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch ph\u1ee5 huynh ti\u1ec1m n\u0103ng</li> </ul>"},{"location":"dev/API_REFERENCE/#post-crmleads","title":"<code>POST /crm/leads</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Th\u00eam m\u1edbi th\u00f4ng tin \u0111\u0103ng k\u00fd nh\u1eadp h\u1ecdc</li> </ul>"},{"location":"dev/API_REFERENCE/#lms-proxy-en-moodle-neu-a-tich-hop","title":"\ud83e\uddd1\u200d\ud83c\udfeb LMS (Proxy \u0111\u1ebfn Moodle \u2013 n\u1ebfu \u0111\u00e3 t\u00edch h\u1ee3p)","text":""},{"location":"dev/API_REFERENCE/#get-lmscourses","title":"<code>GET /lms/courses</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch kho\u00e1 h\u1ecdc t\u1eeb LMS</li> </ul>"},{"location":"dev/API_REFERENCE/#get-lmsstudentsidgrades","title":"<code>GET /lms/students/{id}/grades</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y \u0111i\u1ec3m h\u1ecdc t\u1eadp c\u1ee7a h\u1ecdc sinh t\u1eeb Moodle</li> </ul>"},{"location":"dev/API_REFERENCE/#tai-nguyen-lien-quan","title":"\ud83d\udd17 T\u00e0i nguy\u00ean li\u00ean quan","text":"<ul> <li>Swagger UI: <code>/docs</code></li> <li>ReDoc UI: <code>/redoc</code></li> <li>Quy \u01b0\u1edbc coding: <code>CONTRIBUTING.md</code></li> <li>Dev Guide: <code>DEV_GUIDE.md</code></li> </ul> <p>T\u00e0i li\u1ec7u n\u00e0y l\u00e0 b\u1ea3n m\u00f4 t\u1ea3 th\u1ee7 c\u00f4ng (version: <code>v1</code>). \u0110\u1ec3 c\u1eadp nh\u1eadt \u0111\u1ea7y \u0111\u1ee7 nh\u1ea5t, h\u00e3y tham kh\u1ea3o Swagger UI.</p>"},{"location":"dev/CONTRIBUTING/","title":"\ud83e\udd1d H\u01b0\u1edbng d\u1eabn \u0110\u00f3ng g\u00f3p \u2013 API Gateway (DX VAS)","text":"<p>C\u1ea3m \u01a1n b\u1ea1n \u0111\u00e3 quan t\u00e2m v\u00e0 mu\u1ed1n \u0111\u00f3ng g\u00f3p v\u00e0o d\u1ef1 \u00e1n API Gateway \u2013 Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS! D\u01b0\u1edbi \u0111\u00e2y l\u00e0 h\u01b0\u1edbng d\u1eabn gi\u00fap b\u1ea1n tham gia hi\u1ec7u qu\u1ea3, \u0111\u1ea3m b\u1ea3o ti\u00eau chu\u1ea9n ch\u1ea5t l\u01b0\u1ee3ng v\u00e0 s\u1ef1 nh\u1ea5t qu\u00e1n trong quy tr\u00ecnh ph\u00e1t tri\u1ec3n.</p>"},{"location":"dev/CONTRIBUTING/#muc-tieu","title":"\ud83d\udccc M\u1ee5c ti\u00eau","text":"<ul> <li>Duy tr\u00ec ch\u1ea5t l\u01b0\u1ee3ng code cao, s\u1ea1ch v\u00e0 c\u00f3 ki\u1ec3m th\u1eed.</li> <li>\u0110\u1ea3m b\u1ea3o m\u1ecdi thay \u0111\u1ed5i \u0111\u1ec1u \u0111\u01b0\u1ee3c review, ghi nh\u1eadn v\u00e0 rollback \u0111\u01b0\u1ee3c.</li> <li>Khuy\u1ebfn kh\u00edch \u0111\u00f3ng g\u00f3p t\u1eeb n\u1ed9i b\u1ed9 v\u00e0 c\u1ed9ng \u0111\u1ed3ng m\u1edf r\u1ed9ng (n\u1ebfu applicable).</li> </ul>"},{"location":"dev/CONTRIBUTING/#cau-truc-nhanh-branch-strategy","title":"\ud83e\uddf1 C\u1ea5u tr\u00fac nh\u00e1nh (Branch Strategy)","text":"M\u1ee5c \u0111\u00edch Nh\u00e1nh Production <code>main</code> Staging / t\u00edch h\u1ee3p <code>dev</code> T\u00ednh n\u0103ng m\u1edbi <code>feature/&lt;ten-tinh-nang&gt;</code> Hotfix <code>hotfix/&lt;ten-loi&gt;</code>"},{"location":"dev/CONTRIBUTING/#quy-trinh-ong-gop","title":"\u2699\ufe0f Quy tr\u00ecnh \u0111\u00f3ng g\u00f3p","text":"<ol> <li>T\u1ea1o nh\u00e1nh m\u1edbi t\u1eeb <code>dev</code>:</li> </ol> <pre><code>git checkout dev\ngit pull origin dev\ngit checkout -b feature/ten-tinh-nang\n</code></pre> <ol> <li>Commit theo chu\u1ea9n Conventional Commit:</li> </ol> <pre><code>git commit -m \"feat(auth): th\u00eam x\u00e1c th\u1ef1c OAuth2 cho gi\u00e1o vi\u00ean\"\n</code></pre> <ol> <li>Rebase tr\u01b0\u1edbc khi t\u1ea1o Pull Request:</li> </ol> <pre><code>git fetch origin\ngit rebase origin/dev\n# N\u1ebfu nh\u00e1nh feature \u0111\u00e3 push t\u1eeb tr\u01b0\u1edbc:\ngit push --force-with-lease\n</code></pre> <ol> <li> <p>Push v\u00e0 t\u1ea1o Pull Request v\u1ec1 <code>dev</code>. PR n\u00ean nh\u1ecf, t\u1eadp trung m\u1ed9t ch\u1ee9c n\u0103ng, d\u1ec5 review.</p> </li> <li> <p>Ch\u1edd review t\u1ed1i thi\u1ec3u 1 th\u00e0nh vi\u00ean (\u01b0u ti\u00ean senior dev ho\u1eb7c tech lead v\u1edbi module ph\u1ee9c t\u1ea1p).</p> </li> <li> <p>Resolve conflict (n\u1ebfu c\u00f3) v\u00e0 c\u1eadp nh\u1eadt l\u1ea1i PR.</p> </li> <li> <p>Squash &amp; Merge n\u1ebfu \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn.</p> </li> </ol>"},{"location":"dev/CONTRIBUTING/#checklist-truoc-khi-tao-pr","title":"\u2705 Checklist tr\u01b0\u1edbc khi t\u1ea1o PR","text":"<ul> <li> \u0110\u00e3 vi\u1ebft test (unit/integration n\u1ebfu applicable)?</li> <li> \u0110\u00e3 ch\u1ea1y <code>pre-commit</code> v\u00e0 pass lint?</li> <li> T\u00e0i li\u1ec7u (docstring, README n\u1ebfu c\u1ea7n) \u0111\u00e3 c\u1eadp nh\u1eadt?</li> <li> \u0110\u00e3 ch\u1ea1y <code>docker-compose up</code> v\u00e0 verify ho\u1ea1t \u0111\u1ed9ng local?</li> <li> PR nh\u1ecf, g\u1ecdn, t\u1eadp trung 1 m\u1ee5c ti\u00eau?</li> </ul>"},{"location":"dev/CONTRIBUTING/#coding-convention","title":"\u270d\ufe0f Coding Convention","text":"<ul> <li>Tu\u00e2n theo PEP8</li> <li>S\u1eed d\u1ee5ng type hinting \u0111\u1ea7y \u0111\u1ee7</li> <li>Vi\u1ebft docstring theo Google Style Guide</li> <li>Xem th\u00eam chi ti\u1ebft t\u1ea1i <code>docs/DEV_GUIDE.md</code></li> <li>S\u1eed d\u1ee5ng custom exception theo t\u1eebng domain n\u1ebfu c\u00f3 logic nghi\u1ec7p v\u1ee5</li> </ul>"},{"location":"dev/CONTRIBUTING/#testing-ci","title":"\ud83e\uddea Testing &amp; CI","text":"<ul> <li>Unit test d\u00f9ng <code>pytest</code></li> <li>T\u1ed1i thi\u1ec3u 1 test cho m\u1ed7i logic quan tr\u1ecdng ho\u1eb7c edge case</li> <li>Coverage m\u1ee5c ti\u00eau \u2265 80%</li> <li> <p>CI pipeline t\u1ef1 \u0111\u1ed9ng ch\u1ea1y:</p> </li> <li> <p><code>black</code>, <code>flake8</code>, <code>isort</code></p> </li> <li><code>pytest</code></li> <li><code>bandit</code>, <code>safety</code>, <code>trivy</code></li> </ul>"},{"location":"dev/CONTRIBUTING/#quy-trinh-xu-ly-issuebug","title":"\ud83d\udc1e Quy tr\u00ecnh x\u1eed l\u00fd Issue/Bug","text":"<ul> <li>B\u00e1o c\u00e1o l\u1ed7i qua GitHub Issues ho\u1eb7c Slack n\u1ed9i b\u1ed9</li> <li>G\u00e1n label <code>bug</code>, <code>enhancement</code>, <code>help wanted</code>, v.v.</li> <li>Ch\u1ec9 nh\u1eadn x\u1eed l\u00fd issue khi \u0111\u00e3 assign b\u1ea3n th\u00e2n v\u00e0 th\u00f4ng b\u00e1o v\u1edbi team</li> <li>C\u00e1c issue nghi\u00eam tr\u1ecdng n\u00ean \u0111\u01b0\u1ee3c ghi r\u00f5 reproduction steps, log, \u1ea3nh screenshot n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"dev/CONTRIBUTING/#review-code","title":"\ud83d\udd0d Review code","text":"<ul> <li>T\u1ed1i thi\u1ec3u 1 reviewer ph\u1ea3i approve tr\u01b0\u1edbc khi merge</li> <li>Reviewer n\u00ean l\u00e0 senior dev ho\u1eb7c module owner cho c\u00e1c thay \u0111\u1ed5i l\u1edbn</li> <li>Review c\u1ea7n di\u1ec5n ra trong v\u00f2ng 48 gi\u1edd</li> <li>G\u00f3p \u00fd n\u00ean c\u1ee5 th\u1ec3, t\u00edch c\u1ef1c v\u00e0 r\u00f5 r\u00e0ng</li> <li>Tranh lu\u1eadn k\u1ef9 thu\u1eadt n\u00ean \u0111\u01b0\u1ee3c trao \u0111\u1ed5i trong GitHub comment ho\u1eb7c Slack; escalate n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"dev/CONTRIBUTING/#giao-tiep-phan-hoi","title":"\ud83d\udcac Giao ti\u1ebfp &amp; Ph\u1ea3n h\u1ed3i","text":"<ul> <li>S\u1eed d\u1ee5ng Slack, GitHub Discussion ho\u1eb7c Issue tracker</li> <li>T\u00f4n tr\u1ecdng th\u1eddi gian c\u1ee7a nhau, tr\u00e1nh push commit cu\u1ed1i ng\u00e0y r\u1ed3i y\u00eau c\u1ea7u review g\u1ea5p</li> <li> <p>Reviewer c\u00f3 th\u1ec3 t\u1eeb ch\u1ed1i PR n\u1ebfu:</p> </li> <li> <p>Kh\u00f4ng \u0111\u1ee7 test</p> </li> <li>Kh\u00f4ng \u0111\u00fang convention</li> <li>G\u00e2y \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn module kh\u00e1c m\u00e0 kh\u00f4ng c\u00f3 ph\u1ed1i h\u1ee3p</li> </ul>"},{"location":"dev/CONTRIBUTING/#license-quyen-so-huu","title":"\ud83d\udcc4 License &amp; Quy\u1ec1n s\u1edf h\u1eefu","text":"<p>M\u1ecdi \u0111\u00f3ng g\u00f3p \u0111\u01b0\u1ee3c xem l\u00e0 thu\u1ed9c v\u1ec1 t\u1ed5 ch\u1ee9c Tr\u01b0\u1eddng Vi\u1ec7t Anh \u2013 D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS. Vi\u1ec7c \u0111\u00f3ng g\u00f3p \u0111\u1ed3ng ngh\u0129a v\u1edbi vi\u1ec7c b\u1ea1n \u0111\u1ed3ng thu\u1eadn v\u1edbi c\u00e1c \u0111i\u1ec1u kho\u1ea3n n\u1ed9i b\u1ed9 \u0111\u00e3 \u0111\u01b0\u1ee3c th\u1ed1ng nh\u1ea5t.</p> <p>\u201cM\u1ed7i d\u00f2ng code b\u1ea1n vi\u1ebft h\u00f4m nay l\u00e0 n\u1ec1n t\u1ea3ng cho m\u1ed9t ng\u00f4i tr\u01b0\u1eddng s\u1ed1 th\u00f4ng minh ng\u00e0y mai.\u201d</p> <p>Ch\u00fang t\u00f4i r\u1ea5t mong \u0111\u1ee3i s\u1ef1 \u0111\u00f3ng g\u00f3p c\u1ee7a b\u1ea1n! \u2764\ufe0f</p>"},{"location":"dev/OFFBOARDING/","title":"\ud83d\udd1a OFFBOARDING Checklist \u2013 API Gateway (DX VAS)","text":"<p>C\u1ea3m \u01a1n b\u1ea1n v\u00ec \u0111\u00e3 \u0111\u1ed3ng h\u00e0nh c\u00f9ng d\u1ef1 \u00e1n API Gateway \u2013 Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS! \ud83c\udf89</p> <p>T\u00e0i li\u1ec7u n\u00e0y gi\u00fap \u0111\u1ea3m b\u1ea3o vi\u1ec7c b\u00e0n giao, thu h\u1ed3i quy\u1ec1n truy c\u1eadp, v\u00e0 l\u01b0u gi\u1eef tri th\u1ee9c \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n minh b\u1ea1ch, \u0111\u1ea7y \u0111\u1ee7 khi m\u1ed9t th\u00e0nh vi\u00ean r\u1eddi team (t\u1ea1m th\u1eddi ho\u1eb7c v\u0129nh vi\u1ec5n).</p>"},{"location":"dev/OFFBOARDING/#checklist-khi-offboarding","title":"\u2705 Checklist khi offboarding","text":""},{"location":"dev/OFFBOARDING/#1-thu-hoi-quyen-truy-cap","title":"1. Thu h\u1ed3i quy\u1ec1n truy c\u1eadp","text":"<ul> <li> X\u00f3a kh\u1ecfi GitHub organization ho\u1eb7c repo (<code>vas-org/api-gateway</code>)</li> <li> Thu h\u1ed3i quy\u1ec1n truy c\u1eadp Google Cloud IAM (Console, Cloud SQL, Artifact Registry)</li> <li> G\u1ee1 kh\u1ecfi Slack, Notion ho\u1eb7c t\u00e0i kho\u1ea3n qu\u1ea3n tr\u1ecb n\u1ed9i b\u1ed9 kh\u00e1c</li> <li> G\u1ee1 quy\u1ec1n kh\u1ecfi c\u00e1c d\u1ecbch v\u1ee5 CI/CD (GitHub Secrets, Deployment Keys, v.v.)</li> </ul>"},{"location":"dev/OFFBOARDING/#2-ban-giao-code-va-cong-viec-ang-do","title":"2. B\u00e0n giao code v\u00e0 c\u00f4ng vi\u1ec7c \u0111ang d\u1edf","text":"<ul> <li> <p> To\u00e0n b\u1ed9 nh\u00e1nh <code>feature/*</code> ch\u01b0a merge \u0111\u00e3 \u0111\u01b0\u1ee3c:</p> </li> <li> <p> T\u1ea1o Pull Request (n\u1ebfu \u0111\u1ee7 \u0111i\u1ec1u ki\u1ec7n)</p> </li> <li> G\u00e1n reviewer/assignee thay th\u1ebf</li> <li> Ghi ch\u00fa l\u1ea1i TODO r\u00f5 r\u00e0ng n\u1ebfu ch\u01b0a xong</li> <li> B\u00e0n giao issue \u0111\u00e3 assign trong GitHub Project</li> <li> N\u1ebfu c\u00f3 test/manual data/script local, c\u1ea7n push ho\u1eb7c backup</li> </ul>"},{"location":"dev/OFFBOARDING/#3-ban-giao-tri-thuc-tai-lieu-hoa","title":"3. B\u00e0n giao tri th\u1ee9c &amp; t\u00e0i li\u1ec7u h\u00f3a","text":"<ul> <li> <p> C\u1eadp nh\u1eadt c\u00e1c ph\u1ea7n m\u00ecnh ph\u1ee5 tr\u00e1ch trong:</p> </li> <li> <p> <code>DEV_GUIDE.md</code></p> </li> <li> <code>CONTRIBUTING.md</code> (n\u1ebfu c\u00f3 \u1ea3nh h\u01b0\u1edfng)</li> <li> C\u00e1c file <code>README.md</code> ho\u1eb7c <code>docs/*</code> c\u1ee7a module</li> <li> N\u1ebfu c\u00f3 ki\u1ebfn th\u1ee9c ri\u00eang (c\u00e1ch setup debug, trick v\u1edbi 1 service...), ghi l\u1ea1i trong <code>docs/OFFBOARDING_notes/&lt;t\u00ean&gt;.md</code></li> </ul>"},{"location":"dev/OFFBOARDING/#4-anh-gia-loi-chao","title":"4. \u0110\u00e1nh gi\u00e1 &amp; l\u1eddi ch\u00e0o","text":"<ul> <li> G\u1eedi l\u1eddi c\u1ea3m \u01a1n qua Slack ho\u1eb7c email n\u1ed9i b\u1ed9</li> <li> <p> Ho\u00e0n th\u00e0nh quick retro:</p> </li> <li> <p> Nh\u1eefng g\u00ec b\u1ea1n th\u1ea5y hi\u1ec7u qu\u1ea3</p> </li> <li> \u0110i\u1ec1u g\u00ec c\u00f3 th\u1ec3 c\u1ea3i thi\u1ec7n</li> <li> B\u1ea1n mu\u1ed1n \u0111\u1ec3 l\u1ea1i l\u1eddi nh\u1eafn g\u00ec cho team \ud83d\ude42</li> </ul>"},{"location":"dev/OFFBOARDING/#bieu-mau-offboarding-mau","title":"\ud83e\uddfe Bi\u1ec3u m\u1eabu offboarding m\u1eabu","text":"<pre><code>t\u00ean: Nguy\u1ec5n V\u0103n A\nd\u1ef1 \u00e1n tham gia: API Gateway (DX VAS)\nth\u1eddi gian: Th\u00e1ng 3/2024 \u2013 Th\u00e1ng 8/2025\nb\u00e0n giao cho: Tr\u1ea7n Th\u1ecb B (DevOps), L\u00ea V\u0103n C (backend)\nretro:\n- \u2705 \u0110i\u1ec1u hi\u1ec7u qu\u1ea3: CI/CD nhanh g\u1ecdn, codebase r\u00f5 r\u00e0ng\n- \ud83d\udca1 N\u00ean c\u1ea3i thi\u1ec7n: R\u00fat ng\u1eafn th\u1eddi gian review PR\n- \u2764\ufe0f L\u1eddi nh\u1eafn: C\u1ea3m \u01a1n anh em team, ch\u00fac d\u1ef1 \u00e1n th\u00e0nh c\u00f4ng l\u1edbn!\n</code></pre>"},{"location":"dev/OFFBOARDING/#tai-lieu-ho-tro","title":"\ud83d\udcce T\u00e0i li\u1ec7u h\u1ed7 tr\u1ee3","text":"<ul> <li>Ch\u00ednh s\u00e1ch b\u1ea3o m\u1eadt n\u1ed9i b\u1ed9 (li\u00ean h\u1ec7 IT team)</li> <li>H\u01b0\u1edbng d\u1eabn backup d\u1eef li\u1ec7u t\u1eeb m\u00e1y c\u00e1 nh\u00e2n (tu\u1ef3 theo c\u00f4ng c\u1ee5 team s\u1eed d\u1ee5ng)</li> <li>Template: <code>docs/OFFBOARDING_notes/template.md</code></li> </ul> <p>\u201cB\u1ea1n c\u00f3 th\u1ec3 r\u1eddi d\u1ef1 \u00e1n, nh\u01b0ng nh\u1eefng d\u00f2ng code v\u00e0 tinh th\u1ea7n \u0111\u00f3ng g\u00f3p s\u1ebd c\u00f2n m\u00e3i.\u201d \ud83d\udc9b</p>"},{"location":"dev/ONBOARDING/","title":"\ud83e\udded ONBOARDING Checklist \u2013 API Gateway (DX VAS)","text":"<p>Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi \u0111\u1ed9i ng\u0169 ph\u00e1t tri\u1ec3n API Gateway c\u1ee7a d\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS! \ud83c\udf89</p> <p>T\u00e0i li\u1ec7u n\u00e0y s\u1ebd gi\u00fap b\u1ea1n kh\u1edfi \u0111\u1ed9ng nhanh ch\u00f3ng, n\u1eafm b\u1eaft quy tr\u00ecnh l\u00e0m vi\u1ec7c v\u00e0 thi\u1ebft l\u1eadp \u0111\u1ea7y \u0111\u1ee7 c\u00e1c c\u00f4ng c\u1ee5, quy\u1ec1n truy c\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u \u0111\u00f3ng g\u00f3p hi\u1ec7u qu\u1ea3.</p>"},{"location":"dev/ONBOARDING/#checklist-tuan-au-tien","title":"\u2705 Checklist tu\u1ea7n \u0111\u1ea7u ti\u00ean","text":"<p>G\u1ee3i \u00fd th\u1eddi gian:</p> <ul> <li>Ng\u00e0y 1\u20132: Truy c\u1eadp h\u1ec7 th\u1ed1ng &amp; Thi\u1ebft l\u1eadp m\u00f4i tr\u01b0\u1eddng local</li> <li>Ng\u00e0y 3\u20134: L\u00e0m quen codebase &amp; c\u00f4ng c\u1ee5 CI/CD</li> <li>Ng\u00e0y 5: Giao ti\u1ebfp, g\u00f3p PR \u0111\u1ea7u ti\u00ean, chu\u1ea9n b\u1ecb review</li> </ul>"},{"location":"dev/ONBOARDING/#1-truy-cap-cong-cu","title":"1. Truy c\u1eadp &amp; c\u00f4ng c\u1ee5","text":"<ul> <li> <p> \u0110\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp v\u00e0o:</p> </li> <li> <p> GitHub repo: <code>vas-org/api-gateway</code></p> </li> <li> Google Cloud Console (staging project)</li> <li> Slack n\u1ed9i b\u1ed9 / nh\u00f3m DX VAS</li> <li> <p> C\u00e0i \u0111\u1eb7t c\u00f4ng c\u1ee5:</p> </li> <li> <p> Python &gt;= 3.10</p> </li> <li> Docker &amp; Docker Compose</li> <li> Git</li> <li> VSCode ho\u1eb7c PyCharm</li> <li> Redis client (TablePlus ho\u1eb7c <code>redis-cli</code>)</li> <li> PostgreSQL client (DBeaver, <code>psql</code>)</li> </ul>"},{"location":"dev/ONBOARDING/#2-thiet-lap-moi-truong-local","title":"2. Thi\u1ebft l\u1eadp m\u00f4i tr\u01b0\u1eddng local","text":"<ul> <li> Clone d\u1ef1 \u00e1n v\u00e0 t\u1ea1o file <code>.env</code></li> <li> C\u00e0i \u0111\u1eb7t <code>pre-commit</code> v\u00e0 ch\u1ea1y <code>pre-commit install</code></li> <li> <code>docker-compose up --build</code> v\u00e0 truy c\u1eadp <code>http://localhost:8000/docs</code></li> <li> \u0110\u1ea3m b\u1ea3o FastAPI ho\u1ea1t \u0111\u1ed9ng local kh\u00f4ng l\u1ed7i</li> </ul>"},{"location":"dev/ONBOARDING/#3-lam-quen-voi-ma-nguon-va-quy-trinh","title":"3. L\u00e0m quen v\u1edbi m\u00e3 ngu\u1ed3n v\u00e0 quy tr\u00ecnh","text":"<ul> <li> \u0110\u1ecdc t\u00e0i li\u1ec7u <code>DEV_GUIDE.md</code></li> <li> \u0110\u1ecdc quy \u01b0\u1edbc <code>CONTRIBUTING.md</code></li> <li> Xem ki\u1ebfn tr\u00fac th\u01b0 m\u1ee5c v\u00e0 module ch\u00ednh: <code>auth</code>, <code>rbac</code>, <code>notify</code></li> <li> Ch\u1ea1y th\u1eed test: <code>pytest</code></li> <li> \u0110\u1ecdc CI workflow t\u1ea1i <code>.github/workflows/ci.yml</code></li> <li> L\u00e0m quen v\u1edbi <code>prestart.sh</code> v\u00e0 Dockerfile</li> </ul>"},{"location":"dev/ONBOARDING/#4-giao-tiep-van-hoa-noi-bo","title":"4. Giao ti\u1ebfp &amp; v\u0103n h\u00f3a n\u1ed9i b\u1ed9","text":"<ul> <li> Tham gia nh\u00f3m Slack <code>#dx-vas-dev</code></li> <li> Gi\u1edbi thi\u1ec7u b\u1ea3n th\u00e2n trong nh\u00f3m (\u0111\u01a1n gi\u1ea3n + role)</li> <li> Bi\u1ebft ai l\u00e0 mentor k\u1ef9 thu\u1eadt (th\u01b0\u1eddng l\u00e0 ng\u01b0\u1eddi assign task \u0111\u1ea7u ti\u00ean)</li> </ul>"},{"location":"dev/ONBOARDING/#nhiem-vu-tuan-au-tien-e-xuat","title":"\ud83d\udea7 Nhi\u1ec7m v\u1ee5 tu\u1ea7n \u0111\u1ea7u ti\u00ean (\u0111\u1ec1 xu\u1ea5t)","text":"M\u1ee5c ti\u00eau Task m\u1eabu K\u1ef3 v\u1ecdng L\u00e0m quen codebase Fix l\u1ed7i nh\u1ecf ho\u1eb7c th\u00eam log/debug 1 commit, push l\u00ean branch feature/* CI/CD T\u1ea1o PR nh\u1ecf c\u1eadp nh\u1eadt README ho\u1eb7c badge T\u1ea1o 1 PR &amp; \u0111\u01b0\u1ee3c merge v\u00e0o <code>dev</code> Test Vi\u1ebft th\u00eam 1 test cho route <code>auth/login</code> C\u00f3 th\u1ec3 ch\u1ea1y pass trong <code>pytest</code>"},{"location":"dev/ONBOARDING/#nguoi-ho-tro","title":"\ud83e\uddd1\u200d\ud83c\udfeb Ng\u01b0\u1eddi h\u1ed7 tr\u1ee3","text":"H\u1ea1ng m\u1ee5c Ng\u01b0\u1eddi ph\u1ee5 tr\u00e1ch Mentor k\u1ef9 thu\u1eadt Nguy\u1ec5n V\u0103n A (Tech Lead) Code review B\u1ea5t k\u1ef3 dev c\u1ea5p senior trong team CI/CD &amp; Cloud Tr\u1ea7n Th\u1ecb B (DevOps)"},{"location":"dev/ONBOARDING/#tai-lieu-quan-trong","title":"\ud83d\udcce T\u00e0i li\u1ec7u quan tr\u1ecdng","text":"<ul> <li>Dev Guide: <code>docs/DEV_GUIDE.md</code></li> <li>Coding Convention + PR flow: <code>docs/CONTRIBUTING.md</code></li> <li>Ki\u1ebfn tr\u00fac: <code>docs/ADR/adr-001-fastapi.md</code>, <code>adr-002-rbac-design.md</code></li> <li>API Docs (local): <code>http://localhost:8000/docs</code></li> </ul>"},{"location":"dev/ONBOARDING/#giao-tiep-va-van-hoa-phan-hoi","title":"\ud83d\udcac Giao ti\u1ebfp v\u00e0 v\u0103n h\u00f3a ph\u1ea3n h\u1ed3i","text":"<ul> <li>B\u1ea1n kh\u00f4ng c\u1ea7n bi\u1ebft m\u1ecdi th\u1ee9 t\u1eeb \u0111\u1ea7u \u2013 h\u00e3y h\u1ecfi khi ch\u01b0a r\u00f5! Slack lu\u00f4n m\u1edf.</li> <li>Feedback n\u00ean t\u1eadp trung v\u00e0o h\u00e0nh vi/code thay v\u00ec c\u00e1 nh\u00e2n.</li> <li>\u0110\u01b0a feedback s\u1edbm, c\u1ee5 th\u1ec3, c\u00f3 g\u1ee3i \u00fd h\u00e0nh \u0111\u1ed9ng.</li> <li>T\u00f4n tr\u1ecdng m\u1ecdi th\u00e0nh vi\u00ean trong team, d\u00f9 l\u00e0 junior hay senior.</li> </ul> <p>\u201cKh\u00f4ng c\u1ea7n gi\u1ecfi ngay t\u1eeb \u0111\u1ea7u \u2013 ch\u1ec9 c\u1ea7n ti\u1ebfn b\u1ed9 m\u1ed7i ng\u00e0y c\u00f9ng team \ud83d\udcaa\u201d</p> <p>Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi h\u00e0nh tr\u00ecnh ph\u00e1t tri\u1ec3n m\u1ed9t h\u1ec7 sinh th\u00e1i gi\u00e1o d\u1ee5c s\u1ed1 m\u1ea1nh m\u1ebd! \ud83e\udde1</p>"},{"location":"dev/backend-dev-guide/","title":"\ud83d\udee0\ufe0f Backend Dev Guide \u2013 dx-vas","text":"<p>T\u00e0i li\u1ec7u n\u00e0y d\u00e0nh cho l\u1eadp tr\u00ecnh vi\u00ean backend trong h\u1ec7 th\u1ed1ng dx-vas. M\u1ee5c ti\u00eau l\u00e0 cung c\u1ea5p quy chu\u1ea9n v\u00e0 h\u01b0\u1edbng d\u1eabn chi ti\u1ebft v\u1ec1 c\u00e1ch ph\u00e1t tri\u1ec3n service backend: c\u1ea5u tr\u00fac th\u01b0 m\u1ee5c, ph\u00e2n t\u1ea7ng logic, x\u1eed l\u00fd nghi\u1ec7p v\u1ee5, vi\u1ebft test, v\u00e0 th\u1ef1c thi c\u00e1c ti\u00eau chu\u1ea9n ch\u1ea5t l\u01b0\u1ee3ng code.</p>"},{"location":"dev/backend-dev-guide/#muc-luc","title":"M\u1ee5c l\u1ee5c","text":"<ol> <li>Ph\u1ea1m vi &amp; nguy\u00ean t\u1eafc</li> <li>C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c backend chu\u1ea9n</li> <li>Ph\u00e2n t\u1ea7ng logic &amp; vai tr\u00f2</li> <li>\u0110\u1eb7t t\u00ean &amp; convention code</li> <li>X\u1eed l\u00fd nghi\u1ec7p v\u1ee5 &amp; usecase m\u1eabu</li> <li>Schema &amp; validation (Pydantic)</li> <li>X\u1eed l\u00fd l\u1ed7i &amp; th\u00f4ng b\u00e1o</li> <li>Repository &amp; truy xu\u1ea5t d\u1eef li\u1ec7u</li> <li>Pub/Sub subscriber &amp; idempotency</li> <li>Test \u0111\u01a1n v\u1ecb &amp; t\u00edch h\u1ee3p</li> <li>Checklist khi t\u1ea1o PR backend</li> <li>T\u00e0i li\u1ec7u li\u00ean quan</li> <li>Logging Best Practices</li> <li>Security Considerations \u2013 C\u00e2n nh\u1eafc b\u1ea3o m\u1eadt cho Backend</li> <li>Performance Tips \u2013 T\u1ed1i \u01b0u hi\u1ec7u n\u0103ng Backend</li> </ol>"},{"location":"dev/backend-dev-guide/#1-pham-vi-nguyen-tac","title":"1. Ph\u1ea1m vi &amp; nguy\u00ean t\u1eafc","text":"<p>T\u00e0i li\u1ec7u n\u00e0y d\u00e0nh ri\u00eang cho c\u00e1c th\u00e0nh vi\u00ean ph\u00e1t tri\u1ec3n backend trong h\u1ec7 th\u1ed1ng dx-vas \u2013 n\u01a1i m\u1ecdi service backend \u0111\u01b0\u1ee3c vi\u1ebft theo ki\u1ebfn tr\u00fac microservice, m\u1ed7i service l\u00e0 1 repo ri\u00eang bi\u1ec7t (multi-repo), tri\u1ec3n khai qua Cloud Run.</p>"},{"location":"dev/backend-dev-guide/#muc-tieu","title":"M\u1ee5c ti\u00eau","text":"<p>H\u01b0\u1edbng d\u1eabn l\u1eadp tr\u00ecnh vi\u00ean backend ph\u00e1t tri\u1ec3n service trong h\u1ec7 th\u1ed1ng dx_vas m\u1ed9t c\u00e1ch nh\u1ea5t qu\u00e1n, b\u1ea3o m\u1eadt, d\u1ec5 m\u1edf r\u1ed9ng v\u00e0 d\u1ec5 b\u1ea3o tr\u00ec.</p>"},{"location":"dev/backend-dev-guide/#pham-vi-ap-dung","title":"Ph\u1ea1m vi \u00e1p d\u1ee5ng","text":"<ul> <li>T\u1ea5t c\u1ea3 c\u00e1c backend service vi\u1ebft b\u1eb1ng Python 3.11+ (FastAPI + SQLAlchemy + Pydantic)</li> <li>C\u1ea5u tr\u00fac d\u1ef1a tr\u00ean m\u00f4 h\u00ecnh microservice (multi-repo)</li> </ul>"},{"location":"dev/backend-dev-guide/#nguyen-tac-cot-loi","title":"Nguy\u00ean t\u1eafc c\u1ed1t l\u00f5i","text":"<ul> <li>Separation of concerns: t\u00e1ch bi\u1ec7t r\u00f5 t\u1eebng t\u1ea7ng (Handler \u2013 Service \u2013 Repo)</li> <li>\u0110\u1ea3m b\u1ea3o idempotency v\u00e0 transactional consistency cho c\u00e1c nghi\u1ec7p v\u1ee5</li> <li>Response chu\u1ea9n h\u00f3a theo envelope (meta + data / error)</li> <li>Service kh\u00f4ng raise HTTPException | ch\u1ec9 raise DomainError</li> <li>Schema r\u00f5 r\u00e0ng: ph\u00e2n bi\u1ec7t DTO (schema), model (ORM), entity (n\u1ebfu c\u00f3)</li> <li>Ph\u00e2n quy\u1ec1n theo RBAC \u0111\u1ed9ng \u2013 backend ch\u1ec9 nh\u1eadn <code>X-Permissions</code></li> <li>Security by Design: m\u1ecdi input \u0111\u1ec1u ph\u1ea3i validate \u2013 k\u1ec3 c\u1ea3 event n\u1ed9i b\u1ed9</li> <li>Context: ph\u00e2n bi\u1ec7t r\u00f5 DTO, ORM model, user context (vai tr\u00f2 ng\u01b0\u1eddi d\u00f9ng, \u0111i\u1ec1u ki\u1ec7n RBAC), v\u00e0 request context (trace_id, source_ip...)</li> </ul> <p>\ud83d\udccc L\u01b0u \u00fd: Service kh\u00f4ng ph\u1ee5 thu\u1ed9c gateway \u2013 c\u00f3 th\u1ec3 test \u0111\u1ed9c l\u1eadp</p> <p>\ud83d\udcce T\u00e0i li\u1ec7u n\u00e0y kh\u00f4ng l\u1eb7p l\u1ea1i CI/CD hay c\u1ea5u tr\u00fac repo (\u0111\u00e3 c\u00f3 \u1edf Dev Guide), m\u00e0 t\u1eadp trung v\u00e0o: - Usecase backend (handlers, service, repo) - Convention ph\u00e2n t\u1ea7ng - Test v\u00e0 best practice</p>"},{"location":"dev/backend-dev-guide/#2-cau-truc-thu-muc-backend-chuan","title":"2. C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c backend chu\u1ea9n","text":"<p>T\u1ea5t c\u1ea3 c\u00e1c service backend trong dx-vas n\u00ean tu\u00e2n theo c\u1ea5u tr\u00fac th\u01b0 m\u1ee5c chu\u1ea9n d\u01b0\u1edbi \u0111\u00e2y \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh nh\u1ea5t qu\u00e1n v\u00e0 d\u1ec5 b\u1ea3o tr\u00ec:</p> <pre><code>app/\n\u251c\u2500\u2500 api/              # Router, route handler (FastAPI)\n\u2502   \u2514\u2500\u2500 v1/\n\u2502       \u2514\u2500\u2500 user.py   # Endpoint \u0111\u1ecbnh ngh\u0129a HTTP\n\u251c\u2500\u2500 schemas/          # Pydantic schema (request, response)\n\u2502   \u2514\u2500\u2500 user.py\n\u251c\u2500\u2500 services/         # Business logic (Usecase Layer)\n\u2502   \u2514\u2500\u2500 user\\_service.py\n\u251c\u2500\u2500 repositories/     # Truy c\u1eadp DB, ORM / SQL\n\u2502   \u2514\u2500\u2500 user\\_repo.py\n\u251c\u2500\u2500 models/           # SQLAlchemy model (DB mapping)\n\u2502   \u2514\u2500\u2500 user.py\n\u251c\u2500\u2500 core/             # C\u1ea5u h\u00ecnh, DI, security\n\u2502   \u251c\u2500\u2500 config.py\n\u2502   \u2514\u2500\u2500 security.py\n\u251c\u2500\u2500 events/           # X\u1eed l\u00fd Pub/Sub\n\u2502   \u251c\u2500\u2500 subscriber/   # Nh\u1eadn s\u1ef1 ki\u1ec7n, x\u1eed l\u00fd\n\u2502   \u2514\u2500\u2500 publisher/    # G\u1eedi s\u1ef1 ki\u1ec7n \u0111i\n\u251c\u2500\u2500 deps.py           # Dependency Injection (DB, current\\_user...)\n\u2514\u2500\u2500 main.py           # Entry point FastAPI\n</code></pre>"},{"location":"dev/backend-dev-guide/#mot-so-quy-uoc-chung","title":"\ud83d\udccc M\u1ed9t s\u1ed1 quy \u01b0\u1edbc chung","text":"<ul> <li><code>services/</code> ch\u1ec9 ch\u1ee9a logic nghi\u1ec7p v\u1ee5, kh\u00f4ng g\u1ecdi tr\u1ef1c ti\u1ebfp DB hay HTTP</li> <li><code>repositories/</code> l\u00e0 l\u1edbp duy nh\u1ea5t t\u01b0\u01a1ng t\u00e1c tr\u1ef1c ti\u1ebfp v\u1edbi DB</li> <li><code>schemas/</code> ch\u1ec9 d\u00f9ng cho request/response \u2013 kh\u00f4ng d\u00f9ng l\u00e0m entity ho\u1eb7c DB model</li> <li><code>events/</code> c\u00f3 th\u1ec3 chia nh\u1ecf th\u00e0nh <code>subscriber/</code>, <code>publisher/</code> n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"dev/backend-dev-guide/#goi-y","title":"\ud83d\udcce G\u1ee3i \u00fd","text":"<ul> <li>N\u1ebfu service c\u00f3 ph\u1ea7n x\u1eed l\u00fd RBAC ri\u00eang \u2192 c\u00f3 th\u1ec3 th\u00eam <code>rbac/</code></li> <li>N\u1ebfu c\u1ea7n chia nh\u1ecf service l\u1edbn (VD: SIS Adapter) \u2192 chia th\u00e0nh module theo domain (<code>student/</code>, <code>classroom/</code>, <code>fee/</code>)</li> </ul>"},{"location":"dev/backend-dev-guide/#quan-ly-dependency-depspy","title":"\ud83d\udd27 Qu\u1ea3n l\u00fd Dependency (deps.py)","text":"<p>T\u1eadp tin <code>deps.py</code> l\u00e0 n\u01a1i \u0111\u1ecbnh ngh\u0129a c\u00e1c provider function \u0111\u1ec3 inject dependency nh\u01b0 <code>db_session</code>, <code>current_user</code>, ho\u1eb7c <code>service instance</code> v\u00e0o c\u00e1c route.</p> <p>V\u00ed d\u1ee5:</p> <pre><code>def get_db() -&gt; Generator:\n    session = SessionLocal()\n    try:\n        yield session\n    finally:\n        session.close()\n\ndef get_user_service(db: Session = Depends(get_db)) -&gt; UserService:\n    return UserService(UserRepo(db))\n</code></pre> <p>\ud83d\udcce T\u00e1ch ri\u00eang c\u00e1c provider v\u00e0o deps.py gi\u00fap d\u1ec5 t\u00e1i s\u1eed d\u1ee5ng, test v\u00e0 thay th\u1ebf (mock).</p>"},{"location":"dev/backend-dev-guide/#3-phan-tang-logic-vai-tro","title":"3. Ph\u00e2n t\u1ea7ng logic &amp; vai tr\u00f2","text":"<p>dx-vas \u00e1p d\u1ee5ng m\u00f4 h\u00ecnh 3-layer architecture cho backend, nh\u1eb1m t\u00e1ch bi\u1ec7t r\u00f5 r\u00e0ng gi\u1eefa:</p> <ol> <li>Presentation Layer (API Handler) \u2013 ti\u1ebfp nh\u1eadn request t\u1eeb client</li> <li>Service Layer (Usecase) \u2013 x\u1eed l\u00fd logic nghi\u1ec7p v\u1ee5</li> <li>Data Layer (Repository) \u2013 truy xu\u1ea5t d\u1eef li\u1ec7u t\u1eeb DB ho\u1eb7c b\u00ean th\u1ee9 ba</li> </ol>"},{"location":"dev/backend-dev-guide/#tang-1-api-handler-appapi","title":"\ud83e\uddf1 T\u1ea7ng 1: API Handler (<code>app/api/</code>)","text":"<ul> <li>N\u01a1i \u0111\u1ecbnh ngh\u0129a c\u00e1c route, s\u1eed d\u1ee5ng FastAPI router</li> <li>G\u1ecdi service layer, validate input, tr\u1ea3 response</li> <li>Kh\u00f4ng ch\u1ee9a logic nghi\u1ec7p v\u1ee5 ho\u1eb7c x\u1eed l\u00fd d\u1eef li\u1ec7u ph\u1ee9c t\u1ea1p</li> </ul> <pre><code>@router.get(\\\"/users/{id}\\\", response_model=UserOut)\ndef get_user(id: UUID, user_svc: UserService = Depends(get_user_service)):\n    return user_svc.get_user(id)\n</code></pre>"},{"location":"dev/backend-dev-guide/#ghi-chu-ve-dependency","title":"\ud83d\udcce Ghi ch\u00fa v\u1ec1 Dependency","text":"<p>Bi\u1ebfn <code>user_svc: UserService = Depends(get_user_service)</code> s\u1eed d\u1ee5ng Dependency Injection (DI) c\u1ee7a FastAPI. H\u00e0m <code>get_user_service</code> th\u01b0\u1eddng \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a nh\u01b0 sau:</p> <pre><code># deps.py\ndef get_user_service(db: Session = Depends(get_db)) -&gt; UserService:\n    repo = UserRepo(db)\n    return UserService(repo)\n</code></pre> <p>\u2705 \u0110i\u1ec1u n\u00e0y gi\u00fap t\u00e1ch r\u00f5 logic kh\u1edfi t\u1ea1o v\u00e0 inject c\u00e1c th\u00e0nh ph\u1ea7n nh\u01b0 session, repository, v\u00e0 service \u2013 h\u1ed7 tr\u1ee3 test v\u00e0 maintain d\u1ec5 d\u00e0ng.</p>"},{"location":"dev/backend-dev-guide/#tang-2-service-layer-appservices","title":"\u2699\ufe0f T\u1ea7ng 2: Service Layer (<code>app/services/</code>)","text":"<ul> <li>N\u01a1i x\u1eed l\u00fd to\u00e0n b\u1ed9 logic nghi\u1ec7p v\u1ee5: validate rule, x\u1eed l\u00fd business exception, g\u1ecdi repository</li> <li>\u0110\u01b0\u1ee3c test ri\u00eang b\u1eb1ng unit test</li> <li>Kh\u00f4ng g\u1ecdi tr\u1ef1c ti\u1ebfp HTTP, DB, FastAPI context</li> </ul> <pre><code>class UserService:\n    def __init__(self, user_repo: UserRepo):\n        self.repo = user_repo\n\n    def get_user(self, id: UUID) -&gt; UserOut:\n        user = self.repo.get(id)\n        if not user:\n            raise UserNotFound()\n        return user\n</code></pre>"},{"location":"dev/backend-dev-guide/#tang-3-repository-layer-apprepositories","title":"\ud83d\uddc3\ufe0f T\u1ea7ng 3: Repository Layer (<code>app/repositories/</code>)","text":"<ul> <li>T\u01b0\u01a1ng t\u00e1c v\u1edbi DB qua SQLAlchemy / SQLModel</li> <li>L\u00e0 n\u01a1i duy nh\u1ea5t \u0111\u01b0\u1ee3c g\u1ecdi DB query tr\u1ef1c ti\u1ebfp</li> <li>C\u00f3 th\u1ec3 chia nh\u1ecf theo entity</li> </ul> <pre><code>class UserRepo:\n    def __init__(self, session: Session):\n        self.session = session\n\n    def get(self, id: UUID) -&gt; Optional[User]:\n        return self.session.query(User).filter(User.id == id).first()\n</code></pre>"},{"location":"dev/backend-dev-guide/#luu-y-bo-sung","title":"\ud83d\udca1 L\u01b0u \u00fd b\u1ed5 sung","text":"Th\u00e0nh ph\u1ea7n \u0110\u01b0\u1ee3c ph\u00e9p g\u1ecdi Kh\u00f4ng \u0111\u01b0\u1ee3c g\u1ecdi Handler Service, Schema Repo, Model Service Repo, Schema Handler, DB Repo Model Schema, Service <p>\u2705 M\u00f4 h\u00ecnh n\u00e0y gi\u00fap d\u1ec5 test, d\u1ec5 refactor, v\u00e0 d\u1ec5 scale t\u1eebng t\u1ea7ng khi c\u1ea7n.</p> <p>\ud83d\udcce Service Layer n\u00ean tr\u1ea3 v\u1ec1 DTO (Pydantic Schema), kh\u00f4ng tr\u1ea3 tr\u1ef1c ti\u1ebfp SQLAlchemy model.  </p> <p>\u0110i\u1ec1u n\u00e0y gi\u00fap API Handler t\u00e1ch bi\u1ec7t kh\u1ecfi ORM logic v\u00e0 t\u0103ng kh\u1ea3 n\u0103ng test.</p> <p>\ud83d\udccc N\u1ebfu usecase nghi\u1ec7p v\u1ee5 y\u00eau c\u1ea7u nhi\u1ec1u b\u01b0\u1edbc (update + audit + g\u1eedi event), h\u00e3y c\u00e2n nh\u1eafc t\u1ed5 ch\u1ee9c th\u00e0nh context ho\u1eb7c pattern Unit of Work \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o rollback \u0111\u1ed3ng b\u1ed9 n\u1ebfu c\u00f3 l\u1ed7i.</p>"},{"location":"dev/backend-dev-guide/#so-o-kien-truc-3-layer-luong-xu-ly-ien-hinh-trong-mot-backend-service","title":"\ud83d\udcca S\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac 3-layer \u2013 lu\u1ed3ng x\u1eed l\u00fd \u0111i\u1ec3n h\u00ecnh trong m\u1ed9t backend service","text":"<pre><code>flowchart LR\n  subgraph Client Request\n    UI[API Client / Gateway]\n  end\n\n  subgraph FastAPI App\n    UI --&gt; Handler[API Handler - Router]\n    Handler --&gt; Service[Service Layer]\n    Service --&gt; Repo[Repository Layer]\n    Repo --&gt; DB[Database]\n  end\n\n  subgraph External\n    Service --&gt; PubSub[Pub/Sub]\n    Service --&gt; Redis[Cache]\n    Service --&gt; NotiAPI[Notification Service]\n  end\n\n  classDef main fill:#e8f0fe,stroke:#4285f4,stroke-width:1px;\n  class Handler,Service,Repo main\n</code></pre> <p>\ud83d\udccc S\u01a1 \u0111\u1ed3 m\u00f4 t\u1ea3 r\u00f5 flow x\u1eed l\u00fd t\u1eeb API Gateway \u2192 Handler \u2192 Service \u2192 Repo \u2192 DB C\u00e1c call ph\u1ee5 nh\u01b0 Pub/Sub, Cache, ho\u1eb7c Notification th\u01b0\u1eddng xu\u1ea5t ph\u00e1t t\u1eeb Service Layer.</p>"},{"location":"dev/backend-dev-guide/#goi-y-nang-cao-unit-of-work-uow","title":"\ud83d\udca1 G\u1ee3i \u00fd n\u00e2ng cao \u2013 Unit of Work (UoW)","text":"<p>Khi usecase bao g\u1ed3m nhi\u1ec1u b\u01b0\u1edbc quan tr\u1ecdng (VD: c\u1eadp nh\u1eadt h\u1ecdc sinh, ghi audit, g\u1eedi th\u00f4ng b\u00e1o), n\u00ean g\u00f3i c\u00e1c h\u00e0nh \u0111\u1ed9ng n\u00e0y trong m\u1ed9t context ho\u1eb7c pattern \"Unit of Work\" \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o rollback \u0111\u1ed3ng b\u1ed9 n\u1ebfu c\u00f3 l\u1ed7i:</p> <pre><code>class StudentUoW:\n    def __init__(self, db: Session):\n        self.db = db\n        self.student_repo = StudentRepo(db)\n        self.audit_repo = AuditRepo(db)\n\n    def commit(self):\n        self.db.commit()\n\n    def rollback(self):\n        self.db.rollback()\n\n# Trong service\ndef update_student_and_audit(self, payload: StudentUpdateIn, uow: StudentUoW):\n    student = uow.student_repo.update(payload)\n    uow.audit_repo.log(\"C\u1eadp nh\u1eadt HS\", student.id)\n    uow.commit()\n</code></pre> <p>\ud83d\udccc UoW pattern gi\u00fap gom logic nghi\u1ec7p v\u1ee5 \u0111a b\u01b0\u1edbc v\u00e0o m\u1ed9t transaction duy nh\u1ea5t, v\u00e0 gi\u1ea3m r\u1ee7i ro b\u1ecf s\u00f3t commit ho\u1eb7c rollback.</p>"},{"location":"dev/backend-dev-guide/#4-at-ten-convention-code","title":"4. \u0110\u1eb7t t\u00ean &amp; convention code","text":"<p>Vi\u1ec7c \u0111\u1eb7t t\u00ean r\u00f5 r\u00e0ng, nh\u1ea5t qu\u00e1n gi\u00fap code d\u1ec5 \u0111\u1ecdc, d\u1ec5 review v\u00e0 d\u1ec5 b\u1ea3o tr\u00ec. dx-vas s\u1eed d\u1ee5ng convention theo ki\u1ec3u snake_case cho file/bi\u1ebfn, CamelCase cho class, v\u00e0 lowercase-with-dash cho route.</p>"},{"location":"dev/backend-dev-guide/#ten-file-thu-muc","title":"\ud83d\udcc1 T\u00ean file &amp; th\u01b0 m\u1ee5c","text":"Lo\u1ea1i Quy t\u1eafc V\u00ed d\u1ee5 Th\u01b0 m\u1ee5c module snake_case <code>user_service/</code>, <code>classroom/</code> File schema snake_case <code>user.py</code>, <code>role.py</code> File repo/service snake_case <code>user_repo.py</code>, <code>user_service.py</code> <p>\ud83d\udcce N\u1ebfu microservice c\u00f3 nhi\u1ec1u domain (VD: SIS Adapter) \u2192 n\u00ean chia theo module con: <code>app/student/schemas/</code>, <code>app/student/services/</code>, <code>app/student/repositories/</code> Khi \u0111\u00f3, m\u1ed7i module s\u1ebd c\u00f3 th\u01b0 m\u1ee5c <code>services/</code>, <code>schemas/</code> ri\u00eang thay v\u00ec d\u00f9ng th\u01b0 m\u1ee5c c\u1ea5p cao.</p>"},{"location":"dev/backend-dev-guide/#ten-class","title":"\ud83d\udd24 T\u00ean class","text":"Lo\u1ea1i Quy t\u1eafc V\u00ed d\u1ee5 Pydantic schema CamelCase <code>UserCreate</code>, <code>RoleOut</code> Service CamelCase <code>UserService</code>, <code>PermissionService</code> SQLAlchemy model CamelCase <code>User</code>, <code>Classroom</code> Exception CamelCase + <code>Error</code> <code>UserNotFoundError</code>"},{"location":"dev/backend-dev-guide/#at-ten-route-api-path","title":"\ud83c\udf10 \u0110\u1eb7t t\u00ean route (API path)","text":"<ul> <li>Lowercase, n\u1ed1i b\u1eb1ng <code>-</code>, d\u00f9ng danh t\u1eeb</li> <li>Phi\u00ean b\u1ea3n h\u00f3a b\u1eb1ng prefix <code>/v1</code></li> <li>H\u00e0nh \u0111\u1ed9ng th\u1ec3 hi\u1ec7n qua method: GET/POST/PATCH/DELETE</li> </ul> M\u1ee5c ti\u00eau Method Route L\u1ea5y user GET <code>/v1/users/{id}</code> T\u1ea1o m\u1edbi user POST <code>/v1/users</code> C\u1eadp nh\u1eadt user PATCH <code>/v1/users/{id}</code> Xo\u00e1 user DELETE <code>/v1/users/{id}</code>"},{"location":"dev/backend-dev-guide/#ten-bien-ham","title":"\ud83d\udcac T\u00ean bi\u1ebfn &amp; h\u00e0m","text":"<ul> <li>snake_case cho bi\u1ebfn, h\u00e0m, argument</li> <li>T\u00ean n\u00ean r\u00f5 r\u00e0ng, kh\u00f4ng vi\u1ebft t\u1eaft kh\u00f3 hi\u1ec3u</li> </ul> Kh\u00f4ng n\u00ean N\u00ean d\u00f9ng <code>u</code>, <code>res</code> <code>user</code>, <code>response</code> <code>get()</code> <code>get_user_by_id()</code> <code>svc</code> <code>user_service</code> <p>\ud83d\udcce Tham kh\u1ea3o convention PEP8 + Black formatting (auto format \u0111\u01b0\u1ee3c trong CI/CD).</p>"},{"location":"dev/backend-dev-guide/#5-xu-ly-nghiep-vu-usecase-mau","title":"5. X\u1eed l\u00fd nghi\u1ec7p v\u1ee5 &amp; usecase m\u1eabu","text":"<p>T\u1ea7ng Service (Usecase Layer) l\u00e0 n\u01a1i x\u1eed l\u00fd logic nghi\u1ec7p v\u1ee5 ch\u00ednh trong m\u1ed7i service. C\u00e1c class \u1edf t\u1ea7ng n\u00e0y c\u1ea7n \u0111\u1ed9c l\u1eadp v\u1edbi framework (FastAPI, SQLAlchemy...) v\u00e0 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c test \u0111\u01a1n l\u1ebb.</p>"},{"location":"dev/backend-dev-guide/#mot-usecase-mau-cap-nhat-thong-tin-hoc-sinh","title":"\ud83e\udde9 M\u1ed9t usecase m\u1eabu \u2013 C\u1eadp nh\u1eadt th\u00f4ng tin h\u1ecdc sinh","text":"<p>Gi\u1ea3 s\u1eed route PATCH <code>/students/{id}</code> nh\u1eadn th\u00f4ng tin c\u1eadp nh\u1eadt v\u00e0 g\u1ecdi \u0111\u1ebfn t\u1ea7ng Service nh\u01b0 sau:</p>"},{"location":"dev/backend-dev-guide/#1-schema-au-vao-schemasstudentpy","title":"1. Schema \u0111\u1ea7u v\u00e0o (<code>schemas/student.py</code>)","text":"<pre><code>class StudentUpdate(BaseModel):\n    name: Optional[str]\n    birthday: Optional[date]\n</code></pre>"},{"location":"dev/backend-dev-guide/#2-api-handler-apiv1studentpy","title":"2. API Handler (<code>api/v1/student.py</code>)","text":"<pre><code>@router.patch(\\\"/students/{id}\\\", response_model=StudentOut)\ndef update_student(id: UUID, payload: StudentUpdate, svc: StudentService = Depends(get_service)):\n    return svc.update_student(id, payload)\n</code></pre>"},{"location":"dev/backend-dev-guide/#3-service-servicesstudent_servicepy","title":"3. Service (<code>services/student_service.py</code>)","text":"<pre><code>class StudentService:\n    def __init__(self, repo: StudentRepo):\n        self.repo = repo\n\n    def update_student(self, id: UUID, payload: StudentUpdate) -&gt; StudentOut:\n        student = self.repo.get(id)\n        if not student:\n            raise StudentNotFoundError()\n        student.name = payload.name or student.name\n        student.birthday = payload.birthday or student.birthday\n        updated = self.repo.save(student)\n        return StudentOut.from_orm(updated)\n</code></pre>"},{"location":"dev/backend-dev-guide/#4-repository-repositoriesstudent_repopy","title":"4. Repository (<code>repositories/student_repo.py</code>)","text":"<pre><code># repositories/student_repo.py\n\nclass StudentRepo:\n    def __init__(self, session: Session):\n        self.session = session\n\n    def get(self, id: UUID) -&gt; Optional[Student]:\n        return self.session.query(Student).filter(Student.id == id).first()\n\n    def save(self, student: Student) -&gt; Student:\n        self.session.add(student)\n        return student\n</code></pre> <p>\ud83d\udcce Repo ch\u1ec9 n\u00ean th\u1ef1c hi\u1ec7n add() ho\u1eb7c update() v\u00e0 kh\u00f4ng g\u1ecdi commit() \u2013 vi\u1ec7c commit/rollback s\u1ebd \u0111\u01b0\u1ee3c x\u1eed l\u00fd b\u1edfi get_db() ho\u1eb7c unit-of-work \u1edf t\u1ea7ng tr\u00ean.</p>"},{"location":"dev/backend-dev-guide/#ghi-nho-khi-viet-usecase","title":"\u2705 Ghi nh\u1edb khi vi\u1ebft usecase","text":"Y\u00eau c\u1ea7u Gi\u1ea3i th\u00edch Kh\u00f4ng g\u1ecdi tr\u1ef1c ti\u1ebfp DB trong service Lu\u00f4n qua repository Kh\u00f4ng x\u1eed l\u00fd response trong service Service tr\u1ea3 object/data, kh\u00f4ng <code>JSONResponse</code> Kh\u00f4ng raise HTTPException trong service Ch\u1ec9 raise <code>domain error</code>, handler s\u1ebd map sang HTTP code Logic r\u1ebd nh\u00e1nh n\u00ean r\u00f5 r\u00e0ng Tr\u00e1nh if/else l\u1ed3ng qu\u00e1 s\u00e2u"},{"location":"dev/backend-dev-guide/#luu-y-nang-cao-idempotency-cho-usecase-ong-bo","title":"\ud83d\udd01 L\u01b0u \u00fd n\u00e2ng cao: Idempotency cho usecase \u0111\u1ed3ng b\u1ed9","text":"<p>V\u1edbi c\u00e1c API <code>POST</code>, <code>PATCH</code> quan tr\u1ecdng (VD: t\u1ea1o h\u1ee3p \u0111\u1ed3ng, g\u1eedi \u0111\u01a1n), n\u00ean c\u00e2n nh\u1eafc cho ph\u00e9p client g\u1eedi <code>Idempotency-Key</code> \u0111\u1ec3 tr\u00e1nh x\u1eed l\u00fd tr\u00f9ng n\u1ebfu retry. Service layer n\u00ean ki\u1ec3m tra key n\u00e0y tr\u01b0\u1edbc khi ti\u1ebfp t\u1ee5c.</p> <p>\ud83d\udccc N\u1ebfu h\u1ec7 th\u1ed1ng kh\u00f4ng d\u00f9ng Idempotency-Key, c\u00f3 th\u1ec3 d\u1ef1a v\u00e0o unique constraint (VD: email h\u1ecdc sinh) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o g\u1ecdi nhi\u1ec1u l\u1ea7n kh\u00f4ng g\u00e2y l\u1ed7i ho\u1eb7c x\u1eed l\u00fd tr\u00f9ng.</p> <p>\ud83d\udcce Tham kh\u1ea3o m\u1eabu to\u00e0n di\u1ec7n t\u1ea1i: <code>dx-user-service</code></p>"},{"location":"dev/backend-dev-guide/#6-schema-validation-pydantic","title":"6. Schema &amp; validation (Pydantic)","text":"<p>T\u1ea5t c\u1ea3 request/response \u0111\u1ea7u v\u00e0o ra c\u1ee7a API trong dx-vas \u0111\u1ec1u s\u1eed d\u1ee5ng Pydantic schema \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o type safety, validate d\u1eef li\u1ec7u v\u00e0 sinh t\u00e0i li\u1ec7u OpenAPI.</p>"},{"location":"dev/backend-dev-guide/#phan-loai-schema","title":"\ud83d\udce6 Ph\u00e2n lo\u1ea1i schema","text":"M\u1ee5c \u0111\u00edch \u0110\u1eb7t t\u00ean V\u00ed d\u1ee5 Input t\u1eeb request <code>*Create</code>, <code>*Update</code>, <code>*In</code> <code>UserCreate</code>, <code>StudentUpdate</code> Output tr\u1ea3 v\u1ec1 <code>*Out</code>, <code>*Response</code> <code>UserOut</code>, <code>ScoreResponse</code> DB schema (tu\u1ef3 ch\u1ecdn) <code>*DB</code> <code>UserDB</code> Schema n\u1ed9i b\u1ed9 <code>*Payload</code>, <code>*Data</code> <code>NotificationPayload</code>"},{"location":"dev/backend-dev-guide/#vi-du-schema-student","title":"\u2705 V\u00ed d\u1ee5 schema \u2013 Student","text":"<pre><code>class StudentCreate(BaseModel):\n    name: str = Field(..., min_length=2)\n    birthday: date\n    class_id: UUID\n\nclass StudentOut(BaseModel):\n    id: UUID\n    name: str\n    birthday: date\n    class_name: Optional[str]\n</code></pre>"},{"location":"dev/backend-dev-guide/#custom-validator-vi-du","title":"\ud83e\uddea Custom validator v\u00ed d\u1ee5","text":"<pre><code>class StudentCreate(BaseModel):\n    name: str\n    birthday: date\n\n    @validator(\"name\")\n    def validate_name(cls, value):\n        if not value.isalpha():\n            raise ValueError(\"T\u00ean ch\u1ec9 \u0111\u01b0\u1ee3c ch\u1ee9a ch\u1eef c\u00e1i\")\n        return value\n</code></pre> <p>\ud83d\udcce D\u00f9ng @validator khi c\u1ea7n ki\u1ec3m tra ho\u1eb7c chu\u1ea9n h\u00f3a d\u1eef li\u1ec7u \u0111\u1ea7u v\u00e0o \u2013 r\u1ea5t h\u1eefu \u00edch cho rule nghi\u1ec7p v\u1ee5 nh\u01b0 ki\u1ec3m tra \u0111\u1ecbnh d\u1ea1ng m\u00e3 h\u1ecdc sinh, t\u00ean kh\u00f4ng ch\u1ee9a s\u1ed1, v.v.</p>"},{"location":"dev/backend-dev-guide/#luu-y-khi-dung-schema","title":"\u26a0\ufe0f L\u01b0u \u00fd khi d\u00f9ng schema","text":"<ul> <li>D\u00f9ng <code>Field(...)</code> \u0111\u1ec3 validate field r\u00f5 r\u00e0ng</li> <li>Kh\u00f4ng \u0111\u1eb7t default = None n\u1ebfu field b\u1eaft bu\u1ed9c</li> <li>Kh\u00f4ng d\u00f9ng schema output l\u00e0m model DB ho\u1eb7c input</li> <li>Tr\u00e1nh schema qu\u00e1 s\u00e2u/l\u1ed3ng nhau ph\u1ee9c t\u1ea1p \u2013 n\u00ean t\u00e1ch nh\u1ecf</li> <li>N\u1ebfu <code>orm_mode = True</code> \u2192 schema d\u00f9ng \u0111\u01b0\u1ee3c <code>.from_orm(obj)</code></li> </ul>"},{"location":"dev/backend-dev-guide/#tips-nang-cao","title":"\ud83d\udcce Tips n\u00e2ng cao","text":"<ul> <li>C\u00f3 th\u1ec3 k\u1ebf th\u1eeba schema:</li> </ul> <pre><code>class StudentBase(BaseModel):\n    name: str\n    birthday: date\n\nclass StudentCreate(StudentBase):\n    class_id: UUID\n</code></pre> <ul> <li>T\u00e1ch ri\u00eang <code>PaginationMeta</code>, <code>ErrorEnvelope</code>... d\u00f9ng chung to\u00e0n h\u1ec7 th\u1ed1ng t\u1ea1i <code>schemas/common.py</code></li> </ul> <p>\ud83d\udcce N\u1ebfu h\u1ec7 th\u1ed1ng d\u00f9ng camelCase trong JSON response: <pre><code>class Config:\n    alias_generator = lambda s: ''.join(\n        word.capitalize() if i else word for i, word in enumerate(s.split('_'))\n    )\n    allow_population_by_field_name = True\n</code></pre></p> <p>\ud83d\udcce Schema chu\u1ea9n c\u1ee7a to\u00e0n h\u1ec7 th\u1ed1ng \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a t\u1ea1i: <code>dx-service-template/schemas/common.py</code></p>"},{"location":"dev/backend-dev-guide/#7-xu-ly-loi-thong-bao","title":"7. X\u1eed l\u00fd l\u1ed7i &amp; th\u00f4ng b\u00e1o","text":"<p>dx-vas chu\u1ea9n ho\u00e1 c\u01a1 ch\u1ebf x\u1eed l\u00fd l\u1ed7i \u0111\u1ec3 API consistent, d\u1ec5 debug v\u00e0 d\u1ec5 theo d\u00f5i log. M\u1ed7i service \u0111\u1ec1u tr\u1ea3 v\u1ec1 l\u1ed7i theo d\u1ea1ng <code>ErrorEnvelope</code> chu\u1ea9n v\u00e0 s\u1eed d\u1ee5ng exception theo t\u1eebng t\u1ea7ng.</p>"},{"location":"dev/backend-dev-guide/#cau-truc-loi-chuan","title":"\ud83d\udea7 C\u1ea5u tr\u00fac l\u1ed7i chu\u1ea9n","text":"<pre><code>{\n  \"error\": {\n    \"code\": \"USER_NOT_FOUND\",\n    \"message\": \"Ng\u01b0\u1eddi d\u00f9ng kh\u00f4ng t\u1ed3n t\u1ea1i\",\n    \"details\": null\n  },\n  \"meta\": {\n    \"request_id\": \"abc-xyz-123\",\n    \"timestamp\": \"2025-06-01T12:00:00Z\"\n  }\n}\n</code></pre>"},{"location":"dev/backend-dev-guide/#phan-tang-xu-ly-loi","title":"\ud83d\udca2 Ph\u00e2n t\u1ea7ng x\u1eed l\u00fd l\u1ed7i","text":"T\u1ea7ng Lo\u1ea1i exception V\u00ed d\u1ee5 API (router) HTTPException, 422 FastAPI s\u1ebd auto catch Service DomainError <code>UserNotFoundError</code>, <code>InvalidScoreError</code> Repo Optional + catch DB error <code>SQLAlchemyError</code>, rollback"},{"location":"dev/backend-dev-guide/#base-error-dung-chung","title":"\ud83e\uddf1 Base error d\u00f9ng chung","text":"<pre><code>class DomainError(Exception):\n    def __init__(self, code: str, message: str, status_code: int = 400):\n        self.code = code\n        self.message = message\n        self.status_code = status_code\n\n    code = \\\"UNSPECIFIED_ERROR\\\"\n    message = \\\"C\u00f3 l\u1ed7i x\u1ea3y ra\\\"\n\n    def __init__(self, detail=None):\n        self.detail = detail\n\nclass UserNotFoundError(DomainError):\n    code = \\\"USER_NOT_FOUND\\\"\n    message = \\\"Ng\u01b0\u1eddi d\u00f9ng kh\u00f4ng t\u1ed3n t\u1ea1i\\\"\n</code></pre> <p>Trong route handler:</p> <pre><code>try:\n    user = svc.get_user(id)\nexcept DomainError as e:\n    raise HTTPException(status_code=404, detail={\n        \\\"code\\\": e.code,\n        \\\"message\\\": e.message,\n        \\\"details\\\": e.detail\n    })\n</code></pre>"},{"location":"dev/backend-dev-guide/#mapping-loi-ma-http","title":"\ud83d\udd01 Mapping l\u1ed7i \u2192 m\u00e3 HTTP","text":"Domain Error HTTP code <code>NotFoundError</code> 404 <code>ValidationError</code> 400 <code>PermissionDenied</code> 403 <code>Conflict</code> 409 <code>InternalError</code> 500 <p>\u2705 Service kh\u00f4ng \u0111\u01b0\u1ee3c raise <code>HTTPException</code>, m\u00e0 ch\u1ec9 raise domain-level error \ud83d\udccc C\u00f3 th\u1ec3 \u0111\u1ecbnh ngh\u0129a m\u1ed9t global exception handler trong FastAPI \u0111\u1ec3 t\u1ef1 \u0111\u1ed9ng map <code>DomainError</code> sang HTTPException v\u1edbi <code>ErrorEnvelope</code>, gi\u00fap code t\u1ea1i route g\u1ecdn h\u01a1n:</p> <pre><code>@app.exception_handler(DomainError)\ndef handle_domain_error(request: Request, exc: DomainError):\n    return JSONResponse(\n        status_code=exc.status_code,\n        content=ErrorEnvelope(error={\n            \"code\": exc.code,\n            \"message\": exc.message,\n        }).dict()\n    )\n</code></pre> <p>\ud83d\udcce M\u1eabu <code>ErrorEnvelope</code>, <code>BaseError</code> c\u00f3 s\u1eb5n trong: <code>dx-service-template/schemas/common.py</code></p>"},{"location":"dev/backend-dev-guide/#8-repository-truy-xuat-du-lieu","title":"8. Repository &amp; truy xu\u1ea5t d\u1eef li\u1ec7u","text":"<p>Repository l\u00e0 t\u1ea7ng duy nh\u1ea5t t\u01b0\u01a1ng t\u00e1c tr\u1ef1c ti\u1ebfp v\u1edbi c\u01a1 s\u1edf d\u1eef li\u1ec7u. M\u1ee5c ti\u00eau l\u00e0 t\u00e1ch bi\u1ec7t logic nghi\u1ec7p v\u1ee5 kh\u1ecfi chi ti\u1ebft truy v\u1ea5n SQL ho\u1eb7c ORM.</p>"},{"location":"dev/backend-dev-guide/#vai-tro-cua-repository","title":"\ud83d\udce6 Vai tr\u00f2 c\u1ee7a repository","text":"<ul> <li>Qu\u1ea3n l\u00fd session DB (commit, rollback)</li> <li>T\u01b0\u01a1ng t\u00e1c SQLAlchemy model</li> <li>Tr\u1ea3 v\u1ec1 entity/raw data, kh\u00f4ng map sang schema</li> <li>C\u00f3 th\u1ec3 group theo domain (<code>student_repo.py</code>, <code>classroom_repo.py</code>)</li> </ul>"},{"location":"dev/backend-dev-guide/#mau-repository-studentrepo","title":"\ud83e\uddf1 M\u1eabu repository \u2013 StudentRepo","text":"<pre><code>class StudentRepo:\n    def __init__(self, session: Session):\n        self.session = session\n\n    def get_by_id(self, id: UUID) -&gt; Optional[Student]:\n        return self.session.query(Student).filter(Student.id == id).first()\n\n    def create(self, student: Student) -&gt; Student:\n        self.session.add(student)\n        return student\n\n    def update(self, student: Student) -&gt; Student:\n        return student\n\n\n    def list_by_class(self, class_id: UUID) -&gt; List[Student]:\n        return self.session.query(Student).filter(Student.class_id == class_id).all()\n</code></pre>"},{"location":"dev/backend-dev-guide/#luu-y","title":"\ud83e\uddef L\u01b0u \u00fd","text":"Quy t\u1eafc Gi\u1ea3i th\u00edch Kh\u00f4ng tr\u1ea3 v\u1ec1 Pydantic schema Ch\u1ec9 tr\u1ea3 v\u1ec1 SQLAlchemy model Kh\u00f4ng g\u1ecdi schema trong repo Repo kh\u00f4ng bi\u1ebft g\u00ec v\u1ec1 t\u1ea7ng tr\u00ean Lu\u00f4n ki\u1ec3m so\u00e1t session commit Kh\u00f4ng \u0111\u1ec3 service t\u1ef1 commit DB Transaction nhi\u1ec1u b\u01b0\u1edbc \u2192 g\u00f3i l\u1ea1i b\u1eb1ng context ho\u1eb7c unit of work Tr\u00e1nh l\u1ed7i rollback thi\u1ebfu b\u01b0\u1edbc"},{"location":"dev/backend-dev-guide/#tao-session-db","title":"\ud83d\udee0 T\u1ea1o session DB","text":"<pre><code>def get_db() -&gt; Generator:\n    session = SessionLocal()\n    try:\n        yield session\n        session.commit()\n    except:\n        session.rollback()\n        raise\n    finally:\n        session.close()\n</code></pre> <p>Trong service:</p> <pre><code># Trong FastAPI handler\n@router.get(\"/students/{id}\", response_model=StudentOut)\ndef get_student_api_handler(id: UUID, student_svc: StudentService = Depends(get_student_service)):\n    student = student_svc.get_student_by_id(id)\n    if not student:\n        raise StudentNotFoundError()\n    return StudentOut.from_orm(student)\n</code></pre> <p>\ud83d\udcce StudentService v\u00e0 StudentRepo n\u00ean \u0111\u01b0\u1ee3c kh\u1edfi t\u1ea1o th\u00f4ng qua DI \u2013 ho\u1eb7c th\u00f4ng qua h\u00e0m get_student_service() nh\u01b0 m\u00f4 t\u1ea3 \u1edf M\u1ee5c 3.</p> <p>\ud83d\udcce DB schema \u2192 xem <code>models/student.py</code></p> <p>\ud83d\udcce C\u1ea5u h\u00ecnh DB trong <code>core/config.py</code>, session \u1edf <code>deps.py</code></p>"},{"location":"dev/backend-dev-guide/#9-pubsub-subscriber-idempotency","title":"9. Pub/Sub subscriber &amp; idempotency","text":"<p>M\u1ed9t s\u1ed1 service backend c\u1ee7a dx-vas ho\u1ea1t \u0111\u1ed9ng theo m\u00f4 h\u00ecnh event-driven \u2013 ngh\u0129a l\u00e0 nh\u1eadn s\u1ef1 ki\u1ec7n t\u1eeb c\u00e1c topic Pub/Sub v\u00e0 x\u1eed l\u00fd b\u1ea5t \u0111\u1ed3ng b\u1ed9. Vi\u1ec7c \u0111\u1ea3m b\u1ea3o idempotency (x\u1eed l\u00fd l\u1eb7p l\u1ea1i kh\u00f4ng g\u00e2y l\u1ed7i) l\u00e0 b\u1eaft bu\u1ed9c.</p>"},{"location":"dev/backend-dev-guide/#cau-truc-thu-muc-goi-y","title":"\ud83d\udce6 C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c g\u1ee3i \u00fd","text":"<pre><code>events/\n\u251c\u2500\u2500 subscriber/\n\u2502   \u2514\u2500\u2500 user\\_event\\_handler.py\n\u251c\u2500\u2500 publisher/\n\u2502   \u2514\u2500\u2500 notify\\_event.py\n</code></pre>"},{"location":"dev/backend-dev-guide/#viet-mot-subscriber-handler","title":"\ud83d\udce5 Vi\u1ebft m\u1ed9t subscriber handler","text":"<p>\ud83d\udcce Schema b\u1ea3ng <code>processed_messages</code>: <pre><code>CREATE TABLE processed_messages (\n  message_id VARCHAR(255) PRIMARY KEY,\n  processed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  status VARCHAR(50) DEFAULT 'success'\n);\n</code></pre></p> <pre><code>def handle_user_created(message: PubSubMessage):\n    db_session_event = SessionLocal()\n    try:\n        repo = UserRepo(db_session_event)\n        data = json.loads(message.data.decode(\"utf-8\"))\n        user_id = data[\"user_id\"]\n\n        if repo.has_processed(message.message_id):\n            return\n\n        user = repo.get(user_id)\n        if not user:\n            raise UserNotFoundError()\n\n        # ... x\u1eed l\u00fd s\u1ef1 ki\u1ec7n ...\n\n        repo.mark_processed(message.message_id)\n        db_session_event.commit()\n    except Exception:\n        db_session_event.rollback()\n        raise\n    finally:\n        db_session_event.close()\n</code></pre> <p>\u2705 S\u1eed d\u1ee5ng SessionLocal() ri\u00eang cho background worker, \u0111\u1ea3m b\u1ea3o qu\u1ea3n l\u00fd transaction t\u00e1ch bi\u1ec7t v\u1edbi request.</p>"},{"location":"dev/backend-dev-guide/#idempotency-cach-am-bao","title":"\ud83e\uddea Idempotency: c\u00e1ch \u0111\u1ea3m b\u1ea3o","text":"K\u1ef9 thu\u1eadt Ghi ch\u00fa Ghi log message \u0111\u00e3 x\u1eed l\u00fd T\u1ea1o b\u1ea3ng <code>processed_messages(message_id)</code> Tr\u00e1nh logic g\u00e2y side effect nhi\u1ec1u l\u1ea7n G\u1eedi noti 1 l\u1ea7n, t\u1ea1o record 1 l\u1ea7n Transaction to\u00e0n b\u1ed9 handler Commit/rollback to\u00e0n ph\u1ea7n Retry-safe N\u1ebfu l\u1ed7i do m\u1ea1ng \u2192 message s\u1ebd \u0111\u01b0\u1ee3c retry"},{"location":"dev/backend-dev-guide/#framework-ho-tro","title":"\ud83e\udded Framework h\u1ed7 tr\u1ee3","text":"<ul> <li>Google Pub/Sub client (<code>google-cloud-pubsub</code>)</li> <li>Wrapper: <code>pubsub_fastapi</code>, <code>pubsub-consumer</code> custom</li> <li>C\u00f3 th\u1ec3 t\u00edch h\u1ee3p v\u00e0o background task trong <code>main.py</code></li> </ul>"},{"location":"dev/backend-dev-guide/#cleanup","title":"\ud83e\uddfc Cleanup","text":"<ul> <li>D\u00f9ng TTL ho\u1eb7c cronjob \u0111\u1ec3 xo\u00e1 b\u1ea3n ghi <code>processed_messages</code> c\u0169</li> <li>C\u00f3 th\u1ec3 d\u00f9ng Redis thay DB n\u1ebfu c\u1ea7n t\u1ed1c \u0111\u1ed9 cao v\u00e0 l\u01b0u ng\u1eafn h\u1ea1n</li> </ul> <p>\ud83d\udcce M\u1eabu event flow: System Diagrams</p> <p>\ud83d\udcce Quy \u01b0\u1edbc Pub/Sub topic: Dev Ops Guide</p>"},{"location":"dev/backend-dev-guide/#10-test-on-vi-tich-hop","title":"10. Test \u0111\u01a1n v\u1ecb &amp; t\u00edch h\u1ee3p","text":"<p>Vi\u1ebft test l\u00e0 b\u1eaft bu\u1ed9c trong m\u1ed7i backend service. dx-vas \u01b0u ti\u00ean unit test cho service layer v\u00e0 integration test cho route + DB + Pub/Sub.</p>"},{"location":"dev/backend-dev-guide/#cau-truc-thu-muc-test","title":"\ud83e\uddea C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c test","text":"<pre><code>tests/\n\u251c\u2500\u2500 unit/\n\u2502   \u2514\u2500\u2500 test\\_user\\_service.py\n\u251c\u2500\u2500 integration/\n\u2502   \u251c\u2500\u2500 test\\_user\\_routes.py\n\u2502   \u2514\u2500\u2500 test\\_pubsub\\_event.py\n\u251c\u2500\u2500 conftest.py\n</code></pre>"},{"location":"dev/backend-dev-guide/#unit-test-service-khong-phu-thuoc-db","title":"\u2705 Unit test \u2013 Service kh\u00f4ng ph\u1ee5 thu\u1ed9c DB","text":"<pre><code>def test_get_user_success():\n    fake_repo = MagicMock()\n    fake_repo.get.return_value = User(id=1, name=\\\"John\\\")\n\n    svc = UserService(fake_repo)\n    result = svc.get_user(1)\n\n    assert result.name == \\\"John\\\"\n</code></pre> <ul> <li>D\u00f9ng <code>MagicMock</code> \u0111\u1ec3 m\u00f4 ph\u1ecfng repository</li> <li>Kh\u00f4ng c\u1ea7n DB ho\u1eb7c HTTP client</li> <li>Ch\u1ea1y nhanh, d\u1ec5 debug</li> </ul>"},{"location":"dev/backend-dev-guide/#integration-test-route-db","title":"\ud83d\udd01 Integration test \u2013 Route + DB","text":"<pre><code>def test_create_user(client, db_session):\n    payload = {\\\"name\\\": \\\"John\\\"}\n    response = client.post(\\\"/v1/users\\\", json=payload)\n    assert response.status_code == 201\n</code></pre> <ul> <li>D\u00f9ng <code>TestClient</code> c\u1ee7a FastAPI + session test DB</li> <li>C\u00f3 th\u1ec3 seed d\u1eef li\u1ec7u b\u1eb1ng fixture</li> </ul>"},{"location":"dev/backend-dev-guide/#pytest-fixture-goi-y-conftestpy","title":"\ud83e\udde9 Pytest fixture g\u1ee3i \u00fd (<code>conftest.py</code>)","text":"<pre><code>@pytest.fixture\ndef db_session():\n    session = SessionLocal()\n    yield session\n    session.rollback()\n    session.close()\n\n@pytest.fixture\ndef client():\n    from app.main import app\n    return TestClient(app)\n</code></pre>"},{"location":"dev/backend-dev-guide/#luu-y-khi-viet-test","title":"\ud83d\udca1 L\u01b0u \u00fd khi vi\u1ebft test","text":"Nguy\u00ean t\u1eafc Gi\u1ea3i th\u00edch T\u00ean test r\u00f5 r\u00e0ng <code>test_create_user_fail_invalid_email()</code> Test kh\u00f4ng ph\u1ee5 thu\u1ed9c nhau Kh\u00f4ng d\u00f9ng shared global state Bao ph\u1ee7 logic r\u1ebd nh\u00e1nh Test success, fail, edge case Mock \u0111\u00fang ch\u1ed7 Repo, API external, Pub/Sub client <ul> <li>C\u00f3 th\u1ec3 d\u00f9ng <code>pytest-mock</code> ho\u1eb7c <code>unittest.mock</code> \u0111\u1ec3 mock nhanh logic ph\u1ee5 thu\u1ed9c (Pub/Sub, Redis)</li> <li>\u0110\u1ed1i v\u1edbi integration test:</li> <li>D\u00f9ng Alembic \u0111\u1ec3 apply schema l\u00ean test DB (ho\u1eb7c t\u1ea1o file <code>.sql</code>)</li> <li>Seed data m\u1eabu b\u1eb1ng fixture (VD: 1 h\u1ecdc sinh, 1 l\u1edbp h\u1ecdc)</li> <li>Rollback sau m\u1ed7i test \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o isolation</li> </ul> <p>\ud83d\udcce Coverage t\u1ed1i thi\u1ec3u y\u00eau c\u1ea7u: 85% cho unit, 70% cho integration \ud83d\udcce L\u1ec7nh test m\u1eabu:</p> <pre><code>make test\npytest tests/unit/\npytest --cov=app\n</code></pre>"},{"location":"dev/backend-dev-guide/#11-checklist-khi-tao-pr-backend","title":"11. Checklist khi t\u1ea1o PR backend","text":"<p>M\u1ed7i Pull Request (PR) backend trong dx-vas c\u1ea7n tu\u00e2n theo checklist sau \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o ch\u1ea5t l\u01b0\u1ee3ng, t\u00ednh nh\u1ea5t qu\u00e1n v\u00e0 tr\u00e1nh l\u1ed7i khi merge v\u00e0o nh\u00e1nh ch\u00ednh.</p>"},{"location":"dev/backend-dev-guide/#checklist-ky-thuat","title":"\u2705 Checklist k\u1ef9 thu\u1eadt","text":"<ul> <li> T\u00ean PR r\u00f5 r\u00e0ng, theo format: <code>[feature] Add create student usecase</code></li> <li> Code \u0111\u00e3 format b\u1eb1ng Black / isort / lint pass</li> <li> \u0110\u00e3 th\u00eam unit test cho logic nghi\u1ec7p v\u1ee5</li> <li> \u0110\u00e3 th\u00eam integration test cho API / DB / PubSub</li> <li> \u0110\u1ea3m b\u1ea3o test pass (<code>make test</code>, CI green)</li> <li> Kh\u00f4ng commit <code>.env</code>, file secret ho\u1eb7c credential</li> <li> Kh\u00f4ng hardcode config, API key trong code</li> <li> Schema \u0111\u1ea7u v\u00e0o c\u00f3 validate \u0111\u1ea7y \u0111\u1ee7 (Pydantic)</li> <li> Error tr\u1ea3 v\u1ec1 \u0111\u00fang <code>ErrorEnvelope</code> chu\u1ea9n</li> </ul>"},{"location":"dev/backend-dev-guide/#checklist-logic-nghiep-vu","title":"\ud83d\udcce Checklist logic nghi\u1ec7p v\u1ee5","text":"<ul> <li> N\u1ebfu c\u00f3 s\u1eeda DB \u2192 \u0111\u00e3 vi\u1ebft migration</li> <li> N\u1ebfu th\u00eam permission \u2192 c\u1eadp nh\u1eadt file RBAC <code>permissions.yaml</code>     \ud83d\udcce Xem c\u00e1ch \u0111\u1ecbnh ngh\u0129a permission t\u1ea1i RBAC Deep Dive</li> <li> N\u1ebfu thay \u0111\u1ed5i API \u2192 c\u1eadp nh\u1eadt OpenAPI / Interface Contracts</li> <li> N\u1ebfu \u1ea3nh h\u01b0\u1edfng cross-service \u2192 \u0111\u00e3 th\u00f4ng b\u00e1o/ghi ch\u00fa r\u00f5</li> <li> N\u1ebfu c\u1ea7n sync d\u1eef li\u1ec7u \u2192 vi\u1ebft r\u00f5 flow trong commit message</li> </ul>"},{"location":"dev/backend-dev-guide/#goi-y-review","title":"\ud83d\udd0d G\u1ee3i \u00fd review","text":"<ul> <li>Xem flow t\u1eeb API \u2192 Service \u2192 Repo \u2192 Test</li> <li>Xem logging c\u00f3 \u0111\u00fang c\u1ea5p \u0111\u1ed9, kh\u00f4ng log sensitive</li> <li>Xem logic r\u1ebd nh\u00e1nh \u0111\u1ea7y \u0111\u1ee7 ch\u01b0a (success, fail, edge case)</li> <li>Comment r\u00f5 TODO n\u1ebfu c\u00f2n d\u1edf dang (v\u00e0 ghi task follow-up)</li> </ul> <p>\ud83d\udcce Format commit message \u2192 xem Dev Guide  </p> <p>\ud83d\udcce Qu\u1ea3n l\u00fd permission \u2192 xem RBAC Deep Dive  </p> <p>\ud83d\udcce Migration &amp; version DB \u2192 xem Dev Ops Guide m\u1ee5c 7</p>"},{"location":"dev/backend-dev-guide/#12-tai-lieu-lien-quan","title":"12. T\u00e0i li\u1ec7u li\u00ean quan","text":"<p>D\u01b0\u1edbi \u0111\u00e2y l\u00e0 c\u00e1c t\u00e0i li\u1ec7u n\u1ed9i b\u1ed9 h\u1ed7 tr\u1ee3 cho qu\u00e1 tr\u00ecnh ph\u00e1t tri\u1ec3n backend trong h\u1ec7 th\u1ed1ng dx-vas. Developer n\u00ean tham kh\u1ea3o \u0111\u1ea7y \u0111\u1ee7 \u0111\u1ec3 n\u1eafm \u0111\u01b0\u1ee3c to\u00e0n b\u1ed9 b\u1ee9c tranh ki\u1ebfn tr\u00fac, quy tr\u00ecnh CI/CD, RBAC, interface contracts, v\u00e0 v\u1eadn h\u00e0nh.</p>"},{"location":"dev/backend-dev-guide/#tai-lieu-kien-truc-luong-he-thong","title":"\ud83d\udcda T\u00e0i li\u1ec7u ki\u1ebfn tr\u00fac &amp; lu\u1ed3ng h\u1ec7 th\u1ed1ng","text":"T\u00e0i li\u1ec7u M\u1ee5c ti\u00eau System Diagrams T\u1ed5ng quan ki\u1ebfn tr\u00fac, s\u01a1 \u0111\u1ed3 c\u00e1c lu\u1ed3ng nghi\u1ec7p v\u1ee5 RBAC Deep Dive Ki\u1ebfn tr\u00fac RBAC \u0111\u1ed9ng, JSONB, ph\u00e2n quy\u1ec1n &amp; cache Interface Contracts \u0110\u1ecbnh ngh\u0129a OpenAPI + schema li\u00ean service"},{"location":"dev/backend-dev-guide/#dev-guide-cicd","title":"\ud83e\uddea Dev Guide &amp; CI/CD","text":"T\u00e0i li\u1ec7u M\u1ee5c ti\u00eau Dev Guide H\u01b0\u1edbng d\u1eabn CI/CD, test, lint, docker h\u00f3a, PR flow Dev Ops Guide H\u01b0\u1edbng d\u1eabn v\u1eadn h\u00e0nh: Cloud Run, Redis, Pub/Sub ADR Index Danh s\u00e1ch c\u00e1c quy\u1ebft \u0111\u1ecbnh ki\u1ebfn tr\u00fac quan tr\u1ecdng"},{"location":"dev/backend-dev-guide/#service-template-example","title":"\ud83d\udee0 Service template &amp; example","text":"Repo Vai tr\u00f2 <code>dx-service-template</code> M\u1eabu service chu\u1ea9n (FastAPI, pubsub, test, CI) <code>dx-user-service</code> Tri\u1ec3n khai m\u1eabu: RBAC, JWT, user CRUD <code>dx-notification-service</code> G\u1eedi th\u00f4ng b\u00e1o Web/Zalo/Email, Pub/Sub event-driven <p>\ud83d\udcce Developer m\u1edbi n\u00ean \u0111\u1ecdc theo th\u1ee9 t\u1ef1:</p> <ol> <li><code>backend-dev-guide.md</code> (t\u00e0i li\u1ec7u n\u00e0y)</li> <li>System Diagrams \u2192 RBAC Deep Dive</li> <li>Dev Guide \u2192 Dev Ops Guide</li> </ol>"},{"location":"dev/backend-dev-guide/#13-logging-best-practices","title":"13. Logging Best Practices","text":"<p>H\u1ec7 th\u1ed1ng n\u00ean s\u1eed d\u1ee5ng logging chu\u1ea9n v\u1edbi c\u00e1c nguy\u00ean t\u1eafc sau \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o kh\u1ea3 n\u0103ng gi\u00e1m s\u00e1t v\u00e0 trace d\u1ec5 d\u00e0ng:</p>"},{"location":"dev/backend-dev-guide/#cap-o-log","title":"\ud83d\udd0d C\u1ea5p \u0111\u1ed9 log","text":"Level M\u1ee5c \u0111\u00edch DEBUG Chi ti\u1ebft k\u1ef9 thu\u1eadt \u0111\u1ec3 debug (kh\u00f4ng log \u1edf production) INFO B\u01b0\u1edbc x\u1eed l\u00fd ch\u00ednh, h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng WARNING B\u1ea5t th\u01b0\u1eddng kh\u00f4ng g\u00e2y l\u1ed7i ERROR L\u1ed7i nghi\u00eam tr\u1ecdng, n\u00ean c\u00f3 traceback"},{"location":"dev/backend-dev-guide/#cau-truc-log","title":"\ud83d\udce6 C\u1ea5u tr\u00fac log","text":"<ul> <li>D\u00f9ng structured log (JSON format) \u2192 d\u1ec5 t\u00edch h\u1ee3p v\u1edbi Cloud Logging</li> <li>Bao g\u1ed3m <code>request_id</code>, <code>user_id</code> n\u1ebfu c\u00f3 th\u1ec3</li> <li>Log theo trace-id n\u1ebfu d\u00f9ng OpenTelemetry ho\u1eb7c t\u01b0\u01a1ng t\u1ef1</li> </ul>"},{"location":"dev/backend-dev-guide/#goi-y-log-theo-tang","title":"\ud83e\udded G\u1ee3i \u00fd log theo t\u1ea7ng","text":"T\u1ea7ng Log g\u00ec Handler B\u1eaft \u0111\u1ea7u/k\u1ebft th\u00fac x\u1eed l\u00fd request, input Service B\u01b0\u1edbc nghi\u1ec7p v\u1ee5 quan tr\u1ecdng, \u0111i\u1ec1u ki\u1ec7n ph\u00e2n nh\u00e1nh Repo Truy v\u1ea5n \u0111\u1eb7c bi\u1ec7t ho\u1eb7c l\u1ed7i DB <p>\ud83d\udcce Kh\u00f4ng log d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m (password, token, email h\u1ecdc sinh...)</p>"},{"location":"dev/backend-dev-guide/#14-security-considerations-can-nhac-bao-mat-cho-backend","title":"14. Security Considerations \u2013 C\u00e2n nh\u1eafc b\u1ea3o m\u1eadt cho Backend","text":""},{"location":"dev/backend-dev-guide/#nguyen-tac-cot-loi_1","title":"\ud83d\udd10 Nguy\u00ean t\u1eafc c\u1ed1t l\u00f5i","text":"<ul> <li>Security by Design: B\u1ea3o m\u1eadt kh\u00f4ng ph\u1ea3i l\u00e0 t\u00ednh n\u0103ng ph\u1ee5 tr\u1ee3 \u2013 n\u00f3 ph\u1ea3i \u0111\u01b0\u1ee3c t\u00edch h\u1ee3p ngay t\u1eeb ki\u1ebfn tr\u00fac v\u00e0 quy tr\u00ecnh ph\u00e1t tri\u1ec3n.</li> <li>Zero Trust: Kh\u00f4ng gi\u1ea3 \u0111\u1ecbnh b\u1ea5t k\u1ef3 ngu\u1ed3n d\u1eef li\u1ec7u n\u00e0o l\u00e0 an to\u00e0n, k\u1ec3 c\u1ea3 t\u1eeb n\u1ed9i b\u1ed9.</li> </ul>"},{"location":"dev/backend-dev-guide/#input-validation-sanity-check","title":"\ud83e\uddea Input validation &amp; Sanity Check","text":"<ul> <li>Lu\u00f4n d\u00f9ng Pydantic Schema \u0111\u1ec3 ki\u1ec3m so\u00e1t input cho API &amp; Pub/Sub.</li> <li>Validation b\u1ed5 sung \u1edf t\u1ea7ng Service n\u1ebfu logic ph\u1ee9c t\u1ea1p h\u01a1n (v\u00ed d\u1ee5: ch\u1ec9 gi\u00e1o vi\u00ean ch\u1ee7 nhi\u1ec7m m\u1edbi s\u1eeda \u0111i\u1ec3m).</li> <li>Kh\u00f4ng tin t\u01b0\u1edfng payload n\u1ed9i b\u1ed9 \u2013 kh\u00f4ng \u0111\u01b0\u1ee3c skip validation khi nh\u1eadn request t\u1eeb API Gateway ho\u1eb7c t\u1eeb event Pub/Sub.</li> </ul>"},{"location":"dev/backend-dev-guide/#quan-ly-secret-cau-hinh-an-toan","title":"\ud83d\udd10 Qu\u1ea3n l\u00fd secret &amp; c\u1ea5u h\u00ecnh an to\u00e0n","text":"<ul> <li>Kh\u00f4ng bao gi\u1edd commit file <code>.env</code> ho\u1eb7c bi\u1ebfn m\u00f4i tr\u01b0\u1eddng ch\u1ee9a token, DB URL, v.v.</li> <li>Secrets n\u00ean \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd qua:</li> <li>Google Secret Manager (ho\u1eb7c <code>doppler</code>, <code>Vault</code> n\u1ebfu d\u00f9ng self-hosted)</li> <li>Inject v\u00e0o m\u00f4i tr\u01b0\u1eddng Cloud Run qua <code>env var</code> ho\u1eb7c <code>mount volume</code></li> <li>T\u00e1ch bi\u1ec7t <code>config.py</code> ch\u1ee9a bi\u1ebfn c\u00f4ng khai v\u00e0 <code>env var</code> ch\u1ee9a th\u00f4ng tin nh\u1ea1y c\u1ea3m.</li> </ul>"},{"location":"dev/backend-dev-guide/#token-phan-quyen","title":"\ud83d\udce6 Token &amp; ph\u00e2n quy\u1ec1n","text":"<ul> <li>Kh\u00f4ng decode token JWT t\u1ea1i backend n\u1ebfu \u0111\u00e3 c\u00f3 API Gateway ki\u1ec3m tra r\u1ed3i \u2013 thay v\u00e0o \u0111\u00f3:</li> <li>Tin t\u01b0\u1edfng <code>X-User-ID</code>, <code>X-User-Role</code>, <code>X-Permissions</code> \u0111\u01b0\u1ee3c Gateway g\u1eafn v\u00e0o header \u0111\u00e3 \u0111\u01b0\u1ee3c k\u00fd (<code>X-Signature</code>)</li> <li>Kh\u00f4ng d\u00f9ng token client-side tr\u1ef1c ti\u1ebfp g\u1ecdi v\u00e0o backend \u2013 m\u1ecdi truy c\u1eadp b\u1eaft bu\u1ed9c qua Gateway.</li> </ul>"},{"location":"dev/backend-dev-guide/#owasp-api-security-cac-lo-hong-can-e-phong","title":"\ud83d\udcdb OWASP API Security \u2013 C\u00e1c l\u1ed7 h\u1ed5ng c\u1ea7n \u0111\u1ec1 ph\u00f2ng","text":"V\u1ea5n \u0111\u1ec1 Bi\u1ec7n ph\u00e1p Injection D\u00f9ng ORM (SQLAlchemy), tr\u00e1nh query raw n\u1ebfu kh\u00f4ng escape Broken Auth Kh\u00f4ng d\u00f9ng x\u00e1c th\u1ef1c ri\u00eang t\u1ea1i backend \u2013 ch\u1ec9 ki\u1ec3m tra ph\u00e2n quy\u1ec1n Excessive Data Exposure D\u00f9ng <code>response_model</code> \u0111\u1ec3 gi\u1edbi h\u1ea1n d\u1eef li\u1ec7u tr\u1ea3 ra Improper Asset Mgmt Kh\u00f4ng expose <code>/docs</code>, <code>/openapi.json</code> tr\u00ean production Lack of Rate Limit \u0110\u00e3 x\u1eed l\u00fd \u1edf API Gateway, nh\u01b0ng v\u1eabn c\u1ea7n audit log local"},{"location":"dev/backend-dev-guide/#logging-auditing","title":"\ud83e\uddef Logging &amp; Auditing","text":"<ul> <li>Kh\u00f4ng log d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m (email h\u1ecdc sinh, m\u00e3 OTP, token).</li> <li>Lu\u00f4n log <code>request_id</code>, <code>user_id</code>, <code>endpoint</code>, v\u00e0 <code>status</code>.</li> <li>Xem th\u00eam ph\u1ea7n <code>13. Logging Best Practices</code></li> </ul> <p>\ud83d\udccc Xem th\u00eam ch\u00ednh s\u00e1ch b\u1ea3o m\u1eadt to\u00e0n h\u1ec7 th\u1ed1ng t\u1ea1i ADR: <code>adr-004-security.md</code></p>"},{"location":"dev/backend-dev-guide/#15-performance-tips-toi-uu-hieu-nang-backend","title":"15. Performance Tips \u2013 T\u1ed1i \u01b0u hi\u1ec7u n\u0103ng Backend","text":"<p>Hi\u1ec7u n\u0103ng h\u1ec7 th\u1ed1ng kh\u00f4ng ch\u1ec9 ph\u1ee5 thu\u1ed9c v\u00e0o h\u1ea1 t\u1ea7ng m\u00e0 c\u00f2n b\u1ecb \u1ea3nh h\u01b0\u1edfng tr\u1ef1c ti\u1ebfp b\u1edfi c\u00e1ch vi\u1ebft code \u1edf t\u1ea7ng service v\u00e0 repository.</p>"},{"location":"dev/backend-dev-guide/#truy-van-db-hieu-qua","title":"\ud83d\udce5 Truy v\u1ea5n DB hi\u1ec7u qu\u1ea3","text":"M\u1eb9o Ghi ch\u00fa D\u00f9ng <code>.limit()</code> thay v\u00ec <code>.all()</code> n\u1ebfu d\u1eef li\u1ec7u nhi\u1ec1u Tr\u00e1nh load to\u00e0n b\u1ed9 b\u1ea3ng v\u00e0o RAM D\u00f9ng <code>selectinload()</code> ho\u1eb7c <code>joinedload()</code> khi c\u1ea7n truy c\u1eadp nhi\u1ec1u b\u1ea3n ghi li\u00ean quan Tr\u00e1nh N+1 query Tr\u00e1nh <code>.count()</code> trong b\u1ea3ng l\u1edbn N\u1ebfu c\u00f3 th\u1ec3, d\u00f9ng limit + exists/check T\u00e1ch c\u00e1c truy v\u1ea5n ph\u00e2n t\u00edch/ph\u1ee9c t\u1ea1p ra background Tr\u00e1nh block API request"},{"location":"dev/backend-dev-guide/#caching-neu-can-thiet","title":"\ud83d\udce4 Caching n\u1ebfu c\u1ea7n thi\u1ebft","text":"<ul> <li>Kh\u00f4ng n\u00ean cache s\u1edbm \u2013 ch\u1ec9 cache khi th\u1ea5y r\u00f5 bottleneck</li> <li>\u01afu ti\u00ean cache k\u1ebft qu\u1ea3 <code>read-only</code> (VD: danh s\u00e1ch ng\u00e0nh h\u1ecdc)</li> <li>D\u00f9ng Redis ho\u1eb7c local in-memory cache (VD: <code>lru_cache</code>) n\u1ebfu ph\u00f9 h\u1ee3p</li> <li>C\u1ea9n tr\u1ecdng v\u1edbi cache invalidation n\u1ebfu d\u1eef li\u1ec7u th\u01b0\u1eddng xuy\u00ean thay \u0111\u1ed5i</li> </ul>"},{"location":"dev/backend-dev-guide/#toi-uu-luong-xu-ly","title":"\ud83e\ude84 T\u1ed1i \u01b0u lu\u1ed3ng x\u1eed l\u00fd","text":"K\u1ef9 thu\u1eadt D\u00f9ng khi n\u00e0o <code>BackgroundTasks</code> (FastAPI) G\u1eedi email, sync webhook, audit, log external <code>Pub/Sub</code> ho\u1eb7c message queue T\u00e1ch c\u00e1c h\u00e0nh \u0111\u1ed9ng kh\u00f4ng c\u1ea7n blocking user Batch insert/update N\u1ebfu c\u1ea7n ghi h\u00e0ng lo\u1ea1t (VD: \u0111i\u1ec3m h\u1ecdc sinh)"},{"location":"dev/backend-dev-guide/#giam-thieu-io-blocking","title":"\ud83e\uddee Gi\u1ea3m thi\u1ec3u I/O Blocking","text":"<ul> <li>Lu\u00f4n d\u00f9ng <code>async def</code> \u1edf API handler n\u1ebfu g\u1ecdi I/O (DB, HTTP)</li> <li>Tr\u00e1nh c\u00e1c blocking call trong async context (VD: <code>requests.get()</code> \u2192 d\u00f9ng <code>httpx.AsyncClient</code>)</li> </ul>"},{"location":"dev/backend-dev-guide/#o-luong-va-theo-doi","title":"\ud83e\uddea \u0110o l\u01b0\u1eddng v\u00e0 theo d\u00f5i","text":"<ul> <li>D\u00f9ng <code>OpenTelemetry</code> \u0111\u1ec3 trace request &amp; \u0111o th\u1eddi gian x\u1eed l\u00fd t\u1eebng t\u1ea7ng</li> <li>\u0110o <code>latency</code> v\u00e0 <code>throughput</code> theo t\u1eebng API</li> <li>Gi\u00e1m s\u00e1t s\u1ed1 l\u01b0\u1ee3ng request l\u1ed7i (5xx), timeout, v\u00e0 retry qua c\u00e1c bi\u1ec3u \u0111\u1ed3 Cloud Monitoring</li> </ul> <p>\ud83d\udccc Xem th\u00eam c\u1ea5u tr\u00fac log v\u00e0 trace t\u1ea1i M\u1ee5c <code>13. Logging</code> v\u00e0 c\u1ea5u h\u00ecnh h\u1ea1 t\u1ea7ng t\u1ea1i Dev Ops Guide</p> <p>\ud83d\udcce Developer m\u1edbi n\u00ean \u0111\u1ecdc theo th\u1ee9 t\u1ef1:</p> <ol> <li><code>backend-dev-guide.md</code> (t\u00e0i li\u1ec7u n\u00e0y)</li> <li>System Diagrams \u2192 RBAC Deep Dive</li> <li>Dev Guide \u2192 Dev Ops Guide</li> </ol>"},{"location":"dev/dev-guide/","title":"\ud83d\udcd8 Dev Guide \u2013 dx-vas","text":"<p>T\u00e0i li\u1ec7u n\u00e0y cung c\u1ea5p h\u01b0\u1edbng d\u1eabn ph\u00e1t tri\u1ec3n h\u1ec7 th\u1ed1ng dx-vas cho to\u00e0n b\u1ed9 \u0111\u1ed9i ng\u0169 k\u1ef9 thu\u1eadt. Bao g\u1ed3m c\u00e1ch c\u00e0i \u0111\u1eb7t m\u00f4i tr\u01b0\u1eddng, quy \u01b0\u1edbc code, c\u1ea5u tr\u00fac d\u1ecbch v\u1ee5, qu\u1ea3n l\u00fd RBAC, CI/CD, v\u00e0 c\u00e1c quy tr\u00ecnh v\u1eadn h\u00e0nh li\u00ean quan.</p>"},{"location":"dev/dev-guide/#muc-luc","title":"M\u1ee5c l\u1ee5c","text":"<ol> <li>Gi\u1edbi thi\u1ec7u t\u1ed5ng quan</li> <li>C\u00e0i \u0111\u1eb7t m\u00f4i tr\u01b0\u1eddng ph\u00e1t tri\u1ec3n</li> <li>C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c &amp; d\u1ecbch v\u1ee5</li> <li>Quy \u01b0\u1edbc vi\u1ebft m\u00e3 &amp; Coding Style</li> <li>RBAC \u2013 Ph\u00e2n quy\u1ec1n \u0111\u1ed9ng</li> <li>Thi\u1ebft k\u1ebf API &amp; OpenAPI</li> <li>G\u1eedi th\u00f4ng b\u00e1o (Notification)</li> <li>Quy tr\u00ecnh test &amp; CI/CD</li> <li>Migration &amp; Qu\u1ea3n l\u00fd c\u01a1 s\u1edf d\u1eef li\u1ec7u</li> <li>Quy tr\u00ecnh pull request &amp; review</li> <li>Theo d\u00f5i &amp; v\u1eadn h\u00e0nh</li> <li>Troubleshooting \u2013 L\u1ed7i th\u01b0\u1eddng g\u1eb7p</li> </ol>"},{"location":"dev/dev-guide/#1-gioi-thieu-tong-quan","title":"1. Gi\u1edbi thi\u1ec7u t\u1ed5ng quan","text":"<ul> <li> <p>T\u00e0i li\u1ec7u k\u1ef9 thu\u1eadt v\u00e0 h\u01b0\u1edbng d\u1eabn \u0111\u01b0\u1ee3c \u0111\u1eb7t t\u1ea1i repo <code>dx-vas</code>, \u0111\u00f3ng vai tr\u00f2 nh\u01b0 repo \u0111i\u1ec1u ph\u1ed1i trung t\u00e2m, ch\u1ee9a t\u00e0i li\u1ec7u h\u1ec7 th\u1ed1ng, s\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac, ADR, IC v\u00e0 Dev Guide. H\u1ec7 th\u1ed1ng dx-vas bao g\u1ed3m c\u00e1c th\u00e0nh ph\u1ea7n:</p> </li> <li> <p>API Gateway (FastAPI)</p> </li> <li>Core Services: Auth Service, User Service, Notification Service</li> <li>Business Adapters: CRM Adapter, SIS Adapter, LMS Adapter</li> <li>C\u00e1c th\u00e0nh ph\u1ea7n h\u1ea1 t\u1ea7ng: Redis, PostgreSQL, MySQL, Pub/Sub, GCS</li> <li>Ki\u1ebfn tr\u00fac microservices, t\u1ea5t c\u1ea3 tri\u1ec3n khai tr\u00ean Google Cloud Run</li> <li>M\u1ecdi truy c\u1eadp \u0111\u1ec1u th\u00f4ng qua API Gateway v\u1edbi ki\u1ec3m so\u00e1t RBAC \u0111\u1ed9ng</li> <li>S\u01a1 \u0111\u1ed3 h\u1ec7 th\u1ed1ng \u0111\u1ea7y \u0111\u1ee7 t\u1ea1i: System Diagrams</li> </ul>"},{"location":"dev/dev-guide/#2-cai-at-moi-truong-phat-trien","title":"2. C\u00e0i \u0111\u1eb7t m\u00f4i tr\u01b0\u1eddng ph\u00e1t tri\u1ec3n","text":"<p>M\u1ee5c ti\u00eau: gi\u00fap developer kh\u1edfi t\u1ea1o m\u00f4i tr\u01b0\u1eddng ph\u00e1t tri\u1ec3n cho t\u1eebng service trong h\u1ec7 th\u1ed1ng dx-vas, trong m\u00f4 h\u00ecnh multi-repo (m\u1ed7i service l\u00e0 m\u1ed9t Git repository ri\u00eang).</p>"},{"location":"dev/dev-guide/#yeu-cau-he-thong","title":"\ud83e\uddf0 Y\u00eau c\u1ea7u h\u1ec7 th\u1ed1ng","text":"<ul> <li>Python 3.11+ (cho c\u00e1c backend service)</li> <li>Node.js 18+ (cho frontend SPA/PWA)</li> <li>Docker + Docker Compose</li> <li><code>direnv</code> (tu\u1ef3 ch\u1ecdn \u2013 ti\u1ec7n cho vi\u1ec7c n\u1ea1p bi\u1ebfn m\u00f4i tr\u01b0\u1eddng)</li> <li>VS Code (khuy\u1ebfn ngh\u1ecb)</li> </ul>"},{"location":"dev/dev-guide/#cau-truc-he-thong-multi-repo","title":"\ud83d\udcc1 C\u1ea5u tr\u00fac h\u1ec7 th\u1ed1ng (multi-repo)","text":"<p>M\u1ed7i service l\u00e0 m\u1ed9t repo Git ri\u00eang bi\u1ec7t:</p> <pre><code>\ud83d\udce6 dx-api-gateway\n\ud83d\udce6 dx-auth-service\n\ud83d\udce6 dx-user-service\n\ud83d\udce6 dx-notification-service\n\ud83d\udce6 dx-crm-adapter\n\ud83d\udce6 dx-sis-adapter\n\ud83d\udce6 dx-lms-adapter\n\ud83d\udce6 dx-admin-webapp\n\ud83d\udce6 dx-customer-portal\n\ud83d\udce6 dx-vas\n</code></pre> <p>T\u00e0i li\u1ec7u <code>dev-guide.md</code> n\u00e0y n\u1eb1m trong repo <code>dx-vas</code>.</p>"},{"location":"dev/dev-guide/#cloning-cac-repo-lien-quan","title":"\ud83d\udd17 Cloning c\u00e1c repo li\u00ean quan","text":"<pre><code>git clone git@github.com:vas/dx-api-gateway.git\ngit clone git@github.com:vas/dx-auth-service.git\ngit clone git@github.com:vas/dx-user-service.git\ngit clone git@github.com:vas/dx-notification-service.git\n...\n</code></pre>"},{"location":"dev/dev-guide/#cach-chay-mot-service-vd-dx-auth-service","title":"\ud83d\udd04 C\u00e1ch ch\u1ea1y m\u1ed9t service (VD: dx-auth-service)","text":"<pre><code>cd dx-auth-service\ncp .env.example .env\n\n# C\u00e0i virtualenv v\u00e0 c\u00e0i dependencies\npython -m venv .venv &amp;&amp; source .venv/bin/activate\npip install -r requirements.txt\n\n# Ch\u1ea1y service\nuvicorn main:app --reload --port 8001\n</code></pre>"},{"location":"dev/dev-guide/#cach-chay-bang-docker-tuy-service","title":"\ud83d\udd01 C\u00e1ch ch\u1ea1y b\u1eb1ng Docker (tu\u1ef3 service)","text":"<pre><code>cd dx-auth-service\ndocker build -t dx-auth .\ndocker run --env-file .env -p 8001:8000 dx-auth\n</code></pre>"},{"location":"dev/dev-guide/#port-mac-inh-tung-service-dev","title":"\ud83e\uddea Port m\u1eb7c \u0111\u1ecbnh t\u1eebng service (dev)","text":"Service Port Docs Auth Service 8001 http://localhost:8001/docs User Service 8002 http://localhost:8002/docs Notification Service 8003 http://localhost:8003/docs API Gateway 8080 http://localhost:8080/docs <p>\ud83d\udcce Tham kh\u1ea3o s\u01a1 \u0111\u1ed3 k\u1ebft n\u1ed1i c\u00e1c service t\u1ea1i: System Diagrams</p> <p>\ud83d\udcce Tham kh\u1ea3o c\u00e1ch thi\u1ebft k\u1ebf IC cho t\u1eebng service t\u1ea1i: Interface Contracts</p>"},{"location":"dev/dev-guide/#3-cau-truc-thu-muc-dich-vu","title":"3. C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c &amp; d\u1ecbch v\u1ee5","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng ki\u1ebfn tr\u00fac microservices theo m\u00f4 h\u00ecnh multi-repo, trong \u0111\u00f3 m\u1ed7i service l\u00e0 m\u1ed9t repository \u0111\u1ed9c l\u1eadp, tri\u1ec3n khai ri\u00eang bi\u1ec7t.</p>"},{"location":"dev/dev-guide/#phan-loai-cac-repo","title":"\ud83e\uddf1 Ph\u00e2n lo\u1ea1i c\u00e1c repo","text":"Nh\u00f3m Repo M\u00f4 t\u1ea3 Gateway <code>dx-api-gateway</code> C\u1ed5ng v\u00e0o duy nh\u1ea5t, ki\u1ec3m tra ph\u00e2n quy\u1ec1n (RBAC) Core Services <code>dx-auth-service</code>, <code>dx-user-service</code>, <code>dx-notification-service</code> C\u00e1c service l\u00f5i ch\u1ea1y \u0111\u1ed9c l\u1eadp Business Adapters <code>dx-crm-adapter</code>, <code>dx-sis-adapter</code>, <code>dx-lms-adapter</code> Adapter k\u1ebft n\u1ed1i \u0111\u1ebfn h\u1ec7 th\u1ed1ng CRM/SIS/LMS b\u00ean ngo\u00e0i Frontend <code>dx-admin-webapp</code>, <code>dx-customer-portal</code> Giao di\u1ec7n cho admin (SPA) v\u00e0 ph\u1ee5 huynh/h\u1ecdc sinh (PWA) T\u00e0i li\u1ec7u <code>dx-docs</code> Ch\u1ee9a to\u00e0n b\u1ed9 t\u00e0i li\u1ec7u k\u1ef9 thu\u1eadt, s\u01a1 \u0111\u1ed3, h\u01b0\u1edbng d\u1eabn"},{"location":"dev/dev-guide/#goi-y-cau-truc-thu-muc-noi-bo-moi-service-backend","title":"\ud83d\udce6 G\u1ee3i \u00fd c\u1ea5u tr\u00fac th\u01b0 m\u1ee5c n\u1ed9i b\u1ed9 (m\u1ed7i service backend)","text":"<p>\u00c1p d\u1ee5ng cho t\u1ea5t c\u1ea3 backend service (Python + FastAPI):</p> <pre><code>dx-&lt;service&gt;/\n\u251c\u2500\u2500 app/                    # Source code ch\u00ednh\n\u2502   \u251c\u2500\u2500 main.py             # Entry point FastAPI\n\u2502   \u251c\u2500\u2500 api/                # Routers\n\u2502   \u251c\u2500\u2500 models/             # SQLAlchemy models\n\u2502   \u251c\u2500\u2500 schemas/            # Pydantic schemas\n\u2502   \u251c\u2500\u2500 services/           # Business logic\n\u2502   \u2514\u2500\u2500 core/               # C\u1ea5u h\u00ecnh, security, middleware\n\u251c\u2500\u2500 tests/                  # Unit &amp; integration tests\n\u251c\u2500\u2500 alembic/                # Migration (n\u1ebfu d\u00f9ng PostgreSQL)\n\u251c\u2500\u2500 .env.example            # M\u1eabu bi\u1ebfn m\u00f4i tr\u01b0\u1eddng\n\u251c\u2500\u2500 requirements.txt        # Dependencies\n\u2514\u2500\u2500 README.md\n</code></pre>"},{"location":"dev/dev-guide/#giao-tiep-giua-cac-service","title":"\ud83e\udde9 Giao ti\u1ebfp gi\u1eefa c\u00e1c service","text":"<ul> <li>M\u1ecdi request t\u1eeb frontend ho\u1eb7c service kh\u00e1c \u0111\u1ec1u \u0111i qua API Gateway</li> <li>RBAC \u0111\u01b0\u1ee3c ki\u1ec3m tra t\u1ea1i Gateway tr\u01b0\u1edbc khi forward request</li> <li>Redis \u0111\u01b0\u1ee3c d\u00f9ng \u0111\u1ec3 cache RBAC v\u00e0 session token</li> <li>Giao ti\u1ebfp b\u1ea5t \u0111\u1ed3ng b\u1ed9 (event) s\u1eed d\u1ee5ng Pub/Sub</li> </ul>"},{"location":"dev/dev-guide/#goi-y-chuan-hoa-template","title":"\ud83d\udcc4 G\u1ee3i \u00fd chu\u1ea9n h\u00f3a template","text":"<ul> <li>C\u00e1c service n\u00ean kh\u1edfi t\u1ea1o t\u1eeb c\u00f9ng m\u1ed9t service template chu\u1ea9n \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o:</li> <li>C\u1ea5u tr\u00fac \u0111\u1ed3ng nh\u1ea5t</li> <li>H\u1ec7 th\u1ed1ng logging/tracing th\u1ed1ng nh\u1ea5t</li> <li>C\u00f9ng h\u1ec7 th\u1ed1ng health check, swagger, RBAC header, metrics</li> </ul> <p>\ud83d\udcce Template tham kh\u1ea3o: <code>dx-service-template</code> (gi\u1ea3 \u0111\u1ecbnh)</p> <p>\ud83d\udcce S\u01a1 \u0111\u1ed3 lu\u1ed3ng giao ti\u1ebfp c\u00e1c service c\u00f3 th\u1ec3 xem t\u1ea1i: System Diagrams</p>"},{"location":"dev/dev-guide/#4-quy-uoc-viet-ma-coding-style","title":"4. Quy \u01b0\u1edbc vi\u1ebft m\u00e3 &amp; Coding Style","text":"<p>Quy \u01b0\u1edbc n\u00e0y \u00e1p d\u1ee5ng cho to\u00e0n b\u1ed9 backend services v\u00e0 frontend apps trong h\u1ec7 th\u1ed1ng dx-vas nh\u1eb1m \u0111\u1ea3m b\u1ea3o:</p> <ul> <li>\u0110\u1ed3ng nh\u1ea5t v\u1ec1 style</li> <li>D\u1ec5 \u0111\u1ecdc, d\u1ec5 review</li> <li>D\u1ec5 b\u1ea3o tr\u00ec v\u00e0 m\u1edf r\u1ed9ng</li> </ul>"},{"location":"dev/dev-guide/#python-backend-services","title":"\ud83d\udc0d Python \u2013 Backend Services","text":"<p>\u00c1p d\u1ee5ng cho c\u00e1c repo: <code>dx-auth-service</code>, <code>dx-user-service</code>, <code>dx-notification-service</code>, v\u00e0 c\u00e1c adapter.</p>"},{"location":"dev/dev-guide/#coding-style","title":"\u2705 Coding style","text":"<ul> <li>Tu\u00e2n theo chu\u1ea9n PEP8</li> <li>S\u1eed d\u1ee5ng <code>black</code> \u0111\u1ec3 auto-format</li> <li>Import theo nh\u00f3m (stdlib, third-party, local)</li> </ul>"},{"location":"dev/dev-guide/#tool","title":"\ud83d\udce6 Tool","text":"<pre><code>pip install black isort flake8\n</code></pre>"},{"location":"dev/dev-guide/#format-code","title":"\ud83d\udd01 Format code","text":"<pre><code>black app/\nisort app/\nflake8 app/\n</code></pre>"},{"location":"dev/dev-guide/#goi-y-cau-truc-project","title":"\ud83d\udcd8 G\u1ee3i \u00fd c\u1ea5u tr\u00fac project","text":"<pre><code>app/\n\u251c\u2500\u2500 main.py            # Entry point FastAPI\n\u251c\u2500\u2500 api/               # Routers (t\u1ed5 ch\u1ee9c theo domain)\n\u251c\u2500\u2500 models/            # SQLAlchemy models\n\u251c\u2500\u2500 schemas/           # Pydantic DTOs\n\u251c\u2500\u2500 services/          # Business logic\n\u251c\u2500\u2500 core/              # C\u1ea5u h\u00ecnh, b\u1ea3o m\u1eadt, middleware\n\u2514\u2500\u2500 utils/             # H\u00e0m d\u00f9ng chung\n</code></pre>"},{"location":"dev/dev-guide/#javascripttypescript-frontend-spa-pwa","title":"\ud83c\udf10 JavaScript/TypeScript \u2013 Frontend (SPA &amp; PWA)","text":"<p>\u00c1p d\u1ee5ng cho c\u00e1c repo: <code>dx-admin-webapp</code>, <code>dx-customer-portal</code></p>"},{"location":"dev/dev-guide/#coding-style_1","title":"\u2705 Coding style","text":"<ul> <li>S\u1eed d\u1ee5ng TypeScript to\u00e0n b\u1ed9</li> <li>Tu\u00e2n theo Airbnb style guide (ho\u1eb7c ESLint chu\u1ea9n Vite/Next)</li> <li>Format b\u1eb1ng Prettier</li> </ul>"},{"location":"dev/dev-guide/#tool_1","title":"\ud83d\udce6 Tool","text":"<pre><code>npm install --save-dev eslint prettier\n</code></pre>"},{"location":"dev/dev-guide/#format-code_1","title":"\ud83d\udd01 Format code","text":"<pre><code>npx prettier --write .\nnpx eslint . --fix\n</code></pre>"},{"location":"dev/dev-guide/#ten-bien-ten-ham-ten-file","title":"\ud83d\udd0d T\u00ean bi\u1ebfn, t\u00ean h\u00e0m, t\u00ean file","text":"Lo\u1ea1i Format V\u00ed d\u1ee5 Bi\u1ebfn Python snake_case <code>access_token</code>, <code>is_active</code> Class Python PascalCase <code>UserService</code>, <code>PermissionCondition</code> Route kebab-case <code>/reset-password</code> File TS kebab-case <code>login-form.tsx</code>"},{"location":"dev/dev-guide/#rbac-permission-naming","title":"\ud83e\udde9 RBAC &amp; Permission Naming","text":"<p>Tu\u00e2n theo c\u1ea5u tr\u00fac: <code>RESOURCE_ACTION[_SCOPE]</code> V\u00ed d\u1ee5:</p> <ul> <li><code>VIEW_SCORE</code></li> <li><code>EDIT_SCORE_OWN_CLASS</code></li> <li><code>RECEIVE_NOTIFICATION_PARENT</code></li> </ul> <p>\ud83d\udcce Chi ti\u1ebft t\u1ea1i: RBAC Deep Dive</p>"},{"location":"dev/dev-guide/#commit-message-convention","title":"\u2705 Commit Message Convention","text":"<p>\u00c1p d\u1ee5ng format <code>type(scope): message</code></p> <p>V\u00ed d\u1ee5:</p> <pre><code>feat(auth): add OTP fallback logic\nfix(user): wrong default role assignment\nrefactor: move shared utils to core/\n</code></pre> <p>C\u00e1c lo\u1ea1i type ph\u1ed5 bi\u1ebfn:</p> <ul> <li><code>feat</code>, <code>fix</code>, <code>refactor</code>, <code>docs</code>, <code>test</code>, <code>chore</code>, <code>perf</code></li> </ul> <p>\ud83d\udcce Xem v\u00ed d\u1ee5 c\u1ea5u tr\u00fac chu\u1ea9n t\u1ea1i: <code>dx-service-template</code> (gi\u1ea3 \u0111\u1ecbnh)</p>"},{"location":"dev/dev-guide/#5-rbac-phan-quyen-ong","title":"5. RBAC \u2013 Ph\u00e2n quy\u1ec1n \u0111\u1ed9ng","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng m\u00f4 h\u00ecnh RBAC \u0111\u1ed9ng (Contextual Role-Based Access Control), trong \u0111\u00f3 quy\u1ec1n \u0111\u01b0\u1ee3c \u0111\u00e1nh gi\u00e1 theo vai tr\u00f2, h\u00e0nh \u0111\u1ed9ng v\u00e0 \u0111i\u1ec1u ki\u1ec7n <code>condition</code> t\u00f9y ng\u1eef c\u1ea3nh.</p>"},{"location":"dev/dev-guide/#cau-truc-rbac","title":"\u2699\ufe0f C\u1ea5u tr\u00fac RBAC","text":"Th\u00e0nh ph\u1ea7n M\u00f4 t\u1ea3 <code>Role</code> Vai tr\u00f2 ng\u01b0\u1eddi d\u00f9ng (admin, teacher, parent...) <code>Permission</code> M\u1ed9t h\u00e0nh \u0111\u1ed9ng c\u1ee5 th\u1ec3 l\u00ean m\u1ed9t t\u00e0i nguy\u00ean <code>Condition (JSONB)</code> \u0110i\u1ec1u ki\u1ec7n ki\u1ec3m so\u00e1t ng\u1eef c\u1ea3nh \u2013 \u00e1p d\u1ee5ng theo user, resource, th\u1eddi \u0111i\u1ec3m <code>User-Role Mapping</code> M\u1ed9t user c\u00f3 th\u1ec3 g\u00e1n nhi\u1ec1u vai tr\u00f2 <code>Role-Permission Mapping</code> M\u1ed7i vai tr\u00f2 g\u00e1n nhi\u1ec1u permission <p>\ud83d\udcd8 C\u00e1c b\u1ea3ng \u0111\u01b0\u1ee3c m\u00f4 t\u1ea3 trong: RBAC Deep Dive</p>"},{"location":"dev/dev-guide/#quy-tac-anh-gia-phan-quyen","title":"\ud83d\udd10 Quy t\u1eafc \u0111\u00e1nh gi\u00e1 ph\u00e2n quy\u1ec1n","text":"<ol> <li>API Gateway nh\u1eadn request \u2192 ki\u1ec3m tra token (JWT)</li> <li>Tr\u00edch <code>user_id</code>, <code>role</code>, v\u00e0 context (VD: <code>student_id</code>, <code>class_id</code>, ...)</li> <li>T\u00ecm danh s\u00e1ch permission c\u1ee7a user t\u1eeb Redis cache (ho\u1eb7c g\u1ecdi <code>User Service</code>)</li> <li>V\u1edbi m\u1ed7i permission c\u00f3 <code>condition</code>, evaluate theo <code>context</code></li> <li>N\u1ebfu c\u00f3 \u00edt nh\u1ea5t 1 permission th\u1ecfa \u0111i\u1ec1u ki\u1ec7n \u2192 allow request</li> </ol>"},{"location":"dev/dev-guide/#at-ten-permission","title":"\ud83d\udccb \u0110\u1eb7t t\u00ean permission","text":"<p>Tu\u00e2n theo format:</p> <pre><code>&lt;RESOURCE&gt;*&lt;ACTION&gt;\\[*&lt;SCOPE&gt;]\n</code></pre> <p>V\u00ed d\u1ee5:</p> <ul> <li><code>VIEW_SCORE_OWN_CHILD</code></li> <li><code>EDIT_SCORE_CLASS_OWNER</code></li> <li><code>RECEIVE_NOTIFICATION_PARENT</code></li> </ul> <p>\ud83d\udcce Chi ti\u1ebft t\u1ea1i: RBAC Deep Dive</p>"},{"location":"dev/dev-guide/#cach-inh-nghia-permission-moi","title":"\ud83d\udce6 C\u00e1ch \u0111\u1ecbnh ngh\u0129a permission m\u1edbi","text":"<ol> <li>Th\u00eam d\u00f2ng m\u1edbi v\u00e0o file YAML <code>permissions.yaml</code> trong repo <code>dx-user-service</code></li> <li>Ch\u1ea1y l\u1ec7nh migrate RBAC:</li> </ol> <pre><code>make rbac-migrate\n</code></pre> <ol> <li>G\u00e1n permission n\u00e0y v\u00e0o role trong b\u1ea3ng <code>role_permission</code></li> <li>G\u00e1n role cho user \u2192 t\u1ef1 \u0111\u1ed9ng invalidate cache qua s\u1ef1 ki\u1ec7n <code>rbac_updated</code></li> </ol>"},{"location":"dev/dev-guide/#goi-y-khi-thiet-ke-condition","title":"\ud83d\udd0d G\u1ee3i \u00fd khi thi\u1ebft k\u1ebf condition","text":"<ul> <li>D\u00f9ng kh\u00f3a r\u00f5 r\u00e0ng: <code>class_ids</code>, <code>student_ids</code>, <code>term</code>, ...</li> <li>Tr\u00e1nh condition qu\u00e1 ph\u1ee9c t\u1ea1p \u2192 ph\u00e2n t\u00e1ch th\u00e0nh nhi\u1ec1u permission \u0111\u01a1n gi\u1ea3n</li> <li>Test v\u1edbi context th\u1ef1c t\u1ebf qua API Gateway</li> </ul>"},{"location":"dev/dev-guide/#test-rbac","title":"\ud83e\uddea Test RBAC","text":"<ul> <li>Mock user v\u00e0 role</li> <li>G\u1ecdi API th\u1eadt qua Gateway v\u1edbi JWT h\u1ee3p l\u1ec7</li> <li>Ki\u1ec3m tra log: permission granted / denied</li> <li>Ki\u1ec3m tra h\u00e0nh vi v\u1edbi user b\u1ecb <code>is_active = false</code></li> </ul> <p>\ud83d\udcce Xem s\u01a1 \u0111\u1ed3 RBAC chi ti\u1ebft t\u1ea1i: System Diagrams</p>"},{"location":"dev/dev-guide/#6-thiet-ke-api-openapi","title":"6. Thi\u1ebft k\u1ebf API &amp; OpenAPI","text":"<p>To\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng dx-vas tu\u00e2n theo nguy\u00ean t\u1eafc API chu\u1ea9n RESTful, \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a b\u1eb1ng OpenAPI 3.x (s\u1eed d\u1ee5ng FastAPI).</p>"},{"location":"dev/dev-guide/#nguyen-tac-thiet-ke-api","title":"\ud83d\udcd0 Nguy\u00ean t\u1eafc thi\u1ebft k\u1ebf API","text":"Ti\u00eau ch\u00ed Quy \u0111\u1ecbnh URL lowercase, d\u00f9ng kebab-case Method Tu\u00e2n chu\u1ea9n REST: GET/POST/PATCH/DELETE Versioning <code>v1</code> g\u1eafn v\u00e0o prefix: <code>/v1/users/...</code> Response G\u00f3i trong <code>data</code>, <code>meta</code>, <code>error</code> Error D\u00f9ng m\u00e3 l\u1ed7i chu\u1ea9n, message r\u00f5 r\u00e0ng RBAC Header <code>X-Permissions</code>, context dynamic"},{"location":"dev/dev-guide/#cau-truc-response-chuan","title":"\ud83d\udce6 C\u1ea5u tr\u00fac response chu\u1ea9n","text":"<pre><code>{\n  \"data\": {...},\n  \"meta\": {\n    \"request_id\": \"uuid\",\n    \"timestamp\": \"2024-01-01T12:00:00Z\"\n  },\n  \"error\": null\n}\n</code></pre> <p>Khi l\u1ed7i:</p> <pre><code>{\n  \"data\": null,\n  \"meta\": {...},\n  \"error\": {\n    \"code\": \"USER_NOT_FOUND\",\n    \"message\": \"User does not exist\"\n  }\n}\n</code></pre>"},{"location":"dev/dev-guide/#inh-nghia-api-bang-openapi","title":"\ud83d\udcd8 \u0110\u1ecbnh ngh\u0129a API b\u1eb1ng OpenAPI","text":"<ul> <li>M\u1ed7i service c\u00f3 m\u1ed9t file <code>openapi.yaml</code> \u0111\u1ecbnh ngh\u0129a OpenAPI 3.x</li> <li>C\u00f3 th\u1ec3 generate t\u1ef1 \u0111\u1ed9ng t\u1eeb FastAPI ho\u1eb7c vi\u1ebft tay v\u1edbi VS Code plugin</li> <li>D\u00f9ng Redoc, Swagger UI ho\u1eb7c Stoplight Studio \u0111\u1ec3 xem</li> </ul>"},{"location":"dev/dev-guide/#vi-du-repo-dx-user-service","title":"\ud83d\udcc1 V\u00ed d\u1ee5 repo <code>dx-user-service</code>","text":"<pre><code>dx-user-service/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u2514\u2500\u2500 users.py         # Define @router.get(\"/users\")\n\u251c\u2500\u2500 docs/\n\u2502   \u2514\u2500\u2500 openapi.yaml         # OpenAPI 3.x schema\n</code></pre>"},{"location":"dev/dev-guide/#api-gateway-routing","title":"\u2705 API Gateway routing","text":"<ul> <li>API Gateway \u0111\u1ecbnh tuy\u1ebfn \u0111\u1ebfn c\u00e1c service theo rule</li> <li> <p>M\u1ed7i route c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c g\u1eafn v\u1edbi:</p> </li> <li> <p><code>target_service</code></p> </li> <li><code>required_permissions</code></li> <li><code>path_rewrite</code> (n\u1ebfu c\u1ea7n)</li> </ul>"},{"location":"dev/dev-guide/#kiem-thu-api","title":"\ud83e\uddea Ki\u1ec3m th\u1eed API","text":"<ul> <li>G\u1ecdi tr\u1ef1c ti\u1ebfp local (FastAPI): http://localhost:8001/docs</li> <li>G\u1ecdi qua API Gateway (RBAC enforced): http://localhost:8080/v1/...</li> <li>D\u00f9ng Postman, HTTPie, Swagger UI, ho\u1eb7c test script t\u1ef1 \u0111\u1ed9ng</li> </ul> <p>\ud83d\udcce Xem Interface Contracts (ICs) t\u1ea1i: <code>docs/interfaces/</code></p> <p>\ud83d\udcce \u0110\u1ecbnh d\u1ea1ng chu\u1ea9n response/error \u0111\u01b0\u1ee3c m\u00f4 t\u1ea3 t\u1ea1i: <code>adr-001-fastapi</code> (gi\u1ea3 \u0111\u1ecbnh)</p>"},{"location":"dev/dev-guide/#7-gui-thong-bao-notification","title":"7. G\u1eedi th\u00f4ng b\u00e1o (Notification)","text":"<p>Notification Service l\u00e0 m\u1ed9t core service trong dx-vas, ch\u1ecbu tr\u00e1ch nhi\u1ec7m g\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn ng\u01b0\u1eddi d\u00f9ng qua nhi\u1ec1u k\u00eanh kh\u00e1c nhau: Web, Email, Zalo OA, Google Chat.</p>"},{"location":"dev/dev-guide/#cac-kenh-ho-tro","title":"\ud83d\udcec C\u00e1c k\u00eanh h\u1ed7 tr\u1ee3","text":"K\u00eanh \u0110\u1ed1i t\u01b0\u1ee3ng ch\u00ednh Ghi ch\u00fa WebPush H\u1ecdc sinh, gi\u00e1o vi\u00ean Nh\u1eadn trong Admin Webapp ho\u1eb7c PWA Gmail API Ph\u1ee5 huynh, gi\u00e1o vi\u00ean G\u1eedi email qua Google Workspace Zalo ZNS Ph\u1ee5 huynh Y\u00eau c\u1ea7u \u0111\u0103ng k\u00fd OA + duy\u1ec7t template Google Chat Nh\u00e2n vi\u00ean n\u1ed9i b\u1ed9 D\u00e0nh cho th\u00f4ng b\u00e1o h\u1ec7 th\u1ed1ng, v\u1eadn h\u00e0nh"},{"location":"dev/dev-guide/#cac-api-chinh","title":"\ud83d\udce6 C\u00e1c API ch\u00ednh","text":"<p>T\u1ea5t c\u1ea3 API \u0111\u1ec1u g\u1ecdi qua API Gateway Gateway ki\u1ec3m tra quy\u1ec1n <code>RECEIVE_NOTIFICATION_*</code></p>"},{"location":"dev/dev-guide/#post-notificationssend","title":"<code>POST /notifications/send</code>","text":"<p>G\u1eedi th\u00f4ng b\u00e1o theo template:</p> <pre><code>{\n  \"channel\": \"zalo\",\n  \"user_id\": \"u123\",\n  \"template_id\": \"ZALO_FEE_REMINDER\",\n  \"payload\": {\n    \"amount\": \"2.000.000\",\n    \"due_date\": \"2024-01-10\"\n  }\n}\n</code></pre>"},{"location":"dev/dev-guide/#post-notificationsregister-channel","title":"<code>POST /notifications/register-channel</code>","text":"<p>G\u00e1n user v\u1edbi th\u00f4ng tin thi\u1ebft b\u1ecb (device token, Zalo ID, email...)</p>"},{"location":"dev/dev-guide/#gui-thong-bao-qua-su-kien-event-driven","title":"\ud83d\udce1 G\u1eedi th\u00f4ng b\u00e1o qua s\u1ef1 ki\u1ec7n (event-driven)","text":"<ul> <li>C\u00e1c service nh\u01b0 CRM/SIS/LMS c\u00f3 th\u1ec3 ph\u00e1t s\u1ef1 ki\u1ec7n <code>NOTIFICATION_REQUESTED</code></li> <li>Notification Service subscribe t\u1eeb Pub/Sub</li> <li>V\u00ed d\u1ee5 event:</li> </ul> <pre><code>{\n  \"event\": \"NOTIFICATION_REQUESTED\",\n  \"user_id\": \"u123\",\n  \"channel\": \"email\",\n  \"template_id\": \"WELCOME\",\n  \"payload\": {\n    \"name\": \"Nguy\u1ec5n V\u0103n A\"\n  }\n}\n</code></pre>"},{"location":"dev/dev-guide/#uu-tien-fallback-kenh","title":"\ud83d\udd04 \u01afu ti\u00ean &amp; fallback k\u00eanh","text":"<ul> <li>M\u1ed7i user c\u00f3 th\u1ec3 c\u1ea5u h\u00ecnh k\u00eanh \u01b0a th\u00edch (stored in User Service)</li> <li>N\u1ebfu g\u1eedi th\u1ea5t b\u1ea1i (timeout/quota), c\u00f3 th\u1ec3 fallback sang email</li> </ul>"},{"location":"dev/dev-guide/#test-notification-service","title":"\ud83e\uddea Test Notification Service","text":"<ul> <li>G\u1ecdi th\u1eed API <code>/send</code> v\u1edbi JWT h\u1ee3p l\u1ec7</li> <li>Ki\u1ec3m tra log g\u1eedi th\u00e0nh c\u00f4ng/th\u1ea5t b\u1ea1i</li> <li>Gi\u1ea3 l\u1eadp s\u1ef1 ki\u1ec7n tr\u00ean Pub/Sub</li> <li>Ki\u1ec3m tra tr\u1ea1ng th\u00e1i t\u1eebng message qua Admin Webapp</li> </ul> <p>\ud83d\udcce Xem s\u01a1 \u0111\u1ed3 Notification Flow t\u1ea1i: System Diagrams</p> <p>\ud83d\udcce \u0110\u1ecbnh ngh\u0129a chi ti\u1ebft t\u1ea1i IC: <code>ic-04-notification.md</code></p>"},{"location":"dev/dev-guide/#8-quy-trinh-test-cicd","title":"8. Quy tr\u00ecnh test &amp; CI/CD","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u00e1p d\u1ee5ng quy tr\u00ecnh ki\u1ec3m th\u1eed v\u00e0 tri\u1ec3n khai li\u00ean t\u1ee5c cho t\u1eebng service \u0111\u1ed9c l\u1eadp. M\u1ed7i service c\u00f3 workflow CI/CD ri\u00eang, ch\u1ea1y t\u1ef1 \u0111\u1ed9ng tr\u00ean GitHub Actions ho\u1eb7c Google Cloud Build.</p>"},{"location":"dev/dev-guide/#cac-tang-kiem-thu","title":"\u2705 C\u00e1c t\u1ea7ng ki\u1ec3m th\u1eed","text":"Lo\u1ea1i test M\u1ee5c ti\u00eau V\u00ed d\u1ee5 Unit test Ki\u1ec3m tra logic \u0111\u01a1n v\u1ecb H\u00e0m x\u1eed l\u00fd OTP, parse template Integration test Ki\u1ec3m tra nhi\u1ec1u module k\u1ebft h\u1ee3p G\u1ecdi API <code>/users</code> \u2192 tr\u1ea3 response \u0111\u00fang E2E test Ki\u1ec3m tra end-to-end to\u00e0n h\u1ec7 th\u1ed1ng (t\u00f9y ch\u1ecdn) \u0110\u0103ng k\u00fd h\u1ecdc sinh t\u1eeb CRM \u2192 \u0111\u1ed3ng b\u1ed9 qua SIS, LMS"},{"location":"dev/dev-guide/#cong-cu","title":"\ud83d\udce6 C\u00f4ng c\u1ee5","text":"<ul> <li><code>pytest</code>, <code>pytest-cov</code>: cho Python services</li> <li><code>requests</code>, <code>httpx</code>: test API</li> <li><code>docker-compose.test.yml</code>: kh\u1edfi ch\u1ea1y m\u00f4i tr\u01b0\u1eddng test c\u00f3 DB/Redis</li> <li><code>testcontainers</code>: n\u1ebfu mu\u1ed1n test v\u1edbi Redis/PostgreSQL th\u1eadt</li> </ul>"},{"location":"dev/dev-guide/#chay-test-local","title":"\ud83e\uddea Ch\u1ea1y test local","text":"<pre><code># Trong t\u1eebng repo service\npytest tests/\npytest --cov=app tests/\n</code></pre>"},{"location":"dev/dev-guide/#yeu-cau-coverage","title":"\ud83d\udcca Y\u00eau c\u1ea7u coverage","text":"<ul> <li>Core logic (RBAC, Auth, Notification): \u2265 85%</li> <li>Adapter/API layer: \u2265 70%</li> </ul> <p>CI s\u1ebd fail n\u1ebfu coverage th\u1ea5p h\u01a1n ng\u01b0\u1ee1ng quy \u0111\u1ecbnh</p>"},{"location":"dev/dev-guide/#ci-workflow-github-actions","title":"\ud83e\uddf1 CI Workflow (GitHub Actions)","text":"<pre><code>name: CI\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Set up Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n      # Trong GitHub Actions ho\u1eb7c Google Cloud Build\n      - run: make test\n      - run: make format\n</code></pre>"},{"location":"dev/dev-guide/#trien-khai-cd","title":"\ud83d\ude80 Tri\u1ec3n khai (CD)","text":"<ul> <li>D\u00f9ng Google Cloud Build / GitHub Actions</li> <li>Tri\u1ec3n khai Cloud Run theo branch/tag:</li> </ul> Branch M\u00f4i tr\u01b0\u1eddng Ghi ch\u00fa <code>dev</code> Staging Auto-deploy <code>main</code> Production Require approval"},{"location":"dev/dev-guide/#makefile-chuan","title":"\ud83d\udee0 Makefile chu\u1ea9n","text":"<p>M\u1ed7i repo n\u00ean c\u00f3:</p> <pre><code># Makefile v\u00ed d\u1ee5\n\nrun:\n  uvicorn app.main:app --reload --port=8001\n\ntest:\n  pytest --cov=app tests/\n\nformat:\n  black app/ &amp;&amp; isort app/\n</code></pre> <p>\ud83d\udcce Xem ADR CI/CD t\u1ea1i: <code>adr-001-ci-cd.md</code></p>"},{"location":"dev/dev-guide/#9-migration-quan-ly-co-so-du-lieu","title":"9. Migration &amp; Qu\u1ea3n l\u00fd c\u01a1 s\u1edf d\u1eef li\u1ec7u","text":"<p>M\u1ed7i service trong dx-vas qu\u1ea3n l\u00fd database ri\u00eang bi\u1ec7t, kh\u00f4ng chia s\u1ebb DB tr\u1ef1c ti\u1ebfp. Core Services d\u00f9ng PostgreSQL, Adapters d\u00f9ng MySQL. M\u1ecdi thay \u0111\u1ed5i d\u1eef li\u1ec7u \u0111\u1ec1u \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd qua migration c\u00f3 version.</p>"},{"location":"dev/dev-guide/#cong-cu_1","title":"\ud83d\uddc4\ufe0f C\u00f4ng c\u1ee5","text":"Lo\u1ea1i DB C\u00f4ng c\u1ee5 Ghi ch\u00fa PostgreSQL Alembic D\u00f9ng chung v\u1edbi SQLAlchemy MySQL Alembic ho\u1eb7c raw SQL T\u00f9y d\u1ecbch v\u1ee5"},{"location":"dev/dev-guide/#cau-truc-thu-muc","title":"\ud83d\udce6 C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c","text":"<pre><code>dx-user-service/\n\u251c\u2500\u2500 alembic/\n\u2502   \u251c\u2500\u2500 versions/\n\u2502   \u2514\u2500\u2500 env.py\n\u251c\u2500\u2500 alembic.ini\n</code></pre>"},{"location":"dev/dev-guide/#tao-migration-moi","title":"\ud83e\uddea T\u1ea1o migration m\u1edbi","text":"<pre><code>alembic revision -m \"add table permission\"\n</code></pre> <p>Sau \u0111\u00f3 s\u1eeda file trong <code>versions/</code> \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a l\u1ec7nh SQL.</p>"},{"location":"dev/dev-guide/#chay-migration","title":"\ud83d\ude80 Ch\u1ea1y migration","text":"<pre><code>alembic upgrade head\n</code></pre> <p>\u26a0\ufe0f C\u1ea7n ch\u1eafc ch\u1eafn k\u1ebft n\u1ed1i <code>DATABASE_URL</code> \u0111\u00e3 \u0111\u00fang (env/dev.env)</p>"},{"location":"dev/dev-guide/#rollback-migration","title":"\ud83d\udd01 Rollback migration","text":"<pre><code>alembic downgrade -1\n</code></pre>"},{"location":"dev/dev-guide/#at-ten-migration-chuan","title":"\u2705 \u0110\u1eb7t t\u00ean migration chu\u1ea9n","text":"<p>Format: <code>yymmdd_hhmm_&lt;slug&gt;.py</code></p> <p>V\u00ed d\u1ee5: <code>240112_1030_add_role_table.py</code></p>"},{"location":"dev/dev-guide/#quan-ly-schema-chung","title":"\ud83e\udde9 Qu\u1ea3n l\u00fd schema chung","text":"<ul> <li>Core schema nh\u01b0 <code>Permission</code>, <code>Role</code>, <code>User</code> \u0111\u01b0\u1ee3c chu\u1ea9n h\u00f3a v\u00e0 migrate t\u1eeb <code>dx-user-service</code></li> <li>Kh\u00f4ng s\u1eeda tr\u1ef1c ti\u1ebfp d\u1eef li\u1ec7u RBAC trong DB \u2192 d\u00f9ng migration ho\u1eb7c API qu\u1ea3n tr\u1ecb</li> <li>D\u1eef li\u1ec7u ban \u0111\u1ea7u (seed) \u0111\u01b0\u1ee3c load qua script Python ho\u1eb7c fixture <code>.sql</code></li> </ul>"},{"location":"dev/dev-guide/#test-db-local","title":"\ud83e\uddea Test DB local","text":"<pre><code>docker run --rm -e POSTGRES_PASSWORD=dx -p 5432:5432 postgres:15\n</code></pre> <p>Ho\u1eb7c d\u00f9ng Docker Compose trong <code>dev</code> m\u00f4i tr\u01b0\u1eddng</p> <p>\ud83d\udcce Xem \u0111\u1ecbnh ngh\u0129a schema chu\u1ea9n t\u1ea1i: RBAC Deep Dive</p>"},{"location":"dev/dev-guide/#10-quy-trinh-pull-request-review","title":"10. Quy tr\u00ecnh pull request &amp; review","text":"<p>M\u1ed7i thay \u0111\u1ed5i trong h\u1ec7 th\u1ed1ng dx-vas ph\u1ea3i \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n th\u00f4ng qua Pull Request (PR) theo quy tr\u00ecnh r\u00f5 r\u00e0ng v\u00e0 c\u00f3 ki\u1ec3m duy\u1ec7t. Quy tr\u00ecnh n\u00e0y \u0111\u1ea3m b\u1ea3o:</p> <ul> <li>Code r\u00f5 r\u00e0ng, \u0111\u00fang chu\u1ea9n style</li> <li>Logic \u0111\u01b0\u1ee3c test v\u00e0 review</li> <li>Kh\u00f4ng \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn h\u1ec7 th\u1ed1ng v\u1eadn h\u00e0nh</li> </ul>"},{"location":"dev/dev-guide/#quy-trinh-phat-trien-co-ban","title":"\ud83d\ude80 Quy tr\u00ecnh ph\u00e1t tri\u1ec3n c\u01a1 b\u1ea3n","text":"<ol> <li>T\u1ea1o nh\u00e1nh m\u1edbi t\u1eeb <code>dev</code></li> </ol> <pre><code>git checkout dev\ngit pull\ngit checkout -b feat/&lt;service&gt;-&lt;short-desc&gt;\n</code></pre> <ol> <li>Vi\u1ebft code &amp; test</li> <li>Ch\u1ea1y test + format code</li> <li>Push l\u00ean GitHub</li> <li>T\u1ea1o PR v\u1ec1 <code>dev</code></li> </ol>"},{"location":"dev/dev-guide/#quy-inh-at-ten-nhanh","title":"\u2705 Quy \u0111\u1ecbnh \u0111\u1eb7t t\u00ean nh\u00e1nh","text":"<pre><code>feat/&lt;service&gt;-ten-tinh-nang\nfix/&lt;service&gt;-ten-loi\nrefactor/&lt;service&gt;-ten-module\n</code></pre> <p>V\u00ed d\u1ee5:</p> <ul> <li><code>feat/auth-otp-login</code></li> <li><code>fix/user-role-sync-error</code></li> </ul>"},{"location":"dev/dev-guide/#checklist-khi-mo-pr","title":"\ud83e\udde9 Checklist khi m\u1edf PR","text":"<ul> <li> \u0110\u00e3 vi\u1ebft unit test v\u00e0 integration test (n\u1ebfu c\u1ea7n)</li> <li> \u0110\u00e3 ch\u1ea1y <code>black</code>, <code>isort</code>, <code>flake8</code> (Python)</li> <li> \u0110\u00e3 ch\u1ea1y <code>prettier</code>, <code>eslint</code> (Frontend)</li> <li> Kh\u00f4ng push <code>.env</code>, credential, d\u1eef li\u1ec7u c\u00e1 nh\u00e2n</li> <li> Kh\u00f4ng s\u1eeda file c\u1ea5u h\u00ecnh deployment production tr\u1eeb khi \u0111\u01b0\u1ee3c duy\u1ec7t</li> </ul>"},{"location":"dev/dev-guide/#reviewer-can-kiem-tra","title":"\ud83d\udc40 Reviewer c\u1ea7n ki\u1ec3m tra","text":"<ul> <li>Logic c\u00f3 h\u1ee3p l\u00fd kh\u00f4ng?</li> <li>T\u00ean bi\u1ebfn, t\u00ean h\u00e0m c\u00f3 r\u00f5 r\u00e0ng?</li> <li>C\u00f3 g\u00e2y side effect kh\u00f4ng mong mu\u1ed1n?</li> <li>\u0110\u00e3 c\u00f3 test &amp; ch\u1ea1y pass ch\u01b0a?</li> <li>C\u00f3 \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn schema / RBAC kh\u00f4ng? (\u2192 c\u1ea7n update migration ho\u1eb7c IC?)</li> </ul>"},{"location":"dev/dev-guide/#luong-pr-ien-hinh","title":"\ud83d\udee1\ufe0f Lu\u1ed3ng PR \u0111i\u1ec3n h\u00ecnh","text":"<pre><code>Dev \u2192 Push l\u00ean nh\u00e1nh feat/... \u2192 M\u1edf PR \u2192 Review + Comment \u2192 S\u1eeda \u0111\u1ed5i \u2192 Merge\n</code></pre>"},{"location":"dev/dev-guide/#luat-merge","title":"\ud83d\udd12 Lu\u1eadt merge","text":"M\u00f4i tr\u01b0\u1eddng Nh\u00e1nh Merge v\u00e0o Ghi ch\u00fa Staging <code>dev</code> <code>dev</code> Merge sau khi pass CI Production <code>main</code> <code>main</code> Require approval 2 ng\u01b0\u1eddi <p>\ud83d\udcce Xem CI/CD detail: <code>adr-001-ci-cd.md</code></p> <p>\ud83d\udcce Xem Coding Style t\u1ea1i: M\u1ee5c 4 \u2013 Quy \u01b0\u1edbc vi\u1ebft m\u00e3</p>"},{"location":"dev/dev-guide/#11-theo-doi-van-hanh","title":"11. Theo d\u00f5i &amp; v\u1eadn h\u00e0nh","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u0111\u01b0\u1ee3c tri\u1ec3n khai theo ki\u1ebfn tr\u00fac ph\u00e2n t\u00e1n, y\u00eau c\u1ea7u gi\u00e1m s\u00e1t ch\u1ee7 \u0111\u1ed9ng v\u00e0 kh\u1ea3 n\u0103ng truy v\u1ebft l\u1ed7i hi\u1ec7u qu\u1ea3. T\u1ea5t c\u1ea3 service \u0111\u1ec1u ch\u1ea1y tr\u00ean Google Cloud Run v\u00e0 t\u00edch h\u1ee3p logging/tracing t\u1eadp trung.</p>"},{"location":"dev/dev-guide/#thanh-phan-quan-sat-chinh","title":"\ud83d\udce6 Th\u00e0nh ph\u1ea7n quan s\u00e1t ch\u00ednh","text":"Th\u00e0nh ph\u1ea7n M\u1ee5c ti\u00eau Cloud Logging T\u1eadp trung log t\u1eeb t\u1ea5t c\u1ea3 container Cloud Monitoring Gi\u00e1m s\u00e1t CPU, latency, error rate Cloud Trace Theo d\u00f5i trace request ph\u00e2n t\u00e1n Cloud Alerting Thi\u1ebft l\u1eadp c\u1ea3nh b\u00e1o theo rule Pub/Sub Dead Letter Ghi nh\u1eadn s\u1ef1 ki\u1ec7n x\u1eed l\u00fd l\u1ed7i / timeout"},{"location":"dev/dev-guide/#moi-service-can-implement","title":"\ud83d\udee0 M\u1ed7i service c\u1ea7n implement","text":"<ul> <li> <p>Logging chu\u1ea9n h\u00f3a theo JSON:   <pre><code>{\n  \"level\": \"INFO\",\n  \"service\": \"user-service\",\n  \"request_id\": \"abc-123\",\n  \"message\": \"User updated\",\n  \"user_id\": \"u789\"\n}\n</code></pre></p> </li> <li> <p>Trace header (<code>X-Request-ID</code>) c\u1ea7n \u0111\u01b0\u1ee3c truy\u1ec1n xuy\u00ean su\u1ed1t m\u1ecdi service</p> </li> <li>B\u1eaft timeout, quota error t\u1eeb external API (Zalo, Gmail...) \u2192 log c\u1ea3nh b\u00e1o</li> </ul>"},{"location":"dev/dev-guide/#bao-mat-tong-the-security-overview","title":"\ud83d\udd10 B\u1ea3o m\u1eadt t\u1ed5ng th\u1ec3 (Security Overview)","text":"<p>C\u00e1c ch\u00ednh s\u00e1ch v\u00e0 c\u01a1 ch\u1ebf b\u1ea3o m\u1eadt ch\u00ednh:</p> <ul> <li>RBAC \u0111\u1ed9ng: Ki\u1ec3m so\u00e1t truy c\u1eadp chi ti\u1ebft theo ng\u1eef c\u1ea3nh</li> <li>X\u00e1c th\u1ef1c token: OAuth2, JWT, OTP theo user group</li> <li>Gi\u1edbi h\u1ea1n truy c\u1eadp: Rate limiting, CAPTCHA v\u1edbi public endpoint</li> <li>Audit log: Ghi l\u1ea1i thay \u0111\u1ed5i RBAC, l\u1ed7i x\u00e1c th\u1ef1c, h\u00e0nh vi b\u1ea5t th\u01b0\u1eddng</li> <li>Header signing / mTLS: Cho giao ti\u1ebfp gi\u1eefa c\u00e1c service n\u1ed9i b\u1ed9</li> </ul> <p>\ud83d\udcce Tham kh\u1ea3o: <code>adr-004-security.md</code> \ud83d\udcce Chi ti\u1ebft RBAC: RBAC Deep Dive</p>"},{"location":"dev/dev-guide/#log-bao-mat","title":"\ud83d\udd10 Log b\u1ea3o m\u1eadt","text":"<ul> <li>Log RBAC: <code>permission_denied</code>, <code>rbac_modified_by</code>, <code>invalid_token</code></li> <li>Log auth: <code>login_failed</code>, <code>otp_failed</code>, <code>user_locked</code></li> <li> <p>G\u1eedi alert khi:</p> </li> <li> <p>\u0110\u0103ng nh\u1eadp sai li\u00ean ti\u1ebfp &gt; 5 l\u1ea7n</p> </li> <li>Thay \u0111\u1ed5i quy\u1ec1n role \u0111\u1eb7c bi\u1ec7t</li> <li>Truy c\u1eadp endpoint nh\u1ea1y c\u1ea3m th\u1ea5t b\u1ea1i</li> </ul>"},{"location":"dev/dev-guide/#alerting-goi-y","title":"\u26a0\ufe0f Alerting g\u1ee3i \u00fd","text":"Rule \u0110i\u1ec1u ki\u1ec7n M\u1ee9c Gateway error spike <code>5xx</code> t\u0103ng &gt; 20% trong 5 ph\u00fat \u26a0\ufe0f Warning Pub/Sub failed ack <code>notification_event</code> timeout &gt; 10 l\u1ea7n \ud83d\udea8 Critical Redis miss rate cao Miss rate &gt; 40% trong 10 ph\u00fat \u26a0\ufe0f Warning Login fail 10+ l\u1ea7n t\u1eeb 1 IP trong 1 ph\u00fat \ud83d\udea8 Security"},{"location":"dev/dev-guide/#health-check-trace","title":"\ud83e\uddea Health check &amp; trace","text":"<ul> <li>T\u1ea5t c\u1ea3 service expose <code>/healthz</code> tr\u1ea3 <code>200 OK</code></li> <li>Gateway trace t\u1eebng request \u2192 g\u1eafn <code>request_id</code></li> <li>Pub/Sub v\u00e0 Redis c\u00f3 dashboard tr\u1ea1ng th\u00e1i ri\u00eang</li> </ul> <p>\ud83d\udcce Xem th\u00eam: <code>adr-008-audit-logging.md</code></p> <p>\ud83d\udcce S\u01a1 \u0111\u1ed3 tri\u1ec3n khai observability: System Diagrams</p>"},{"location":"dev/dev-guide/#12-troubleshooting-loi-thuong-gap","title":"12. Troubleshooting \u2013 L\u1ed7i th\u01b0\u1eddng g\u1eb7p","text":"<p>D\u01b0\u1edbi \u0111\u00e2y l\u00e0 danh s\u00e1ch m\u1ed9t s\u1ed1 l\u1ed7i th\u01b0\u1eddng g\u1eb7p trong qu\u00e1 tr\u00ecnh ph\u00e1t tri\u1ec3n, test ho\u1eb7c v\u1eadn h\u00e0nh h\u1ec7 th\u1ed1ng dx-vas \u2013 c\u00f9ng v\u1edbi c\u00e1ch x\u1eed l\u00fd \u0111\u1ec1 xu\u1ea5t.</p>"},{"location":"dev/dev-guide/#authentication-token","title":"\ud83d\udd11 Authentication &amp; Token","text":"L\u1ed7i Nguy\u00ean nh\u00e2n Gi\u1ea3i ph\u00e1p <code>401 Unauthorized</code> Thi\u1ebfu ho\u1eb7c sai JWT Ki\u1ec3m tra <code>Authorization: Bearer &lt;token&gt;</code> <code>Signature has expired</code> Token h\u1ebft h\u1ea1n G\u1ecdi l\u1ea1i <code>/refresh-token</code> <code>403 Forbidden</code> Kh\u00f4ng c\u00f3 quy\u1ec1n Ki\u1ec3m tra permission ho\u1eb7c header <code>X-Permissions</code>"},{"location":"dev/dev-guide/#rbac-redis","title":"\ud83d\udd10 RBAC &amp; Redis","text":"L\u1ed7i Nguy\u00ean nh\u00e2n Gi\u1ea3i ph\u00e1p <code>permission denied</code> Kh\u00f4ng match <code>condition</code> Debug b\u1eb1ng context g\u1eedi qua request Cache kh\u00f4ng c\u1eadp nh\u1eadt RBAC ch\u01b0a \u0111\u01b0\u1ee3c invalidate G\u1ecdi l\u1ea1i API ho\u1eb7c \u0111\u1ee3i TTL Redis (~5 ph\u00fat) <code>KeyError</code> RBAC Sai format permission Ki\u1ec3m tra file <code>permissions.yaml</code> v\u00e0 migration"},{"location":"dev/dev-guide/#database-migration","title":"\ud83d\udee0 Database &amp; Migration","text":"L\u1ed7i Nguy\u00ean nh\u00e2n Gi\u1ea3i ph\u00e1p <code>alembic error</code> Thi\u1ebfu <code>env.py</code> ho\u1eb7c config Ki\u1ec3m tra <code>alembic.ini</code> &amp; env var <code>DATABASE_URL</code> <code>table does not exist</code> Qu\u00ean migrate <code>alembic upgrade head</code> <code>duplicate key</code> Tr\u00f9ng d\u1eef li\u1ec7u seed Ki\u1ec3m tra file insert ho\u1eb7c set <code>on_conflict</code>"},{"location":"dev/dev-guide/#docker-service-dev","title":"\ud83d\udce6 Docker &amp; Service Dev","text":"L\u1ed7i Nguy\u00ean nh\u00e2n Gi\u1ea3i ph\u00e1p <code>address already in use</code> Port b\u1ecb chi\u1ebfm \u0110\u1ed5i port trong <code>.env</code> ho\u1eb7c docker <code>ModuleNotFoundError</code> Thi\u1ebfu dependency <code>pip install -r requirements.txt</code> ho\u1eb7c rebuild container Service kh\u00f4ng start L\u1ed7i env ho\u1eb7c l\u1ed7i DB Ki\u1ec3m tra <code>.env</code>, log DB, Redis, Pub/Sub"},{"location":"dev/dev-guide/#cicd-test","title":"\ud83e\uddea CI/CD &amp; Test","text":"L\u1ed7i Nguy\u00ean nh\u00e2n Gi\u1ea3i ph\u00e1p <code>pytest ImportError</code> Ch\u1ea1y ngo\u00e0i virtualenv <code>source .venv/bin/activate</code> <code>coverage &lt; 70%</code> Thi\u1ebfu test cho logic ch\u00ednh Th\u00eam unit test cho service, router, schema CI fail \u1edf <code>black</code> Kh\u00f4ng format code <code>black app/</code> r\u1ed3i commit l\u1ea1i"},{"location":"dev/dev-guide/#notification","title":"\ud83d\udce1 Notification","text":"L\u1ed7i Nguy\u00ean nh\u00e2n Gi\u1ea3i ph\u00e1p Kh\u00f4ng g\u1eedi Zalo Sai template ho\u1eb7c quota Ki\u1ec3m tra token OA + c\u1ea5u h\u00ecnh template ID G\u1eedi email th\u1ea5t b\u1ea1i L\u1ed7i Gmail API quota Ch\u1edd retry ho\u1eb7c contact admin Push kh\u00f4ng nh\u1eadn User ch\u01b0a \u0111\u0103ng k\u00fd device token G\u1ecdi <code>/notifications/register-channel</code> tr\u01b0\u1edbc"},{"location":"dev/dev-guide/#general-tips","title":"\ud83e\udde9 General Tips","text":"<ul> <li>S\u1eed d\u1ee5ng header <code>X-Request-ID</code> \u2192 d\u1ec5 truy v\u1ebft trong log</li> <li>D\u00f9ng <code>curl</code> ho\u1eb7c <code>httpie</code> \u0111\u1ec3 test \u0111\u01a1n gi\u1ea3n</li> <li>Ki\u1ec3m tra log Cloud Run ho\u1eb7c container local n\u1ebfu service crash</li> <li>D\u00f9ng <code>direnv</code>, <code>.env.example</code>, <code>.envrc</code> \u0111\u1ec3 tr\u00e1nh qu\u00ean bi\u1ebfn m\u00f4i tr\u01b0\u1eddng</li> </ul> <p>\ud83d\udcce Xem log v\u00e0 trace t\u1ea1i: System Diagrams</p> <p>\ud83d\udcce V\u1ea5n \u0111\u1ec1 li\u00ean quan \u0111\u1ebfn RBAC: RBAC Deep Dive</p>"},{"location":"dev/ops-guide/","title":"\ud83d\udcd8 Ops Guide \u2013 dx-vas","text":"<p>T\u00e0i li\u1ec7u n\u00e0y d\u00e0nh cho DevOps/SRE v\u1eadn h\u00e0nh h\u1ec7 th\u1ed1ng dx-vas tr\u00ean m\u00f4i tr\u01b0\u1eddng production v\u00e0 staging. Bao g\u1ed3m gi\u00e1m s\u00e1t, tri\u1ec3n khai, scaling, b\u1ea3o m\u1eadt, ki\u1ec3m tra s\u1ef1 c\u1ed1 v\u00e0 c\u00e1c quy tr\u00ecnh v\u1eadn h\u00e0nh th\u01b0\u1eddng nh\u1eadt.</p>"},{"location":"dev/ops-guide/#muc-luc","title":"M\u1ee5c l\u1ee5c","text":"<ol> <li>T\u1ed5ng quan tri\u1ec3n khai h\u1ea1 t\u1ea7ng</li> <li>Tri\u1ec3n khai d\u1ecbch v\u1ee5 &amp; m\u00f4i tr\u01b0\u1eddng</li> <li>Gi\u00e1m s\u00e1t &amp; c\u1ea3nh b\u00e1o</li> <li>Logging &amp; Trace ph\u00e2n t\u00e1n</li> <li>Qu\u1ea3n l\u00fd b\u1ea3o m\u1eadt &amp; credentials</li> <li>Chi\u1ebfn l\u01b0\u1ee3c scaling &amp; autoscale</li> <li>Quy tr\u00ecnh c\u1eadp nh\u1eadt &amp; rollback</li> <li>Qu\u1ea3n l\u00fd Pub/Sub &amp; Dead Letter</li> <li>Ki\u1ec3m so\u00e1t chi ph\u00ed &amp; t\u1ed1i \u01b0u t\u00e0i nguy\u00ean</li> <li>Checklist \u0111\u1ecbnh k\u1ef3 v\u1eadn h\u00e0nh</li> <li>\u1ee8ng ph\u00f3 s\u1ef1 c\u1ed1 &amp; kh\u00f4i ph\u1ee5c</li> <li>Backup &amp; Disaster Recovery (DR)</li> <li>Security audit &amp; compliance</li> <li>C\u00f4ng c\u1ee5 &amp; dashboard h\u1ed7 tr\u1ee3</li> </ol>"},{"location":"dev/ops-guide/#1-tong-quan-trien-khai-ha-tang","title":"1. T\u1ed5ng quan tri\u1ec3n khai h\u1ea1 t\u1ea7ng","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u0111\u01b0\u1ee3c tri\u1ec3n khai ho\u00e0n to\u00e0n tr\u00ean h\u1ea1 t\u1ea7ng Google Cloud Platform (GCP), s\u1eed d\u1ee5ng c\u00e1c d\u1ecbch v\u1ee5 serverless v\u00e0 managed \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng, b\u1ea3o tr\u00ec \u0111\u01a1n gi\u1ea3n v\u00e0 v\u1eadn h\u00e0nh \u1ed5n \u0111\u1ecbnh.</p>"},{"location":"dev/ops-guide/#kien-truc-trien-khai-chinh","title":"\u2699\ufe0f Ki\u1ebfn tr\u00fac tri\u1ec3n khai ch\u00ednh","text":"Th\u00e0nh ph\u1ea7n Tri\u1ec3n khai tr\u00ean Ghi ch\u00fa API Gateway Cloud Run Ki\u1ec3m so\u00e1t truy c\u1eadp, ki\u1ec3m tra RBAC Core Services (Auth, User, Notification) Cloud Run \u0110\u1ed9c l\u1eadp, stateless Business Adapters (CRM/SIS/LMS) Cloud Run K\u1ebft n\u1ed1i h\u1ec7 th\u1ed1ng b\u00ean ngo\u00e0i Redis Cache Memorystore L\u01b0u RBAC cache, token, session PostgreSQL (Core) Cloud SQL CSDL ch\u00ednh cho RBAC, ng\u01b0\u1eddi d\u00f9ng MySQL (Adapters) Cloud SQL T\u01b0\u01a1ng th\u00edch v\u1edbi h\u1ec7 th\u1ed1ng CRM/SIS/LMS Pub/Sub GCP Pub/Sub Event bus cho Notification &amp; Sync GCS Google Cloud Storage L\u01b0u tr\u1eef \u1ea3nh, file t\u0129nh, JSON config"},{"location":"dev/ops-guide/#ha-tang-phan-tang","title":"\u2601\ufe0f H\u1ea1 t\u1ea7ng ph\u00e2n t\u1ea7ng","text":"<ul> <li>Cloud Run: M\u1ed7i service l\u00e0 m\u1ed9t container ri\u00eang bi\u1ec7t, autoscale theo l\u01b0u l\u01b0\u1ee3ng.</li> <li>Cloud SQL: Instance ri\u00eang cho PostgreSQL (core) v\u00e0 MySQL (adapters), b\u1eadt PITR.</li> <li>VPC &amp; firewall rules: T\u1ea5t c\u1ea3 Cloud Run \u2192 DB ho\u1eb7c Redis \u0111\u1ec1u qua VPC connector.</li> <li>IAM &amp; Secret Manager: Qu\u1ea3n l\u00fd ph\u00e2n quy\u1ec1n truy c\u1eadp service-level v\u00e0 secrets.</li> </ul>"},{"location":"dev/ops-guide/#moi-truong-trien-khai","title":"\ud83d\uddc2\ufe0f M\u00f4i tr\u01b0\u1eddng tri\u1ec3n khai","text":"M\u00f4i tr\u01b0\u1eddng Nh\u00e1nh Git Ghi ch\u00fa Staging <code>dev</code> T\u1ef1 \u0111\u1ed9ng deploy khi merge PR Production <code>main</code> Deploy c\u00f3 approval <p>\ud83d\udcce S\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac t\u1ed5ng quan: System Diagrams</p> <p>\ud83d\udcce Chi ti\u1ebft RBAC: RBAC Deep Dive</p>"},{"location":"dev/ops-guide/#2-trien-khai-dich-vu-moi-truong","title":"2. Tri\u1ec3n khai d\u1ecbch v\u1ee5 &amp; m\u00f4i tr\u01b0\u1eddng","text":"<p>H\u1ec7 th\u1ed1ng dx-vas g\u1ed3m nhi\u1ec1u service \u0111\u1ed9c l\u1eadp, m\u1ed7i service l\u00e0 m\u1ed9t Dockerized microservice \u0111\u01b0\u1ee3c tri\u1ec3n khai l\u00ean Google Cloud Run. M\u1ed7i service c\u00f3 repository ri\u00eang bi\u1ec7t, CI/CD ri\u00eang, v\u00e0 t\u00e1ch bi\u1ec7t gi\u1eefa staging v\u00e0 production.</p>"},{"location":"dev/ops-guide/#mo-hinh-multi-repo","title":"\ud83d\udce6 M\u00f4 h\u00ecnh multi-repo","text":"Service Repo CI/CD Port dev API Gateway <code>dx-api-gateway</code> GitHub Actions \u2192 Cloud Run 8080 Auth Service <code>dx-auth-service</code> GitHub Actions \u2192 Cloud Run 8001 User Service <code>dx-user-service</code> GitHub Actions \u2192 Cloud Run 8002 Notification Service <code>dx-notification-service</code> GitHub Actions \u2192 Cloud Run 8003 CRM Adapter <code>dx-crm-adapter</code> GitHub Actions \u2192 Cloud Run 8011 SIS Adapter <code>dx-sis-adapter</code> GitHub Actions \u2192 Cloud Run 8012 LMS Adapter <code>dx-lms-adapter</code> GitHub Actions \u2192 Cloud Run 8013"},{"location":"dev/ops-guide/#quy-trinh-trien-khai-ien-hinh","title":"\ud83e\uddf1 Quy tr\u00ecnh tri\u1ec3n khai \u0111i\u1ec3n h\u00ecnh","text":"<ol> <li>Developer push code l\u00ean nh\u00e1nh <code>dev</code></li> <li>CI ch\u1ea1y test + lint + security scan</li> <li>N\u1ebfu pass:</li> <li>T\u1ef1 \u0111\u1ed9ng build image \u2192 upload Container Registry (Artifact Registry)</li> <li>Deploy l\u00ean Cloud Run m\u00f4i tr\u01b0\u1eddng Staging</li> <li>V\u1edbi <code>main</code>:</li> <li>Ch\u1ec9 \u0111\u01b0\u1ee3c merge khi c\u00f3 2 approval</li> <li>Y\u00eau c\u1ea7u x\u00e1c nh\u1eadn deploy \u2192 Production</li> </ol>"},{"location":"dev/ops-guide/#cau-hinh-deploy-vi-du-github-actions","title":"\ud83d\udee0 C\u1ea5u h\u00ecnh deploy (v\u00ed d\u1ee5 GitHub Actions)","text":"<pre><code>- name: Deploy to Cloud Run\n  uses: google-github-actions/deploy-cloudrun@v1\n  with:\n    service: user-service\n    image: gcr.io/$PROJECT_ID/user-service:$GITHUB_SHA\n    region: asia-southeast1\n    env_vars: ENV=${{ github.ref == 'refs/heads/main' &amp;&amp; 'production' || 'staging' }}\n</code></pre> <p>\ud83d\udccc Trong workflow th\u1ef1c t\u1ebf, bi\u1ebfn ENV kh\u00f4ng g\u00e1n c\u1ee9ng m\u00e0 \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh t\u1ef1 \u0111\u1ed9ng d\u1ef1a tr\u00ean nh\u00e1nh (ho\u1eb7c GitHub environment). C\u00f3 th\u1ec3 s\u1eed d\u1ee5ng bi\u1ebfn github.ref ho\u1eb7c GitHub Environments (production, staging) \u0111\u1ec3 thi\u1ebft l\u1eadp \u0111\u00fang bi\u1ebfn m\u00f4i tr\u01b0\u1eddng cho Cloud Run.</p>"},{"location":"dev/ops-guide/#cau-hinh-bien-moi-truong-cloud-run","title":"\ud83d\udcc1 C\u1ea5u h\u00ecnh bi\u1ebfn m\u00f4i tr\u01b0\u1eddng (Cloud Run)","text":"<ul> <li>D\u00f9ng Secret Manager \u0111\u1ec3 l\u01b0u token nh\u1ea1y c\u1ea3m</li> <li>C\u00e1c bi\u1ebfn <code>.env</code> \u0111\u01b0\u1ee3c sync th\u00f4ng qua deploy script</li> <li>M\u1ed9t s\u1ed1 bi\u1ebfn m\u00f4i tr\u01b0\u1eddng \u0111i\u1ec3n h\u00ecnh:</li> </ul> <pre><code>ENV=production\nDATABASE_URL=...\nREDIS_URL=...\nJWT_SECRET=...\nPUBSUB_PROJECT_ID=...\n</code></pre> <p>\ud83d\udcce Chi ti\u1ebft CI/CD: Dev Guide</p> <p>\ud83d\udcce C\u1ea5u tr\u00fac m\u00f4i tr\u01b0\u1eddng Cloud Run: System Diagrams</p>"},{"location":"dev/ops-guide/#3-giam-sat-canh-bao","title":"3. Gi\u00e1m s\u00e1t &amp; c\u1ea3nh b\u00e1o","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng Google Cloud Monitoring \u0111\u1ec3 theo d\u00f5i tr\u1ea1ng th\u00e1i d\u1ecbch v\u1ee5, hi\u1ec7u n\u0103ng, t\u1ec9 l\u1ec7 l\u1ed7i v\u00e0 thi\u1ebft l\u1eadp c\u1ea3nh b\u00e1o theo rule t\u00f9y ch\u1ec9nh. M\u1ed7i service \u0111\u01b0\u1ee3c gi\u00e1m s\u00e1t \u0111\u1ed9c l\u1eadp v\u00e0 c\u00f3 dashboard ri\u00eang.</p>"},{"location":"dev/ops-guide/#cac-loai-metric-giam-sat","title":"\ud83d\udcca C\u00e1c lo\u1ea1i metric gi\u00e1m s\u00e1t","text":"Nh\u00f3m Metric V\u00ed d\u1ee5 Cloud Run Request count, latency, error rate 5xx t\u0103ng b\u1ea5t th\u01b0\u1eddng Pub/Sub Pending messages, retry count Queue b\u1ecb k\u1eb9t Redis Miss rate, latency Cache ch\u1eadm ho\u1eb7c m\u1ea5t Database Connection usage, slow queries PostgreSQL / MySQL RBAC Permission denied, cache invalidated S\u1ef1 ki\u1ec7n b\u1ea3o m\u1eadt Notification Success/failure rate theo k\u00eanh Zalo/Gmail th\u1ea5t b\u1ea1i"},{"location":"dev/ops-guide/#alerting-rule-goi-y","title":"\u26a0\ufe0f Alerting rule g\u1ee3i \u00fd","text":"Rule \u0110i\u1ec1u ki\u1ec7n Severity Gateway error spike 5xx &gt; 20% trong 5 ph\u00fat \ud83d\udd25 Critical Redis miss t\u0103ng cao Miss rate &gt; 50% trong 10 ph\u00fat \u26a0\ufe0f Warning Pub/Sub backlog &gt; 500 messages trong 5 ph\u00fat \u26a0\ufe0f Warning \u0110\u0103ng nh\u1eadp th\u1ea5t b\u1ea1i &gt; 10 l\u1ea7n t\u1eeb 1 IP trong 1 ph\u00fat \ud83d\udea8 Security DB connection full S\u1eed d\u1ee5ng &gt; 90% connection pool \ud83d\udd25 Critical"},{"location":"dev/ops-guide/#dashboard-e-xuat","title":"\ud83d\udcc9 Dashboard \u0111\u1ec1 xu\u1ea5t","text":"<ul> <li>M\u1ed9t dashboard chung to\u00e0n h\u1ec7 th\u1ed1ng (multi-service)</li> <li>Dashboard ri\u00eang cho t\u1eebng service:</li> <li><code>gateway-dashboard</code></li> <li><code>auth-dashboard</code></li> <li><code>user-dashboard</code></li> <li><code>notification-dashboard</code></li> <li>C\u00f3 th\u1ec3 d\u00f9ng dashboard template t\u1eeb Google Cloud Monitoring</li> </ul>"},{"location":"dev/ops-guide/#canh-bao-thong-bao","title":"\ud83d\udd04 C\u1ea3nh b\u00e1o &amp; th\u00f4ng b\u00e1o","text":"<ul> <li>C\u1ea3nh b\u00e1o g\u1eedi qua:</li> <li>Google Chat (devops channel)</li> <li>Email (alerts@truongvietanh.edu.vn)</li> <li>\u0110\u1ecbnh k\u1ef3 audit c\u1ea3nh b\u00e1o sai l\u1ec7ch ho\u1eb7c tr\u00f9ng l\u1eb7p</li> </ul>"},{"location":"dev/ops-guide/#so-o-luong-canh-bao-monitoring-alerts","title":"\ud83d\udece\ufe0f S\u01a1 \u0111\u1ed3 lu\u1ed3ng c\u1ea3nh b\u00e1o (Monitoring Alerts)","text":"<pre><code>flowchart TD\n    A[Service Metrics  Cloud Run, Redis, DB...]\n    B[Cloud Monitoring]\n    C[Alert Policy  Threshold Rules]\n    D[Notification Channel  Google Chat, Email]\n    E[Incident Response  Ops team]\n\n    A --&gt; B\n    B --&gt; C\n    C --&gt; D\n    D --&gt; E\n\n    click C href \"https://console.cloud.google.com/monitoring/alerting\" \"View Alerting Policy\"\n    click D href \"https://console.cloud.google.com/monitoring/settings\" \"View Notification Settings\"\n</code></pre> <p>Gi\u1ea3i th\u00edch:</p> <ol> <li>Service Metrics: Metrics \u0111\u01b0\u1ee3c export t\u1eeb Cloud Run, Redis, Cloud SQL, v.v. (VD: CPU usage, 5xx error rate).</li> <li>Cloud Monitoring: Thu th\u1eadp v\u00e0 ph\u00e2n t\u00edch c\u00e1c metric.</li> <li>Alert Policy: \u0110\u1ecbnh ngh\u0129a ng\u01b0\u1ee1ng c\u1ea3nh b\u00e1o (v\u00ed d\u1ee5: n\u1ebfu error rate &gt; 5% trong 1 ph\u00fat).</li> <li>Notification Channel: Khi c\u00f3 c\u1ea3nh b\u00e1o, h\u1ec7 th\u1ed1ng g\u1eedi t\u1edbi c\u00e1c k\u00eanh nh\u01b0 Google Chat, Email, PagerDuty (n\u1ebfu c\u00f3).</li> <li>Incident Response: \u0110\u1ed9i ng\u0169 v\u1eadn h\u00e0nh nh\u1eadn c\u1ea3nh b\u00e1o v\u00e0 th\u1ef1c hi\u1ec7n x\u1eed l\u00fd theo Runbook.</li> </ol> <p>\ud83d\udccc C\u00e1c b\u01b0\u1edbc ti\u1ebfp theo c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c trigger t\u1ef1 \u0111\u1ed9ng (g\u1eedi c\u1ea3nh b\u00e1o qua bot, m\u1edf ticket, c\u1eadp nh\u1eadt dashboard\u2026). B\u1ea1n c\u00f3 th\u1ec3 nh\u00fang th\u00eam link ho\u1eb7c m\u1edf r\u1ed9ng n\u1ebfu d\u00f9ng Alertmanager ho\u1eb7c b\u00ean th\u1ee9 ba nh\u01b0 OpsGenie, PagerDuty.</p> <p>\ud83d\udcce Xem th\u00eam c\u1ea5u tr\u00fac trace/log t\u1ea1i: M\u1ee5c 4 \u2013 Logging &amp; Trace </p> <p>\ud83d\udcce \u0110\u1ecbnh ngh\u0129a dashboard: Observability</p>"},{"location":"dev/ops-guide/#4-logging-trace-phan-tan","title":"4. Logging &amp; Trace ph\u00e2n t\u00e1n","text":"<p>M\u1ecdi service trong dx-vas \u0111\u1ec1u ghi log theo \u0111\u1ecbnh d\u1ea1ng JSON chu\u1ea9n h\u00f3a, c\u00f3 g\u1eafn <code>request_id</code>, v\u00e0 g\u1eedi v\u1ec1 Google Cloud Logging. H\u1ec7 th\u1ed1ng \u0111\u1ed3ng th\u1eddi h\u1ed7 tr\u1ee3 tracing ph\u00e2n t\u00e1n v\u1edbi Google Cloud Trace \u0111\u1ec3 theo d\u00f5i lu\u1ed3ng x\u1eed l\u00fd xuy\u00ean su\u1ed1t nhi\u1ec1u service.</p>"},{"location":"dev/ops-guide/#inh-dang-log-chuan","title":"\ud83e\uddfe \u0110\u1ecbnh d\u1ea1ng log chu\u1ea9n","text":"<pre><code>{\n  \"timestamp\": \"2024-06-01T10:15:00Z\",\n  \"level\": \"INFO\",\n  \"service\": \"user-service\",\n  \"request_id\": \"req-123456\",\n  \"message\": \"User updated successfully\",\n  \"user_id\": \"u789\"\n}\n</code></pre>"},{"location":"dev/ops-guide/#luu-y","title":"\ud83d\udccc L\u01b0u \u00fd:","text":"<ul> <li>Log theo c\u1ea5u tr\u00fac (structured logging) \u0111\u1ec3 d\u1ec5 filter v\u00e0 alert</li> <li>G\u1eafn <code>request_id</code> xuy\u00ean su\u1ed1t: t\u1eeb client \u2192 gateway \u2192 service \u2192 pub/sub</li> </ul>"},{"location":"dev/ops-guide/#trace-phan-tan","title":"\ud83d\udd0d Trace ph\u00e2n t\u00e1n","text":"<ul> <li>M\u1ed7i request \u0111\u1ec1u g\u1eafn <code>X-Request-ID</code> v\u00e0 <code>X-Trace-ID</code></li> <li>Gateway kh\u1edfi t\u1ea1o trace \u2192 propagate xu\u1ed1ng c\u00e1c service</li> <li>Google Cloud Trace ghi nh\u1eadn timeline xuy\u00ean service (g\u1ecdi API, DB, Pub/Sub...)</li> </ul>"},{"location":"dev/ops-guide/#su-dung-log-trace","title":"\ud83d\udcca S\u1eed d\u1ee5ng log &amp; trace","text":"<ul> <li>T\u00ecm theo <code>request_id</code>: truy v\u1ebft l\u1ed7i logic li\u00ean service</li> <li>So s\u00e1nh <code>start_time</code> \u2013 <code>end_time</code>: \u0111o \u0111\u1ed9 tr\u1ec5 t\u1eebng hop</li> <li>L\u1ecdc theo <code>level: ERROR</code>: ph\u00e1t hi\u1ec7n service m\u1ea5t \u1ed5n \u0111\u1ecbnh</li> <li>Trace c\u00e1c retry / fail event t\u1eeb Notification, RBAC, Auth</li> </ul>"},{"location":"dev/ops-guide/#goi-y-log-prefix","title":"\ud83d\uddc2\ufe0f G\u1ee3i \u00fd log prefix","text":"Th\u00e0nh ph\u1ea7n Prefix g\u1ee3i \u00fd Gateway <code>[GATEWAY]</code> Auth Service <code>[AUTH]</code> User Service <code>[USER]</code> Notification <code>[NOTI]</code> RBAC <code>[RBAC]</code> Redis <code>[CACHE]</code>"},{"location":"dev/ops-guide/#log-bao-mat","title":"\ud83d\udd10 Log b\u1ea3o m\u1eadt","text":"<ul> <li> <p>Log c\u00e1c s\u1ef1 ki\u1ec7n nh\u1ea1y c\u1ea3m:</p> </li> <li> <p>\u0110\u0103ng nh\u1eadp sai, lock t\u00e0i kho\u1ea3n</p> </li> <li>Thay \u0111\u1ed5i role/permission</li> <li>L\u1ed7i RBAC condition</li> </ul> <p>\ud83d\udcce H\u01b0\u1edbng d\u1eabn chi ti\u1ebft log/tracing: <code>adr-008-audit-logging.md</code></p> <p>\ud83d\udcce C\u1ea5u tr\u00fac trace \u2192 diagram: System Diagrams</p>"},{"location":"dev/ops-guide/#5-quan-ly-bao-mat-credentials","title":"5. Qu\u1ea3n l\u00fd b\u1ea3o m\u1eadt &amp; credentials","text":"<p>T\u1ea5t c\u1ea3 th\u00f4ng tin nh\u1ea1y c\u1ea3m nh\u01b0 token, secret, key API \u0111\u1ec1u \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd qua Google Secret Manager, c\u00f3 ki\u1ec3m so\u00e1t quy\u1ec1n truy c\u1eadp b\u1eb1ng IAM. Kh\u00f4ng \u0111\u1ec3 b\u1ea5t k\u1ef3 credential n\u00e0o trong repo code ho\u1eb7c bi\u1ebfn m\u00f4i tr\u01b0\u1eddng c\u00f4ng khai.</p>"},{"location":"dev/ops-guide/#loai-thong-tin-can-bao-ve","title":"\ud83d\udd10 Lo\u1ea1i th\u00f4ng tin c\u1ea7n b\u1ea3o v\u1ec7","text":"Lo\u1ea1i V\u00ed d\u1ee5 JWT secret <code>JWT_SECRET</code>, <code>REFRESH_SECRET</code> OAuth credentials Google OAuth Client ID/Secret Redis password <code>REDIS_AUTH</code> n\u1ebfu b\u1eadt ACL DB credentials <code>DATABASE_URL</code> API key b\u00ean th\u1ee9 ba Zalo OA, Gmail API Webhook URL Google Chat, Slack alerting"},{"location":"dev/ops-guide/#quan-ly-cau-hinh-ong-khong-nhay-cam","title":"\ud83e\udde9 Qu\u1ea3n l\u00fd c\u1ea5u h\u00ecnh \u0111\u1ed9ng (kh\u00f4ng nh\u1ea1y c\u1ea3m)","text":"<p>Ngo\u00e0i credentials, h\u1ec7 th\u1ed1ng c\u00f3 th\u1ec3 c\u1ea7n c\u1ea5u h\u00ecnh c\u00e1c gi\u00e1 tr\u1ecb \u0111\u1ed9ng nh\u01b0:</p> <ul> <li>Feature flags</li> <li>Ng\u01b0\u1ee1ng c\u1ea3nh b\u00e1o t\u00f9y ch\u1ec9nh</li> <li>C\u1ea5u h\u00ecnh lu\u1ed3ng nghi\u1ec7p v\u1ee5</li> </ul> <p>\ud83d\udccc dx_vas hi\u1ec7n h\u1ed7 tr\u1ee3 \u0111\u1ecdc c\u00e1c c\u1ea5u h\u00ecnh \u0111\u1ed9ng t\u1eeb:</p> <ul> <li>Google Cloud Storage (GCS): ch\u1ee9a file <code>.json</code> c\u1ea5u h\u00ecnh chung (VD: <code>config/global.json</code>)</li> <li>Firestore (option): n\u1ebfu c\u1ea7n c\u1eadp nh\u1eadt realtime (VD: c\u1ea5u h\u00ecnh theo ng\u01b0\u1eddi d\u00f9ng, theo campus)</li> <li>Hardcoded YAML (c\u00f3 ki\u1ec3m so\u00e1t qua Git): d\u00f9ng cho c\u1ea5u h\u00ecnh \u00edt thay \u0111\u1ed5i nh\u01b0 RBAC schema</li> </ul> <p>\u2705 M\u1ecdi thay \u0111\u1ed5i c\u1ea5u h\u00ecnh c\u1ea7n version, audit v\u00e0 tr\u00e1nh c\u1eadp nh\u1eadt runtime n\u1ebfu kh\u00f4ng ki\u1ec3m so\u00e1t rollback.</p>"},{"location":"dev/ops-guide/#quy-trinh-quan-ly-secret","title":"\ud83e\uddf1 Quy tr\u00ecnh qu\u1ea3n l\u00fd secret","text":"<ol> <li>T\u1ea1o secret tr\u00ean GCP:</li> </ol> <pre><code>gcloud secrets create dx-auth-jwt-secret \\\n  --replication-policy automatic\n</code></pre> <ol> <li>Upload version:</li> </ol> <pre><code>echo \"supersecret123\" | gcloud secrets versions add dx-auth-jwt-secret --data-file=-\n</code></pre> <ol> <li>G\u00e1n quy\u1ec1n IAM cho Cloud Run:</li> </ol> <pre><code>gcloud secrets add-iam-policy-binding dx-auth-jwt-secret \\\n  --member=serviceAccount:auth-service@PROJECT_ID.iam.gserviceaccount.com \\\n  --role=roles/secretmanager.secretAccessor\n</code></pre> <ol> <li>Truy xu\u1ea5t trong runtime (qua ENV ho\u1eb7c SDK)</li> </ol>"},{"location":"dev/ops-guide/#thuc-hanh-tot","title":"\ud83d\udce6 Th\u1ef1c h\u00e0nh t\u1ed1t","text":"<ul> <li>Secret ch\u1ec9 c\u1ea5p quy\u1ec1n <code>read</code>, kh\u00f4ng <code>write</code> t\u1eeb service</li> <li>Rotate \u0111\u1ecbnh k\u1ef3 m\u1ed7i 90 ng\u00e0y</li> <li>B\u1eaft bu\u1ed9c audit n\u1ebfu secret b\u1ecb thay \u0111\u1ed5i</li> <li>Kh\u00f4ng \u0111\u1ec3 <code>.env</code> ch\u1ee9a secret trong repo \u2013 d\u00f9ng <code>.env.example</code></li> </ul>"},{"location":"dev/ops-guide/#kiem-tra-nhanh","title":"\ud83e\uddea Ki\u1ec3m tra nhanh","text":"<pre><code>gcloud secrets list\ngcloud secrets versions list dx-auth-jwt-secret\n</code></pre> <p>\ud83d\udcce Ch\u00ednh s\u00e1ch b\u1ea3o m\u1eadt chi ti\u1ebft: <code>adr-003-secrets.md</code></p> <p>\ud83d\udcce T\u1ed5ng quan b\u1ea3o m\u1eadt to\u00e0n h\u1ec7 th\u1ed1ng: Dev Guide \u2013 M\u1ee5c 11.3</p>"},{"location":"dev/ops-guide/#6-chien-luoc-scaling-autoscale","title":"6. Chi\u1ebfn l\u01b0\u1ee3c scaling &amp; autoscale","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng Google Cloud Run \u0111\u1ec3 tri\u1ec3n khai to\u00e0n b\u1ed9 service backend. Cloud Run cung c\u1ea5p kh\u1ea3 n\u0103ng autoscale theo s\u1ed1 l\u01b0\u1ee3ng request, \u0111\u1ea3m b\u1ea3o h\u1ec7 th\u1ed1ng lu\u00f4n ph\u1ea3n h\u1ed3i nhanh nh\u01b0ng ti\u1ebft ki\u1ec7m t\u00e0i nguy\u00ean.</p>"},{"location":"dev/ops-guide/#autoscaling-mac-inh","title":"\u2699\ufe0f Autoscaling m\u1eb7c \u0111\u1ecbnh","text":"Service Min instance Max instance Concurrency (requests/instance) Ghi ch\u00fa Gateway 2 50 10 Lu\u00f4n duy tr\u00ec s\u1eb5n s\u00e0ng Auth/User 1 20 10 Core services, nh\u1ea1y c\u1ea3m v\u1edbi \u0111\u1ed9 tr\u1ec5 Notification 0 30 20 C\u00f3 th\u1ec3 burst cao khi g\u1eedi h\u00e0ng lo\u1ea1t Adapters 0 10 10 T\u00f9y theo m\u1ee9c \u0111\u1ed9 t\u00edch h\u1ee3p (CRM, SIS, LMS) <p>\ud83d\udccc Gi\u00e1 tr\u1ecb concurrency m\u1eb7c \u0111\u1ecbnh c\u1ee7a Cloud Run l\u00e0 <code>80 requests/instance</code>. H\u1ec7 th\u1ed1ng dx-vas \u0111\u00e3 c\u1ea5u h\u00ecnh l\u1ea1i (gi\u1ea3m) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o \u0111\u1ed9 tr\u1ec5 th\u1ea5p cho c\u00e1c service x\u1eed l\u00fd d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m nh\u01b0 Auth v\u00e0 User.</p>"},{"location":"dev/ops-guide/#hanh-vi-scaling","title":"\ud83d\udd01 H\u00e0nh vi scaling","text":"<ul> <li>T\u0103ng instance khi s\u1ed1 l\u01b0\u1ee3ng request v\u01b0\u1ee3t concurrency threshold</li> <li>Gi\u1ea3m instance khi idle trong m\u1ed9t th\u1eddi gian (15 ph\u00fat m\u1eb7c \u0111\u1ecbnh)</li> <li>Cloud Run \u0111\u1ea3m b\u1ea3o m\u1ed7i container x\u1eed l\u00fd t\u1ed1i \u0111a <code>CONCURRENCY</code> request c\u00f9ng l\u00fac</li> </ul>"},{"location":"dev/ops-guide/#toi-uu-scaling","title":"\ud83d\udcc9 T\u1ed1i \u01b0u scaling","text":"<ul> <li>S\u1eed d\u1ee5ng health check <code>/healthz</code> \u0111\u1ec3 lo\u1ea1i b\u1ecf container l\u1ed7i kh\u1ecfi autoscaler</li> <li>Log metric <code>request count</code>, <code>concurrency</code>, <code>latency</code> \u0111\u1ec3 \u0111\u00e1nh gi\u00e1 scaling th\u1ef1c t\u1ebf</li> <li>C\u00f3 th\u1ec3 g\u00e1n h\u1ea1n m\u1ee9c chi ph\u00ed/quotas cho t\u1eebng service n\u1ebfu c\u1ea7n ki\u1ec3m so\u00e1t t\u1ea3i</li> </ul>"},{"location":"dev/ops-guide/#luu-y_1","title":"\ud83d\udd10 L\u01b0u \u00fd","text":"<ul> <li>Lu\u00f4n b\u1eadt min instance = 1 v\u1edbi Auth v\u00e0 User Service \u0111\u1ec3 gi\u1ea3m cold start</li> <li>S\u1eed d\u1ee5ng VPC Connector cho Cloud SQL/Redis \u2013 \u0111\u1ea3m b\u1ea3o scaling kh\u00f4ng b\u1ecb ngh\u1ebdn</li> <li>Kh\u00f4ng scale v\u00f4 h\u1ea1n: max instance c\u1ea7n \u0111\u01b0\u1ee3c c\u1ea5u h\u00ecnh ph\u00f9 h\u1ee3p \u0111\u1ec3 tr\u00e1nh qu\u00e1 t\u1ea3i DB</li> </ul> <p>\ud83d\udcce C\u1ea5u tr\u00fac tri\u1ec3n khai: System Diagrams </p> <p>\ud83d\udcce Tham kh\u1ea3o th\u00eam: Dev Guide</p>"},{"location":"dev/ops-guide/#7-quy-trinh-cap-nhat-rollback","title":"7. Quy tr\u00ecnh c\u1eadp nh\u1eadt &amp; rollback","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng CI/CD \u0111\u1ec3 tri\u1ec3n khai d\u1ecbch v\u1ee5 l\u00ean Cloud Run. M\u1ed7i l\u1ea7n c\u1eadp nh\u1eadt \u0111\u1ec1u t\u1ea1o ra m\u1ed9t b\u1ea3n ph\u00e1t h\u00e0nh m\u1edbi (revision) v\u00e0 c\u00f3 th\u1ec3 rollback v\u1ec1 b\u1ea3n c\u0169 nhanh ch\u00f3ng n\u1ebfu ph\u00e1t sinh s\u1ef1 c\u1ed1.</p>"},{"location":"dev/ops-guide/#quy-trinh-cap-nhat","title":"\ud83d\ude80 Quy tr\u00ecnh c\u1eadp nh\u1eadt","text":"<ol> <li>Developer merge code v\u00e0o nh\u00e1nh <code>dev</code> ho\u1eb7c <code>main</code></li> <li>GitHub Actions th\u1ef1c hi\u1ec7n:</li> <li>Ch\u1ea1y test</li> <li>Build Docker image \u2192 \u0111\u1ea9y l\u00ean Artifact Registry</li> <li>Deploy Cloud Run service v\u1edbi revision m\u1edbi</li> <li>Cloud Run gi\u1eef l\u1ea1i to\u00e0n b\u1ed9 revision \u0111\u00e3 deploy (tr\u1eeb khi b\u1ecb x\u00f3a)</li> </ol>"},{"location":"dev/ops-guide/#kiem-soat-theo-moi-truong","title":"\ud83d\udce6 Ki\u1ec3m so\u00e1t theo m\u00f4i tr\u01b0\u1eddng","text":"Nh\u00e1nh M\u00f4i tr\u01b0\u1eddng Auto Deploy Require Approval <code>dev</code> Staging \u2705 \u274c <code>main</code> Production \u26a0\ufe0f (C\u00f3 th\u1ec3 b\u1eadt/t\u1eaft) \u2705 Required"},{"location":"dev/ops-guide/#rollback-khi-loi","title":"\ud83d\uded1 Rollback khi l\u1ed7i","text":"<p>N\u1ebfu sau deploy x\u1ea3y ra l\u1ed7i:</p> <ol> <li>V\u00e0o Google Cloud Console \u2192 Cloud Run \u2192 Service</li> <li>Ch\u1ecdn tab Revisions</li> <li>Click Pin traffic ho\u1eb7c Rollback v\u1ec1 revision tr\u01b0\u1edbc \u0111\u00f3</li> <li>Ho\u1eb7c d\u00f9ng l\u1ec7nh CLI:</li> </ol> <pre><code>gcloud run services update-traffic user-service \\\n  --to-revisions=rev-1234=100\n</code></pre>"},{"location":"dev/ops-guide/#luu-y-khi-kiem-tra-version","title":"\ud83e\uddea L\u01b0u \u00fd khi ki\u1ec3m tra version","text":"<ul> <li>M\u1ed7i revision c\u00f3 label: <code>git_sha</code>, <code>build_time</code></li> <li>Gateway ho\u1eb7c c\u00e1c service c\u00f3 th\u1ec3 tr\u1ea3 <code>X-Revision-ID</code> trong header</li> <li>C\u00f3 th\u1ec3 t\u1ea1o endpoint <code>/__version__</code> tr\u1ea3 v\u1ec1 git commit + th\u1eddi gian build</li> </ul>"},{"location":"dev/ops-guide/#nhung-rui-ro-can-chu-y","title":"\u26a0\ufe0f Nh\u1eefng r\u1ee7i ro c\u1ea7n ch\u00fa \u00fd","text":"<ul> <li>Rollback logic c\u00f3 th\u1ec3 kh\u00f4ng rollback \u0111\u01b0\u1ee3c DB schema \u2192 d\u00f9ng <code>alembic downgrade</code> n\u1ebfu c\u1ea7n</li> <li>Cache ho\u1eb7c RBAC c\u00f3 th\u1ec3 c\u1ea7n invalidate n\u1ebfu rollback auth/user</li> <li>N\u1ebfu s\u1eed d\u1ee5ng secret m\u1edbi trong phi\u00ean b\u1ea3n m\u1edbi \u2192 rollback ph\u1ea3i \u0111\u1ea3m b\u1ea3o backward-compatible</li> </ul>"},{"location":"dev/ops-guide/#zero-downtime-deployment-canary-release-cloud-run","title":"\u2728 Zero Downtime Deployment &amp; Canary Release (Cloud Run)","text":"<p>Cloud Run h\u1ed7 tr\u1ee3 tri\u1ec3n khai kh\u00f4ng downtime b\u1eb1ng c\u00e1ch t\u1ef1 \u0111\u1ed9ng route traffic sang revision m\u1edbi sau khi build &amp; deploy th\u00e0nh c\u00f4ng. B\u1ea1n kh\u00f4ng c\u1ea7n c\u1ea5u h\u00ecnh load balancer ph\u1ee9c t\u1ea1p nh\u01b0 VM/Container truy\u1ec1n th\u1ed1ng.</p> <p>Chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai c\u00f3 th\u1ec3 \u00e1p d\u1ee5ng:</p>"},{"location":"dev/ops-guide/#1-all-or-nothing-mac-inh","title":"\u2705 1. All-or-nothing (M\u1eb7c \u0111\u1ecbnh)","text":"<ul> <li>Sau khi deploy, to\u00e0n b\u1ed9 traffic \u0111\u01b0\u1ee3c chuy\u1ec3n sang revision m\u1edbi.</li> <li>N\u1ebfu c\u00f3 s\u1ef1 c\u1ed1, rollback v\u1ec1 revision c\u0169 b\u1eb1ng l\u1ec7nh: <pre><code>gcloud run services update-traffic my-service \\\n  --to-revisions=rev-abc123=100\n</code></pre></li> </ul>"},{"location":"dev/ops-guide/#2-canary-release-traffic-splitting","title":"\ud83e\uddea 2. Canary Release (Traffic Splitting)","text":"<ul> <li>Cho ph\u00e9p chia traffic gi\u1eefa revision c\u0169 v\u00e0 m\u1edbi (VD: 90% - 10%)</li> </ul> <pre><code>gcloud run services update-traffic my-service \\\n  --to-revisions=rev-old=90,rev-new=10\n</code></pre> <ul> <li>Theo d\u00f5i metric (error rate, latency) trong v\u00e0i ph\u00fat, sau \u0111\u00f3 t\u0103ng d\u1ea7n l\u00ean 100%.</li> </ul>"},{"location":"dev/ops-guide/#luu-y_2","title":"\ud83d\udee1\ufe0f L\u01b0u \u00fd:","text":"<ul> <li>M\u1ed7i revision l\u00e0 m\u1ed9t phi\u00ean b\u1ea3n \u0111\u1ed9c l\u1eadp (immutable).</li> <li>\u0110\u1ea3m b\u1ea3o backward compatibility trong DB schema n\u1ebfu c\u1ea7n rollback.</li> <li>C\u00f3 th\u1ec3 t\u1ef1 \u0111\u1ed9ng h\u00f3a canary via GitHub Actions + monitoring alert.</li> </ul> <p>\ud83d\udccc Canary release gi\u00fap gi\u1ea3m r\u1ee7i ro s\u1ea3n xu\u1ea5t \u2013 r\u1ea5t ph\u00f9 h\u1ee3p cho c\u00e1c service nh\u1ea1y c\u1ea3m (nh\u01b0 User Service, Notification).</p> <p>\ud83d\udcce H\u01b0\u1edbng d\u1eabn CI/CD chi ti\u1ebft: Dev Guide</p> <p>\ud83d\udcce Checklist s\u1ef1 c\u1ed1: M\u1ee5c 11 \u2013 \u1ee8ng ph\u00f3 s\u1ef1 c\u1ed1</p>"},{"location":"dev/ops-guide/#8-quan-ly-pubsub-dead-letter","title":"8. Qu\u1ea3n l\u00fd Pub/Sub &amp; Dead Letter","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng Google Cloud Pub/Sub \u0111\u1ec3 truy\u1ec1n s\u1ef1 ki\u1ec7n b\u1ea5t \u0111\u1ed3ng b\u1ed9 gi\u1eefa c\u00e1c service (Notification, Sync, Audit...). M\u1ed7i topic c\u00f3 \u00edt nh\u1ea5t m\u1ed9t subscription. N\u1ebfu x\u1eed l\u00fd l\u1ed7i ho\u1eb7c timeout, message s\u1ebd \u0111\u01b0\u1ee3c chuy\u1ec3n sang Dead Letter Topic (DLT).</p>"},{"location":"dev/ops-guide/#cac-topic-chinh","title":"\ud83d\udd01 C\u00e1c topic ch\u00ednh","text":"Topic Publisher Subscriber M\u00f4 t\u1ea3 <code>notification-events</code> CRM, SIS, Gateway Notification Service G\u1eedi th\u00f4ng b\u00e1o theo s\u1ef1 ki\u1ec7n <code>user-events</code> Auth, CRM User Service \u0110\u1ed3ng b\u1ed9 tr\u1ea1ng th\u00e1i, RBAC <code>sync-events</code> CRM Adapter SIS Adapter, LMS Adapter \u0110\u1ed3ng b\u1ed9 h\u1ecdc sinh sau tuy\u1ec3n sinh <code>audit-events</code> All Audit Logger Ghi nh\u1eadn h\u00e0nh vi nh\u1ea1y c\u1ea3m"},{"location":"dev/ops-guide/#dead-letter-topics-dlt","title":"\ud83d\udce6 Dead Letter Topics (DLT)","text":"<p>M\u1ed7i subscription \u0111\u1ec1u c\u00f3 c\u1ea5u h\u00ecnh DLT \u0111i k\u00e8m, v\u00ed d\u1ee5:</p> <pre><code>gcloud pubsub subscriptions update my-subscription \\\n  --dead-letter-topic=projects/$PROJECT_ID/topics/my-sub-dlt \\\n  --max-delivery-attempts=5\n</code></pre> <p>Khi message retry qu\u00e1 5 l\u1ea7n \u2192 chuy\u1ec3n sang DLT \u2192 log l\u1ea1i s\u1ef1 ki\u1ec7n l\u1ed7i.</p>"},{"location":"dev/ops-guide/#giam-sat-pubsub","title":"\ud83d\udd0d Gi\u00e1m s\u00e1t Pub/Sub","text":"<ul> <li> <p>S\u1eed d\u1ee5ng metric:</p> </li> <li> <p><code>num_undelivered_messages</code></p> </li> <li><code>ack_latency</code></li> <li><code>dead_letter_message_count</code></li> <li> <p>C\u00f3 th\u1ec3 t\u1ea1o alert khi:</p> </li> <li> <p>DLT t\u0103ng \u0111\u1ed9t bi\u1ebfn</p> </li> <li>T\u1ed3n \u0111\u1ecdng nhi\u1ec1u message ch\u01b0a x\u1eed l\u00fd</li> <li>Dashboard: <code>pubsub-dashboard</code>, <code>notification-dlt-dashboard</code></li> </ul>"},{"location":"dev/ops-guide/#handling-retry","title":"\ud83d\udee0 Handling retry","text":"<ul> <li>Logic subscriber c\u1ea7n idempotent (x\u1eed l\u00fd l\u1ea1i kh\u00f4ng g\u00e2y l\u1ed7i)</li> <li>D\u00f9ng <code>message_id</code> \u0111\u1ec3 detect duplicate</li> <li>N\u1ebfu s\u1eed d\u1ee5ng database \u2192 d\u00f9ng transaction + retry-safe query</li> </ul>"},{"location":"dev/ops-guide/#debug-dlt-message","title":"\u270f\ufe0f Debug DLT message","text":"<ol> <li>Subscribe t\u1ea1m th\u1eddi v\u00e0o DLT</li> <li>Ghi log n\u1ed9i dung message \u0111\u1ec3 ph\u00e2n t\u00edch</li> <li>Quy\u1ebft \u0111\u1ecbnh: s\u1eeda l\u1ed7i source, ho\u1eb7c re-publish message (th\u1eadn tr\u1ecdng)</li> </ol> <p>\ud83d\udcce V\u00ed d\u1ee5 tri\u1ec3n khai subscriber: <code>dx-notification-service</code></p> <p>\ud83d\udcce S\u01a1 \u0111\u1ed3 flow: System Diagrams</p>"},{"location":"dev/ops-guide/#9-kiem-soat-chi-phi-toi-uu-tai-nguyen","title":"9. Ki\u1ec3m so\u00e1t chi ph\u00ed &amp; t\u1ed1i \u01b0u t\u00e0i nguy\u00ean","text":"<p>H\u1ec7 th\u1ed1ng dx-vas s\u1eed d\u1ee5ng nhi\u1ec1u d\u1ecbch v\u1ee5 managed (Cloud Run, SQL, Pub/Sub...) \u2013 gi\u00fap v\u1eadn h\u00e0nh \u0111\u01a1n gi\u1ea3n nh\u01b0ng c\u0169ng c\u1ea7n theo d\u00f5i s\u00e1t \u0111\u1ec3 tr\u00e1nh chi ph\u00ed v\u01b0\u1ee3t ki\u1ec3m so\u00e1t. Chi ph\u00ed ch\u1ee7 y\u1ebfu ph\u00e1t sinh t\u1eeb Cloud Run, Cloud SQL, Pub/Sub, Storage v\u00e0 Network.</p>"},{"location":"dev/ops-guide/#cac-thanh-phan-ton-chi-phi","title":"\ud83d\udcb0 C\u00e1c th\u00e0nh ph\u1ea7n t\u1ed1n chi ph\u00ed","text":"D\u1ecbch v\u1ee5 Nh\u00f3m ch\u00ednh Chi ph\u00ed t\u00ednh theo Cloud Run API Gateway, c\u00e1c service S\u1ed1 request, CPU/Memory usage Cloud SQL PostgreSQL, MySQL Instance uptime + storage Redis (MemoryStore) RBAC cache GB RAM provisioned Pub/Sub Event-driven flow Message volume + retention GCS Static assets, backup GB l\u01b0u tr\u1eef + truy xu\u1ea5t IAM/Secret Manager Token, config R\u1ea5t nh\u1ecf nh\u01b0ng c\u00f3 \u0111\u1ecbnh m\u1ee9c"},{"location":"dev/ops-guide/#network-egress-costs","title":"\ud83c\udf10 Network Egress Costs","text":"<ul> <li>Cloud Run b\u1ecb t\u00ednh ph\u00ed egress n\u1ebfu g\u1ecdi ra ngo\u00e0i VPC, \u0111\u1eb7c bi\u1ec7t l\u00e0:</li> <li>G\u1ecdi API b\u00ean th\u1ee9 ba (Zalo, Gmail...)</li> <li>Truy c\u1eadp GCS n\u1ebfu kh\u00f4ng b\u1eadt Private Google Access</li> <li>Giao ti\u1ebfp li\u00ean v\u00f9ng (multi-region)</li> </ul> <p>\ud83d\udccc C\u00e1ch t\u1ed1i \u01b0u:</p> Gi\u1ea3i ph\u00e1p M\u00f4 t\u1ea3 Private Google Access Cho ph\u00e9p Cloud Run g\u1ecdi GCS/PubSub m\u00e0 kh\u00f4ng t\u00ednh egress VPC Service Controls H\u1ea1n ch\u1ebf egress tr\u00e1i ph\u00e9p t\u1eeb service n\u1ed9i b\u1ed9 Region matching \u0110\u1ea3m b\u1ea3o Redis, SQL, Cloud Run c\u00f9ng region (vd: <code>asia-southeast1</code>) API Gateway batching G\u1ed9p nhi\u1ec1u API outbound th\u00e0nh 1 request n\u1ebfu \u0111\u01b0\u1ee3c <p>\u26a0\ufe0f M\u1ed9t s\u1ed1 quota mi\u1ec5n ph\u00ed c\u1ee7a GCP kh\u00f4ng \u00e1p d\u1ee5ng cho traffic egress gi\u1eefa v\u00f9ng ho\u1eb7c ra Internet.</p>"},{"location":"dev/ops-guide/#theo-doi-chi-phi","title":"\ud83d\udcca Theo d\u00f5i chi ph\u00ed","text":"<ul> <li>S\u1eed d\u1ee5ng Cloud Billing \u2192 Cost Table + Cost Breakdown theo service</li> <li>T\u1ea1o budget alert qua Billing Budgets:</li> </ul> <pre><code>gcloud billing budgets create --display-name=\"VAS Monthly Budget\" ...\n</code></pre> <ul> <li>G\u1eedi c\u1ea3nh b\u00e1o qua email ho\u1eb7c Google Chat</li> </ul>"},{"location":"dev/ops-guide/#chien-luoc-toi-uu","title":"\ud83c\udfaf Chi\u1ebfn l\u01b0\u1ee3c t\u1ed1i \u01b0u","text":"D\u1ecbch v\u1ee5 Chi\u1ebfn l\u01b0\u1ee3c Cloud Run Set max instance limit, tuning concurrency Redis Ch\u1ec9 cache permission n\u00f3ng, TTL ng\u1eafn (5\u201310 ph\u00fat) Cloud SQL T\u1eaft instance staging ban \u0111\u00eam, s\u1eed d\u1ee5ng shared tier n\u1ebfu load th\u1ea5p Pub/Sub Gi\u1ea3m message size, ki\u1ec3m tra retry qu\u00e1 m\u1ee9c GCS Xo\u00e1 \u1ea3nh c\u0169/backup qu\u00e1 h\u1ea1n, d\u00f9ng <code>lifecycle rule</code>"},{"location":"dev/ops-guide/#canh-bao-thuc-te","title":"\u26a0\ufe0f C\u1ea3nh b\u00e1o th\u1ef1c t\u1ebf","text":"<ul> <li>Cloud SQL chi\u1ebfm ~50% t\u1ed5ng bill n\u1ebfu kh\u00f4ng t\u1ed1i \u01b0u idle time</li> <li>Redis billing theo GB RAM provisioned   <p>\ud83d\udccc dx-vas hi\u1ec7n s\u1eed d\u1ee5ng Memorystore for Redis (standard tier, non-cluster) \u2013 kh\u00f4ng t\u1ef1 \u0111\u1ed9ng scale. N\u1ebfu c\u1ea7n scaling theo chi\u1ec1u ngang, c\u00f3 th\u1ec3 c\u00e2n nh\u1eafc n\u00e2ng c\u1ea5p l\u00ean Memorystore for Redis Cluster.</p> </li> <li>Pub/Sub c\u00f3 th\u1ec3 ph\u00e1t sinh retry loop g\u00e2y bill \u1ea9n</li> </ul> <p>\ud83d\udcce Theo d\u00f5i chi ph\u00ed chi ti\u1ebft: GCP \u2192 Billing \u2192 Reports</p> <p>\ud83d\udcce C\u1ea3nh b\u00e1o s\u1eed d\u1ee5ng resource: Xem th\u00eam M\u1ee5c 3 \u2013 Gi\u00e1m s\u00e1t &amp; c\u1ea3nh b\u00e1o</p>"},{"location":"dev/ops-guide/#10-checklist-inh-ky-van-hanh","title":"10. Checklist \u0111\u1ecbnh k\u1ef3 v\u1eadn h\u00e0nh","text":"<p>Vi\u1ec7c ki\u1ec3m tra \u0111\u1ecbnh k\u1ef3 l\u00e0 thi\u1ebft y\u1ebfu \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o h\u1ec7 th\u1ed1ng dx-vas ho\u1ea1t \u0111\u1ed9ng an to\u00e0n, hi\u1ec7u qu\u1ea3 v\u00e0 kh\u00f4ng ph\u00e1t sinh chi ph\u00ed ngo\u00e0i ki\u1ec3m so\u00e1t. Checklist sau \u0111\u00e2y \u0111\u01b0\u1ee3c chia theo t\u1ea7n su\u1ea5t: h\u00e0ng tu\u1ea7n, h\u00e0ng th\u00e1ng v\u00e0 h\u00e0ng qu\u00fd.</p>"},{"location":"dev/ops-guide/#hang-tuan","title":"\ud83d\udd01 H\u00e0ng tu\u1ea7n","text":"<ul> <li> Ki\u1ec3m tra Cloud Run error rate \u2265 5%</li> <li> X\u00e1c minh c\u00e1c alert Pub/Sub/Redis c\u00f3 b\u1ecb miss kh\u00f4ng</li> <li> Xem l\u1ea1i DLT logs \u2192 x\u1eed l\u00fd message fail l\u1eb7p l\u1ea1i</li> <li> Ki\u1ec3m tra tr\u1ea1ng th\u00e1i deploy c\u1ee7a c\u00e1c service staging</li> <li> Check audit log li\u00ean quan \u0111\u1ebfn RBAC, Auth</li> </ul>"},{"location":"dev/ops-guide/#hang-thang","title":"\ud83d\udcc5 H\u00e0ng th\u00e1ng","text":"<ul> <li> Xo\u00e1 Cloud SQL backups c\u0169 (n\u1ebfu kh\u00f4ng c\u1ea7n thi\u1ebft)</li> <li> Review budget report \u2192 so v\u1edbi usage th\u1ef1c t\u1ebf</li> <li> Rotate JWT signing key (n\u1ebfu b\u1eadt ch\u1ebf \u0111\u1ed9 ng\u1eafn h\u1ea1n)</li> <li> Check Cloud Storage \u2192 xo\u00e1 \u1ea3nh/file/log qu\u00e1 h\u1ea1n</li> <li> Ch\u1ea1y l\u1ea1i test E2E: Webform \u2192 CRM \u2192 SIS \u2192 LMS</li> <li> Ki\u1ec3m tra l\u1ea1i gi\u1edbi h\u1ea1n Cloud Run (max instance, timeout)</li> </ul>"},{"location":"dev/ops-guide/#hang-quy","title":"\ud83d\udce3 H\u00e0ng qu\u00fd","text":"<ul> <li> R\u00e0 so\u00e1t IAM roles tr\u00ean to\u00e0n b\u1ed9 d\u1ef1 \u00e1n</li> <li> \u0110\u00e1nh gi\u00e1 l\u1ea1i quota c\u1ee7a Redis, Cloud SQL, Pub/Sub</li> <li> Ki\u1ec3m th\u1eed k\u1ecbch b\u1ea3n rollback v\u00e0 DR (Disaster Recovery)</li> <li> \u0110\u00e1nh gi\u00e1 performance th\u1ef1c t\u1ebf \u2192 \u0111i\u1ec1u ch\u1ec9nh autoscale</li> <li> C\u1eadp nh\u1eadt b\u1ea3ng permission &amp; roles (RBAC evolution)</li> </ul>"},{"location":"dev/ops-guide/#cach-theo-doi-checklist","title":"\ud83d\udccc C\u00e1ch theo d\u00f5i checklist","text":"<ul> <li>L\u01b0u checklist tr\u00ean Notion/Google Sheet theo ng\u00e0y</li> <li>D\u00f9ng Google Calendar \u0111\u1ec3 nh\u1eafc l\u1ecbch \u0111\u1ecbnh k\u1ef3</li> <li>G\u1eafn v\u00e0o bu\u1ed5i h\u1ecdp k\u1ef9 thu\u1eadt h\u00e0ng th\u00e1ng (KT Sync)</li> </ul> <p>\ud83d\udcce C\u00e1c log h\u1ed7 tr\u1ee3: M\u1ee5c 4 \u2013 Logging &amp; Trace </p> <p>\ud83d\udcce Chi ph\u00ed/quota \u2192 M\u1ee5c 9 \u2013 Ki\u1ec3m so\u00e1t chi ph\u00ed</p>"},{"location":"dev/ops-guide/#11-ung-pho-su-co-khoi-phuc","title":"11. \u1ee8ng ph\u00f3 s\u1ef1 c\u1ed1 &amp; kh\u00f4i ph\u1ee5c","text":"<p>Trong m\u1ecdi h\u1ec7 th\u1ed1ng s\u1ea3n ph\u1ea9m, kh\u1ea3 n\u0103ng ph\u1ea3n \u1ee9ng nhanh khi x\u1ea3y ra l\u1ed7i nghi\u00eam tr\u1ecdng l\u00e0 y\u1ebfu t\u1ed1 s\u1ed1ng c\u00f2n. dx-vas \u00e1p d\u1ee5ng m\u00f4 h\u00ecnh chu\u1ea9n h\u00f3a: ph\u00e2n lo\u1ea1i s\u1ef1 c\u1ed1, x\u1eed l\u00fd theo checklist, ghi nh\u1eadn h\u1eadu ki\u1ec3m (postmortem).</p>"},{"location":"dev/ops-guide/#vai-tro-trong-quy-trinh-ung-pho-su-co-incident-response-roles","title":"\ud83e\uddd1\u200d\ud83d\ude92 Vai tr\u00f2 trong quy tr\u00ecnh \u1ee9ng ph\u00f3 s\u1ef1 c\u1ed1 (Incident Response Roles)","text":"<p>Khi x\u1ea3y ra s\u1ef1 c\u1ed1 nghi\u00eam tr\u1ecdng (v\u00ed d\u1ee5: gi\u00e1n \u0111o\u1ea1n d\u1ecbch v\u1ee5, m\u1ea5t d\u1eef li\u1ec7u, s\u1ef1 c\u1ed1 b\u1ea3o m\u1eadt), vi\u1ec7c ph\u00e2n vai r\u00f5 r\u00e0ng gi\u00fap \u0111\u1ed9i ng\u0169 ph\u1ea3n \u1ee9ng nhanh v\u00e0 hi\u1ec7u qu\u1ea3 h\u01a1n.</p> Vai tr\u00f2 M\u00f4 t\u1ea3 nhi\u1ec7m v\u1ee5 ch\u00ednh Incident Commander (IC) \u0110i\u1ec1u ph\u1ed1i to\u00e0n b\u1ed9 quy tr\u00ecnh \u1ee9ng ph\u00f3, \u0111\u01b0a ra quy\u1ebft \u0111\u1ecbnh cu\u1ed1i c\u00f9ng v\u1ec1 rollback, escalations. Technical Lead (TL) Ph\u00e2n t\u00edch nguy\u00ean nh\u00e2n, \u0111\u01b0a ra h\u01b0\u1edbng x\u1eed l\u00fd k\u1ef9 thu\u1eadt, l\u00e0m vi\u1ec7c tr\u1ef1c ti\u1ebfp v\u1edbi h\u1ec7 th\u1ed1ng. Communications Lead (Comms) G\u1eedi update n\u1ed9i b\u1ed9, th\u00f4ng b\u00e1o t\u1edbi stakeholder, kh\u00e1ch h\u00e0ng (n\u1ebfu c\u1ea7n). Scribe / Logger Ghi l\u1ea1i timeline x\u1eed l\u00fd s\u1ef1 c\u1ed1, action \u0111\u00e3 th\u1ef1c hi\u1ec7n \u2013 ph\u1ee5c v\u1ee5 postmortem. Service Owner (n\u1ebfu kh\u00e1c IC) Cung c\u1ea5p ki\u1ebfn th\u1ee9c h\u1ec7 th\u1ed1ng, ch\u1ecbu tr\u00e1ch nhi\u1ec7m kh\u00f4i ph\u1ee5c d\u1ecbch v\u1ee5. <p>\ud83e\udded Trong \u0111\u1ed9i ng\u0169 nh\u1ecf, m\u1ed9t ng\u01b0\u1eddi c\u00f3 th\u1ec3 ki\u00eam nhi\u1ec1u vai. Tuy nhi\u00ean, IC n\u00ean lu\u00f4n l\u00e0 ng\u01b0\u1eddi t\u00e1ch bi\u1ec7t v\u1edbi thao t\u00e1c k\u1ef9 thu\u1eadt \u0111\u1ec3 gi\u1eef \u0111\u01b0\u1ee3c \"t\u1ea7m nh\u00ecn chi\u1ebfn l\u01b0\u1ee3c\".</p> <p>\ud83d\udccc Template postmortem c\u00f3 th\u1ec3 \u0111\u1eb7t trong <code>docs/postmortem-template.md</code>.</p>"},{"location":"dev/ops-guide/#phan-loai-su-co","title":"\ud83d\udea8 Ph\u00e2n lo\u1ea1i s\u1ef1 c\u1ed1","text":"Lo\u1ea1i V\u00ed d\u1ee5 Ph\u1ea3n \u1ee9ng \ud83d\udd25 Production Outage Cloud Run 5xx to\u00e0n h\u1ec7 th\u1ed1ng Ph\u00e1t \u0111\u1ed9ng k\u00eanh kh\u1ea9n c\u1ea5p \u26a0\ufe0f Functional Bug Notification kh\u00f4ng g\u1eedi Theo m\u1ee9c \u0111\u1ed9 nghi\u00eam tr\u1ecdng \u23f1 Degraded Redis timeout, DB latency cao Theo d\u00f5i, \u0111i\u1ec1u ch\u1ec9nh autoscale \ud83d\udd12 Security R\u00f2 r\u1ec9 token, t\u1ea5n c\u00f4ng brute force Ng\u1eaft t\u1ea1m, rotate credential"},{"location":"dev/ops-guide/#checklist-phan-ung-nhanh","title":"\ud83e\uddef Checklist ph\u1ea3n \u1ee9ng nhanh","text":"<ol> <li>X\u00e1c nh\u1eadn l\u1ed7i</li> <li>Ghi nh\u1eadn timestamp + request_id</li> <li>Check status Cloud Run, Redis, Pub/Sub, GCS</li> <li>Ph\u00e2n lo\u1ea1i l\u1ed7i</li> <li>Outage / Degraded / Security</li> <li>K\u00edch ho\u1ea1t recovery</li> <li>N\u1ebfu l\u1ed7i rollout: Rollback ngay (Xem M\u1ee5c 7)</li> <li>N\u1ebfu Redis fail: flush cache + restart service</li> <li>Th\u00f4ng b\u00e1o</li> <li>G\u1eedi update qua Google Chat <code>#dx-ops-alert</code></li> <li>Kh\u00f4i ph\u1ee5c t\u1ea1m th\u1eddi</li> <li>T\u1eaft 1 v\u00e0i feature non-critical n\u1ebfu c\u1ea7n</li> </ol>"},{"location":"dev/ops-guide/#log-cong-cu-ho-tro","title":"\ud83d\uddc2 Log &amp; c\u00f4ng c\u1ee5 h\u1ed7 tr\u1ee3","text":"<ul> <li>Cloud Run log + trace</li> <li>Pub/Sub Dead Letter inspection</li> <li>Redis monitor command</li> <li>GCS object viewer (xem c\u1ea5u h\u00ecnh/static l\u1ed7i)</li> </ul>"},{"location":"dev/ops-guide/#postmortem-template","title":"\ud83d\udccb Postmortem template","text":"<ol> <li>S\u1ef1 c\u1ed1: (m\u00f4 t\u1ea3 ng\u1eafn)</li> <li>Th\u1eddi gian: (b\u1eaft \u0111\u1ea7u \u2013 k\u1ebft th\u00fac)</li> <li>\u1ea2nh h\u01b0\u1edfng: (ng\u01b0\u1eddi d\u00f9ng n\u00e0o? d\u1ecbch v\u1ee5 n\u00e0o?)</li> <li>Nguy\u00ean nh\u00e2n g\u1ed1c: (root cause)</li> <li>Gi\u1ea3i ph\u00e1p kh\u1eafc ph\u1ee5c: (ng\u1eafn h\u1ea1n + d\u00e0i h\u1ea1n)</li> <li>Ai x\u1eed l\u00fd / li\u00ean h\u1ec7: (contact)</li> </ol> <p>\u2705 M\u1ecdi postmortem c\u1ea7n l\u01b0u t\u1ea1i <code>docs/postmortem/</code> d\u01b0\u1edbi repo <code>dx-vas</code></p> <p>\ud83d\udcce C\u00e1ch ki\u1ec3m tra s\u1ef1 c\u1ed1 theo trace: M\u1ee5c 4 \u2013 Logging &amp; Trace </p> <p>\ud83d\udcce Kh\u1ea3 n\u0103ng rollback: M\u1ee5c 7 \u2013 C\u1eadp nh\u1eadt &amp; Rollback</p>"},{"location":"dev/ops-guide/#12-backup-disaster-recovery-dr","title":"12. Backup &amp; Disaster Recovery (DR)","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf v\u1edbi kh\u1ea3 n\u0103ng kh\u00f4i ph\u1ee5c linh ho\u1ea1t v\u00e0 gi\u1edbi h\u1ea1n downtime. M\u1ed7i th\u00e0nh ph\u1ea7n quan tr\u1ecdng \u0111\u1ec1u c\u00f3 chi\u1ebfn l\u01b0\u1ee3c DR ri\u00eang, \u0111\u1ea3m b\u1ea3o kh\u00f4i ph\u1ee5c d\u1eef li\u1ec7u v\u00e0 d\u1ecbch v\u1ee5 khi x\u1ea3y ra s\u1ef1 c\u1ed1 l\u1edbn (m\u1ea5t DB, h\u1ea1 t\u1ea7ng, l\u1ed7i logic nghi\u00eam tr\u1ecdng...).</p>"},{"location":"dev/ops-guide/#rto-rpo-muc-tieu","title":"\ud83c\udfaf RTO &amp; RPO m\u1ee5c ti\u00eau","text":"Th\u00e0nh ph\u1ea7n RTO RPO PostgreSQL (Core) 15 ph\u00fat 5 ph\u00fat Redis (Cache) 5 ph\u00fat 0 (ch\u1ea5p nh\u1eadn m\u1ea5t cache) MySQL (Adapters) 30 ph\u00fat 15 ph\u00fat Pub/Sub 10 ph\u00fat 1 ph\u00fat Static (GCS) 30 ph\u00fat 0 ph\u00fat <p>RTO: Recovery Time Objective RPO: Recovery Point Objective</p>"},{"location":"dev/ops-guide/#backup-chien-luoc","title":"\ud83d\udce6 Backup chi\u1ebfn l\u01b0\u1ee3c","text":"Th\u00e0nh ph\u1ea7n Ph\u01b0\u01a1ng ph\u00e1p Cloud SQL (PostgreSQL, MySQL) Enable PITR + Scheduled Snapshots Redis Kh\u00f4ng backup \u2013 auto recreate t\u1eeb source GCS Object versioning + lifecycle rule Pub/Sub DLT L\u01b0u message fail trong Dead Letter Topic Interface Contracts &amp; ADRs Sync t\u1eeb Git \u2192 gi\u1eef b\u1ea3n ch\u00ednh tr\u00ean <code>dx-vas</code> repo"},{"location":"dev/ops-guide/#kiem-thu-dr-inh-ky","title":"\ud83d\udd01 Ki\u1ec3m th\u1eed DR \u0111\u1ecbnh k\u1ef3","text":"<ul> <li>M\u1ed7i qu\u00fd th\u1ef1c hi\u1ec7n drill (gi\u1ea3 l\u1eadp s\u1ef1 c\u1ed1)</li> <li>X\u00f3a b\u1ea3n ghi DB staging \u2192 restore t\u1eeb snapshot</li> <li>Simulate fail c\u1ee7a Notification ho\u1eb7c Gateway</li> <li>\u0110\u1ea3m b\u1ea3o kh\u00f4i ph\u1ee5c service trong khung th\u1eddi gian m\u1ee5c ti\u00eau</li> </ul>"},{"location":"dev/ops-guide/#luu-y-bao-mat","title":"\ud83d\udd10 L\u01b0u \u00fd b\u1ea3o m\u1eadt","text":"<ul> <li>Backup GCS ph\u1ea3i b\u1eadt encryption at rest</li> <li>Ch\u1ec9 t\u00e0i kho\u1ea3n c\u00f3 <code>roles/cloudsql.admin</code> m\u1edbi \u0111\u01b0\u1ee3c t\u1ea1o snapshot</li> <li>Audit access c\u00e1c b\u1ea3n backup qua Cloud Audit Log</li> </ul>"},{"location":"dev/ops-guide/#cong-cu-kiem-tra-khoi-phuc","title":"\ud83e\uddea C\u00f4ng c\u1ee5 ki\u1ec3m tra &amp; kh\u00f4i ph\u1ee5c","text":"<pre><code># Li\u1ec7t k\u00ea backup\ngcloud sql backups list --instance=dx-user-postgres\n\n# Restore t\u1eeb backup\ngcloud sql instances restore-backup dx-user-postgres \\\n  --backup-id=1234567890\n</code></pre>"},{"location":"dev/ops-guide/#vi-du-kich-ban-dr-mat-ket-noi-cloud-sql","title":"\ud83e\uddea V\u00ed d\u1ee5: K\u1ecbch b\u1ea3n DR \u2013 M\u1ea5t k\u1ebft n\u1ed1i Cloud SQL","text":"<p>T\u00ecnh hu\u1ed1ng: Cloud SQL instance (PostgreSQL) cho <code>user-service</code> b\u1ecb m\u1ea5t k\u1ebft n\u1ed1i do l\u1ed7i khu v\u1ef1c (region) ho\u1eb7c l\u1ed7i c\u1ea5u h\u00ecnh.</p>"},{"location":"dev/ops-guide/#cac-buoc-khoi-phuc","title":"\ud83d\udee0\ufe0f C\u00e1c b\u01b0\u1edbc kh\u00f4i ph\u1ee5c:","text":"<ol> <li>X\u00e1c \u0111\u1ecbnh l\u1ed7i:</li> <li>Ki\u1ec3m tra Cloud Monitoring \u2192 Metric <code>database/connection_count</code>, <code>availability</code>.</li> <li> <p>Ki\u1ec3m tra <code>gcloud sql instances describe</code> \u0111\u1ec3 x\u00e1c nh\u1eadn t\u00ecnh tr\u1ea1ng.</p> </li> <li> <p>K\u00edch ho\u1ea1t DR Plan:</p> </li> <li>Truy c\u1eadp Cloud SQL snapshot \u0111\u1ecbnh k\u1ef3 (PITR ho\u1eb7c b\u1ea3n sao).</li> <li>T\u1ea1o l\u1ea1i instance t\u1ea1i region kh\u00e1c (ho\u1eb7c c\u00f9ng region n\u1ebfu do c\u1ea5u h\u00ecnh).</li> </ol> <p><code>bash    gcloud sql instances create user-db-dr \\      --region=asia-southeast2 \\      --database-version=POSTGRES_14 \\      --source-instance=user-db \\      --restore-backup=auto</code></p> <ol> <li> <p>C\u1eadp nh\u1eadt Cloud Run ENV:</p> </li> <li> <p>Tr\u1ecf <code>DATABASE_URL</code> c\u1ee7a <code>user-service</code> sang instance m\u1edbi.</p> </li> <li>Redeploy service:</li> </ol> <pre><code>gcloud run services update user-service \\\n  --set-env-vars=DATABASE_URL=postgresql://...\n</code></pre> <ol> <li> <p>Ki\u1ec3m tra \u1ee9ng d\u1ee5ng:</p> </li> <li> <p>Ki\u1ec3m tra tr\u1ea1ng th\u00e1i Cloud Run revision m\u1edbi.</p> </li> <li> <p>Ch\u1ea1y smoke test ho\u1eb7c c\u00e1c health endpoint.</p> </li> <li> <p>Th\u00f4ng b\u00e1o &amp; ghi nh\u1eadn:</p> </li> <li> <p>G\u1eedi th\u00f4ng b\u00e1o h\u1ec7 th\u1ed1ng \u0111\u00e3 kh\u00f4i ph\u1ee5c.</p> </li> <li>Log \u0111\u1ea7y \u0111\u1ee7 action &amp; th\u1eddi gian v\u00e0o s\u1ef1 ki\u1ec7n DR.</li> </ol> <p>\ud83d\udccc L\u01b0u \u00fd:</p> <ul> <li>N\u00ean chu\u1ea9n b\u1ecb s\u1eb5n script DR cho t\u1eebng service ho\u1eb7c d\u1ecbch v\u1ee5 CSDL.</li> <li>C\u00f3 th\u1ec3 s\u1eed d\u1ee5ng Terraform \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a s\u1eb5n c\u1ea5u h\u00ecnh DR infra.</li> <li>M\u1ecdi s\u1ef1 ki\u1ec7n DR ph\u1ea3i \u0111\u01b0\u1ee3c di\u1ec5n t\u1eadp \u0111\u1ecbnh k\u1ef3.</li> </ul> <p>\ud83d\udcce K\u1ecbch b\u1ea3n s\u1ef1 c\u1ed1 to\u00e0n c\u1ee5m: M\u1ee5c 11 \u2013 \u1ee8ng ph\u00f3 s\u1ef1 c\u1ed1 &amp; kh\u00f4i ph\u1ee5c</p> <p>\ud83d\udcce C\u1ea5u tr\u00fac tri\u1ec3n khai d\u1ecbch v\u1ee5: System Diagrams</p>"},{"location":"dev/ops-guide/#13-security-audit-compliance","title":"13. Security audit &amp; compliance","text":"<p>H\u1ec7 th\u1ed1ng dx-vas \u00e1p d\u1ee5ng c\u01a1 ch\u1ebf ki\u1ec3m so\u00e1t b\u1ea3o m\u1eadt ch\u1eb7t ch\u1ebd ngay t\u1eeb ki\u1ebfn tr\u00fac. \u0110\u1ed9i DevOps/SRE c\u1ea7n duy tr\u00ec c\u00e1c ho\u1ea1t \u0111\u1ed9ng audit \u0111\u1ecbnh k\u1ef3 \u0111\u1ec3 ph\u00e1t hi\u1ec7n l\u1ed7 h\u1ed5ng, ki\u1ec3m so\u00e1t ph\u00e2n quy\u1ec1n v\u00e0 \u0111\u1ea3m b\u1ea3o tu\u00e2n th\u1ee7 theo c\u00e1c ti\u00eau chu\u1ea9n b\u1ea3o m\u1eadt n\u1ed9i b\u1ed9.</p>"},{"location":"dev/ops-guide/#kiem-tra-inh-ky","title":"\ud83d\udd0d Ki\u1ec3m tra \u0111\u1ecbnh k\u1ef3","text":"Nh\u00f3m H\u00e0nh \u0111\u1ed9ng IAM R\u00e0 so\u00e1t service account, roles kh\u00f4ng d\u00f9ng Secret X\u00e1c minh secret h\u1ebft h\u1ea1n, rotate \u0111\u00fang l\u1ecbch RBAC So kh\u1edbp permission \u2192 role \u2192 user Log Ki\u1ec3m tra trace b\u1ea5t th\u01b0\u1eddng, login fail Infra Check port m\u1edf, endpoint public (Cloud Run, Redis)"},{"location":"dev/ops-guide/#lich-audit-goi-y","title":"\ud83d\udcc5 L\u1ecbch audit g\u1ee3i \u00fd","text":"T\u1ea7n su\u1ea5t H\u00e0nh \u0111\u1ed9ng H\u00e0ng th\u00e1ng R\u00e0 IAM role, x\u00f3a service account c\u0169 H\u00e0ng qu\u00fd Rotate JWT secret, ki\u1ec3m tra RBAC file 6 th\u00e1ng Penetration test n\u1ed9i b\u1ed9 (black box / white box) H\u00e0ng n\u0103m Audit to\u00e0n h\u1ec7 th\u1ed1ng, backup policy, access policy"},{"location":"dev/ops-guide/#cong-cu-ho-tro-audit","title":"\ud83d\udee0 C\u00f4ng c\u1ee5 h\u1ed7 tr\u1ee3 audit","text":"<ul> <li>Google Cloud Asset Inventory (IAM, Secret, API enabled)</li> <li>GCP IAM Recommender</li> <li><code>gcloud iam roles list</code>, <code>gcloud secrets versions list</code></li> <li>Manual RBAC linter v\u1edbi file <code>permissions.yaml</code></li> </ul>"},{"location":"dev/ops-guide/#compliance-noi-bo","title":"\ud83d\udd12 Compliance (n\u1ed9i b\u1ed9)","text":"Y\u00eau c\u1ea7u T\u00ecnh tr\u1ea1ng RBAC \u0111\u01b0\u1ee3c ki\u1ec3m so\u00e1t qua giao di\u1ec7n &amp; versioned \u2705 Kh\u00f4ng c\u00f3 secret n\u1eb1m trong repo code \u2705 T\u1ea5t c\u1ea3 d\u1ecbch v\u1ee5 qua Gateway, c\u00f3 log RBAC \u2705 Xo\u00e1 user = inactive + revoke token \u2705 C\u00f3 log &amp; alert cho h\u00e0nh vi b\u1ea5t th\u01b0\u1eddng \u2705 <p>\ud83c\udfaf dx-vas h\u01b0\u1edbng \u0111\u1ebfn m\u00f4 h\u00ecnh Security-by-Design \u2013 kh\u00f4ng x\u1eed l\u00fd b\u1ea3o m\u1eadt sau c\u00f9ng, m\u00e0 t\u00edch h\u1ee3p xuy\u00ean su\u1ed1t.</p> <p>\ud83d\udcce Ch\u00ednh s\u00e1ch RBAC: RBAC Deep Dive </p> <p>\ud83d\udcce Chi ti\u1ebft b\u1ea3o m\u1eadt tri\u1ec3n khai: <code>adr-004-security.md</code> </p> <p>\ud83d\udcce H\u1ec7 th\u1ed1ng log gi\u00e1m s\u00e1t: M\u1ee5c 4 \u2013 Logging &amp; Trace</p>"},{"location":"dev/ops-guide/#14-cong-cu-dashboard-ho-tro","title":"14. C\u00f4ng c\u1ee5 &amp; dashboard h\u1ed7 tr\u1ee3","text":"<p>\u0110\u1ec3 h\u1ed7 tr\u1ee3 v\u1eadn h\u00e0nh h\u1ec7 th\u1ed1ng dx-vas \u1ed5n \u0111\u1ecbnh v\u00e0 ch\u1ee7 \u0111\u1ed9ng, \u0111\u1ed9i DevOps c\u1ea7n s\u1eed d\u1ee5ng k\u1ebft h\u1ee3p nhi\u1ec1u c\u00f4ng c\u1ee5 gi\u00e1m s\u00e1t, quan s\u00e1t, ph\u00e2n t\u00edch log v\u00e0 ki\u1ec3m tra h\u1ea1 t\u1ea7ng.</p>"},{"location":"dev/ops-guide/#bo-cong-cu-chinh","title":"\ud83e\uddf0 B\u1ed9 c\u00f4ng c\u1ee5 ch\u00ednh","text":"C\u00f4ng c\u1ee5 M\u1ee5c \u0111\u00edch Ghi ch\u00fa Google Cloud Logging Xem log to\u00e0n h\u1ec7 th\u1ed1ng Filter theo request_id, service Cloud Monitoring Theo d\u00f5i metric, alert \u0110\u1ecbnh ng\u01b0\u1ee1ng cho Redis, DB, Pub/Sub Cloud Trace Xem trace ph\u00e2n t\u00e1n T\u00ecm request ch\u1eadm, l\u1ed7i chu\u1ed7i Cloud SQL Insights Ph\u00e2n t\u00edch query ch\u1eadm H\u1ed7 tr\u1ee3 c\u1ea3 Postgres &amp; MySQL Pub/Sub Viewer Xem backlog, message retry Ki\u1ec3m tra DLT Secret Manager Qu\u1ea3n l\u00fd key/token Audit access IAM Recommender \u0110\u1ec1 xu\u1ea5t gi\u1ea3m quy\u1ec1n IAM Audit vai tr\u00f2 kh\u00f4ng c\u1ea7n thi\u1ebft Artifact Registry Qu\u1ea3n l\u00fd Docker image Theo d\u00f5i size, version deploy"},{"location":"dev/ops-guide/#dashboard-tham-khao","title":"\ud83d\udcca Dashboard tham kh\u1ea3o","text":"T\u00ean dashboard M\u1ee5c ti\u00eau <code>gateway-dashboard</code> Theo d\u00f5i t\u1ec9 l\u1ec7 l\u1ed7i, \u0111\u1ed9 tr\u1ec5 Gateway <code>auth-dashboard</code> Login rate, OTP fail, token issue <code>user-dashboard</code> Truy xu\u1ea5t RBAC, update user <code>notification-dashboard</code> G\u1eedi email/Zalo, theo d\u00f5i retry <code>pubsub-dashboard</code> Backlog, fail, DLT monitor <code>db-performance-dashboard</code> Slow query, connection pool usage <code>cost-dashboard</code> T\u1ed5ng chi ph\u00ed, c\u1ea3nh b\u00e1o v\u01b0\u1ee3t budget"},{"location":"dev/ops-guide/#bang-lenh-cli-devops-thuong-dung-gcp-cloud-run-pubsub-cloud-sql","title":"\ud83e\uddf0 B\u1ea3ng l\u1ec7nh CLI DevOps th\u01b0\u1eddng d\u00f9ng (GCP \u2013 Cloud Run, Pub/Sub, Cloud SQL)","text":"M\u1ee5c \u0111\u00edch L\u1ec7nh Xem revision &amp; traffic c\u1ee7a m\u1ed9t service <code>gcloud run services describe user-service --format=\"value(status.traffic)\"</code> Rollback revision c\u1ee5 th\u1ec3 <code>gcloud run services update-traffic user-service --to-revisions=rev-abc123=100</code> Ki\u1ec3m tra log Cloud Run m\u1edbi nh\u1ea5t <code>gcloud logs read \"resource.type=cloud_run_revision\" --limit=50</code> Xem th\u00f4ng \u0111i\u1ec7p b\u1ecb \u0111\u1ea9y v\u00e0o DLT <code>gcloud pubsub subscriptions pull user-dlt-sub --limit=5 --auto-ack</code> Scale min/max instance Cloud Run <code>gcloud run services update user-service --min-instances=1 --max-instances=5</code> T\u1ea1o Cloud SQL t\u1eeb backup <code>gcloud sql instances create user-db-dr --restore-backup=1234567890</code> Truy c\u1eadp shell PostgreSQL Cloud SQL <code>gcloud sql connect user-db --user=postgres</code> Ki\u1ec3m tra tr\u1ea1ng th\u00e1i Redis <code>gcloud redis instances describe vas-rbac-cache</code> <p>\ud83d\udccc Tham kh\u1ea3o file t\u1ed5ng h\u1ee3p Dev Ops Cheatsheet d\u1ef1 ki\u1ebfn.</p>"},{"location":"dev/ops-guide/#uong-dan-huu-ich","title":"\ud83d\udcce \u0110\u01b0\u1eddng d\u1eabn h\u1eefu \u00edch","text":"<ul> <li>Cloud Run logs</li> <li>Pub/Sub Viewer</li> <li>SQL Insights</li> <li>Secret Manager</li> </ul> <p>\ud83d\udcce M\u1ecdi dashboard n\u00ean \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef version (JSON export) t\u1ea1i: <code>dx-vas/docs/observability/dashboards/</code></p> <p>\ud83d\udcce Li\u00ean k\u1ebft CI/CD \u2013 xem Dev Guide: Dev Guide</p>"},{"location":"dev/OFFBOARDING_notes/template/","title":"\ud83d\udcdd OFFBOARDING NOTES TEMPLATE \u2013 DX VAS","text":"<p>S\u1eed d\u1ee5ng m\u1eabu n\u00e0y khi b\u1ea1n chu\u1ea9n b\u1ecb r\u1eddi d\u1ef1 \u00e1n. M\u1ee5c ti\u00eau l\u00e0 l\u01b0u l\u1ea1i tri th\u1ee9c, kinh nghi\u1ec7m c\u00e1 nh\u00e2n, gi\u00fap ng\u01b0\u1eddi ti\u1ebfp qu\u1ea3n c\u00f4ng vi\u1ec7c nhanh ch\u00f3ng v\u00e0 team c\u00f3 th\u1ec3 duy tr\u00ec ch\u1ea5t l\u01b0\u1ee3ng li\u00ean t\u1ee5c.</p>"},{"location":"dev/OFFBOARDING_notes/template/#thong-tin-ca-nhan","title":"\ud83d\udc64 Th\u00f4ng tin c\u00e1 nh\u00e2n","text":"<ul> <li>H\u1ecd t\u00ean:</li> <li>Email li\u00ean h\u1ec7 (n\u1ebfu c\u1ea7n):</li> <li>Th\u1eddi gian tham gia d\u1ef1 \u00e1n: DD/MM/YYYY \u2013 DD/MM/YYYY</li> <li>V\u1ecb tr\u00ed/role:</li> </ul>"},{"location":"dev/OFFBOARDING_notes/template/#cac-modulephan-viec-ban-a-phu-trach","title":"\ud83d\udce6 C\u00e1c module/ph\u1ea7n vi\u1ec7c b\u1ea1n \u0111\u00e3 ph\u1ee5 tr\u00e1ch","text":"Module Vai tr\u00f2 ch\u00ednh / M\u1ee9c \u0111\u1ed9 tham gia <code>auth</code> <code>rbac</code> <code>notify</code> CI/CD pipeline Cloud Run / GCP Docs / Dev Guide Kh\u00e1c"},{"location":"dev/OFFBOARDING_notes/template/#ghi-chu-ky-thuat-quan-trong","title":"\ud83e\udde0 Ghi ch\u00fa k\u1ef9 thu\u1eadt quan tr\u1ecdng","text":"<ul> <li> <p>Contacts quan tr\u1ecdng (n\u1ebfu c\u00f3):</p> </li> <li> <p>T\u00ean, vai tr\u00f2, li\u00ean h\u1ec7 (email/Slack), li\u00ean quan \u0111\u1ebfn module n\u00e0o</p> </li> </ul>"},{"location":"dev/OFFBOARDING_notes/template/#meo-debug-dev-local","title":"M\u1eb9o debug / dev local:","text":""},{"location":"dev/OFFBOARDING_notes/template/#cac-servicescript-ac-biet-ban-a-viet-hoac-dung","title":"C\u00e1c service/script \u0111\u1eb7c bi\u1ec7t b\u1ea1n \u0111\u00e3 vi\u1ebft ho\u1eb7c d\u00f9ng:","text":""},{"location":"dev/OFFBOARDING_notes/template/#luu-y-khi-deploy-config-ac-thu","title":"L\u01b0u \u00fd khi deploy / config \u0111\u1eb7c th\u00f9:","text":""},{"location":"dev/OFFBOARDING_notes/template/#cam-bay-loi-thuong-gap","title":"C\u1ea1m b\u1eaby / l\u1ed7i th\u01b0\u1eddng g\u1eb7p:","text":""},{"location":"dev/OFFBOARDING_notes/template/#cac-quyet-inh-thiet-ke-ban-tung-tham-gia-chua-co-trong-adr","title":"C\u00e1c quy\u1ebft \u0111\u1ecbnh thi\u1ebft k\u1ebf b\u1ea1n t\u1eebng tham gia (ch\u01b0a c\u00f3 trong ADR):","text":""},{"location":"dev/OFFBOARDING_notes/template/#ban-giao-cong-viec","title":"\ud83d\uddc2 B\u00e0n giao c\u00f4ng vi\u1ec7c","text":"<ul> <li> <p>C\u00e1c nh\u00e1nh ch\u01b0a merge:</p> </li> <li> <p><code>feature/xxx</code>: m\u00f4 t\u1ea3 tr\u1ea1ng th\u00e1i, TODO, ai ti\u1ebfp qu\u1ea3n</p> </li> <li> <p>Issue c\u00f2n m\u1edf:</p> </li> <li> <p>Link \u0111\u1ebfn issue, g\u1ee3i \u00fd x\u1eed l\u00fd ti\u1ebfp theo</p> </li> <li> <p>T\u00e0i li\u1ec7u li\u00ean quan (ngo\u00e0i code):</p> </li> <li> <p>Google Docs, b\u1ea3n thi\u1ebft k\u1ebf, Gist, link n\u1ed9i b\u1ed9, v.v.</p> </li> <li> </li> </ul>"},{"location":"dev/OFFBOARDING_notes/template/#filecode-can-chu-y-ac-biet","title":"File/code c\u1ea7n ch\u00fa \u00fd \u0111\u1eb7c bi\u1ec7t:","text":""},{"location":"dev/OFFBOARDING_notes/template/#kien-thuc-chuyen-sau-deep-dives-neu-co","title":"\ud83e\udde0 Ki\u1ebfn th\u1ee9c chuy\u00ean s\u00e2u (Deep Dives \u2013 n\u1ebfu c\u00f3)","text":"<p>N\u1ebfu b\u1ea1n c\u00f3 hi\u1ec3u bi\u1ebft \u0111\u1eb7c bi\u1ec7t s\u00e2u v\u1ec1 m\u1ed9t ch\u1ee7 \u0111\u1ec1/module, h\u00e3y m\u00f4 t\u1ea3 th\u00eam ho\u1eb7c d\u1eabn link \u0111\u1ebfn t\u00e0i li\u1ec7u \u0111\u00e3 vi\u1ebft</p> <ul> <li>L\u0129nh v\u1ef1c:</li> <li>M\u00f4 t\u1ea3 / Link:</li> </ul>"},{"location":"dev/OFFBOARDING_notes/template/#cong-cu-thu-vien-yeu-thich-ban-a-su-dung-trong-du-an","title":"\ud83d\udee0 C\u00f4ng c\u1ee5 / th\u01b0 vi\u1ec7n y\u00eau th\u00edch b\u1ea1n \u0111\u00e3 s\u1eed d\u1ee5ng trong d\u1ef1 \u00e1n","text":"<p>G\u1ee3i \u00fd nh\u1eefng c\u00f4ng c\u1ee5 \u0111\u00e1ng d\u00f9ng, c\u00f9ng l\u00fd do v\u00ec sao b\u1ea1n th\u1ea5y hi\u1ec7u qu\u1ea3</p> <ul> <li>T\u00ean c\u00f4ng c\u1ee5/th\u01b0 vi\u1ec7n:</li> <li>S\u1eed d\u1ee5ng \u1edf \u0111\u00e2u:</li> <li>L\u00fd do y\u00eau th\u00edch:</li> </ul>"},{"location":"dev/OFFBOARDING_notes/template/#loi-nhan","title":"\u2764\ufe0f L\u1eddi nh\u1eafn","text":"<p>Vi\u1ebft \u0111i\u1ec1u b\u1ea1n mu\u1ed1n \u0111\u1ec3 l\u1ea1i cho team \u2013 c\u1ea3m \u01a1n, kh\u00edch l\u1ec7, ho\u1eb7c \u0111\u01a1n gi\u1ea3n l\u00e0 l\u1eddi ch\u00e0o th\u00e2n t\u00ecnh \u2728</p>"},{"location":"interfaces/adr-index/","title":"\ud83e\udded ADR Index \u2013 T\u1ed5ng h\u1ee3p &amp; Ph\u00e2n lo\u1ea1i Ki\u1ebfn tr\u00fac Quy\u1ebft \u0111\u1ecbnh cho dx-vas","text":"<p>T\u00e0i li\u1ec7u n\u00e0y gi\u00fap b\u1ea1n \u0111\u1ecbnh h\u01b0\u1edbng nhanh to\u00e0n b\u1ed9 c\u00e1c quy\u1ebft \u0111\u1ecbnh ki\u1ebfn tr\u00fac (Architecture Decision Records \u2013 ADR) \u0111\u00e3 ban h\u00e0nh trong h\u1ec7 th\u1ed1ng dx-vas, ph\u1ee5c v\u1ee5 cho vi\u1ec7c tra c\u1ee9u, onboarding, v\u00e0 thi\u1ebft k\u1ebf service interface.</p>"},{"location":"interfaces/adr-index/#chu-giai-bieu-tuong","title":"\ud83d\udd30 Ch\u00fa gi\u1ea3i bi\u1ec3u t\u01b0\u1ee3ng","text":"<ul> <li>\u2705: \u1ea2nh h\u01b0\u1edfng tr\u1ef1c ti\u1ebfp \u0111\u1ebfn Interface Contract \u2013 c\u1ea7n tu\u00e2n th\u1ee7 khi thi\u1ebft k\u1ebf API (schema, header, c\u1ea5u tr\u00fac response).</li> <li>\u26a0\ufe0f: C\u00f3 \u1ea3nh h\u01b0\u1edfng gi\u00e1n ti\u1ebfp \u2013 c\u1ea7n l\u01b0u \u00fd trong behavior, versioning, rollout, ho\u1eb7c integration.</li> <li>\u274c: Kh\u00f4ng \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn Interface Contract.</li> </ul>"},{"location":"interfaces/adr-index/#danh-sach-adr-theo-nhom-chu-e","title":"\ud83d\udcda Danh s\u00e1ch ADR theo nh\u00f3m ch\u1ee7 \u0111\u1ec1","text":""},{"location":"interfaces/adr-index/#cicd-devops","title":"CI/CD &amp; DevOps","text":"ADR T\u00ean \u1ea2nh h\u01b0\u1edfng Interface Contract Ghi ch\u00fa / Chi ti\u1ebft \u1ea3nh h\u01b0\u1edfng ADR-001 CI/CD Strategy \u2705 Mapping nh\u00e1nh Git \u2192 m\u00f4i tr\u01b0\u1eddng tri\u1ec3n khai \u2192 <code>ENV</code>, \u1ea3nh h\u01b0\u1edfng t\u1edbi c\u00e1ch load c\u1ea5u h\u00ecnh &amp; endpoint ADR-002 IaC Terraform \u26a0\ufe0f Resource nh\u01b0 DB/Redis do IaC t\u1ea1o c\u00f3 th\u1ec3 \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn kh\u1ea3 n\u0103ng t\u01b0\u01a1ng th\u00edch API, \u0111\u1eb7c bi\u1ec7t khi li\u00ean quan t\u1edbi enum, constraint, ho\u1eb7c storage layout ADR-003 Secrets Management \u26a0\ufe0f Client c\u1ea7n bi\u1ebft c\u00e1ch l\u1ea5y v\u00e0 s\u1eed d\u1ee5ng token (OAuth2 bearer token trong header); lu\u1ed3ng OAuth ph\u1ea3i public r\u00f5 <code>client_id</code>, <code>redirect_uri</code> n\u1ebfu l\u00e0 public client ADR-005 Env Config \u2705 <code>ENV=staging</code> \u2192 c\u1ea5u h\u00ecnh ph\u00f9 h\u1ee3p \u0111\u1ec3 g\u1ecdi \u0111\u00fang backend, b\u1eadt \u0111\u00fang flag ADR-017 Env Deploy Boundary \u2705 Contract c\u00f3 th\u1ec3 kh\u00e1c bi\u1ec7t nh\u1ecf gi\u1eefa m\u00f4i tr\u01b0\u1eddng (m\u1ed9t s\u1ed1 API ch\u1ec9 enable \u1edf dev, flag b\u1eadt/t\u1eaft theo ENV \u1ea3nh h\u01b0\u1edfng behavior) ADR-018 Release Approval Policy \u274c Kh\u00f4ng \u1ea3nh h\u01b0\u1edfng tr\u1ef1c ti\u1ebfp contract ADR-015 Deployment Strategy \u26a0\ufe0f N\u1ebfu rollout d\u1ea7n (canary, blue/green) \u2192 contract ph\u1ea3i backward compatible trong su\u1ed1t qu\u00e1 tr\u00ecnh ADR-014 Zero Downtime \u2705 Kh\u00f4ng \u0111\u01b0\u1ee3c breaking change trong API contract \u2013 ph\u1ea3i t\u1ea1o version m\u1edbi n\u1ebfu c\u1ea7n ADR-016 Auto Scaling \u274c Kh\u00f4ng \u1ea3nh h\u01b0\u1edfng contract ADR-020 Cost Observability \u274c Kh\u00f4ng \u1ea3nh h\u01b0\u1edfng contract"},{"location":"interfaces/adr-index/#auth-rbac-api","title":"Auth, RBAC, API","text":"ADR T\u00ean \u1ea2nh h\u01b0\u1edfng Interface Contract Ghi ch\u00fa / Chi ti\u1ebft \u1ea3nh h\u01b0\u1edfng ADR-006 Auth Strategy \u2705 Y\u00eau c\u1ea7u JWT/OTP; \u0111\u1ecbnh ngh\u0129a c\u00e1c header <code>X-User-ID</code>, <code>X-Role</code>, <code>X-Auth-Method</code> ADR-007 RBAC Dynamic \u2705 <code>X-Permissions</code>: danh s\u00e1ch c\u00e1c permission code \u0111\u00e3 evaluate; backend s\u1eed d\u1ee5ng v\u00e0 tin c\u1eady danh s\u00e1ch n\u00e0y ADR-004 Security Strategy \u2705 Header b\u1ea3o m\u1eadt (HTTPS, X-Frame-Options), sanitize input, CSRF n\u1ebfu d\u00f9ng form, rate-limit headers ADR-009 API Governance \u2705 B\u1eaft bu\u1ed9c versioning, OpenAPI, backward compatibility khi thay \u0111\u1ed5i ADR-013 Path Naming Convention \u2705 T\u00ean path chu\u1ea9n RESTful, \u0111\u1ed9ng t\u1eeb, snake_case, plural nouns ADR-010 Contract Testing \u2705 Interface contract ph\u1ea3i c\u00f3 test t\u01b0\u01a1ng \u1ee9ng (Pact ho\u1eb7c OpenAPI validation)"},{"location":"interfaces/adr-index/#logging-error-observability","title":"Logging, Error, Observability","text":"ADR T\u00ean \u1ea2nh h\u01b0\u1edfng Interface Contract Ghi ch\u00fa / Chi ti\u1ebft \u1ea3nh h\u01b0\u1edfng ADR-011 API Error Format \u2705 M\u1ecdi l\u1ed7i ph\u1ea3i tr\u1ea3 theo schema <code>error.code</code>, <code>message</code>, <code>details</code> ADR-012 Response Structure \u2705 Response lu\u00f4n c\u00f3 <code>data</code>, <code>error</code>, <code>meta</code> \u2013 ph\u1ea3i \u0111\u00fang \u0111\u1ecbnh d\u1ea1ng n\u00e0y ADR-008 Audit Logging \u2705 H\u00e0nh \u0111\u1ed9ng thay \u0111\u1ed5i d\u1eef li\u1ec7u ph\u1ea3i sinh audit log, c\u1ea7n metadata chu\u1ea9n trong request ADR-021 External Observability \u26a0\ufe0f Trace ID, correlation ID ph\u1ea3i \u0111\u01b0\u1ee3c truy\u1ec1n \u0111\u1ea7y \u0111\u1ee7 \u0111\u1ec3 log/trace \u0111\u00fang trong h\u1ec7 th\u1ed1ng ngo\u00e0i ADR-022 SLA/SLO Monitoring \u26a0\ufe0f Y\u00eau c\u1ea7u gi\u1edbi h\u1ea1n latency/availability c\u00f3 th\u1ec3 \u1ea3nh h\u01b0\u1edfng API schema, streaming, ho\u1eb7c pagination"},{"location":"interfaces/adr-index/#data-storage-governance","title":"Data, Storage, Governance","text":"ADR T\u00ean \u1ea2nh h\u01b0\u1edfng Interface Contract Ghi ch\u00fa / Chi ti\u1ebft \u1ea3nh h\u01b0\u1edfng ADR-023 Schema Migration \u2705 Contract ph\u1ea3i backward compatible trong qu\u00e1 tr\u00ecnh thay \u0111\u1ed5i DB schema (VD: th\u00eam enum m\u1edbi, c\u1ed9t m\u1edbi) ADR-024 Data Anonymization &amp; Retention \u26a0\ufe0f Kh\u00f4ng tr\u1ea3 PII kh\u00f4ng c\u1ea7n thi\u1ebft; c\u1ea7n masking trong log/response n\u1ebfu l\u00e0 m\u00f4i tr\u01b0\u1eddng dev/sandbox"},{"location":"interfaces/adr-index/#to-chuc-he-thong","title":"T\u1ed5 ch\u1ee9c h\u1ec7 th\u1ed1ng","text":"ADR T\u00ean \u1ea2nh h\u01b0\u1edfng Interface Contract Ghi ch\u00fa / Chi ti\u1ebft \u1ea3nh h\u01b0\u1edfng ADR-019 GCP Project Layout \u274c T\u1ed5 ch\u1ee9c h\u1ea1 t\u1ea7ng, kh\u00f4ng \u1ea3nh h\u01b0\u1edfng contract"},{"location":"interfaces/adr-index/#cach-su-dung-bang-nay-khi-viet-interface-contract","title":"\ud83d\udd0d C\u00e1ch s\u1eed d\u1ee5ng b\u1ea3ng n\u00e0y khi vi\u1ebft Interface Contract","text":"<ul> <li>Ki\u1ec3m tra endpoint c\u00f3 tu\u00e2n th\u1ee7 <code>ADR-012</code> (format response) v\u00e0 <code>ADR-011</code> (format l\u1ed7i)?</li> <li>Request c\u00f3 c\u1ea7n <code>X-Permissions</code>, <code>X-User-ID</code>, <code>Trace-ID</code> theo <code>ADR-006</code>, <code>ADR-007</code>, <code>ADR-004</code> kh\u00f4ng?</li> <li>Path c\u00f3 theo <code>ADR-013</code>? Permission t\u01b0\u01a1ng \u1ee9ng c\u00f3 \u0111\u1ecbnh ngh\u0129a kh\u00f4ng (ADR-007)?</li> <li>C\u00f3 \u1ea3nh h\u01b0\u1edfng b\u1edfi <code>contract testing</code> b\u1eaft bu\u1ed9c (ADR-010)?</li> </ul> <p>\u201cInterface t\u1ed1t kh\u00f4ng ch\u1ec9 l\u00e0 API \u0111\u00fang \u2013 m\u00e0 l\u00e0 API ph\u1ea3n \u00e1nh chu\u1ea9n ki\u1ebfn tr\u00fac h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"interfaces/ic-01-api-gateway/","title":"\ud83d\udcd8 Interface Contract \u2013 API Gateway (dx-vas)","text":""},{"location":"interfaces/ic-01-api-gateway/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y m\u00f4 t\u1ea3 h\u1ee3p \u0111\u1ed3ng giao ti\u1ebfp (interface contract) cho API Gateway c\u1ee7a h\u1ec7 th\u1ed1ng dx-vas, nh\u1eb1m chu\u1ea9n h\u00f3a:</p> <ul> <li>\u0110\u1ecbnh d\u1ea1ng request/response</li> <li>Header b\u1eaft bu\u1ed9c</li> <li>Lu\u1ed3ng x\u00e1c th\u1ef1c v\u00e0 ph\u00e2n quy\u1ec1n (theo ADR-006, ADR-007)</li> <li>H\u00e0nh vi x\u1eed l\u00fd l\u1ed7i v\u00e0 trace (ADR-011, ADR-012)</li> </ul>"},{"location":"interfaces/ic-01-api-gateway/#api-groups-by-client","title":"\ud83c\udf10 API Groups by Client","text":"Client API Group Backend Service Admin Webapp <code>/users</code>, <code>/roles</code>, <code>/permissions</code> User Service <code>/classes</code> SIS Adapter <code>/notifications/send</code> Notification Service Customer Portal <code>/students/me</code>, <code>/students/me/scores</code>, <code>/students/me/timetable</code> LMS Adapter, SIS Adapter <code>/notifications</code> Notification Service Public Forms <code>/crm/leads</code> (POST) CRM Adapter Auth (shared) <code>/auth/*</code> Auth Service <p>M\u1ecdi g\u1ecdi API c\u1ee7a client \u0111\u1ec1u th\u00f4ng qua Gateway v\u00e0 \u0111\u01b0\u1ee3c \u0111\u1ecbnh tuy\u1ebfn t\u1edbi service backend t\u01b0\u01a1ng \u1ee9ng, k\u00e8m c\u00e1c header <code>X-User-ID</code>, <code>X-Permissions</code>, <code>Trace-ID</code>...</p>"},{"location":"interfaces/ic-01-api-gateway/#yeu-cau-chung-cho-moi-request","title":"\ud83d\udd10 Y\u00eau c\u1ea7u chung cho m\u1ecdi request","text":""},{"location":"interfaces/ic-01-api-gateway/#header-bat-buoc-tu-client","title":"Header b\u1eaft bu\u1ed9c t\u1eeb client:","text":"Header M\u00f4 t\u1ea3 <code>Authorization</code> <code>Bearer &lt;access_token&gt;</code> \u2013 JWT \u0111\u01b0\u1ee3c ph\u00e1t h\u00e0nh t\u1eeb Auth Service (Google OAuth ho\u1eb7c OTP)"},{"location":"interfaces/ic-01-api-gateway/#header-bat-buoc-uoc-api-gateway-forward-en-backend","title":"Header b\u1eaft bu\u1ed9c \u0111\u01b0\u1ee3c API Gateway forward \u0111\u1ebfn backend:","text":"Header M\u00f4 t\u1ea3 Tham chi\u1ebfu <code>X-User-ID</code> ID ng\u01b0\u1eddi d\u00f9ng t\u1eeb token ADR-006 <code>X-Role</code> Vai tr\u00f2 hi\u1ec7n t\u1ea1i ADR-006 <code>X-Auth-Method</code> <code>google</code>, <code>otp</code>, <code>local</code> ADR-006 <code>X-Permissions</code> Danh s\u00e1ch permission code \u0111\u00e3 evaluate ADR-007 <code>Trace-ID</code> M\u00e3 trace ID duy nh\u1ea5t theo request ADR-011 <p>C\u00e1c service backend kh\u00f4ng c\u1ea7n decode JWT \u2013 ch\u1ec9 s\u1eed d\u1ee5ng c\u00e1c header tr\u00ean.</p>"},{"location":"interfaces/ic-01-api-gateway/#cau-truc-response-chuan-ap-dung-cho-moi-api-tra-ve","title":"\ud83d\udce6 C\u1ea5u tr\u00fac response chu\u1ea9n (\u00e1p d\u1ee5ng cho m\u1ecdi API tr\u1ea3 v\u1ec1)","text":"<pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"timestamp\": \"2025-07-10T12:00:00Z\",\n    \"trace_id\": \"abc123\",\n    \"source\": \"api_gateway\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-01-api-gateway/#khi-loi-xay-ra","title":"Khi l\u1ed7i x\u1ea3y ra:","text":"<pre><code>{\n  \"data\": null,\n  \"error\": {\n    \"code\": \"FORBIDDEN\",\n    \"message\": \"Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n truy c\u1eadp\",\n    \"details\": {}\n  },\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"abc123\"\n  }\n}\n</code></pre> <p>Tu\u00e2n th\u1ee7 ADR-011 v\u00e0 ADR-012.</p>"},{"location":"interfaces/ic-01-api-gateway/#hanh-vi-xu-ly-request","title":"\ud83d\udd01 H\u00e0nh vi x\u1eed l\u00fd request","text":"B\u01b0\u1edbc Di\u1ec5n gi\u1ea3i 1 API Gateway x\u00e1c th\u1ef1c JWT ho\u1eb7c OTP, t\u1eeb \u0111\u00f3 l\u1ea5y <code>user_id</code>, <code>role</code>, <code>auth_method</code> 2 Ki\u1ec3m tra <code>is_active</code> trong b\u1ea3ng <code>users</code> (theo README.md) 3 Tra danh s\u00e1ch permission code qua Redis cache (ho\u1eb7c fallback DB) 4 Ki\u1ec3m tra permission t\u01b0\u01a1ng \u1ee9ng v\u1edbi endpoint \u0111ang g\u1ecdi 5 G\u1eafn header <code>X-*</code> v\u00e0 forward \u0111\u1ebfn service \u0111\u00edch"},{"location":"interfaces/ic-01-api-gateway/#luu-y-ac-biet-khi-thiet-ke-endpoint-tai-backend","title":"\ud83d\udccc L\u01b0u \u00fd \u0111\u1eb7c bi\u1ec7t khi thi\u1ebft k\u1ebf endpoint t\u1ea1i backend","text":"<ul> <li>Lu\u00f4n nh\u1eadn c\u00e1c header <code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code></li> <li>Kh\u00f4ng c\u1ea7n re-evaluate logic ph\u00e2n quy\u1ec1n: <code>X-Permissions</code> l\u00e0 danh s\u00e1ch permission code \u0111\u00e3 \u0111\u01b0\u1ee3c Gateway ki\u1ec3m tra v\u00e0 x\u00e1c th\u1ef1c theo context hi\u1ec7n t\u1ea1i. Backend ch\u1ec9 c\u1ea7n ki\u1ec3m tra code c\u00f3 t\u1ed3n t\u1ea1i trong danh s\u00e1ch n\u00e0y \u0111\u1ec3 cho ph\u00e9p h\u00e0nh \u0111\u1ed9ng.</li> <li>M\u1ecdi response \u0111\u1ec1u theo format ADR-012.</li> </ul>"},{"location":"interfaces/ic-01-api-gateway/#cac-ma-loi-ac-thu-cua-api-gateway-tham-khao","title":"\ud83d\udea8 C\u00e1c m\u00e3 l\u1ed7i \u0111\u1eb7c th\u00f9 c\u1ee7a API Gateway (tham kh\u1ea3o)","text":"M\u00e3 l\u1ed7i Khi n\u00e0o x\u1ea3y ra <code>TOKEN_INVALID</code> JWT kh\u00f4ng h\u1ee3p l\u1ec7 ho\u1eb7c kh\u00f4ng gi\u1ea3i m\u00e3 \u0111\u01b0\u1ee3c <code>TOKEN_EXPIRED</code> JWT \u0111\u00e3 h\u1ebft h\u1ea1n <code>RBAC_CACHE_UNAVAILABLE</code> Redis RBAC cache b\u1ecb l\u1ed7i ho\u1eb7c kh\u00f4ng ph\u1ea3n h\u1ed3i <code>PERMISSION_DENIED</code> Kh\u00f4ng c\u00f3 permission t\u01b0\u01a1ng \u1ee9ng v\u1edbi endpoint <code>BACKEND_SERVICE_UNAVAILABLE</code> Kh\u00f4ng g\u1ecdi \u0111\u01b0\u1ee3c \u0111\u1ebfn service \u0111\u00edch <code>IS_INACTIVE_USER</code> Ng\u01b0\u1eddi d\u00f9ng b\u1ecb kh\u00f3a (is_active = false) <p>M\u1ecdi l\u1ed7i \u0111\u1ec1u tr\u1ea3 v\u1ec1 theo c\u1ea5u tr\u00fac chu\u1ea9n ADR-011 v\u1edbi <code>error.code</code>, <code>message</code>, <code>details</code>.</p>"},{"location":"interfaces/ic-01-api-gateway/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-011: API Error Format</li> <li>ADR-012: Response Structure</li> <li>README.md \u2013 Quy tr\u00ecnh ph\u00e2n quy\u1ec1n v\u00e0 header forward</li> </ul> <p>\u201cAPI Gateway kh\u00f4ng ch\u1ec9 l\u00e0 ng\u01b0\u1eddi g\u00e1c c\u1ed5ng \u2013 m\u00e0 l\u00e0 ng\u01b0\u1eddi truy\u1ec1n \u0111i \u0111\u00fang danh t\u00ednh, \u0111\u00fang quy\u1ec1n h\u1ea1n, v\u00e0 \u0111\u00fang chu\u1ea9n.\u201d</p>"},{"location":"interfaces/ic-02-admin-webapp/","title":"\ud83d\udcd8 Interface Contract \u2013 Admin Webapp (dx-vas)","text":""},{"location":"interfaces/ic-02-admin-webapp/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y m\u00f4 t\u1ea3 c\u00e1c API m\u00e0 Admin Webapp s\u1eed d\u1ee5ng th\u00f4ng qua API Gateway, nh\u1eb1m:</p> <ul> <li>\u0110\u1ecbnh ngh\u0129a r\u00f5 t\u1eebng endpoint, schema input/output</li> <li>X\u00e1c \u0111\u1ecbnh permission code y\u00eau c\u1ea7u (theo ADR-007)</li> <li>\u0110\u1ed3ng b\u1ed9 h\u00f3a v\u1edbi c\u00e1c nguy\u00ean t\u1eafc t\u1eeb API Gateway v\u00e0 RBAC h\u1ec7 th\u1ed1ng</li> </ul>"},{"location":"interfaces/ic-02-admin-webapp/#danh-sach-endpoint-tieu-bieu","title":"\ud83e\udde9 Danh s\u00e1ch endpoint ti\u00eau bi\u1ec3u","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/users</code> L\u1ea5y danh s\u00e1ch ng\u01b0\u1eddi d\u00f9ng <code>page: int</code>, <code>search: str</code> <code>List[UserOut]</code> <code>VIEW_USER_ALL</code> POST <code>/users</code> T\u1ea1o ng\u01b0\u1eddi d\u00f9ng m\u1edbi <code>UserCreate</code> <code>UserOut</code> <code>CREATE_USER</code> PATCH <code>/users/{id}</code> C\u1eadp nh\u1eadt th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng <code>UserUpdate</code> <code>UserOut</code> <code>EDIT_USER</code> GET <code>/roles</code> Danh s\u00e1ch role \u2014 <code>List[RoleOut]</code> <code>VIEW_ROLE_ALL</code> POST <code>/roles</code> T\u1ea1o role <code>RoleCreate</code> <code>RoleOut</code> <code>CREATE_ROLE</code> GET <code>/permissions</code> Danh s\u00e1ch permission \u2014 <code>List[PermissionOut]</code> <code>VIEW_PERMISSION_ALL</code> POST <code>/classes</code> T\u1ea1o l\u1edbp h\u1ecdc <code>ClassCreate</code> <code>ClassOut</code> <code>CREATE_CLASS</code> GET <code>/audit/logs</code> L\u1ecbch s\u1eed thao t\u00e1c <code>resource: str</code>, <code>user_id: UUID</code>, <code>date: ISODateString</code> <code>List[AuditLogOut]</code> <code>VIEW_AUDIT_LOG</code> POST <code>/notifications/send</code> G\u1eedi th\u00f4ng b\u00e1o <code>NotificationRequest</code> <code>NotificationResult</code> <code>SEND_NOTIFICATION_ALL</code> <p>C\u00e1c schema (UserCreate, RoleOut, ...) \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a th\u1ed1ng nh\u1ea5t b\u1eb1ng Pydantic ho\u1eb7c JSON Schema v\u00e0 ph\u1ea3i \u0111\u1ed3ng b\u1ed9 v\u1edbi OpenAPI.</p>"},{"location":"interfaces/ic-02-admin-webapp/#co-che-xac-thuc-phan-quyen","title":"\ud83d\udd10 C\u01a1 ch\u1ebf x\u00e1c th\u1ef1c &amp; ph\u00e2n quy\u1ec1n","text":"<ul> <li>T\u1ea5t c\u1ea3 request t\u1eeb Admin Webapp g\u1ecdi qua API Gateway \u2192 \u0111\u1ec1u ph\u1ea3i g\u1eedi <code>Authorization: Bearer &lt;token&gt;</code>.</li> <li> <p>API Gateway s\u1ebd forward c\u00e1c header:</p> </li> <li> <p><code>X-User-ID</code>, <code>X-Role</code>, <code>X-Auth-Method</code>, <code>X-Permissions</code>, <code>Trace-ID</code></p> </li> <li>Backend ki\u1ec3m tra s\u1ef1 t\u1ed3n t\u1ea1i c\u1ee7a permission code trong <code>X-Permissions</code>, kh\u00f4ng c\u1ea7n re-evaluate condition (theo ADR-007)</li> </ul>"},{"location":"interfaces/ic-02-admin-webapp/#response-structure","title":"\ud83d\udce6 Response structure","text":"<p>Tu\u00e2n th\u1ee7 to\u00e0n b\u1ed9 theo ADR-012:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"...\",\n    \"source\": \"api_gateway\"\n  }\n}\n</code></pre> <p>Khi l\u1ed7i:</p> <pre><code>{\n  \"data\": null,\n  \"error\": {\n    \"code\": \"FORBIDDEN\",\n    \"message\": \"Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n truy c\u1eadp\"\n  },\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"...\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-02-admin-webapp/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>UI c\u1ee7a Admin Webapp ph\u1ea3i hi\u1ec7n th\u00f4ng b\u00e1o ph\u00f9 h\u1ee3p d\u1ef1a v\u00e0o <code>error.code</code>, <code>error.message</code> (theo ADR-011)</li> <li>Khi thao t\u00e1c thay \u0111\u1ed5i d\u1eef li\u1ec7u (user, class, role, permission...), backend ph\u1ea3i t\u1ea1o audit log (theo ADR-008)</li> <li>Admin Webapp kh\u00f4ng t\u1ea1o trace_id \u2013 m\u00e0 log v\u00e0 truy\u1ec1n l\u1ea1i trace_id \u0111\u00e3 nh\u1eadn trong response \u0111\u1ec3 quan s\u00e1t xuy\u00ean su\u1ed1t chu\u1ed7i call (ho\u1eb7c \u0111\u1ec3 debug frontend/backend t\u01b0\u01a1ng \u1ee9ng)</li> </ul>"},{"location":"interfaces/ic-02-admin-webapp/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-007: RBAC Dynamic</li> <li>ADR-012: Response Structure</li> <li>ADR-011: API Error Format</li> <li>ADR-008: Audit Logging</li> <li>README.md \u2013 API Gateway &amp; RBAC</li> </ul> <p>\u201cAdmin Webapp kh\u00f4ng ch\u1ec9 l\u00e0 n\u01a1i thao t\u00e1c \u2013 m\u00e0 l\u00e0 n\u01a1i th\u1ec3 hi\u1ec7n r\u00f5 lu\u1ed3ng quy\u1ec1n l\u1ef1c v\u00e0 tr\u00e1ch nhi\u1ec7m trong h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"interfaces/ic-03-customer-portal/","title":"\ud83d\udcd8 Interface Contract \u2013 Customer Portal (dx-vas)","text":""},{"location":"interfaces/ic-03-customer-portal/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y \u0111\u1ecbnh ngh\u0129a h\u1ee3p \u0111\u1ed3ng giao ti\u1ebfp cho Customer Portal, h\u1ec7 th\u1ed1ng d\u00e0nh cho ph\u1ee5 huynh v\u00e0 h\u1ecdc sinh:</p> <ul> <li>Giao ti\u1ebfp v\u1edbi API Gateway v\u00e0 backend LMS</li> <li>\u00c1p d\u1ee5ng x\u00e1c th\u1ef1c OTP ho\u1eb7c Google Workspace</li> <li>\u0110\u1ea3m b\u1ea3o h\u00e0nh vi th\u1ed1ng nh\u1ea5t v\u1ec1 ph\u00e2n quy\u1ec1n, ph\u1ea3n h\u1ed3i l\u1ed7i, trace ID</li> </ul>"},{"location":"interfaces/ic-03-customer-portal/#danh-sach-endpoint-tieu-bieu-phu-huynh-hoc-sinh","title":"\ud83e\udde9 Danh s\u00e1ch endpoint ti\u00eau bi\u1ec3u (ph\u1ee5 huynh &amp; h\u1ecdc sinh)","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Params Output Schema Permission Code GET <code>/students/me</code> Xem th\u00f4ng tin h\u1ecdc sinh (b\u1ea3n th\u00e2n ho\u1eb7c con) \u2014 <code>StudentOut</code> <code>VIEW_STUDENT_PROFILE_SELF</code> (h\u1ecdc sinh) / <code>VIEW_STUDENT_PROFILE_OWN_CHILD</code> (ph\u1ee5 huynh) GET <code>/students/me/scores</code> Xem \u0111i\u1ec3m s\u1ed1 h\u1ecdc sinh <code>term: str</code>, <code>subject?: str</code> <code>List[ScoreOut]</code> <code>VIEW_STUDENT_SCORE_SELF</code> / <code>VIEW_STUDENT_SCORE_OWN_CHILD</code> GET <code>/students/me/timetable</code> L\u1ecbch h\u1ecdc <code>week: ISODate</code> <code>List[TimetableOut]</code> <code>VIEW_STUDENT_TIMETABLE_SELF</code> / <code>VIEW_STUDENT_TIMETABLE_OWN_CHILD</code> GET <code>/notifications</code> Th\u00f4ng b\u00e1o d\u00e0nh cho ng\u01b0\u1eddi d\u00f9ng hi\u1ec7n t\u1ea1i <code>page: int</code> <code>List[Notification]</code> <code>VIEW_NOTIFICATION_SELF</code> / <code>VIEW_NOTIFICATION_OWN_CHILD</code> <p>C\u00e1c endpoint <code>/students/me/...</code> \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf \u0111\u1ec3 d\u00f9ng chung cho c\u1ea3 h\u1ecdc sinh v\u00e0 ph\u1ee5 huynh. Gateway x\u00e1c \u0111\u1ecbnh context ng\u01b0\u1eddi d\u00f9ng v\u00e0 forward c\u00e1c permission code ph\u00f9 h\u1ee3p: n\u1ebfu l\u00e0 h\u1ecdc sinh th\u00ec l\u00e0 <code>*_SELF</code>, n\u1ebfu l\u00e0 ph\u1ee5 huynh th\u00ec l\u00e0 <code>*_OWN_CHILD</code>. Backend x\u1eed l\u00fd theo permission v\u00e0 ng\u1eef c\u1ea3nh <code>user_id</code> \u0111\u01b0\u1ee3c forward.</p>"},{"location":"interfaces/ic-03-customer-portal/#co-che-xac-thuc-phan-quyen","title":"\ud83d\udd10 C\u01a1 ch\u1ebf x\u00e1c th\u1ef1c &amp; ph\u00e2n quy\u1ec1n","text":"<ul> <li>H\u1ecdc sinh \u0111\u0103ng nh\u1eadp b\u1eb1ng Google Workspace \u2192 OAuth2</li> <li>Ph\u1ee5 huynh \u0111\u0103ng nh\u1eadp b\u1eb1ng OTP (email/SMS)</li> <li>Nh\u1eadn JWT t\u1eeb Auth Service (qua Gateway)</li> <li>G\u1eedi <code>Authorization: Bearer &lt;token&gt;</code> trong m\u1ecdi request</li> <li> <p>Gateway s\u1ebd forward c\u00e1c header:</p> </li> <li> <p><code>X-User-ID</code>, <code>X-Role</code>, <code>X-Auth-Method</code>, <code>X-Permissions</code>, <code>Trace-ID</code></p> </li> </ul> <p>Backend (LMS Adapter) s\u1eed d\u1ee5ng c\u00e1c permission code \u0111\u00e3 evaluate b\u1edfi Gateway, kh\u00f4ng t\u1ef1 re-evaluate \u0111i\u1ec1u ki\u1ec7n.</p>"},{"location":"interfaces/ic-03-customer-portal/#cau-truc-phan-hoi","title":"\ud83d\udce6 C\u1ea5u tr\u00fac ph\u1ea3n h\u1ed3i","text":"<p>Tu\u00e2n th\u1ee7 theo ADR-012:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"...\",\n    \"source\": \"api_gateway\"\n  }\n}\n</code></pre> <p>Khi l\u1ed7i:</p> <pre><code>{\n  \"data\": null,\n  \"error\": {\n    \"code\": \"FORBIDDEN\",\n    \"message\": \"Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n truy c\u1eadp\"\n  },\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"...\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-03-customer-portal/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>Customer Portal kh\u00f4ng c\u1ea7n hi\u1ec3n th\u1ecb <code>trace_id</code>, nh\u01b0ng c\u00f3 th\u1ec3 log l\u1ea1i n\u1ebfu h\u1ed7 tr\u1ee3 debug / report</li> <li> <p>UI n\u00ean hi\u1ec3n th\u1ecb l\u1ed7i r\u00f5 r\u00e0ng theo <code>error.message</code>, v\u00e0 h\u1ed7 tr\u1ee3 <code>error.code</code> \u0111\u1ec3 ph\u00e2n bi\u1ec7t c\u00e1c l\u1ed7i \u0111\u1eb7c th\u00f9 nh\u01b0:</p> </li> <li> <p><code>OTP_INVALID</code>, <code>OTP_EXPIRED</code>, <code>STUDENT_NOT_FOUND</code>, <code>FORBIDDEN</code></p> </li> <li>Permission code <code>*_SELF</code> \u00e1p d\u1ee5ng cho h\u1ecdc sinh; <code>*_OWN_CHILD</code> \u00e1p d\u1ee5ng cho ph\u1ee5 huynh. T\u1ea5t c\u1ea3 \u0111\u01b0\u1ee3c evaluate t\u1ea1i Gateway theo context <code>user_id</code>, kh\u00f4ng c\u1ea7n logic ph\u00e2n quy\u1ec1n \u1edf backend (theo ADR-007)</li> </ul>"},{"location":"interfaces/ic-03-customer-portal/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-011: API Error Format</li> <li>ADR-012: Response Structure</li> <li>README.md \u2013 Ph\u00e2n quy\u1ec1n \u0111\u1ed9ng cho ph\u1ee5 huynh</li> </ul> <p>\u201cCustomer Portal kh\u00f4ng ch\u1ec9 l\u00e0 n\u01a1i tra c\u1ee9u \u2013 m\u00e0 l\u00e0 c\u1ea7u n\u1ed1i gi\u1eefa ph\u1ee5 huynh v\u00e0 h\u00e0nh tr\u00ecnh h\u1ecdc t\u1eadp c\u1ee7a h\u1ecdc sinh.\u201d</p>"},{"location":"interfaces/ic-04-notification/","title":"\ud83d\udcd8 Interface Contract \u2013 Notification Service (dx-vas)","text":""},{"location":"interfaces/ic-04-notification/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y \u0111\u1ecbnh ngh\u0129a interface contract cho Notification Service, th\u00e0nh ph\u1ea7n ch\u1ecbu tr\u00e1ch nhi\u1ec7m:</p> <ul> <li>G\u1eedi th\u00f4ng b\u00e1o qua email, app, Zalo, Google Chat</li> <li>Nh\u1eadn y\u00eau c\u1ea7u g\u1eedi t\u1eeb c\u00e1c h\u1ec7 th\u1ed1ng kh\u00e1c qua API Gateway</li> <li>T\u1ef1 \u0111\u1ed9ng ho\u00e1 g\u1eedi theo template, \u0111\u1ecbnh tuy\u1ebfn k\u00eanh g\u1eedi ph\u00f9 h\u1ee3p</li> </ul>"},{"location":"interfaces/ic-04-notification/#endpoint-notification-service-phoi-ra-provider-api","title":"\ud83d\udce4 Endpoint Notification Service ph\u01a1i ra (Provider API)","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema Output Schema Permission Code POST <code>/notifications/send</code> G\u1eedi th\u00f4ng b\u00e1o \u0111\u01a1n l\u1ebb t\u1edbi user c\u1ee5 th\u1ec3 (Admin Webapp, SIS Adapter g\u1ecdi) <code>NotificationRequest</code> <code>NotificationResult</code> <code>SEND_NOTIFICATION_ALL</code> / <code>SEND_NOTIFICATION_STUDENT</code> POST <code>/notifications/schedule-reminder</code> G\u1eedi nh\u1eafc h\u1ecdc b\u00e0i \u0111\u1ecbnh k\u1ef3 (LMS Adapter g\u1ecdi) <code>ReminderScheduleRequest</code> <code>NotificationResult</code> <code>SEND_NOTIFICATION_STUDENT</code> POST <code>/notifications/bulk</code> G\u1eedi th\u00f4ng b\u00e1o h\u00e0ng lo\u1ea1t (CRM Adapter g\u1ecdi) <code>BulkNotificationRequest</code> <code>NotificationResult</code> <code>SEND_NOTIFICATION_ALL</code> GET <code>/notifications/{dispatch_id}</code> Truy v\u1ea5n tr\u1ea1ng th\u00e1i g\u1eedi c\u1ee7a 1 dispatch c\u1ee5 th\u1ec3 <code>dispatch_id: str</code> <code>NotificationStatusOut</code> <code>VIEW_NOTIFICATION_STATUS</code> GET <code>/notifications</code> L\u1ea5y danh s\u00e1ch th\u00f4ng b\u00e1o c\u1ee7a ng\u01b0\u1eddi d\u00f9ng hi\u1ec7n t\u1ea1i (d\u00f9ng trong Customer Portal) <code>page: int</code> <code>List[NotificationOut]</code> <code>VIEW_NOTIFICATION_SELF</code> / <code>VIEW_NOTIFICATION_OWN_CHILD</code> <p>T\u1ea5t c\u1ea3 endpoint \u0111\u1ec1u \u0111i qua API Gateway v\u00e0 c\u1ea7n JWT h\u1ee3p l\u1ec7. Gateway s\u1ebd forward c\u00e1c header: <code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code>, <code>Trace-ID</code>. Backend ch\u1ec9 c\u1ea7n ki\u1ec3m tra permission code c\u00f3 n\u1eb1m trong <code>X-Permissions</code>.</p>"},{"location":"interfaces/ic-04-notification/#input-schema","title":"\ud83d\udce5 Input Schema","text":""},{"location":"interfaces/ic-04-notification/#notificationrequest-post-notificationssend","title":"NotificationRequest (POST /notifications/send)","text":"<pre><code>{\n  \"recipient_ids\": [\"u123\", \"u456\"],\n  \"channels\": [\"email\", \"zalo\", \"app\"],\n  \"template_code\": \"REMINDER_SCORE_AVAILABLE\",\n  \"payload\": {\n    \"student_name\": \"Nguy\u1ec5n V\u0103n A\",\n    \"term\": \"HK1\",\n    \"score_link\": \"https://...\"\n  },\n  \"priority\": \"high\",\n  \"metadata\": {\n    \"trace_id\": \"abc-xyz\",\n    \"requested_by\": \"admin_user_id_123\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-04-notification/#reminderschedulerequest-post-notificationsschedule-reminder","title":"ReminderScheduleRequest (POST /notifications/schedule-reminder)","text":"<pre><code>{\n  \"student_id\": \"abc123\",\n  \"term\": \"HK1\",\n  \"reminder_type\": \"assignment_due\",\n  \"channels\": [\"app\"],\n  \"template_code\": \"REMINDER_ASSIGNMENT\",\n  \"payload\": { \"assignment_count\": 2 },\n  \"schedule_time\": \"2025-07-10T18:00:00Z\"\n}\n</code></pre>"},{"location":"interfaces/ic-04-notification/#bulknotificationrequest-post-notificationsbulk","title":"BulkNotificationRequest (POST /notifications/bulk)","text":"<pre><code>{\n  \"audience_group\": \"new_parents_2025\",\n  \"template_code\": \"WELCOME\",\n  \"channels\": [\"zalo\", \"email\"],\n  \"payload\": {\n    \"event_name\": \"Khai gi\u1ea3ng\",\n    \"event_date\": \"2025-09-01\"\n  },\n  \"priority\": \"normal\",\n  \"metadata\": {\n    \"trace_id\": \"...\",\n    \"requested_by\": \"crm_system\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-04-notification/#output-schema","title":"\ud83d\udce4 Output Schema","text":""},{"location":"interfaces/ic-04-notification/#notificationresult","title":"NotificationResult","text":"<pre><code>{\n  \"data\": {\n    \"dispatch_id\": \"notif-xyz\",\n    \"status\": \"queued\",\n    \"channels\": [\"email\", \"zalo\"],\n    \"failures\": []\n  },\n  \"error\": null,\n  \"meta\": {\n    \"trace_id\": \"abc-xyz\",\n    \"timestamp\": \"...\",\n    \"source\": \"notification_service\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-04-notification/#notificationstatusout-get-notificationsdispatch_id","title":"NotificationStatusOut (GET /notifications/{dispatch_id})","text":"<pre><code>{\n  \"dispatch_id\": \"notif-xyz\",\n  \"status\": \"sent\",\n  \"channels\": [\"email\"],\n  \"failures\": [\"zalo\"]\n}\n</code></pre>"},{"location":"interfaces/ic-04-notification/#listnotificationout-get-notifications","title":"List[NotificationOut] (GET /notifications)","text":"<pre><code>[\n  {\n    \"id\": \"n001\",\n    \"channel\": \"email\",\n    \"title\": \"\u0110i\u1ec3m h\u1ecdc k\u1ef3 1 \u0111\u00e3 c\u00f3\",\n    \"received_at\": \"2025-07-10T19:00:00Z\",\n    \"read\": false\n  },\n  ...\n]\n</code></pre>"},{"location":"interfaces/ic-04-notification/#rbac-phan-quyen","title":"\ud83d\udee1\ufe0f RBAC &amp; Ph\u00e2n quy\u1ec1n","text":"<ul> <li>C\u00e1c permission code y\u00eau c\u1ea7u:</li> <li><code>SEND_NOTIFICATION_ALL</code> \u2013 cho ph\u00e9p g\u1eedi m\u1ecdi lo\u1ea1i th\u00f4ng b\u00e1o</li> <li><code>SEND_NOTIFICATION_STUDENT</code> \u2013 ch\u1ec9 cho ph\u00e9p g\u1eedi \u0111\u1ebfn h\u1ecdc sinh/ph\u1ee5 huynh</li> <li><code>VIEW_NOTIFICATION_SELF</code>, <code>VIEW_NOTIFICATION_OWN_CHILD</code> \u2013 xem th\u00f4ng b\u00e1o (qua portal)</li> <li><code>VIEW_NOTIFICATION_STATUS</code> \u2013 xem tr\u1ea1ng th\u00e1i g\u1eedi</li> <li>API Gateway evaluate permission v\u00e0 forward c\u00e1c header t\u01b0\u01a1ng \u1ee9ng</li> </ul>"},{"location":"interfaces/ic-04-notification/#loi-ac-thu","title":"\u26a0\ufe0f L\u1ed7i \u0111\u1eb7c th\u00f9","text":"Code M\u00f4 t\u1ea3 <code>TEMPLATE_NOT_FOUND</code> <code>template_code</code> kh\u00f4ng t\u1ed3n t\u1ea1i ho\u1eb7c kh\u00f4ng \u0111\u01b0\u1ee3c ph\u00e9p <code>INVALID_RECIPIENT</code> C\u00f3 <code>user_id</code> kh\u00f4ng h\u1ee3p l\u1ec7 ho\u1eb7c b\u1ecb block <code>CHANNEL_UNSUPPORTED</code> Channel kh\u00f4ng kh\u1ea3 d\u1ee5ng cho user <code>RATE_LIMIT_EXCEEDED</code> V\u01b0\u1ee3t qu\u00e1 t\u1ea7n su\u1ea5t g\u1eedi cho user ho\u1eb7c h\u1ec7 th\u1ed1ng"},{"location":"interfaces/ic-04-notification/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li><code>trace_id</code> ph\u1ea3i \u0111\u01b0\u1ee3c forward xuy\u00ean su\u1ed1t \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o observability</li> <li>M\u1ed7i <code>dispatch_id</code> c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c truy v\u1ea5n qua <code>/notifications/{dispatch_id}</code></li> <li>Template c\u00f3 th\u1ec3 versioned ho\u1eb7c h\u1ed7 tr\u1ee3 A/B testing n\u1ed9i b\u1ed9 n\u1ebfu c\u1ea7n</li> <li>C\u00e1c endpoint ph\u1ea3i tu\u00e2n th\u1ee7 [ADR-012] v\u00e0 [ADR-011]</li> </ul>"},{"location":"interfaces/ic-04-notification/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-011: API Error Format</li> <li>ADR-012: Response Structure</li> <li>ADR-008: Audit Logging</li> </ul> <p>\u201cTh\u00f4ng b\u00e1o t\u1ed1t kh\u00f4ng ch\u1ec9 \u0111\u1ebfn \u0111\u00fang ng\u01b0\u1eddi \u2013 m\u00e0 c\u00f2n \u0111\u00fang l\u00fac, \u0111\u00fang c\u00e1ch, v\u00e0 c\u00f3 th\u1ec3 ki\u1ec3m so\u00e1t \u0111\u01b0\u1ee3c.\u201d</p>"},{"location":"interfaces/ic-05-crm/","title":"\ud83d\udcd8 Interface Contract \u2013 CRM Adapter (dx-vas)","text":""},{"location":"interfaces/ic-05-crm/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y \u0111\u1ecbnh ngh\u0129a giao ti\u1ebfp c\u1ee7a CRM Adapter, \u0111\u00f3ng vai tr\u00f2:</p> <ul> <li>Nh\u1eadn d\u1eef li\u1ec7u \u0111\u1ed3ng b\u1ed9 t\u1eeb h\u1ec7 th\u1ed1ng tuy\u1ec3n sinh, webform landing page</li> <li>Cung c\u1ea5p th\u00f4ng tin kh\u00e1ch h\u00e0ng (ph\u1ee5 huynh/h\u1ecdc sinh ti\u1ec1m n\u0103ng) cho Admin Webapp</li> <li>G\u1eedi th\u00f4ng tin c\u1eadp nh\u1eadt \u0111\u1ebfn Notification Service n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"interfaces/ic-05-crm/#endpoint-crm-phoi-ra-provider-api","title":"\ud83e\udde9 Endpoint CRM ph\u01a1i ra (Provider API)","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/crm/leads</code> Danh s\u00e1ch lead (ph\u1ee5 huynh ti\u1ec1m n\u0103ng) <code>source: str</code>, <code>status: str</code>, <code>assigned_to?: str</code>, <code>created_from?: date</code>, <code>created_to?: date</code> <code>List[LeadOut]</code> <code>VIEW_LEAD_ALL</code> GET <code>/crm/leads/{id}</code> Chi ti\u1ebft m\u1ed9t lead <code>id: UUID</code> <code>LeadOut</code> <code>VIEW_LEAD_DETAIL</code> POST <code>/crm/leads</code> T\u1ea1o m\u1edbi lead t\u1eeb webform <code>LeadCreate</code> <code>LeadOut</code> Kh\u00f4ng y\u00eau c\u1ea7u (public n\u1ebfu l\u00e0 webform) PATCH <code>/crm/leads/{id}</code> C\u1eadp nh\u1eadt tr\u1ea1ng th\u00e1i lead <code>LeadStatusUpdate</code> <code>LeadOut</code> <code>EDIT_LEAD_STATUS</code> <p><code>LeadQueryParams</code> h\u1ed7 tr\u1ee3 l\u1ecdc theo ngu\u1ed3n (<code>source</code>), tr\u1ea1ng th\u00e1i (<code>status</code>), ng\u01b0\u1eddi ph\u1ee5 tr\u00e1ch (<code>assigned_to</code>), v\u00e0 kho\u1ea3ng th\u1eddi gian t\u1ea1o (<code>created_from</code>, <code>created_to</code>).</p>"},{"location":"interfaces/ic-05-crm/#crm-goi-cac-he-thong-khac","title":"\ud83d\udd01 CRM g\u1ecdi c\u00e1c h\u1ec7 th\u1ed1ng kh\u00e1c","text":"Target Method Endpoint M\u00f4 t\u1ea3 Notification POST <code>/notifications/bulk</code> G\u1eedi th\u00f4ng b\u00e1o h\u00e0ng lo\u1ea1t v\u1ec1 ch\u01b0\u01a1ng tr\u00ecnh m\u1edbi LMS Adapter PUT <code>/students/from-lead/{id}</code> Khi lead chuy\u1ec3n th\u00e0nh h\u1ecdc sinh ch\u00ednh th\u1ee9c"},{"location":"interfaces/ic-05-crm/#xac-thuc-rbac","title":"\ud83d\udd10 X\u00e1c th\u1ef1c &amp; RBAC","text":"<ul> <li> <p>T\u1ea5t c\u1ea3 request qua API Gateway \u2192 c\u00f3 JWT v\u00e0 header chu\u1ea9n:</p> </li> <li> <p><code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code>, <code>Trace-ID</code></p> </li> <li> <p>API <code>/crm/leads</code> (POST) l\u00e0 endpoint public d\u00f9ng cho webform tuy\u1ec3n sinh:</p> </li> <li> <p>Kh\u00f4ng y\u00eau c\u1ea7u JWT, nh\u01b0ng b\u1eaft bu\u1ed9c s\u1eed d\u1ee5ng token x\u00e1c th\u1ef1c \u0111\u01a1n gi\u1ea3n (<code>X-Form-Token</code>) ho\u1eb7c x\u00e1c th\u1ef1c CAPTCHA v3 \u0111\u1ec3 ng\u0103n abuse</p> </li> <li>C\u00f3 th\u1ec3 \u00e1p d\u1ee5ng rate-limit per IP / session theo ADR-004: Security Strategy</li> <li>N\u1ebfu abuse b\u1ecb ph\u00e1t hi\u1ec7n \u2192 kh\u00f3a ngu\u1ed3n ho\u1eb7c tr\u1ea3 v\u1ec1 l\u1ed7i <code>RATE_LIMIT_EXCEEDED</code></li> <li>C\u00e1c endpoint c\u00f2n l\u1ea1i y\u00eau c\u1ea7u x\u00e1c th\u1ef1c v\u00e0 permission c\u1ee5 th\u1ec3 (theo ADR-007)</li> </ul>"},{"location":"interfaces/ic-05-crm/#response-structure","title":"\ud83d\udce6 Response structure","text":"<p>Tu\u00e2n th\u1ee7 ADR-012:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"trace_id\": \"...\",\n    \"timestamp\": \"...\",\n    \"source\": \"crm_adapter\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-05-crm/#loi-ac-thu","title":"\u26a0\ufe0f L\u1ed7i \u0111\u1eb7c th\u00f9","text":"Code M\u00f4 t\u1ea3 <code>LEAD_NOT_FOUND</code> Kh\u00f4ng t\u1ed3n t\u1ea1i lead t\u01b0\u01a1ng \u1ee9ng <code>INVALID_LEAD_SOURCE</code> D\u1eef li\u1ec7u t\u1ea1o lead thi\u1ebfu ho\u1eb7c kh\u00f4ng h\u1ee3p l\u1ec7 <code>UNAUTHORIZED_EDIT_LEAD</code> Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n c\u1eadp nh\u1eadt lead <code>RATE_LIMIT_EXCEEDED</code> Webform b\u1ecb spam v\u01b0\u1ee3t gi\u1edbi h\u1ea1n h\u1ec7 th\u1ed1ng"},{"location":"interfaces/ic-05-crm/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>CRM Adapter l\u00e0 bridge gi\u1eefa lead v\u00e0 h\u1ec7 th\u1ed1ng h\u1ecdc sinh ch\u00ednh th\u1ee9c \u2192 d\u1eef li\u1ec7u ph\u1ea3i r\u00f5 v\u00e0 \u0111\u01b0\u1ee3c validate ch\u1eb7t</li> <li>Admin Webapp s\u1ebd g\u1ecdi c\u00e1c API n\u00e0y \u0111\u1ec3 x\u1eed l\u00fd lu\u1ed3ng tuy\u1ec3n sinh</li> <li>C\u00e1c thay \u0111\u1ed5i tr\u1ea1ng th\u00e1i quan tr\u1ecdng (v\u00ed d\u1ee5 chuy\u1ec3n t\u1eeb 'ti\u1ec1m n\u0103ng' \u2192 'tr\u00fang tuy\u1ec3n') n\u00ean t\u1ea1o <code>audit_log</code></li> </ul>"},{"location":"interfaces/ic-05-crm/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-011: API Error Format</li> <li>ADR-012: Response Structure</li> <li>ADR-004: Security Strategy</li> <li>ADR-008: Audit Logging</li> </ul> <p>\u201cCRM kh\u00f4ng ch\u1ec9 l\u01b0u danh s\u00e1ch \u2013 m\u00e0 k\u1ebft n\u1ed1i con ng\u01b0\u1eddi v\u1edbi h\u00e0nh tr\u00ecnh gi\u00e1o d\u1ee5c.\u201d</p>"},{"location":"interfaces/ic-06-sis/","title":"\ud83d\udcd8 Interface Contract \u2013 SIS Adapter (dx-vas)","text":""},{"location":"interfaces/ic-06-sis/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y m\u00f4 t\u1ea3 h\u1ee3p \u0111\u1ed3ng giao ti\u1ebfp (interface contract) c\u1ee7a SIS Adapter \u2013 h\u1ec7 th\u1ed1ng qu\u1ea3n l\u00fd h\u1ecdc sinh ch\u00ednh th\u1ee9c:</p> <ul> <li>Qu\u1ea3n l\u00fd th\u00f4ng tin h\u1ed3 s\u01a1 h\u1ecdc sinh v\u00e0 l\u1edbp h\u1ecdc</li> <li>\u0110\u1ed3ng b\u1ed9 d\u1eef li\u1ec7u v\u1edbi LMS, CRM v\u00e0 Admin Webapp</li> <li>Ph\u1ee5c v\u1ee5 cho c\u00e1c nghi\u1ec7p v\u1ee5 nh\u01b0 \u0111\u0103ng k\u00fd l\u1edbp, \u0111i\u1ec1u chuy\u1ec3n, th\u1ed1ng k\u00ea</li> </ul>"},{"location":"interfaces/ic-06-sis/#endpoint-sis-phoi-ra-provider-api","title":"\ud83e\udde9 Endpoint SIS ph\u01a1i ra (Provider API)","text":""},{"location":"interfaces/ic-06-sis/#hoc-sinh","title":"\ud83c\udf93 H\u1ecdc sinh","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/students</code> Danh s\u00e1ch h\u1ecdc sinh <code>page: int</code>, <code>limit: int</code>, <code>class_id?: UUID</code>, <code>status?: str</code>, <code>grade?: int</code> <code>List[StudentOut]</code> <code>VIEW_STUDENT_ALL</code> GET <code>/students/{id}</code> Th\u00f4ng tin chi ti\u1ebft h\u1ecdc sinh \u2014 <code>StudentOut</code> <code>VIEW_STUDENT_DETAIL</code> POST <code>/students</code> T\u1ea1o h\u1ecdc sinh m\u1edbi (nh\u1eadp h\u1ecdc) <code>StudentCreate</code> <code>StudentOut</code> <code>CREATE_STUDENT</code> PATCH <code>/students/{id}</code> C\u1eadp nh\u1eadt h\u1ed3 s\u01a1 h\u1ecdc sinh <code>StudentUpdate</code> <code>StudentOut</code> <code>EDIT_STUDENT</code> POST <code>/students/{id}/transfer</code> \u0110i\u1ec1u chuy\u1ec3n h\u1ecdc sinh <code>TransferRequest</code> <code>StudentOut</code> <code>TRANSFER_STUDENT</code> POST <code>/students/batch</code> L\u1ea5y danh s\u00e1ch th\u00f4ng tin h\u1ecdc sinh theo nhi\u1ec1u ID <code>student_ids: List[UUID]</code> <code>List[StudentOut]</code> <code>VIEW_STUDENT_ALL</code>"},{"location":"interfaces/ic-06-sis/#lop-hoc","title":"\ud83c\udfeb L\u1edbp h\u1ecdc","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/classes</code> Danh s\u00e1ch l\u1edbp h\u1ecdc <code>page: int</code>, <code>limit: int</code> <code>List[ClassOut]</code> <code>VIEW_CLASS_ALL</code> GET <code>/classes/{id}</code> Th\u00f4ng tin chi ti\u1ebft l\u1edbp h\u1ecdc <code>id: UUID</code> <code>ClassOut</code> <code>VIEW_CLASS_DETAIL</code> POST <code>/classes</code> T\u1ea1o l\u1edbp h\u1ecdc m\u1edbi <code>ClassCreate</code> <code>ClassOut</code> <code>CREATE_CLASS</code> PATCH <code>/classes/{id}</code> C\u1eadp nh\u1eadt th\u00f4ng tin l\u1edbp h\u1ecdc <code>ClassUpdate</code> <code>ClassOut</code> <code>EDIT_CLASS</code> <p>T\u1ea5t c\u1ea3 endpoint \u0111\u1ec1u \u0111i qua API Gateway, y\u00eau c\u1ea7u JWT h\u1ee3p l\u1ec7 v\u00e0 header ph\u00e2n quy\u1ec1n chu\u1ea9n (<code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code>, <code>Trace-ID</code>).</p>"},{"location":"interfaces/ic-06-sis/#sis-goi-cac-he-thong-khac-api-consumer","title":"\ud83d\udd01 SIS g\u1ecdi c\u00e1c h\u1ec7 th\u1ed1ng kh\u00e1c (API Consumer)","text":"Target Method Endpoint M\u00f4 t\u1ea3 Notification POST <code>/notifications/send</code> G\u1eedi th\u00f4ng b\u00e1o nh\u1eadp h\u1ecdc th\u00e0nh c\u00f4ng ho\u1eb7c chuy\u1ec3n l\u1edbp LMS Adapter PUT <code>/sync/student/{id}</code> \u0110\u1ed3ng b\u1ed9 th\u00f4ng tin h\u1ed3 s\u01a1 h\u1ecdc sinh m\u1edbi ho\u1eb7c \u0111\u00e3 c\u1eadp nh\u1eadt"},{"location":"interfaces/ic-06-sis/#xac-thuc-rbac","title":"\ud83d\udd10 X\u00e1c th\u1ef1c &amp; RBAC","text":"<ul> <li>M\u1ecdi endpoint g\u1ecdi qua API Gateway \u2192 c\u1ea7n JWT</li> <li>Forward header g\u1ed3m: <code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code>, <code>Trace-ID</code></li> <li>M\u1ecdi endpoint \u0111\u1ec1u y\u00eau c\u1ea7u permission c\u1ee5 th\u1ec3 \u2192 ki\u1ec3m tra <code>X-Permissions</code> t\u1ea1i backend</li> </ul>"},{"location":"interfaces/ic-06-sis/#response-structure","title":"\ud83d\udce6 Response structure","text":"<p>Tu\u00e2n th\u1ee7 ADR-012:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"trace_id\": \"...\",\n    \"timestamp\": \"...\",\n    \"source\": \"sis_adapter\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-06-sis/#loi-ac-thu","title":"\u26a0\ufe0f L\u1ed7i \u0111\u1eb7c th\u00f9","text":"Code M\u00f4 t\u1ea3 <code>STUDENT_NOT_FOUND</code> Kh\u00f4ng t\u1ed3n t\u1ea1i h\u1ecdc sinh v\u1edbi ID t\u01b0\u01a1ng \u1ee9ng <code>INVALID_CLASS_ID</code> Class kh\u00f4ng t\u1ed3n t\u1ea1i ho\u1eb7c kh\u00f4ng thu\u1ed9c campus ng\u01b0\u1eddi d\u00f9ng ph\u1ee5 tr\u00e1ch <code>TRANSFER_CONFLICT</code> \u0110i\u1ec1u chuy\u1ec3n kh\u00f4ng h\u1ee3p l\u1ec7 do tr\u1ea1ng th\u00e1i h\u1ecdc sinh"},{"location":"interfaces/ic-06-sis/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>M\u1ecdi h\u00e0nh \u0111\u1ed9ng t\u1ea1o/c\u1eadp nh\u1eadt h\u1ecdc sinh ho\u1eb7c l\u1edbp \u0111\u1ec1u t\u1ea1o audit log</li> <li>M\u1ecdi thao t\u00e1c c\u1eadp nh\u1eadt h\u1ed3 s\u01a1 h\u1ecdc sinh ph\u1ea3i \u0111\u1ed3ng b\u1ed9 sang LMS</li> <li>C\u00e1c tr\u01b0\u1eddng <code>status</code> c\u00f3 th\u1ec3 l\u00e0 <code>admitted</code>, <code>studying</code>, <code>transferred</code>, <code>left</code></li> <li>C\u00e1c endpoint tr\u1ea3 danh s\u00e1ch n\u00ean lu\u00f4n h\u1ed7 tr\u1ee3 <code>page</code>, <code>limit</code> \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o hi\u1ec7u n\u0103ng v\u00e0 gi\u1ea3m t\u1ea3i frontend</li> </ul>"},{"location":"interfaces/ic-06-sis/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-011: API Error Format</li> <li>ADR-012: Response Structure</li> <li>ADR-008: Audit Logging</li> </ul> <p>\u201cSIS l\u00e0 h\u1ec7 tim c\u1ee7a h\u1ec7 th\u1ed1ng gi\u00e1o d\u1ee5c \u2013 n\u01a1i d\u1eef li\u1ec7u h\u1ecdc sinh v\u00e0 l\u1edbp h\u1ecdc lu\u00f4n \u0111\u01b0\u1ee3c duy tr\u00ec ch\u00ednh x\u00e1c, \u0111\u1ea7y \u0111\u1ee7, v\u00e0 \u0111\u1ed3ng b\u1ed9.\u201d</p>"},{"location":"interfaces/ic-07-lms/","title":"\ud83d\udcd8 Interface Contract \u2013 LMS Adapter (dx-vas)","text":""},{"location":"interfaces/ic-07-lms/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y m\u00f4 t\u1ea3 h\u1ee3p \u0111\u1ed3ng giao ti\u1ebfp (interface contract) c\u1ee7a LMS Adapter \u2013 h\u1ec7 th\u1ed1ng qu\u1ea3n l\u00fd h\u1ecdc t\u1eadp:</p> <ul> <li>Cho ph\u00e9p tra c\u1ee9u l\u1ecbch h\u1ecdc, \u0111i\u1ec3m s\u1ed1, b\u00e0i t\u1eadp cho h\u1ecdc sinh/ph\u1ee5 huynh</li> <li>Nh\u1eadn \u0111\u1ed3ng b\u1ed9 d\u1eef li\u1ec7u t\u1eeb SIS v\u00e0 CRM</li> <li>Cung c\u1ea5p th\u00f4ng tin h\u1ecdc t\u1eadp cho Admin Webapp</li> </ul>"},{"location":"interfaces/ic-07-lms/#endpoint-lms-phoi-ra-provider-api","title":"\ud83e\udde9 Endpoint LMS ph\u01a1i ra (Provider API)","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/scores/student/{id}</code> L\u1ea5y \u0111i\u1ec3m h\u1ecdc sinh theo k\u1ef3 <code>term: str</code>, <code>subject?: str</code>, <code>page?: int</code>, <code>limit?: int</code> <code>List[ScoreOut]</code> <code>VIEW_STUDENT_SCORE_SELF/OWN_CHILD</code> GET <code>/timetable/student/{id}</code> L\u1ecbch h\u1ecdc theo tu\u1ea7n <code>week: ISODate</code>, <code>page?: int</code>, <code>limit?: int</code> <code>List[TimetableOut]</code> <code>VIEW_STUDENT_TIMETABLE_SELF/OWN_CHILD</code> GET <code>/assignments/student/{id}</code> Danh s\u00e1ch b\u00e0i t\u1eadp <code>status?: str</code>, <code>due_before?: date</code>, <code>page?: int</code>, <code>limit?: int</code> <code>List[AssignmentOut]</code> <code>VIEW_STUDENT_ASSIGNMENTS</code> PUT <code>/sync/student/{id}</code> Nh\u1eadn \u0111\u1ed3ng b\u1ed9 th\u00f4ng tin t\u1eeb SIS <code>StudentSyncPayload</code> <code>StudentOut</code> <code>SYNC_FROM_SIS</code> PUT <code>/students/from-lead/{id}</code> Nh\u1eadn h\u1ecdc sinh t\u1eeb CRM khi chuy\u1ec3n \u0111\u1ed5i t\u1eeb lead <code>StudentFromLeadPayload</code> <code>StudentOut</code> <code>CREATE_STUDENT_FROM_LEAD</code> <p>C\u00e1c endpoint <code>/student/{id}</code> d\u00f9ng cho c\u1ea3 h\u1ecdc sinh v\u00e0 ph\u1ee5 huynh (Gateway determine permission code ph\u00f9 h\u1ee3p theo vai tr\u00f2). T\u1ea5t c\u1ea3 endpoint tr\u1ea3 danh s\u00e1ch \u0111\u1ec1u h\u1ed7 tr\u1ee3 ph\u00e2n trang <code>page</code>, <code>limit</code>.</p>"},{"location":"interfaces/ic-07-lms/#lms-goi-he-thong-khac","title":"\ud83d\udd01 LMS g\u1ecdi h\u1ec7 th\u1ed1ng kh\u00e1c","text":"Target Method Endpoint M\u00f4 t\u1ea3 Notification POST <code>/notifications/schedule-reminder</code> G\u1eedi nh\u1eafc h\u1ecdc b\u00e0i, h\u1ea1n b\u00e0i t\u1eadp"},{"location":"interfaces/ic-07-lms/#xac-thuc-rbac","title":"\ud83d\udd10 X\u00e1c th\u1ef1c &amp; RBAC","text":"<ul> <li> <p>T\u1ea5t c\u1ea3 g\u1ecdi qua API Gateway \u2192 JWT v\u00e0 c\u00e1c header:</p> </li> <li> <p><code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code>, <code>Trace-ID</code></p> </li> <li>Backend ch\u1ec9 c\u1ea7n ki\u1ec3m tra <code>X-Permissions</code> \u0111\u1ec3 x\u00e1c \u0111\u1ecbnh quy\u1ec1n truy c\u1eadp</li> <li>H\u1ecdc sinh v\u00e0 ph\u1ee5 huynh d\u00f9ng c\u00f9ng endpoint nh\u01b0ng kh\u00e1c permission code</li> <li> <p>\u0110\u1ed1i v\u1edbi c\u00e1c endpoint nh\u01b0 <code>/students/from-lead/{id}</code> (g\u1ecdi b\u1edfi CRM Adapter):</p> </li> <li> <p>\u0110\u00e2y l\u00e0 lu\u1ed3ng service-to-service, kh\u00f4ng \u0111\u1ea1i di\u1ec7n cho ng\u01b0\u1eddi d\u00f9ng cu\u1ed1i c\u1ee5 th\u1ec3.</p> </li> <li>V\u1eabn \u0111i qua Gateway, c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng <code>X-User-ID</code> \u0111\u1ea1i di\u1ec7n cho service CRM v\u1edbi role <code>system</code>.</li> <li>Permission <code>CREATE_STUDENT_FROM_LEAD</code> \u0111\u01b0\u1ee3c c\u1ea5p cho CRM th\u00f4ng qua c\u1ea5u h\u00ecnh RBAC.</li> <li>LMS Adapter ki\u1ec3m tra <code>X-Permissions</code> nh\u01b0 b\u00ecnh th\u01b0\u1eddng, kh\u00f4ng c\u1ea7n ph\u00e2n bi\u1ec7t user/service.</li> </ul>"},{"location":"interfaces/ic-07-lms/#response-structure","title":"\ud83d\udce6 Response structure","text":"<p>Tu\u00e2n th\u1ee7 ADR-012:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"trace_id\": \"...\",\n    \"timestamp\": \"...\",\n    \"source\": \"lms_adapter\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-07-lms/#loi-ac-thu","title":"\u26a0\ufe0f L\u1ed7i \u0111\u1eb7c th\u00f9","text":"Code M\u00f4 t\u1ea3 <code>SCORE_NOT_FOUND</code> Kh\u00f4ng c\u00f3 \u0111i\u1ec3m cho h\u1ecdc sinh/k\u1ef3 \u0111\u01b0\u1ee3c y\u00eau c\u1ea7u <code>ASSIGNMENT_NOT_FOUND</code> Kh\u00f4ng c\u00f3 b\u00e0i t\u1eadp t\u01b0\u01a1ng \u1ee9ng <code>UNAUTHORIZED_ACCESS_TO_STUDENT</code> D\u1eef li\u1ec7u h\u1ecdc sinh \u0111\u01b0\u1ee3c y\u00eau c\u1ea7u kh\u00f4ng kh\u1edbp v\u1edbi ph\u1ea1m vi \u0111\u01b0\u1ee3c ph\u00e9p c\u1ee7a ng\u01b0\u1eddi d\u00f9ng (d\u00f9 permission code \u0111\u00e3 \u0111\u01b0\u1ee3c c\u1ea5p). Th\u01b0\u1eddng do d\u1eef li\u1ec7u kh\u00f4ng \u0111\u1ed3ng nh\u1ea5t ho\u1eb7c logic nghi\u1ec7p v\u1ee5 s\u00e2u h\u01a1n ngo\u00e0i ph\u1ea1m vi \u0111\u00e1nh gi\u00e1 c\u1ee7a Gateway."},{"location":"interfaces/ic-07-lms/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>M\u1ecdi thay \u0111\u1ed5i t\u1eeb SIS ho\u1eb7c CRM s\u1ebd override d\u1eef li\u1ec7u h\u1ecdc sinh n\u1ebfu g\u1ecdi <code>/sync/student/{id}</code> ho\u1eb7c <code>/students/from-lead/{id}</code></li> <li>H\u00e0nh vi tr\u1ea3 \u0111i\u1ec3m/b\u00e0i t\u1eadp/l\u1ecbch h\u1ecdc ph\u1ea3i \u0111\u1ed3ng b\u1ed9 v\u1edbi permission hi\u1ec7n h\u00e0nh (SELF ho\u1eb7c OWN_CHILD)</li> <li>M\u1ecdi truy c\u1eadp \u0111\u01b0\u1ee3c audit theo ADR-008</li> </ul>"},{"location":"interfaces/ic-07-lms/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-011: API Error Format</li> <li>ADR-012: Response Structure</li> <li>ADR-008: Audit Logging</li> </ul> <p>\u201cLMS kh\u00f4ng ch\u1ec9 ghi \u0111i\u1ec3m \u2013 m\u00e0 ghi l\u1ea1i c\u1ea3 h\u00e0nh tr\u00ecnh h\u1ecdc t\u1eadp c\u1ee7a h\u1ecdc sinh.\u201d</p>"},{"location":"interfaces/ic-08-auth-service/","title":"\ud83d\udcd8 Interface Contract \u2013 Auth Service (dx-vas)","text":""},{"location":"interfaces/ic-08-auth-service/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y \u0111\u1ecbnh ngh\u0129a Interface Contract cho Auth Service, ch\u1ecbu tr\u00e1ch nhi\u1ec7m:</p> <ul> <li>X\u00e1c th\u1ef1c ng\u01b0\u1eddi d\u00f9ng (OTP login, Google OAuth)</li> <li>Ph\u00e1t h\u00e0nh v\u00e0 l\u00e0m m\u1edbi JWT</li> <li>H\u1ed7 tr\u1ee3 \u0111\u0103ng xu\u1ea5t, ki\u1ec3m tra tr\u1ea1ng th\u00e1i token</li> <li>Ph\u1ee5c v\u1ee5 \u0111a k\u00eanh: Web, Mobile App, API Public (n\u1ebfu c\u1ea7n)</li> </ul>"},{"location":"interfaces/ic-08-auth-service/#endpoint-auth-service-cung-cap","title":"\ud83e\udde9 Endpoint Auth Service cung c\u1ea5p","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema Output Schema POST <code>/auth/request-otp</code> G\u1eedi OTP \u0111\u1ebfn email/s\u1ed1 \u0111i\u1ec7n tho\u1ea1i <code>OtpRequest</code> <code>OtpRequestResult</code> POST <code>/auth/verify-otp</code> X\u00e1c th\u1ef1c m\u00e3 OTP v\u00e0 ph\u00e1t h\u00e0nh JWT <code>OtpVerify</code> <code>TokenPair</code> GET <code>/auth/google-login</code> B\u1eaft \u0111\u1ea7u Google OAuth2 (redirect) <code>redirect_uri: str</code> \u2014 (HTTP Redirect) POST <code>/auth/google-callback</code> X\u1eed l\u00fd m\u00e3 tr\u1ea3 v\u1ec1 t\u1eeb Google v\u00e0 ph\u00e1t h\u00e0nh JWT <code>GoogleCallbackPayload</code> <code>TokenPair</code> POST <code>/auth/refresh</code> L\u00e0m m\u1edbi access token b\u1eb1ng refresh token <code>RefreshRequest</code> <code>TokenPair</code> POST <code>/auth/logout</code> Thu h\u1ed3i refresh token (\u0111\u0103ng xu\u1ea5t) <code>LogoutRequest</code> <code>LogoutResult</code>"},{"location":"interfaces/ic-08-auth-service/#xac-thuc-phan-quyen","title":"\ud83d\udd10 X\u00e1c th\u1ef1c &amp; Ph\u00e2n quy\u1ec1n","text":"<ul> <li>C\u00e1c endpoint <code>/auth/*</code> kh\u00f4ng y\u00eau c\u1ea7u access token</li> <li>Sau khi x\u00e1c th\u1ef1c th\u00e0nh c\u00f4ng, Auth Service tr\u1ea3 v\u1ec1:</li> </ul> <pre><code>{\n  \"access_token\": \"...\",\n  \"refresh_token\": \"...\",\n  \"expires_in\": 3600\n}\n</code></pre> <ul> <li><code>access_token</code> l\u00e0 JWT d\u00f9ng g\u1ecdi API Gateway</li> <li><code>refresh_token</code> \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd n\u1ed9i b\u1ed9 ho\u1eb7c l\u01b0u trong cookie (mobile, frontend tu\u1ef3 lu\u1ed3ng)</li> </ul>"},{"location":"interfaces/ic-08-auth-service/#input-schema-tieu-bieu","title":"\ud83d\udce5 Input Schema ti\u00eau bi\u1ec3u","text":""},{"location":"interfaces/ic-08-auth-service/#otprequest","title":"OtpRequest","text":"<pre><code>{\n  \"identity\": \"parent@example.com\",\n  \"channel\": \"email\" // ho\u1eb7c \"sms\"\n}\n</code></pre>"},{"location":"interfaces/ic-08-auth-service/#otpverify","title":"OtpVerify","text":"<pre><code>{\n  \"identity\": \"parent@example.com\",\n  \"otp\": \"123456\"\n}\n</code></pre>"},{"location":"interfaces/ic-08-auth-service/#googlecallbackpayload","title":"GoogleCallbackPayload","text":"<pre><code>{\n  \"code\": \"auth_code_abc\",\n  \"redirect_uri\": \"https://client.dx.edu.vn/oauth2/callback\"\n}\n</code></pre> <p><code>redirect_uri</code> ph\u1ea3i kh\u1edbp ch\u00ednh x\u00e1c v\u1edbi c\u1ea5u h\u00ecnh c\u1ee7a h\u1ec7 th\u1ed1ng \u0111\u1ec3 ng\u0103n gi\u1ea3 m\u1ea1o (ADR-004).</p>"},{"location":"interfaces/ic-08-auth-service/#refreshrequest","title":"RefreshRequest","text":"<pre><code>{\n  \"refresh_token\": \"...\"\n}\n</code></pre>"},{"location":"interfaces/ic-08-auth-service/#logoutrequest","title":"LogoutRequest","text":"<pre><code>{\n  \"refresh_token\": \"...\"\n}\n</code></pre>"},{"location":"interfaces/ic-08-auth-service/#output-schema-tieu-bieu","title":"\ud83d\udce4 Output Schema ti\u00eau bi\u1ec3u","text":""},{"location":"interfaces/ic-08-auth-service/#tokenpair","title":"TokenPair","text":"<pre><code>{\n  \"access_token\": \"...\",\n  \"refresh_token\": \"...\",\n  \"expires_in\": 3600\n}\n</code></pre>"},{"location":"interfaces/ic-08-auth-service/#otprequestresult","title":"OtpRequestResult","text":"<pre><code>{\n  \"channel\": \"email\",\n  \"message_id\": \"otp-xyz-123\"\n}\n</code></pre>"},{"location":"interfaces/ic-08-auth-service/#logoutresult","title":"LogoutResult","text":"<pre><code>{\n  \"success\": true\n}\n</code></pre> <p>M\u1ed9t s\u1ed1 h\u1ec7 th\u1ed1ng c\u00f3 th\u1ec3 tr\u1ea3 HTTP 204 No Content cho logout. T\u1ea1i dx-vas, d\u00f9ng JSON r\u00f5 r\u00e0ng \u0111\u1ec3 ti\u1ec7n logging v\u00e0 frontend x\u1eed l\u00fd.</p>"},{"location":"interfaces/ic-08-auth-service/#loi-ac-thu","title":"\u26a0\ufe0f L\u1ed7i \u0111\u1eb7c th\u00f9","text":"Code M\u00f4 t\u1ea3 <code>OTP_INVALID</code> M\u00e3 OTP kh\u00f4ng h\u1ee3p l\u1ec7 (\u0111\u00e3 bao g\u1ed3m h\u1ebft h\u1ea1n) <code>IDENTITY_NOT_FOUND</code> Email/s\u1ed1 \u0111i\u1ec7n tho\u1ea1i ch\u01b0a \u0111\u0103ng k\u00fd trong h\u1ec7 th\u1ed1ng <code>REFRESH_TOKEN_EXPIRED</code> Refresh token kh\u00f4ng c\u00f2n h\u1ee3p l\u1ec7 <code>GOOGLE_CALLBACK_INVALID</code> Google callback th\u1ea5t b\u1ea1i ho\u1eb7c b\u1ecb gi\u1ea3 m\u1ea1o <code>USER_ACCOUNT_LOCKED</code> T\u00e0i kho\u1ea3n b\u1ecb kho\u00e1, kh\u00f4ng cho ph\u00e9p login <code>USER_ACCOUNT_INACTIVE</code> T\u00e0i kho\u1ea3n ch\u01b0a \u0111\u01b0\u1ee3c k\u00edch ho\u1ea1t ho\u1eb7c \u0111\u00e3 b\u1ecb v\u00f4 hi\u1ec7u ho\u00e1 <p>T\u1ea5t c\u1ea3 l\u1ed7i \u0111\u1ec1u tu\u00e2n theo ADR-011. C\u00e1c m\u00e3 l\u1ed7i n\u00ean \u0111\u01b0\u1ee3c chu\u1ea9n ho\u00e1 v\u00e0 kh\u00f4ng l\u1eb7p l\u1ea1i n\u1ebfu \u0111\u00e3 t\u1ed3n t\u1ea1i trong ADR-011.</p>"},{"location":"interfaces/ic-08-auth-service/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>Auth Service c\u00f3 th\u1ec3 g\u1eafn th\u00eam captcha n\u1ebfu h\u1ec7 th\u1ed1ng ph\u00e1t hi\u1ec7n spam OTP (theo ADR-004)</li> <li>Refresh token h\u1ed7 tr\u1ee3 rotation n\u1ebfu tri\u1ec3n khai n\u00e2ng cao</li> <li>Google login kh\u00f4ng ph\u00e1t h\u00e0nh t\u00e0i kho\u1ea3n m\u1edbi \u2013 ch\u1ec9 li\u00ean k\u1ebft v\u1edbi ng\u01b0\u1eddi d\u00f9ng \u0111\u00e3 c\u00f3 trong h\u1ec7 th\u1ed1ng</li> <li>Auth Service kh\u00f4ng c\u1ea7n permission RBAC \u2013 ch\u1ec9 ph\u00e1t h\u00e0nh token, c\u00f2n quy\u1ec1n s\u1ebd \u0111\u01b0\u1ee3c evaluate t\u1ea1i API Gateway</li> <li>M\u1ecdi response tu\u00e2n th\u1ee7 c\u1ea5u tr\u00fac ADR-012:</li> </ul> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"...\",\n    \"source\": \"auth_service\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-08-auth-service/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-004: Security Strategy</li> <li>ADR-011: API Error Format</li> <li>ADR-012: Response Structure</li> </ul> <p>\u201cAuth Service l\u00e0 c\u00e1nh c\u1eeda \u0111\u1ea7u ti\u00ean \u2013 v\u1eeba an to\u00e0n, v\u1eeba \u0111\u01a1n gi\u1ea3n, v\u1eeba m\u1edf r\u1ed9ng \u0111\u01b0\u1ee3c cho m\u1ecdi k\u00eanh.\u201d</p>"},{"location":"interfaces/ic-09-user-service/","title":"\ud83d\udcd8 Interface Contract \u2013 User Service (dx-vas)","text":""},{"location":"interfaces/ic-09-user-service/#muc-tieu","title":"\ud83d\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y \u0111\u1ecbnh ngh\u0129a giao ti\u1ebfp cho User Service, microservice ch\u1ecbu tr\u00e1ch nhi\u1ec7m:</p> <ul> <li>Qu\u1ea3n l\u00fd ng\u01b0\u1eddi d\u00f9ng n\u1ed9i b\u1ed9 (t\u00e0i kho\u1ea3n, tr\u1ea1ng th\u00e1i, ph\u00e2n quy\u1ec1n)</li> <li>Cung c\u1ea5p d\u1eef li\u1ec7u <code>roles</code>, <code>permissions</code>, <code>is_active</code></li> <li>Ghi nh\u1eadn v\u00e0 cung c\u1ea5p audit log cho c\u00e1c thao t\u00e1c qu\u1ea3n tr\u1ecb</li> <li>L\u00e0 backend x\u1eed l\u00fd ch\u00ednh cho c\u00e1c API <code>/users</code>, <code>/roles</code>, <code>/permissions</code>, <code>/audit/logs</code> \u0111\u01b0\u1ee3c g\u1ecdi t\u1eeb Admin Webapp th\u00f4ng qua Gateway</li> </ul>"},{"location":"interfaces/ic-09-user-service/#endpoint-user-service-phoi-ra-provider-api","title":"\ud83d\udcd9 Endpoint User Service ph\u01a1i ra (Provider API)","text":""},{"location":"interfaces/ic-09-user-service/#user-role-permission-apis","title":"\ud83d\udc64 User, Role, Permission APIs","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/users</code> L\u1ea5y danh s\u00e1ch ng\u01b0\u1eddi d\u00f9ng <code>page</code>, <code>search</code>, <code>role?</code>, <code>status?</code> <code>List[UserOut]</code> <code>VIEW_USER_ALL</code> POST <code>/users</code> T\u1ea1o m\u1edbi ng\u01b0\u1eddi d\u00f9ng <code>UserCreate</code> <code>UserOut</code> <code>CREATE_USER</code> PATCH <code>/users/{id}</code> C\u1eadp nh\u1eadt th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng <code>UserUpdate</code> <code>UserOut</code> <code>EDIT_USER</code> PATCH <code>/users/{id}/status</code> C\u1eadp nh\u1eadt tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng <code>SetActiveRequest</code> <code>UserOut</code> <code>EDIT_USER_STATUS</code> GET <code>/roles</code> Danh s\u00e1ch role \u2014 <code>List[RoleOut]</code> <code>VIEW_ROLE_ALL</code> POST <code>/roles</code> T\u1ea1o role m\u1edbi <code>RoleCreate</code> <code>RoleOut</code> <code>CREATE_ROLE</code> GET <code>/permissions</code> Danh s\u00e1ch permission \u2014 <code>List[PermissionOut]</code> <code>VIEW_PERMISSION_ALL</code>"},{"location":"interfaces/ic-09-user-service/#role-permission-va-user-role-apis","title":"\ud83d\udd17 Role-Permission v\u00e0 User-Role APIs","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema Output Schema Permission Code POST <code>/roles/{id}/permissions</code> G\u00e1n permission v\u00e0o role <code>PermissionAssign</code> <code>RoleOut</code> <code>ASSIGN_PERMISSION_TO_ROLE</code> DELETE <code>/roles/{role_id}/permissions/{permission_id}</code> Thu h\u1ed3i permission kh\u1ecfi role \u2014 <code>RoleOut</code> <code>REMOVE_PERMISSION_FROM_ROLE</code> POST <code>/users/{id}/roles</code> G\u00e1n role cho user <code>RoleAssign</code> <code>UserOut</code> <code>ASSIGN_ROLE_TO_USER</code> DELETE <code>/users/{user_id}/roles/{role_id}</code> Thu h\u1ed3i role kh\u1ecfi user \u2014 <code>UserOut</code> <code>REMOVE_ROLE_FROM_USER</code>"},{"location":"interfaces/ic-09-user-service/#audit-log-api","title":"\ud83d\udcdc Audit Log API","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/audit/logs</code> L\u1ecbch s\u1eed thao t\u00e1c h\u1ec7 th\u1ed1ng <code>resource: str</code>, <code>user_id?: UUID</code>, <code>date?: ISODateString</code> <code>List[AuditLogOut]</code> <code>VIEW_AUDIT_LOG</code> <p>Endpoint <code>/audit/logs</code> d\u00f9ng \u0111\u1ec3 truy v\u1ebft c\u00e1c h\u00e0nh \u0111\u1ed9ng quan tr\u1ecdng nh\u01b0 t\u1ea1o/s\u1eeda role, permission, user\u2026 cho Admin Webapp.</p>"},{"location":"interfaces/ic-09-user-service/#xac-thuc-rbac","title":"\ud83d\udd10 X\u00e1c th\u1ef1c &amp; RBAC","text":"<ul> <li>M\u1ecdi request \u0111i qua API Gateway \u2192 JWT b\u1eaft bu\u1ed9c</li> <li>Gateway forward header:</li> <li><code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code>, <code>Trace-ID</code></li> <li>Backend ch\u1ec9 c\u1ea7n ki\u1ec3m tra permission code c\u00f3 trong <code>X-Permissions</code></li> </ul>"},{"location":"interfaces/ic-09-user-service/#response-structure","title":"\ud83d\udce6 Response structure","text":"<p>Tu\u00e2n th\u1ee7 ADR-012:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"trace_id\": \"...\",\n    \"timestamp\": \"...\",\n    \"source\": \"user_service\"\n  }\n}\n</code></pre>"},{"location":"interfaces/ic-09-user-service/#loi-ac-thu","title":"\u26a0\ufe0f L\u1ed7i \u0111\u1eb7c th\u00f9","text":"Code M\u00f4 t\u1ea3 <code>USER_NOT_FOUND</code> Kh\u00f4ng t\u00ecm th\u1ea5y ng\u01b0\u1eddi d\u00f9ng t\u01b0\u01a1ng \u1ee9ng <code>ROLE_NOT_FOUND</code> Kh\u00f4ng t\u1ed3n t\u1ea1i role <code>PERMISSION_INVALID</code> Permission kh\u00f4ng h\u1ee3p l\u1ec7 ho\u1eb7c kh\u00f4ng g\u1eafn \u0111\u01b0\u1ee3c <code>EMAIL_ALREADY_USED</code> Email \u0111\u00e3 t\u1ed3n t\u1ea1i trong h\u1ec7 th\u1ed1ng <code>INVALID_ROLE_ASSIGNMENT</code> Kh\u00f4ng th\u1ec3 g\u00e1n role kh\u00f4ng \u0111\u01b0\u1ee3c ph\u00e9p"},{"location":"interfaces/ic-09-user-service/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>Permissions \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a t\u0129nh theo chu\u1ea9n h\u1ec7 th\u1ed1ng (ADR-007), \u0111\u01b0\u1ee3c load v\u00e0o DB qua migration ban \u0111\u1ea7u, v\u00e0 API ch\u1ec9 cho ph\u00e9p GET /permissions (kh\u00f4ng c\u00f3 create/update/delete tr\u1ef1c ti\u1ebfp qua API).</li> <li>C\u00e1c thay \u0111\u1ed5i g\u00e1n/thu h\u1ed3i role-permission, user-role \u0111\u01b0\u1ee3c ghi nh\u1eadn v\u00e0 audit r\u00f5 r\u00e0ng.</li> <li>Khi tr\u1ea1ng th\u00e1i <code>is_active</code> thay \u0111\u1ed5i:</li> <li>Gateway s\u1ebd nh\u1eadn event t\u1eeb User Service (qua event bus nh\u01b0 Redis Pub/Sub ho\u1eb7c message queue)</li> <li>Gateway c\u1eadp nh\u1eadt cache permission t\u01b0\u01a1ng \u1ee9ng ho\u1eb7c refresh context cho token m\u1edbi \u0111\u01b0\u1ee3c c\u1ea5p</li> <li>Trong tr\u01b0\u1eddng h\u1ee3p token v\u1eabn c\u00f2n hi\u1ec7u l\u1ef1c, backend c\u00f3 th\u1ec3 ki\u1ec3m tra <code>X-Permissions</code> \u0111\u00e3 \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt \u0111\u00fang n\u1ebfu c\u1ea7n b\u1ea3o v\u1ec7 logic s\u00e2u h\u01a1n.</li> <li><code>/audit/logs</code> ph\u1ea3n \u00e1nh to\u00e0n b\u1ed9 thao t\u00e1c c\u00f3 \u1ea3nh h\u01b0\u1edfng t\u1edbi RBAC, ph\u00e2n quy\u1ec1n, t\u1ea1o user\u2026 t\u1eeb Admin Webapp</li> <li>Ng\u01b0\u1eddi d\u00f9ng c\u00f3 th\u1ec3 l\u00e0 gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean, ph\u1ee5 huynh \u2013 \u0111\u01b0\u1ee3c \u00e1nh x\u1ea1 t\u1eeb SIS/CRM nh\u01b0ng to\u00e0n b\u1ed9 \u0111\u1ecbnh danh, tr\u1ea1ng th\u00e1i <code>is_active</code> v\u00e0 quy\u1ec1n truy c\u1eadp (<code>roles</code>, <code>permissions</code>) \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd t\u1eadp trung t\u1ea1i User Service.</li> <li>M\u1ecdi thay \u0111\u1ed5i \u0111\u1ec1u \u0111\u01b0\u1ee3c audit theo [ADR-008]</li> </ul>"},{"location":"interfaces/ic-09-user-service/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-012: Response Structure</li> <li>ADR-008: Audit Logging</li> </ul> <p>\u201cUser Service l\u00e0 tr\u00e1i tim qu\u1ea3n l\u00fd \u0111\u1ecbnh danh \u2013 duy tr\u00ec quy\u1ec1n l\u1ef1c, truy xu\u1ea5t v\u00e0 t\u00ednh minh b\u1ea1ch cho to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"interfaces/temp-api-gateway-admin-webapp/","title":"\ud83d\udcd8 Service Interface Contracts \u2013 API Gateway &amp; Admin Webapp (dx_vas)","text":""},{"location":"interfaces/temp-api-gateway-admin-webapp/#muc-tieu","title":"\ud83e\udded M\u1ee5c ti\u00eau","text":"<p>Chu\u1ea9n h\u00f3a h\u1ee3p \u0111\u1ed3ng giao ti\u1ebfp (interface contract) gi\u1eefa hai service quan tr\u1ecdng:</p> <ul> <li>API Gateway (trung t\u00e2m ki\u1ec3m so\u00e1t x\u00e1c th\u1ef1c, ph\u00e2n quy\u1ec1n, \u0111\u1ecbnh tuy\u1ebfn request)</li> <li>Admin Webapp (\u1ee9ng d\u1ee5ng qu\u1ea3n tr\u1ecb to\u00e0n h\u1ec7 th\u1ed1ng)</li> </ul>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#1-api-gateway","title":"1\ufe0f\u20e3 API Gateway","text":""},{"location":"interfaces/temp-api-gateway-admin-webapp/#vai-tro","title":"\ud83c\udfaf Vai tr\u00f2","text":"<ul> <li>X\u00e1c th\u1ef1c (OAuth2, Local, OTP)</li> <li>\u00c1p d\u1ee5ng ph\u00e2n quy\u1ec1n RBAC \u0111\u1ed9ng (theo ADR-007)</li> <li>Forward request \u0111\u1ebfn c\u00e1c service ph\u00eda sau (CRM, LMS, SIS...)</li> </ul>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#header-chuan-forward","title":"\ud83d\udd10 Header chu\u1ea9n forward","text":"Header \u00dd ngh\u0129a <code>X-User-ID</code> ID ng\u01b0\u1eddi d\u00f9ng \u0111\u00e3 x\u00e1c th\u1ef1c <code>X-Role</code> Vai tr\u00f2 hi\u1ec7n h\u00e0nh c\u1ee7a ng\u01b0\u1eddi d\u00f9ng <code>X-Auth-Method</code> <code>google</code>, <code>otp</code>, <code>local</code> <code>X-Permissions</code> Danh s\u00e1ch c\u00e1c <code>permission_code</code> h\u1ee3p l\u1ec7 (\u0111\u00e3 evaluate t\u1ea1i Gateway) <code>Trace-ID</code> ID duy nh\u1ea5t cho m\u1ed7i request (theo ADR-011)"},{"location":"interfaces/temp-api-gateway-admin-webapp/#input","title":"\ud83d\udce5 Input","text":"<ul> <li>Request t\u1eeb client (Admin Webapp, Customer Portal...) v\u1edbi JWT ho\u1eb7c OTP token</li> </ul>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#output","title":"\ud83d\udce4 Output","text":"<ul> <li>Forward t\u1edbi backend: CRM, LMS, Notification, ... k\u00e8m headers nh\u01b0 tr\u00ean</li> </ul>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#xu-ly-noi-bo","title":"\ud83d\udd0e X\u1eed l\u00fd n\u1ed9i b\u1ed9","text":"<ul> <li>Tra c\u1ee9u quy\u1ec1n t\u1eeb Redis (RBAC Cache)</li> <li>Ki\u1ec3m tra \u0111i\u1ec1u ki\u1ec7n <code>is_active</code> (README.md)</li> <li>Ki\u1ec3m tra <code>permission</code> theo pattern: resource + action + condition (ADR-007)</li> </ul>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#2-admin-webapp","title":"2\ufe0f\u20e3 Admin Webapp","text":""},{"location":"interfaces/temp-api-gateway-admin-webapp/#vai-tro_1","title":"\ud83c\udfaf Vai tr\u00f2","text":"<ul> <li>Giao di\u1ec7n qu\u1ea3n tr\u1ecb t\u1eadp trung: User, Role, Permission, Class, Fee, Audit</li> <li>K\u1ebft n\u1ed1i API Gateway \u0111\u1ec3 th\u1ef1c hi\u1ec7n thao t\u00e1c \u0111\u1ecdc/ghi t\u1edbi backend services</li> </ul>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#yeu-cau-truy-cap","title":"\ud83d\udd10 Y\u00eau c\u1ea7u truy c\u1eadp","text":"<ul> <li>Lu\u00f4n g\u1eedi JWT khi g\u1ecdi API Gateway</li> <li>Ph\u1ea3i n\u1eb1m trong vai tr\u00f2 c\u00f3 \u0111\u1ee7 permission t\u01b0\u01a1ng \u1ee9ng v\u1edbi endpoint y\u00eau c\u1ea7u</li> </ul>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#endpoint-tieu-bieu-goi-toi-api-gateway","title":"\ud83d\udd27 Endpoint ti\u00eau bi\u1ec3u (g\u1ecdi t\u1edbi API Gateway)","text":"Method Endpoint \u00dd ngh\u0129a Permission Code Input Schema / Query Params Output Schema GET <code>/users</code> Xem danh s\u00e1ch ng\u01b0\u1eddi d\u00f9ng <code>VIEW_USER_ALL</code> <code>?page</code>, <code>?search</code> <code>List[UserOut]</code> POST <code>/users</code> T\u1ea1o ng\u01b0\u1eddi d\u00f9ng m\u1edbi <code>CREATE_USER</code> <code>UserCreate</code> (JSON body) <code>UserOut</code> PATCH <code>/users/{id}</code> C\u1eadp nh\u1eadt th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng <code>EDIT_USER</code> <code>UserUpdate</code> (JSON body) <code>UserOut</code> GET <code>/permissions</code> L\u1ea5y danh s\u00e1ch permission <code>VIEW_PERMISSION_ALL</code> \u2014 <code>List[PermissionOut]</code> POST <code>/roles</code> T\u1ea1o m\u1edbi role <code>CREATE_ROLE</code> <code>RoleCreate</code> <code>RoleOut</code> GET <code>/audit/logs</code> Xem l\u1ecbch s\u1eed thay \u0111\u1ed5i d\u1eef li\u1ec7u <code>VIEW_AUDIT_LOG</code> <code>?resource</code>, <code>?user_id</code>, <code>?date</code> <code>List[AuditLogOut]</code> POST <code>/classes</code> T\u1ea1o l\u1edbp h\u1ecdc <code>CREATE_CLASS</code> <code>ClassCreate</code> <code>ClassOut</code> POST <code>/notifications/send</code> G\u1eedi th\u00f4ng b\u00e1o t\u1edbi ng\u01b0\u1eddi d\u00f9ng <code>SEND_NOTIFICATION_ALL</code> <code>NotificationRequest</code> <code>NotificationDispatchResult</code> <p>C\u00e1c schema c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a b\u1eb1ng Pydantic ho\u1eb7c JSON Schema t\u01b0\u01a1ng \u0111\u01b0\u01a1ng. \u0110\u01b0\u1ee3c d\u00f9ng b\u1edfi c\u1ea3 backend v\u00e0 frontend \u0111\u1ec3 validate.</p>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#phan-hoi-tu-api-gateway","title":"\ud83d\udce4 Ph\u1ea3n h\u1ed3i t\u1eeb API Gateway","text":"<pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"...\",\n    \"source\": \"api_gateway\"\n  }\n}\n</code></pre>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#phan-hoi-loi-tuan-thu-adr-011","title":"\ud83d\udea8 Ph\u1ea3n h\u1ed3i l\u1ed7i (tu\u00e2n th\u1ee7 ADR-011)","text":"<pre><code>{\n  \"data\": null,\n  \"error\": {\n    \"code\": \"FORBIDDEN\",\n    \"message\": \"Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n truy c\u1eadp\"\n  },\n  \"meta\": {\n    \"timestamp\": \"...\",\n    \"trace_id\": \"...\"\n  }\n}\n</code></pre>"},{"location":"interfaces/temp-api-gateway-admin-webapp/#ghi-chu-chung","title":"\u2705 Ghi ch\u00fa chung","text":"<ul> <li>M\u1ecdi request \u0111\u1ec1u ph\u1ea3i \u0111\u01b0\u1ee3c trace b\u1eb1ng <code>trace_id</code> t\u1eeb \u0111\u1ea7u \u0111\u1ebfn cu\u1ed1i chu\u1ed7i d\u1ecbch v\u1ee5 (xem ADR-011)</li> <li>C\u00e1c <code>permission_code</code> \u0111\u01b0\u1ee3c API Gateway evaluate v\u00e0 forward l\u00e0 duy nh\u1ea5t, \u0111\u01b0\u1ee3c backend tin c\u1eady, v\u00e0 l\u00e0 c\u01a1 s\u1edf \u0111\u1ec3 quy\u1ebft \u0111\u1ecbnh cho ph\u00e9p hay t\u1eeb ch\u1ed1i h\u00e0nh \u0111\u1ed9ng t\u01b0\u01a1ng \u1ee9ng.</li> <li>Response structure c\u1ee7a t\u1ea5t c\u1ea3 c\u00e1c service ph\u1ea3i tu\u00e2n theo ADR-012 \u0111\u1ec3 frontend c\u00f3 th\u1ec3 x\u1eed l\u00fd th\u1ed1ng nh\u1ea5t.</li> </ul> <p>\u201cInterface contract r\u00f5 r\u00e0ng l\u00e0 b\u01b0\u1edbc \u0111\u1ea7u ti\u00ean \u0111\u1ec3 m\u1ed7i service c\u00f3 th\u1ec3 ph\u00e1t tri\u1ec3n \u0111\u1ed9c l\u1eadp nh\u01b0ng ph\u1ed1i h\u1ee3p ho\u00e0n h\u1ea3o.\u201d</p>"},{"location":"services/user-service/data-model/","title":"User Service \u2013 Data Model","text":"<p>T\u00e0i li\u1ec7u n\u00e0y m\u00f4 t\u1ea3 chi ti\u1ebft m\u00f4 h\u00ecnh d\u1eef li\u1ec7u trong c\u01a1 s\u1edf d\u1eef li\u1ec7u c\u1ee7a User Service. Bao g\u1ed3m c\u00e1c b\u1ea3ng: <code>users</code>, <code>roles</code>, <code>permissions</code>, <code>user_role</code>, <code>role_permission</code>.</p> <pre><code>erDiagram\n  USERS ||--o{ USER_ROLE : has\n  ROLES ||--o{ USER_ROLE : grants\n  ROLES ||--o{ ROLE_PERMISSION : defines\n  PERMISSIONS ||--o{ ROLE_PERMISSION : belongs\n</code></pre>"},{"location":"services/user-service/data-model/#1-users-thong-tin-nguoi-dung","title":"1. <code>users</code> \u2013 Th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng","text":"T\u00ean c\u1ed9t Ki\u1ec3u d\u1eef li\u1ec7u R\u00e0ng bu\u1ed9c Ghi ch\u00fa id UUID PK \u0110\u1ecbnh danh duy nh\u1ea5t c\u1ee7a ng\u01b0\u1eddi d\u00f9ng email VARCHAR(255) UNIQUE, NOT NULL Email \u0111\u0103ng nh\u1eadp name VARCHAR(255) H\u1ecd t\u00ean ng\u01b0\u1eddi d\u00f9ng status VARCHAR(20) NOT NULL, DEFAULT 'active' Tr\u1ea1ng th\u00e1i: <code>pending</code>, <code>active</code>, <code>inactive</code>, <code>deleted</code> created_at TIMESTAMP DEFAULT now() Th\u1eddi \u0111i\u1ec3m t\u1ea1o updated_at TIMESTAMP DEFAULT now() Th\u1eddi \u0111i\u1ec3m c\u1eadp nh\u1eadt g\u1ea7n nh\u1ea5t <p>\ud83d\udccc M\u1ed9t ng\u01b0\u1eddi d\u00f9ng c\u00f3 th\u1ec3 c\u00f3 nhi\u1ec1u vai tr\u00f2 (quan h\u1ec7 n-n v\u1edbi b\u1ea3ng <code>roles</code>).</p> <p>\ud83d\udccc Tr\u01b0\u1eddng <code>status</code> ph\u1ea3n \u00e1nh v\u00f2ng \u0111\u1eddi t\u00e0i kho\u1ea3n (xem chi ti\u1ebft t\u1ea1i m\u1ee5c \"User Account Lifecycle Flow\" trong <code>design.md</code>).</p>"},{"location":"services/user-service/data-model/#2-roles-vai-tro-nguoi-dung","title":"2. <code>roles</code> \u2013 Vai tr\u00f2 ng\u01b0\u1eddi d\u00f9ng","text":"T\u00ean c\u1ed9t Ki\u1ec3u d\u1eef li\u1ec7u R\u00e0ng bu\u1ed9c Ghi ch\u00fa id UUID PK \u0110\u1ecbnh danh vai tr\u00f2 name VARCHAR(100) UNIQUE, NOT NULL T\u00ean vai tr\u00f2 (v\u00ed d\u1ee5: <code>teacher</code>, <code>admin</code>) description TEXT M\u00f4 t\u1ea3 vai tr\u00f2 created_at TIMESTAMP DEFAULT now() Th\u1eddi \u0111i\u1ec3m t\u1ea1o updated_at TIMESTAMP DEFAULT now() Th\u1eddi \u0111i\u1ec3m c\u1eadp nh\u1eadt g\u1ea7n nh\u1ea5t <p>\ud83d\udccc M\u1ed9t vai tr\u00f2 c\u00f3 th\u1ec3 c\u00f3 nhi\u1ec1u quy\u1ec1n (<code>permissions</code>).</p>"},{"location":"services/user-service/data-model/#3-permissions-cac-quyen-he-thong-tinh","title":"3. <code>permissions</code> \u2013 C\u00e1c quy\u1ec1n h\u1ec7 th\u1ed1ng (t\u0129nh)","text":"T\u00ean c\u1ed9t Ki\u1ec3u d\u1eef li\u1ec7u R\u00e0ng bu\u1ed9c Ghi ch\u00fa id UUID PK \u0110\u1ecbnh danh quy\u1ec1n code VARCHAR(100) UNIQUE, NOT NULL M\u00e3 quy\u1ec1n: <code>VIEW_USER_ALL</code>, <code>CREATE_USER</code>, <code>ASSIGN_PERMISSION_TO_ROLE</code>, v.v. description TEXT M\u00f4 t\u1ea3 quy\u1ec1n condition JSONB \u0110i\u1ec1u ki\u1ec7n RBAC \u0111\u1ed9ng, v\u00ed d\u1ee5: <code>{\"student_ids\": [\"abc\"]}</code> <p>\ud83d\udccc Danh s\u00e1ch quy\u1ec1n \u0111\u01b0\u1ee3c migrate t\u0129nh qua file YAML. Tr\u01b0\u1eddng <code>condition</code> h\u1ed7 tr\u1ee3 \u0111\u00e1nh gi\u00e1 RBAC theo ng\u1eef c\u1ea3nh t\u1ea1i Gateway.</p>"},{"location":"services/user-service/data-model/#4-user_role-mapping-nguoi-dung-vai-tro","title":"4. <code>user_role</code> \u2013 Mapping ng\u01b0\u1eddi d\u00f9ng \u2194 vai tr\u00f2","text":"T\u00ean c\u1ed9t Ki\u1ec3u d\u1eef li\u1ec7u R\u00e0ng bu\u1ed9c Ghi ch\u00fa user_id UUID FK \u2192 users(id), PK (1/2) ID ng\u01b0\u1eddi d\u00f9ng role_id UUID FK \u2192 roles(id), PK (2/2) ID vai tr\u00f2 \u0111\u01b0\u1ee3c g\u00e1n assigned_at TIMESTAMP DEFAULT now() Th\u1eddi \u0111i\u1ec3m g\u00e1n vai tr\u00f2 <p>\ud83d\udccc Composite primary key <code>(user_id, role_id)</code></p>"},{"location":"services/user-service/data-model/#5-role_permission-mapping-vai-tro-quyen","title":"5. <code>role_permission</code> \u2013 Mapping vai tr\u00f2 \u2194 quy\u1ec1n","text":"T\u00ean c\u1ed9t Ki\u1ec3u d\u1eef li\u1ec7u R\u00e0ng bu\u1ed9c Ghi ch\u00fa role_id UUID FK \u2192 roles(id), PK (1/2) ID vai tr\u00f2 permission_id UUID FK \u2192 permissions(id), PK (2/2) ID quy\u1ec1n granted_at TIMESTAMP DEFAULT now() Th\u1eddi \u0111i\u1ec3m c\u1ea5p quy\u1ec1n <p>\ud83d\udccc Composite primary key <code>(role_id, permission_id)</code></p>"},{"location":"services/user-service/data-model/#index-performance-notes","title":"\ud83d\udccc Index &amp; Performance Notes","text":"<ul> <li><code>users.email</code> \u2192 unique index.</li> <li>C\u00e1c b\u1ea3ng mapping (<code>user_role</code>, <code>role_permission</code>) c\u00f3 composite primary key \u2192 t\u1ef1 \u0111\u1ed9ng t\u1ea1o index.</li> <li>C\u00f3 th\u1ec3 b\u1ed5 sung index ri\u00eang cho c\u00e1c truy v\u1ea5n th\u01b0\u1eddng g\u1eb7p nh\u01b0:</li> <li><code>user_id</code> trong <code>user_role</code></li> <li><code>role_id</code> trong <code>role_permission</code></li> </ul>"},{"location":"services/user-service/data-model/#cac-rang-buoc-du-lieu-tinh-toan-ven","title":"\ud83d\udd10 C\u00e1c r\u00e0ng bu\u1ed9c d\u1eef li\u1ec7u &amp; t\u00ednh to\u00e0n v\u1eb9n","text":"<ul> <li>Cascade <code>ON DELETE</code> t\u00f9y logic nghi\u1ec7p v\u1ee5:</li> <li><code>user_role</code>: Xo\u00e1 user \u2192 xo\u00e1 b\u1ea3n ghi g\u00e1n vai tr\u00f2?</li> <li><code>role_permission</code>: Xo\u00e1 role \u2192 c\u00f3 n\u00ean xo\u00e1 mapping quy\u1ec1n?</li> </ul> <p>\u279c Quy\u1ebft \u0111\u1ecbnh n\u00e0y ph\u1ee5 thu\u1ed9c v\u00e0o logic c\u1ee7a h\u1ec7 th\u1ed1ng, c\u00f3 th\u1ec3 \u0111\u1eb7t <code>ON DELETE CASCADE</code> ho\u1eb7c x\u1eed l\u00fd logic \u1edf t\u1ea7ng \u1ee9ng d\u1ee5ng.</p>"},{"location":"services/user-service/data-model/#lien-ket-tai-lieu-lien-quan","title":"\ud83d\udd01 Li\u00ean k\u1ebft t\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Thi\u1ebft k\u1ebf t\u1ed5ng th\u1ec3 User Service (design.md)</li> <li>Interface Contract (interface-contract.md)</li> <li>OpenAPI Spec (openapi.yaml)</li> </ul>"},{"location":"services/user-service/design/","title":"User Service \u2013 Thi\u1ebft k\u1ebf chi ti\u1ebft","text":""},{"location":"services/user-service/design/#1-scope-responsibilities","title":"1. Scope &amp; Responsibilities","text":"<p>M\u00f4 t\u1ea3 ng\u1eafn: User Service l\u00e0 service c\u1ed1t l\u00f5i c\u1ee7a h\u1ec7 th\u1ed1ng dx-vas, ch\u1ecbu tr\u00e1ch nhi\u1ec7m qu\u1ea3n l\u00fd th\u00f4ng tin \u0111\u1ecbnh danh, tr\u1ea1ng th\u00e1i v\u00e0 ph\u00e2n quy\u1ec1n ng\u01b0\u1eddi d\u00f9ng (RBAC). \u0110\u00e2y l\u00e0 trung t\u00e2m ph\u00e2n quy\u1ec1n \u0111\u1ed9ng (condition-based), l\u00e0 n\u01a1i duy nh\u1ea5t ghi nh\u1eadn user-role-permission mapping.</p>"},{"location":"services/user-service/design/#trach-nhiem-chinh","title":"Tr\u00e1ch nhi\u1ec7m ch\u00ednh:","text":"<ul> <li>Qu\u1ea3n l\u00fd d\u1eef li\u1ec7u \u0111\u1ecbnh danh ng\u01b0\u1eddi d\u00f9ng:</li> <li><code>user_id</code>, <code>name</code>, <code>email</code>, <code>status</code>, <code>created_at</code>, <code>updated_at</code></li> <li>Qu\u1ea3n l\u00fd tr\u1ea1ng th\u00e1i t\u00e0i kho\u1ea3n: <code>pending</code>, <code>active</code>, <code>inactive</code>, <code>deleted</code></li> <li>Ph\u00e2n quy\u1ec1n \u0111\u1ed9ng (RBAC):</li> <li>Qu\u1ea3n l\u00fd <code>roles</code>, <code>permissions</code></li> <li>Mapping user \u2192 roles \u2192 permissions (v\u1edbi <code>condition</code>)</li> <li>Cung c\u1ea5p API cho API Gateway ki\u1ec3m tra quy\u1ec1n (qua Redis ho\u1eb7c API fallback)</li> <li>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>rbac_updated</code>, <code>user_status_changed</code> \u0111\u1ec3 \u0111\u1ed3ng b\u1ed9 RBAC cache t\u1ea1i Gateway</li> </ul>"},{"location":"services/user-service/design/#khong-chiu-trach-nhiem","title":"Kh\u00f4ng ch\u1ecbu tr\u00e1ch nhi\u1ec7m:","text":"<ul> <li>\u0110\u0103ng nh\u1eadp / x\u00e1c th\u1ef1c ng\u01b0\u1eddi d\u00f9ng (thu\u1ed9c Auth Service)</li> <li>G\u1eedi th\u00f4ng b\u00e1o (thu\u1ed9c Notification Service)</li> <li>Truy xu\u1ea5t th\u00f4ng tin h\u1ecdc sinh / ph\u1ee5 huynh (thu\u1ed9c SIS)</li> </ul>"},{"location":"services/user-service/design/#tich-hop","title":"T\u00edch h\u1ee3p:","text":"<ul> <li>Redis Cache: \u0111\u1ec3 \u0111\u1ea9y RBAC user snapshot ph\u1ee5c v\u1ee5 API Gateway</li> <li>Pub/Sub: \u0111\u1ec3 publish c\u00e1c s\u1ef1 ki\u1ec7n <code>user_status_changed</code>, <code>rbac_updated</code></li> <li>Cloud SQL (PostgreSQL): l\u01b0u tr\u1eef d\u1eef li\u1ec7u ch\u00ednh</li> </ul>"},{"location":"services/user-service/design/#2-api-specification","title":"2. API Specification","text":"<p>C\u00e1c API c\u1ee7a User Service \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a chi ti\u1ebft trong file OpenAPI t\u1ea1i: \ud83d\udc49 <code>openapi.yaml</code></p>"},{"location":"services/user-service/design/#mo-ta-tong-quan","title":"M\u00f4 t\u1ea3 t\u1ed5ng quan:","text":"Method Path M\u00f4 t\u1ea3 ng\u1eafn GET <code>/users</code> L\u1ea5y danh s\u00e1ch ng\u01b0\u1eddi d\u00f9ng, c\u00f3 ph\u00e2n trang &amp; l\u1ecdc POST <code>/users</code> T\u1ea1o ng\u01b0\u1eddi d\u00f9ng m\u1edbi (ch\u1ec9 d\u00e0nh cho Admin Service) GET <code>/users/{id}</code> L\u1ea5y chi ti\u1ebft ng\u01b0\u1eddi d\u00f9ng PATCH <code>/users/{id}</code> C\u1eadp nh\u1eadt th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng PATCH <code>/users/{id}/status</code> C\u1eadp nh\u1eadt tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng (is_active) GET <code>/users/{id}/permissions</code> L\u1ea5y danh s\u00e1ch quy\u1ec1n c\u1ee7a user (g\u1ed3m condition) GET <code>/users/{id}/permissions/raw</code> L\u1ea5y full RBAC raw (roles, permissions, mapping)"},{"location":"services/user-service/design/#quy-uoc-tra-ve","title":"Quy \u01b0\u1edbc tr\u1ea3 v\u1ec1:","text":"<ul> <li>Tu\u00e2n theo c\u1ea5u tr\u00fac chu\u1ea9n \u0111\u00e3 m\u00f4 t\u1ea3 trong <code>backend-dev-guide.md</code></li> <li>Lu\u00f4n b\u1ecdc k\u1ebft qu\u1ea3 trong <code>DataEnvelope</code>, l\u1ed7i trong <code>ErrorEnvelope</code></li> <li>M\u00e3 l\u1ed7i \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a th\u1ed1ng nh\u1ea5t trong h\u1ec7 th\u1ed1ng (4xx, 5xx)</li> </ul>"},{"location":"services/user-service/design/#bao-mat-phan-quyen","title":"B\u1ea3o m\u1eadt &amp; ph\u00e2n quy\u1ec1n:","text":"<ul> <li>C\u00e1c endpoint y\u00eau c\u1ea7u JWT h\u1ee3p l\u1ec7 t\u1eeb Gateway</li> <li>M\u1ed9t s\u1ed1 endpoint y\u00eau c\u1ea7u <code>X-Permissions</code> t\u01b0\u01a1ng \u1ee9ng (<code>user:read</code>, <code>user:update</code>, <code>rbac:view</code>, v.v.)</li> <li>RBAC \u0111\u01b0\u1ee3c ki\u1ec3m tra b\u1edfi Gateway d\u1ef1a tr\u00ean d\u1eef li\u1ec7u t\u1eeb Redis ho\u1eb7c fallback qua <code>GET /users/{id}/permissions</code></li> </ul> <p>\ud83d\udccc \u0110\u1ec3 xem m\u00f4 t\u1ea3 t\u1ed5ng quan v\u1ec1 c\u00e1c endpoints, m\u1ee5c ti\u00eau v\u00e0 c\u00e1c quy \u01b0\u1edbc giao ti\u1ebfp c\u1ee7a User Service, vui l\u00f2ng tham kh\u1ea3o t\u00e0i li\u1ec7u Interface Contract: \ud83d\udc49 Interface Contract</p> <p>\ud83d\udccc Chi ti\u1ebft schema input/output vui l\u00f2ng xem t\u1ea1i: <code>openapi.yaml</code></p>"},{"location":"services/user-service/design/#3-data-model","title":"3. Data Model","text":"<p>\ud83d\udcc4 Chi ti\u1ebft b\u1ea3ng CSDL \u0111\u01b0\u1ee3c m\u00f4 t\u1ea3 trong <code>data-model.md</code></p>"},{"location":"services/user-service/design/#tong-quan-cac-bang-chinh","title":"T\u1ed5ng quan c\u00e1c b\u1ea3ng ch\u00ednh:","text":"B\u1ea3ng M\u00f4 t\u1ea3 ch\u1ee9c n\u0103ng <code>users</code> L\u01b0u th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng v\u00e0 tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng <code>roles</code> \u0110\u1ecbnh ngh\u0129a c\u00e1c vai tr\u00f2 h\u1ec7 th\u1ed1ng (admin, teacher, ...) <code>permissions</code> \u0110\u1ecbnh ngh\u0129a c\u00e1c quy\u1ec1n chi ti\u1ebft, g\u1ed3m <code>condition</code> JSONB <code>user_role</code> Mapping nhi\u1ec1u-nhi\u1ec1u gi\u1eefa ng\u01b0\u1eddi d\u00f9ng v\u00e0 vai tr\u00f2 <code>role_permission</code> Mapping nhi\u1ec1u-nhi\u1ec1u gi\u1eefa vai tr\u00f2 v\u00e0 quy\u1ec1n"},{"location":"services/user-service/design/#ghi-chu-thiet-ke","title":"Ghi ch\u00fa thi\u1ebft k\u1ebf:","text":"<ul> <li>RBAC \u0111\u1ed9ng: c\u1ed9t <code>condition</code> trong b\u1ea3ng <code>permissions</code> l\u00e0 ki\u1ec3u <code>JSONB</code>, cho ph\u00e9p \u0111\u1ecbnh ngh\u0129a c\u00e1c \u0111i\u1ec1u ki\u1ec7n linh ho\u1ea1t (xem th\u00eam trong <code>rbac-deep-dive.md</code>)</li> <li>T\u00ednh nh\u1ea5t qu\u00e1n: c\u00e1c thay \u0111\u1ed5i li\u00ean quan \u0111\u1ebfn ph\u00e2n quy\u1ec1n s\u1ebd ph\u00e1t s\u1ef1 ki\u1ec7n <code>rbac_updated</code>, c\u00e1c thay \u0111\u1ed5i tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng s\u1ebd ph\u00e1t <code>user_status_changed</code></li> <li>M\u00e3 \u0111\u1ecbnh danh: t\u1ea5t c\u1ea3 b\u1ea3ng \u0111\u1ec1u s\u1eed d\u1ee5ng UUID (<code>uuid4</code>) l\u00e0m kh\u00f3a ch\u00ednh</li> <li>Truy v\u1ebft &amp; log: b\u1ea3ng <code>users</code> c\u00f3 th\u1ec3 m\u1edf r\u1ed9ng th\u00eam c\u00e1c c\u1ed9t <code>created_at</code>, <code>updated_at</code>, <code>last_login_at</code> \u0111\u1ec3 ph\u1ee5c v\u1ee5 m\u1ee5c \u0111\u00edch audit/log</li> </ul> <p>\ud83d\udccc Xem chi ti\u1ebft c\u00e1c c\u1ed9t, ch\u1ec9 m\u1ee5c, r\u00e0ng bu\u1ed9c trong <code>data-model.md</code></p>"},{"location":"services/user-service/design/#4-business-logic-flows-luong-nghiep-vu-chinh","title":"4. Business Logic Flows \u2013 Lu\u1ed3ng nghi\u1ec7p v\u1ee5 ch\u00ednh","text":"<p>User Service kh\u00f4ng ch\u1ec9 l\u01b0u tr\u1eef th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng m\u00e0 c\u00f2n l\u00e0 trung t\u00e2m \u0111i\u1ec1u ph\u1ed1i ph\u00e2n quy\u1ec1n \u0111\u1ed9ng (RBAC) trong to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng. D\u01b0\u1edbi \u0111\u00e2y l\u00e0 c\u00e1c lu\u1ed3ng x\u1eed l\u00fd nghi\u1ec7p v\u1ee5 ch\u00ednh:</p>"},{"location":"services/user-service/design/#41-ang-nhap-thanh-cong-cap-nhat-nguoi-dung-auto-create-neu-chua-ton-tai","title":"4.1. \u0110\u0103ng nh\u1eadp th\u00e0nh c\u00f4ng \u2192 C\u1eadp nh\u1eadt ng\u01b0\u1eddi d\u00f9ng (auto-create n\u1ebfu ch\u01b0a t\u1ed3n t\u1ea1i)","text":"<pre><code>sequenceDiagram\n    participant Gateway\n    participant AuthService\n    participant UserService\n    Gateway-&gt;&gt;AuthService: G\u1ecdi API x\u00e1c th\u1ef1c (OAuth2 ho\u1eb7c Local)\n    AuthService--&gt;&gt;Gateway: Tr\u1ea3 v\u1ec1 JWT ch\u1ee9a `user_id`, `email`, `role_hint`\n    Gateway-&gt;&gt;UserService: `POST /users/sync-from-token` (k\u00e8m info trong token)\n    UserService-&gt;&gt;UserService: Ki\u1ec3m tra `user_id` \u0111\u00e3 t\u1ed3n t\u1ea1i?\n    alt Ch\u01b0a t\u1ed3n t\u1ea1i\n        UserService-&gt;&gt;DB: T\u1ea1o user m\u1edbi, tr\u1ea1ng th\u00e1i `active`\n    else \u0110\u00e3 t\u1ed3n t\u1ea1i\n        UserService-&gt;&gt;DB: C\u1eadp nh\u1eadt `last_login_at`, \u0111\u1ed3ng b\u1ed9 t\u00ean/email n\u1ebfu thay \u0111\u1ed5i\n    end\n    UserService--&gt;&gt;Gateway: OK\n</code></pre>"},{"location":"services/user-service/design/#42-cap-nhat-trang-thai-nguoi-dung-active-inactive","title":"4.2. C\u1eadp nh\u1eadt tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng (Active / Inactive)","text":"<pre><code>sequenceDiagram\n    participant AdminApp\n    participant APIGateway\n    participant UserService\n    participant DB\n\n    AdminApp-&gt;&gt;APIGateway: PATCH /users/{id}/status (active=false)\n    APIGateway-&gt;&gt;UserService: PATCH /users/{id}/status\n    UserService-&gt;&gt;DB: UPDATE users SET is_active = false WHERE id = ?\n    UserService--&gt;&gt;APIGateway: 200 OK\n    APIGateway--&gt;&gt;AdminApp: 200 OK\n    Note over UserService: Emit event `user_status_changed`\n</code></pre>"},{"location":"services/user-service/design/#43-cap-nhat-rbac-cho-nguoi-dung","title":"4.3. C\u1eadp nh\u1eadt RBAC cho ng\u01b0\u1eddi d\u00f9ng","text":"<pre><code>sequenceDiagram\n    participant AdminApp\n    participant APIGateway\n    participant UserService\n    participant DB\n\n    AdminApp-&gt;&gt;APIGateway: PATCH /users/{id}/rbac\n    APIGateway-&gt;&gt;UserService: PATCH /users/{id}/rbac\n    UserService-&gt;&gt;DB: UPDATE user_roles, user_permissions\n    UserService--&gt;&gt;APIGateway: 200 OK\n    APIGateway--&gt;&gt;AdminApp: 200 OK\n    Note over UserService: Emit event `rbac_updated`\n</code></pre>"},{"location":"services/user-service/design/#44-tao-nguoi-dung-moi-tu-he-thong-khac-vi-du-crm-sis","title":"4.4. T\u1ea1o ng\u01b0\u1eddi d\u00f9ng m\u1edbi t\u1eeb h\u1ec7 th\u1ed1ng kh\u00e1c (v\u00ed d\u1ee5: CRM, SIS)","text":"<pre><code>sequenceDiagram\n    participant Adapter\n    participant APIGateway\n    participant UserService\n    participant DB\n\n    Adapter-&gt;&gt;APIGateway: POST /users\n    APIGateway-&gt;&gt;UserService: POST /users\n    UserService-&gt;&gt;DB: INSERT INTO users (...)\n    UserService--&gt;&gt;APIGateway: 201 Created\n    APIGateway--&gt;&gt;Adapter: 201 Created\n    Note over UserService: Emit event `user_created`\n</code></pre>"},{"location":"services/user-service/design/#45-cap-nhat-phan-quyen-ong","title":"4.5. C\u1eadp nh\u1eadt ph\u00e2n quy\u1ec1n \u0111\u1ed9ng","text":"<ul> <li>API: <code>PATCH /users/{id}/rbac</code></li> <li> <p>Logic:</p> </li> <li> <p>C\u1eadp nh\u1eadt danh s\u00e1ch <code>role_id</code> c\u1ee7a user</p> </li> <li>Ghi nh\u1eadn c\u00e1c permission t\u01b0\u01a1ng \u1ee9ng th\u00f4ng qua b\u1ea3ng <code>role_permission</code></li> <li>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>rbac_updated</code> \u0111\u1ec3 API Gateway c\u1eadp nh\u1eadt cache RBAC n\u1ed9i b\u1ed9</li> </ul>"},{"location":"services/user-service/design/#46-ngung-kich-hoat-tai-khoan-nguoi-dung","title":"4.6. Ng\u1eebng k\u00edch ho\u1ea1t t\u00e0i kho\u1ea3n ng\u01b0\u1eddi d\u00f9ng","text":"<ul> <li>API: <code>PATCH /users/{id}/status</code></li> <li> <p>Logic:</p> </li> <li> <p>C\u1eadp nh\u1eadt <code>is_active = false</code></p> </li> <li>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>user_status_changed</code> \u0111\u1ec3 c\u00e1c service li\u00ean quan thu h\u1ed3i token/cache</li> <li>Gateway s\u1ebd t\u1eeb ch\u1ed1i request n\u1ebfu ng\u01b0\u1eddi d\u00f9ng b\u1ecb disable</li> </ul> <p>\ud83d\udd01 C\u00e1c lu\u1ed3ng x\u1eed l\u00fd n\u00e0y \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf \u0111\u1ec3 tu\u00e2n th\u1ee7 m\u00f4 h\u00ecnh event-driven: sau khi c\u1eadp nh\u1eadt tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng ho\u1eb7c ph\u00e2n quy\u1ec1n, User Service s\u1ebd ph\u00e1t s\u1ef1 ki\u1ec7n \u0111\u1ec3 c\u00e1c th\u00e0nh ph\u1ea7n kh\u00e1c nh\u01b0 API Gateway c\u00f3 th\u1ec3 c\u1eadp nh\u1eadt cache t\u01b0\u01a1ng \u1ee9ng.</p> <p>\ud83d\udccc Xem chi ti\u1ebft c\u00e1c permission v\u00e0 schema RBAC trong <code>rbac-deep-dive.md</code></p>"},{"location":"services/user-service/design/#5-events-cac-su-kien-user-service-phat-ra","title":"5. Events \u2013 C\u00e1c s\u1ef1 ki\u1ec7n User Service ph\u00e1t ra","text":"<p>User Service l\u00e0 m\u1ed9t trong c\u00e1c Core Service ph\u00e1t sinh s\u1ef1 ki\u1ec7n quan tr\u1ecdng li\u00ean quan \u0111\u1ebfn tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng v\u00e0 ph\u00e2n quy\u1ec1n. T\u1ea5t c\u1ea3 c\u00e1c s\u1ef1 ki\u1ec7n \u0111\u01b0\u1ee3c ph\u00e1t qua Pub/Sub, v\u00e0 d\u00f9ng \u0111\u1ec3 \u0111\u1ed3ng b\u1ed9 v\u1edbi API Gateway, Notification Service ho\u1eb7c c\u00e1c service kh\u00e1c.</p>"},{"location":"services/user-service/design/#51-user_created","title":"5.1. <code>user_created</code>","text":"<ul> <li>Trigger: Khi m\u1ed9t ng\u01b0\u1eddi d\u00f9ng \u0111\u01b0\u1ee3c kh\u1edfi t\u1ea1o th\u00e0nh c\u00f4ng qua API ho\u1eb7c h\u1ec7 th\u1ed1ng t\u00edch h\u1ee3p (CRM/SIS).</li> <li>Topic: <code>user.events.user_created</code></li> <li>Payload:</li> </ul> <pre><code>{\n  \"user_id\": \"uuid\",\n  \"email\": \"abc@example.com\",\n  \"role_codes\": [\"parent\"],\n  \"created_at\": \"2024-06-01T12:00:00Z\"\n}\n</code></pre> <ul> <li>Consumer: Notification Service (g\u1eedi welcome message), API Gateway (preload RBAC cache), CRM adapter (n\u1ebfu c\u1ea7n sync l\u1ea1i tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng).</li> </ul>"},{"location":"services/user-service/design/#52-user_status_changed","title":"5.2. <code>user_status_changed</code>","text":"<ul> <li>Trigger: Khi tr\u1ea1ng th\u00e1i <code>is_active</code> c\u1ee7a ng\u01b0\u1eddi d\u00f9ng b\u1ecb thay \u0111\u1ed5i.</li> <li>Topic: <code>user.events.user_status_changed</code></li> <li>Payload:</li> </ul> <pre><code>{\n  \"user_id\": \"uuid\",\n  \"is_active\": false,\n  \"updated_by\": \"admin-uuid\",\n  \"timestamp\": \"2024-06-02T10:30:00Z\"\n}\n</code></pre> <ul> <li>Consumer: API Gateway (x\u00f3a RBAC cache n\u1ebfu ng\u01b0\u1eddi d\u00f9ng b\u1ecb inactive), Notification Service (ng\u1eebng g\u1eedi th\u00f4ng b\u00e1o n\u1ebfu ng\u01b0\u1eddi d\u00f9ng b\u1ecb kh\u00f3a).</li> </ul>"},{"location":"services/user-service/design/#53-rbac_updated","title":"5.3. <code>rbac_updated</code>","text":"<ul> <li>Trigger: Khi role ho\u1eb7c permission c\u1ee7a ng\u01b0\u1eddi d\u00f9ng thay \u0111\u1ed5i.</li> <li>Topic: <code>user.events.rbac_updated</code></li> <li>Payload:</li> </ul> <pre><code>{\n  \"user_id\": \"uuid\",\n  \"roles\": [\"teacher\"],\n  \"permissions\": [\"VIEW_SCORE_CLASS\", \"EDIT_TIMETABLE\"],\n  \"updated_by\": \"admin-uuid\",\n  \"timestamp\": \"2024-06-02T11:00:00Z\"\n}\n</code></pre> <ul> <li>Consumer: API Gateway (c\u1eadp nh\u1eadt l\u1ea1i RBAC cache), Admin Webapp (hi\u1ec3n th\u1ecb tr\u1ea1ng th\u00e1i ph\u00e2n quy\u1ec1n m\u1edbi n\u1ebfu \u0111ang m\u1edf session).</li> </ul> <p>\ud83d\udca1 T\u1ea5t c\u1ea3 c\u00e1c s\u1ef1 ki\u1ec7n \u0111\u1ec1u \u0111\u1ea3m b\u1ea3o <code>idempotency</code> b\u1eb1ng c\u00e1ch bao g\u1ed3m <code>user_id</code> v\u00e0 <code>timestamp</code>. C\u00e1c subscriber c\u1ea7n x\u1eed l\u00fd \u0111\u00fang nguy\u00ean t\u1eafc \u0111\u1ea3m b\u1ea3o tr\u1ea1ng th\u00e1i cu\u1ed1i c\u00f9ng lu\u00f4n ch\u00ednh x\u00e1c.</p>"},{"location":"services/user-service/design/#6-authorization-security","title":"6. Authorization &amp; Security","text":"<p>User Service l\u00e0 trung t\u00e2m ph\u00e2n quy\u1ec1n c\u1ee7a to\u00e0n h\u1ec7 th\u1ed1ng, \u0111\u1ea3m nhi\u1ec7m vi\u1ec7c qu\u1ea3n l\u00fd vai tr\u00f2 (role), quy\u1ec1n (permission), v\u00e0 \u0111i\u1ec1u ki\u1ec7n truy c\u1eadp \u0111\u1ed9ng (condition-based RBAC).</p>"},{"location":"services/user-service/design/#61-cac-permission-yeu-cau-khi-goi-api-tu-gateway","title":"6.1. C\u00e1c permission y\u00eau c\u1ea7u khi g\u1ecdi API t\u1eeb Gateway","text":"<p>M\u1ecdi l\u1eddi g\u1ecdi \u0111\u1ebfn User Service \u0111\u1ec1u ph\u1ea3i th\u00f4ng qua API Gateway, n\u01a1i th\u1ef1c hi\u1ec7n x\u00e1c th\u1ef1c JWT v\u00e0 ki\u1ec3m tra RBAC \u0111\u1ed9ng d\u1ef1a tr\u00ean c\u00e1c <code>X-Permissions</code> trong token. User Service s\u1ebd tin t\u01b0\u1edfng ho\u00e0n to\u00e0n c\u00e1c header nh\u01b0 <code>X-User-ID</code>, <code>X-Permissions</code> do Gateway truy\u1ec1n xu\u1ed1ng, v\u00e0 ki\u1ec3m tra b\u1ed5 sung khi c\u1ea7n th\u1ef1c hi\u1ec7n c\u00e1c h\u00e0nh \u0111\u1ed9ng nh\u1ea1y c\u1ea3m (v\u00ed d\u1ee5: t\u1ea1o role, ph\u00e2n quy\u1ec1n).</p> API Permission code y\u00eau c\u1ea7u t\u1ea1i Gateway GET /users <code>VIEW_USER_ALL</code> POST /users <code>CREATE_USER</code> PATCH /users/{id} <code>UPDATE_USER</code> PATCH /users/{id}/status <code>UPDATE_USER_STATUS</code> GET /roles <code>VIEW_ROLE_ALL</code> POST /roles <code>CREATE_ROLE</code> PATCH /roles/{id} <code>UPDATE_ROLE</code> POST /users/{id}/roles <code>ASSIGN_ROLE_TO_USER</code> DELETE /users/{user_id}/roles/{role_id} <code>REVOKE_ROLE_FROM_USER</code> GET /permissions <code>VIEW_PERMISSION_ALL</code> POST /roles/{id}/permissions <code>ASSIGN_PERMISSION_TO_ROLE</code> DELETE /roles/{role_id}/permissions/{permission_id} <code>REVOKE_PERMISSION_FROM_ROLE</code> <p>\ud83d\udccc Ghi ch\u00fa: - C\u00e1c permission \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a t\u0129nh v\u00e0 load v\u00e0o DB th\u00f4ng qua migration. Kh\u00f4ng c\u00f3 API cho ph\u00e9p thao t\u00e1c tr\u1ef1c ti\u1ebfp tr\u00ean b\u1ea3ng <code>permissions</code>. - Vi\u1ec7c ki\u1ec3m tra permission di\u1ec5n ra t\u1ea1i API Gateway theo c\u01a1 ch\u1ebf RBAC \u0111\u1ed9ng \u0111\u00e3 \u0111\u01b0\u1ee3c m\u00f4 t\u1ea3 chi ti\u1ebft trong <code>rbac-deep-dive.md</code>.</p>"},{"location":"services/user-service/design/#62-cach-user-service-anh-gia-phan-quyen","title":"6.2. C\u00e1ch User Service \u0111\u00e1nh gi\u00e1 ph\u00e2n quy\u1ec1n","text":"<ul> <li>User Service kh\u00f4ng \u0111\u00e1nh gi\u00e1 RBAC tr\u1ef1c ti\u1ebfp cho m\u1ed7i request (\u0111\u00e3 do Gateway l\u00e0m).</li> <li>Tuy nhi\u00ean, c\u00e1c endpoint qu\u1ea3n tr\u1ecb (<code>/permissions</code>, <code>/roles</code>) s\u1ebd c\u00f3 decorator n\u1ed9i b\u1ed9 ki\u1ec3m tra <code>X-Permissions</code> header \u0111\u1ec3 gi\u1edbi h\u1ea1n quy\u1ec1n truy c\u1eadp nh\u1ea1y c\u1ea3m.</li> </ul>"},{"location":"services/user-service/design/#63-kiem-soat-thay-oi-rbac","title":"6.3. Ki\u1ec3m so\u00e1t thay \u0111\u1ed5i RBAC","text":"<ul> <li>M\u1ecdi thay \u0111\u1ed5i role/permission ph\u1ea3i \u0111\u01b0\u1ee3c ki\u1ec3m tra RBAC \u1edf Gateway v\u00e0 log l\u1ea1i t\u1ea1i User Service (audit).</li> <li>M\u1ed9t s\u1ed1 h\u00e0nh \u0111\u1ed9ng c\u1ea7n \"RBAC c\u1ea5p cao\", v\u00ed d\u1ee5: ch\u1ec9 <code>rbac:admin</code> m\u1edbi \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt vai tr\u00f2 gi\u00e1o vi\u00ean.</li> </ul>"},{"location":"services/user-service/design/#64-bao-mat-du-lieu","title":"6.4. B\u1ea3o m\u1eadt d\u1eef li\u1ec7u","text":"<ul> <li>Email, password hash, OTP secret \u0111\u1ec1u \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef m\u00e3 h\u00f3a/b\u0103m (tu\u00e2n th\u1ee7 ADR-004).</li> <li>Token kh\u00f4ng \u0111\u01b0\u1ee3c l\u01b0u t\u1ea1i User Service \u2013 do Auth Service qu\u1ea3n l\u00fd.</li> <li>RBAC cache ch\u1ec9 \u0111\u01b0\u1ee3c ph\u00e1t t\u00e1n t\u1edbi Gateway th\u00f4ng qua Pub/Sub <code>rbac_updated</code>.</li> </ul>"},{"location":"services/user-service/design/#65-audit-logging","title":"6.5. Audit Logging","text":"<ul> <li>M\u1ecdi h\u00e0nh \u0111\u1ed9ng ghi thay \u0111\u1ed5i tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng ho\u1eb7c RBAC \u0111\u1ec1u ghi v\u00e0o h\u1ec7 th\u1ed1ng Audit Log.</li> <li>Ghi nh\u1eadn:</li> <li><code>actor_id</code></li> <li><code>target_user_id</code></li> <li><code>action</code></li> <li><code>metadata</code></li> <li><code>timestamp</code></li> </ul>"},{"location":"services/user-service/design/#7-configuration-dependencies","title":"7. Configuration &amp; Dependencies","text":"<p>User Service c\u00f3 m\u1ed9t s\u1ed1 c\u1ea5u h\u00ecnh m\u00f4i tr\u01b0\u1eddng v\u00e0 ph\u1ee5 thu\u1ed9c c\u1ea7n \u0111\u01b0\u1ee3c khai b\u00e1o r\u00f5 \u0111\u1ec3 tri\u1ec3n khai \u0111\u00fang v\u00e0 b\u1ea3o m\u1eadt.</p>"},{"location":"services/user-service/design/#71-bien-moi-truong-env","title":"7.1. Bi\u1ebfn m\u00f4i tr\u01b0\u1eddng (<code>.env</code>)","text":"Bi\u1ebfn \u00dd ngh\u0129a V\u00ed d\u1ee5 <code>ENV</code> M\u00f4i tr\u01b0\u1eddng tri\u1ec3n khai <code>production</code>, <code>staging</code>, <code>local</code> <code>SERVICE_NAME</code> T\u00ean service d\u00f9ng cho logging v\u00e0 header <code>user-service</code> <code>DATABASE_URL</code> K\u1ebft n\u1ed1i \u0111\u1ebfn PostgreSQL <code>postgresql+asyncpg://user:pass@host:5432/db</code> <code>REDIS_URL</code> K\u1ebft n\u1ed1i \u0111\u1ebfn Redis cache (\u0111\u1ec3 load RBAC, status) <code>redis://host:6379/0</code> <code>PUBSUB_TOPIC_RBAC_UPDATED</code> Topic ph\u00e1t s\u1ef1 ki\u1ec7n c\u1eadp nh\u1eadt RBAC <code>rbac-updated</code> <code>PUBSUB_TOPIC_USER_STATUS_CHANGED</code> Topic ph\u00e1t s\u1ef1 ki\u1ec7n \u0111\u1ed5i tr\u1ea1ng th\u00e1i user <code>user-status-changed</code> <code>JWT_PUBLIC_KEY_PATH</code> \u2705 D\u1ef1 ph\u00f2ng \u2013 N\u1ebfu service c\u1ea7n validate m\u1ed9t s\u1ed1 token n\u1ed9i b\u1ed9 (kh\u00f4ng ph\u1ea3i JWT ng\u01b0\u1eddi d\u00f9ng ch\u00ednh), c\u00f3 th\u1ec3 d\u00f9ng key n\u00e0y. Th\u00f4ng th\u01b0\u1eddng, User Service kh\u00f4ng c\u1ea7n t\u1ef1 x\u00e1c th\u1ef1c JWT v\u00ec API Gateway \u0111\u00e3 l\u00e0m vi\u1ec7c \u0111\u00f3. <code>/app/secrets/jwks-public.pem</code> <code>RBAC_CACHE_TTL</code> Th\u1eddi gian TTL cho RBAC cache Redis <code>900</code> (15 ph\u00fat) <code>LOG_LEVEL</code> M\u1ee9c \u0111\u1ed9 log <code>INFO</code>, <code>DEBUG</code> <code>SENTRY_DSN</code> Endpoint g\u1eedi log l\u1ed7i (n\u1ebfu c\u00f3) <code>https://xxx.ingest.sentry.io/abc</code> <p>\ud83d\udccc Ghi ch\u00fa: - C\u00e1c bi\u1ebfn nh\u01b0 <code>JWT_PUBLIC_KEY_PATH</code> c\u00f3 th\u1ec3 kh\u00f4ng c\u1ea7n n\u1ebfu h\u1ec7 th\u1ed1ng s\u1eed d\u1ee5ng ho\u00e0n to\u00e0n x\u00e1c th\u1ef1c trung t\u00e2m t\u1ea1i API Gateway. Tuy nhi\u00ean, v\u1eabn c\u00f3 th\u1ec3 gi\u1eef l\u1ea1i \u0111\u1ec3 h\u1ed7 tr\u1ee3 c\u00e1c c\u01a1 ch\u1ebf n\u1ed9i b\u1ed9 nh\u01b0 x\u00e1c th\u1ef1c mTLS ho\u1eb7c ch\u1eef k\u00fd n\u1ed9i b\u1ed9 gi\u1eefa service.</p>"},{"location":"services/user-service/design/#72-secrets-uoc-inject-tu-secret-manager-hoac-mounted-file","title":"7.2. Secrets (\u0111\u01b0\u1ee3c inject t\u1eeb Secret Manager ho\u1eb7c mounted file)","text":"Secret M\u1ee5c \u0111\u00edch <code>jwt-public-key.pem</code> \u0110\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 x\u00e1c th\u1ef1c JWT header t\u1eeb Gateway <code>pgpassword</code> N\u1ebfu kh\u00f4ng c\u1ea5u h\u00ecnh trong URL \u2013 l\u1ea5y t\u1eeb Secret ri\u00eang"},{"location":"services/user-service/design/#73-phu-thuoc-dich-vu-noi-bo","title":"7.3. Ph\u1ee5 thu\u1ed9c d\u1ecbch v\u1ee5 n\u1ed9i b\u1ed9","text":"Service M\u1ee5c \u0111\u00edch Auth Service (qua Gateway) X\u00e1c th\u1ef1c token, decode metadata Notification Service (qua Gateway) G\u1eedi th\u00f4ng b\u00e1o khi tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi d\u00f9ng thay \u0111\u1ed5i (t\u00f9y ch\u1ecdn) Audit Logging Service (n\u1ebfu t\u00e1ch ri\u00eang) G\u1eedi log audit cho c\u00e1c thao t\u00e1c ph\u00e2n quy\u1ec1n"},{"location":"services/user-service/design/#74-quy-uoc-cau-hinh-noi-bo","title":"7.4. Quy \u01b0\u1edbc c\u1ea5u h\u00ecnh n\u1ed9i b\u1ed9","text":"<ul> <li>To\u00e0n b\u1ed9 config \u0111\u01b0\u1ee3c load qua <code>config.py</code>, ph\u00e2n theo schema chu\u1ea9n.</li> <li>H\u1ed7 tr\u1ee3 c\u1ea5u h\u00ecnh \u0111\u1ed9ng (qua JSON config file mount t\u1eeb GCS ho\u1eb7c th\u00f4ng qua Firestore, n\u1ebfu m\u1edf r\u1ed9ng sau n\u00e0y).</li> </ul>"},{"location":"services/user-service/design/#8-testing-strategy","title":"8. Testing Strategy","text":"<p>User Service l\u00e0 service c\u1ed1t l\u00f5i, n\u00ean c\u1ea7n c\u00f3 coverage test t\u1ed1t \u1edf c\u1ea3 unit test v\u00e0 integration test:</p>"},{"location":"services/user-service/design/#81-unit-test","title":"8.1. Unit Test","text":"<ul> <li>Service methods nh\u01b0 <code>get_user_by_id</code>, <code>update_user_status</code>, <code>update_user_rbac</code> n\u00ean \u0111\u01b0\u1ee3c test \u0111\u1ed9c l\u1eadp.</li> <li>M\u1ecdi logic li\u00ean quan \u0111\u1ebfn RBAC, s\u1ef1 ki\u1ec7n, v\u00e0 transform schema c\u1ea7n test r\u00f5 r\u00e0ng.</li> <li>S\u1eed d\u1ee5ng mock cho DB session, repo v\u00e0 Pub/Sub client.</li> </ul>"},{"location":"services/user-service/design/#82-integration-test","title":"8.2. Integration Test","text":"<ul> <li>Test c\u00e1c API endpoint ch\u00ednh: <code>GET /users</code>, <code>PATCH /users/{id}/status</code>, <code>GET /users/{id}/permissions</code>, v.v.</li> <li>D\u00f9ng DB test ri\u00eang bi\u1ec7t v\u00e0 rollback gi\u1eefa c\u00e1c test.</li> <li>Ki\u1ec3m tra logic RBAC \u1edf c\u1ea3 2 chi\u1ec1u:</li> <li>C\u00f3 quy\u1ec1n \u2192 \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 k\u1ebft qu\u1ea3 \u0111\u00fang.</li> <li>Kh\u00f4ng c\u00f3 quy\u1ec1n \u2192 tr\u1ea3 v\u1ec1 403 ho\u1eb7c error envelope ph\u00f9 h\u1ee3p.</li> </ul>"},{"location":"services/user-service/design/#83-pubsub-testing","title":"8.3. Pub/Sub Testing","text":"<ul> <li>Ki\u1ec3m tra vi\u1ec7c publish s\u1ef1 ki\u1ec7n <code>rbac_updated</code>, <code>user_status_changed</code> sau c\u00e1c h\u00e0nh \u0111\u1ed9ng t\u01b0\u01a1ng \u1ee9ng.</li> <li>Idempotency \u0111\u1ea3m b\u1ea3o qua test double-publish v\u00e0 reprocessing.</li> </ul> <p>\ud83d\udccc Tham kh\u1ea3o chi ti\u1ebft Backend Dev Guide \u2013 M\u1ee5c 10 (Test)</p>"},{"location":"services/user-service/design/#next-steps","title":"Next Steps","text":"<ul> <li>Create <code>data-model.md</code></li> <li>Complete OpenAPI YAML (ensure sync with implemented handlers)</li> <li>Review <code>dx-service-template</code> for conformance</li> <li>Start implementation based on this design</li> </ul>"},{"location":"services/user-service/interface-contract/","title":"\ud83d\udcd8 Interface Contract \u2013 User Service (dx-vas)","text":""},{"location":"services/user-service/interface-contract/#muc-tieu","title":"\ud83d\udded M\u1ee5c ti\u00eau","text":"<p>T\u00e0i li\u1ec7u n\u00e0y \u0111\u1ecbnh ngh\u0129a giao ti\u1ebfp cho User Service, microservice ch\u1ecbu tr\u00e1ch nhi\u1ec7m:</p> <ul> <li>Qu\u1ea3n l\u00fd ng\u01b0\u1eddi d\u00f9ng n\u1ed9i b\u1ed9 (t\u00e0i kho\u1ea3n, tr\u1ea1ng th\u00e1i, ph\u00e2n quy\u1ec1n)</li> <li>Cung c\u1ea5p d\u1eef li\u1ec7u <code>roles</code>, <code>permissions</code>, <code>is_active</code></li> <li>Ghi nh\u1eadn v\u00e0 cung c\u1ea5p audit log cho c\u00e1c thao t\u00e1c qu\u1ea3n tr\u1ecb</li> <li>L\u00e0 backend x\u1eed l\u00fd ch\u00ednh cho c\u00e1c API <code>/users</code>, <code>/roles</code>, <code>/permissions</code>, <code>/audit-logs</code> \u0111\u01b0\u1ee3c g\u1ecdi t\u1eeb Admin Webapp th\u00f4ng qua Gateway</li> </ul>"},{"location":"services/user-service/interface-contract/#endpoint-user-service-phoi-ra-provider-api","title":"\ud83d\udcd9 Endpoint User Service ph\u01a1i ra (Provider API)","text":""},{"location":"services/user-service/interface-contract/#user-role-permission-apis","title":"\ud83d\udc64 User, Role, Permission APIs","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/users</code> L\u1ea5y danh s\u00e1ch ng\u01b0\u1eddi d\u00f9ng <code>page</code>, <code>search</code>, <code>role?</code>, <code>status?</code> <code>List[UserOut]</code> <code>VIEW_USER_ALL</code> POST <code>/users</code> T\u1ea1o m\u1edbi ng\u01b0\u1eddi d\u00f9ng <code>UserCreate</code> <code>UserOut</code> <code>CREATE_USER</code> PATCH <code>/users/{id}</code> C\u1eadp nh\u1eadt th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng <code>UserUpdate</code> <code>UserOut</code> <code>EDIT_USER</code> PATCH <code>/users/{id}/status</code> C\u1eadp nh\u1eadt tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng <code>SetActiveRequest</code> <code>UserOut</code> <code>EDIT_USER_STATUS</code> GET <code>/roles</code> Danh s\u00e1ch role \u2014 <code>List[RoleOut]</code> <code>VIEW_ROLE_ALL</code> POST <code>/roles</code> T\u1ea1o role m\u1edbi <code>RoleCreate</code> <code>RoleOut</code> <code>CREATE_ROLE</code> GET <code>/permissions</code> Danh s\u00e1ch permission \u2014 <code>List[PermissionOut]</code> <code>VIEW_PERMISSION_ALL</code>"},{"location":"services/user-service/interface-contract/#role-permission-va-user-role-apis","title":"\ud83d\udd17 Role-Permission v\u00e0 User-Role APIs","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema Output Schema Permission Code POST <code>/roles/{id}/permissions</code> G\u00e1n permission v\u00e0o role <code>PermissionAssign</code> <code>RoleOut</code> <code>ASSIGN_PERMISSION_TO_ROLE</code> DELETE <code>/roles/{role_id}/permissions/{permission_id}</code> Thu h\u1ed3i permission kh\u1ecfi role \u2014 <code>RoleOut</code> <code>REMOVE_PERMISSION_FROM_ROLE</code> POST <code>/users/{id}/roles</code> G\u00e1n role cho user <code>RoleAssign</code> <code>UserOut</code> <code>ASSIGN_ROLE_TO_USER</code> DELETE <code>/users/{user_id}/roles/{role_id}</code> Thu h\u1ed3i role kh\u1ecfi user \u2014 <code>UserOut</code> <code>REMOVE_ROLE_FROM_USER</code>"},{"location":"services/user-service/interface-contract/#audit-log-api","title":"\ud83d\udcdc Audit Log API","text":"Method Endpoint M\u00f4 t\u1ea3 Input Schema / Query Params Output Schema Permission Code GET <code>/audit-logs</code> L\u1ecbch s\u1eed thao t\u00e1c h\u1ec7 th\u1ed1ng <code>resource: str</code>, <code>user_id?: UUID</code>, <code>date?: ISODateString</code> <code>List[AuditLogOut]</code> <code>VIEW_AUDIT_LOG</code> <p>Endpoint <code>/audit-logs</code> d\u00f9ng \u0111\u1ec3 truy v\u1ebft c\u00e1c h\u00e0nh \u0111\u1ed9ng quan tr\u1ecdng nh\u01b0 t\u1ea1o/s\u1eeda role, permission, user\u2026 cho Admin Webapp.</p>"},{"location":"services/user-service/interface-contract/#xac-thuc-rbac","title":"\ud83d\udd10 X\u00e1c th\u1ef1c &amp; RBAC","text":"<ul> <li>M\u1ecdi request \u0111i qua API Gateway \u2192 JWT b\u1eaft bu\u1ed9c</li> <li>Gateway forward header:</li> <li><code>X-User-ID</code>, <code>X-Role</code>, <code>X-Permissions</code>, <code>Trace-ID</code></li> <li>Backend ch\u1ec9 c\u1ea7n ki\u1ec3m tra permission code c\u00f3 trong <code>X-Permissions</code></li> </ul>"},{"location":"services/user-service/interface-contract/#response-structure","title":"\ud83d\udce6 Response structure","text":"<p>Tu\u00e2n th\u1ee7 ADR-012:</p> <pre><code>{\n  \"data\": {...},\n  \"error\": null,\n  \"meta\": {\n    \"trace_id\": \"...\",\n    \"timestamp\": \"...\",\n    \"source\": \"user_service\"\n  }\n}\n</code></pre>"},{"location":"services/user-service/interface-contract/#loi-ac-thu","title":"\u26a0\ufe0f L\u1ed7i \u0111\u1eb7c th\u00f9","text":"Code M\u00f4 t\u1ea3 <code>USER_NOT_FOUND</code> Kh\u00f4ng t\u00ecm th\u1ea5y ng\u01b0\u1eddi d\u00f9ng t\u01b0\u01a1ng \u1ee9ng <code>ROLE_NOT_FOUND</code> Kh\u00f4ng t\u1ed3n t\u1ea1i role <code>PERMISSION_INVALID</code> Permission kh\u00f4ng h\u1ee3p l\u1ec7 ho\u1eb7c kh\u00f4ng g\u1eafn \u0111\u01b0\u1ee3c <code>EMAIL_ALREADY_USED</code> Email \u0111\u00e3 t\u1ed3n t\u1ea1i trong h\u1ec7 th\u1ed1ng <code>INVALID_ROLE_ASSIGNMENT</code> Kh\u00f4ng th\u1ec3 g\u00e1n role kh\u00f4ng \u0111\u01b0\u1ee3c ph\u00e9p"},{"location":"services/user-service/interface-contract/#ghi-chu","title":"\u2705 Ghi ch\u00fa","text":"<ul> <li>Permissions \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a t\u0129nh theo chu\u1ea9n h\u1ec7 th\u1ed1ng (ADR-007), \u0111\u01b0\u1ee3c load v\u00e0o DB qua migration ban \u0111\u1ea7u, v\u00e0 API ch\u1ec9 cho ph\u00e9p GET /permissions (kh\u00f4ng c\u00f3 create/update/delete tr\u1ef1c ti\u1ebfp qua API).</li> <li>C\u00e1c thay \u0111\u1ed5i g\u00e1n/thu h\u1ed3i role-permission, user-role \u0111\u01b0\u1ee3c ghi nh\u1eadn v\u00e0 audit r\u00f5 r\u00e0ng.</li> <li>Khi tr\u1ea1ng th\u00e1i <code>is_active</code> thay \u0111\u1ed5i:</li> <li>Gateway s\u1ebd nh\u1eadn event t\u1eeb User Service (qua event bus nh\u01b0 Redis Pub/Sub ho\u1eb7c message queue)</li> <li>Gateway c\u1eadp nh\u1eadt cache permission t\u01b0\u01a1ng \u1ee9ng ho\u1eb7c refresh context cho token m\u1edbi \u0111\u01b0\u1ee3c c\u1ea5p</li> <li>Trong tr\u01b0\u1eddng h\u1ee3p token v\u1eabn c\u00f2n hi\u1ec7u l\u1ef1c, backend c\u00f3 th\u1ec3 ki\u1ec3m tra <code>X-Permissions</code> \u0111\u00e3 \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt \u0111\u00fang n\u1ebfu c\u1ea7n b\u1ea3o v\u1ec7 logic s\u00e2u h\u01a1n.</li> <li><code>/audit-logs</code> ph\u1ea3n \u00e1nh to\u00e0n b\u1ed9 thao t\u00e1c c\u00f3 \u1ea3nh h\u01b0\u1edfng t\u1edbi RBAC, ph\u00e2n quy\u1ec1n, t\u1ea1o user\u2026 t\u1eeb Admin Webapp</li> <li>Ng\u01b0\u1eddi d\u00f9ng c\u00f3 th\u1ec3 l\u00e0 gi\u00e1o vi\u00ean, nh\u00e2n vi\u00ean, ph\u1ee5 huynh \u2013 \u0111\u01b0\u1ee3c \u00e1nh x\u1ea1 t\u1eeb SIS/CRM nh\u01b0ng to\u00e0n b\u1ed9 \u0111\u1ecbnh danh, tr\u1ea1ng th\u00e1i <code>is_active</code> v\u00e0 quy\u1ec1n truy c\u1eadp (<code>roles</code>, <code>permissions</code>) \u0111\u01b0\u1ee3c qu\u1ea3n l\u00fd t\u1eadp trung t\u1ea1i User Service.</li> <li>M\u1ecdi thay \u0111\u1ed5i \u0111\u1ec1u \u0111\u01b0\u1ee3c audit theo [ADR-008]</li> </ul>"},{"location":"services/user-service/interface-contract/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>ADR-006: Auth Strategy</li> <li>ADR-007: RBAC Dynamic</li> <li>ADR-012: Response Structure</li> <li>ADR-008: Audit Logging</li> </ul> <p>\u201cUser Service l\u00e0 tr\u00e1i tim qu\u1ea3n l\u00fd \u0111\u1ecbnh danh \u2013 duy tr\u00ec quy\u1ec1n l\u1ef1c, truy xu\u1ea5t v\u00e0 t\u00ednh minh b\u1ea1ch cho to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"tmp/next-step-phat-sinh-va-phuong-an-01/","title":"Next step phat sinh va phuong an 01","text":"<p>Nh\u1eefng vi\u1ec7c c\u1ea7n l\u00e0m ti\u1ebfp theo trong thi\u1ebft k\u1ebf d\u1ef1a tr\u00ean c\u00e1c th\u1ed1ng nh\u1ea5t n\u00e0y:</p> <ol> <li>C\u1eadp nh\u1eadt <code>user-service/data-model.md</code>:<ul> <li>\u0110\u1ecbnh ngh\u0129a schema chi ti\u1ebft cho User Service Master: c\u00e1c b\u1ea3ng <code>users_global</code> (v\u1edbi <code>auth_provider</code>, <code>local_auth_tenant_id</code>), <code>tenants</code>, <code>user_tenant_assignments</code>, <code>global_roles_templates</code>, <code>global_permissions_templates</code>.</li> <li>\u0110\u1ecbnh ngh\u0129a schema chi ti\u1ebft cho Sub User Service (c\u1ea5p tenant): c\u00e1c b\u1ea3ng <code>users_in_tenant</code> (tham chi\u1ebfu <code>user_id_global</code>, c\u00f3 <code>is_active_in_tenant</code>), <code>roles_in_tenant</code>, <code>permissions_in_tenant</code>, v\u00e0 c\u00e1c b\u1ea3ng mapping RBAC c\u1ee5c b\u1ed9. (Ph\u1ea7n n\u00e0y b\u1ea1n \u0111\u00e3 l\u00e0m kh\u00e1 t\u1ed1t r\u1ed3i, ch\u1ec9 c\u1ea7n r\u00e0 so\u00e1t l\u1ea1i cho kh\u1edbp v\u1edbi vai tr\u00f2 c\u1ee7a Master).</li> </ul> </li> <li>C\u1eadp nh\u1eadt <code>user-service/design.md</code>:<ul> <li>L\u00e0m r\u00f5 vai tr\u00f2 v\u00e0 tr\u00e1ch nhi\u1ec7m ri\u00eang bi\u1ec7t c\u1ee7a User Service Master v\u00e0 Sub User Service (tenant-level).</li> <li>V\u1ebd/m\u00f4 t\u1ea3 c\u00e1c lu\u1ed3ng t\u01b0\u01a1ng t\u00e1c m\u1edbi:<ul> <li>Lu\u1ed3ng Superadmin g\u00e1n user v\u00e0o tenant.</li> <li>Lu\u1ed3ng Admin tenant g\u00e1n role cho user trong tenant.</li> <li>Lu\u1ed3ng \u0111\u1ed3ng b\u1ed9 user t\u1eeb Master xu\u1ed1ng Sub User Service qua Pub/Sub.</li> <li>Lu\u1ed3ng User Service Master cung c\u1ea5p d\u1eef li\u1ec7u RBAC cho API Gateway (d\u1ef1a tr\u00ean <code>user_id</code> v\u00e0 <code>tenant_id</code> trong JWT).</li> </ul> </li> </ul> </li> <li>C\u1eadp nh\u1eadt <code>user-service/interface-contract.md</code> v\u00e0 <code>user-service/openapi.yaml</code>:<ul> <li>\u0110\u1ecbnh ngh\u0129a c\u00e1c API cho User Service Master (v\u00ed d\u1ee5: API qu\u1ea3n l\u00fd tenant, API g\u00e1n user v\u00e0o tenant, API qu\u1ea3n l\u00fd template role/permission).</li> <li>R\u00e0 so\u00e1t l\u1ea1i API c\u1ee7a Sub User Service (tenant-level) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o n\u00f3 ch\u1ec9 x\u1eed l\u00fd trong ph\u1ea1m vi tenant c\u1ee7a m\u00ecnh v\u00e0 t\u01b0\u01a1ng t\u00e1c \u0111\u00fang v\u1edbi User Service Master n\u1ebfu c\u1ea7n.</li> </ul> </li> <li>C\u1eadp nh\u1eadt Thi\u1ebft k\u1ebf cho Auth Service (Master v\u00e0 Sub):<ul> <li>T\u1ea1o <code>design.md</code>, <code>interface-contract.md</code>, <code>openapi.yaml</code>, <code>data-model.md</code> (n\u1ebfu Sub Auth Service c\u00f3 state) cho c\u1ea3 Auth Service Master v\u00e0 Sub Auth Service (ho\u1eb7c m\u1ed9t t\u00e0i li\u1ec7u Auth Service chung m\u00f4 t\u1ea3 c\u1ea3 hai vai tr\u00f2).</li> <li>\u0110\u1eb7c t\u1ea3 r\u00f5 lu\u1ed3ng c\u1ea5p ph\u00e1t JWT \"\u0111\u1ea7y \u0111\u1ee7\".</li> </ul> </li> <li>C\u1eadp nh\u1eadt <code>system-diagrams.md</code>:<ul> <li>S\u01a1 \u0111\u1ed3 t\u1ed5ng quan c\u1ea7n ph\u1ea3n \u00e1nh r\u00f5 s\u1ef1 t\u1ed3n t\u1ea1i c\u1ee7a User Service Master v\u00e0 c\u00e1c Sub User Service (ho\u1eb7c c\u00e1ch c\u00e1c stack c\u1ee7a tenant t\u01b0\u01a1ng t\u00e1c v\u1edbi Master).</li> <li>C\u00f3 th\u1ec3 c\u1ea7n th\u00eam s\u01a1 \u0111\u1ed3 ki\u1ebfn tr\u00fac multi-tenant chi ti\u1ebft h\u01a1n.</li> </ul> </li> <li>C\u1eadp nh\u1eadt <code>README.md</code> (Ki\u1ebfn tr\u00fac t\u1ed5ng th\u1ec3) v\u00e0 <code>rbac-deep-dive.md</code>:<ul> <li>\u0110\u1ea3m b\u1ea3o c\u00e1c t\u00e0i li\u1ec7u n\u00e0y ph\u1ea3n \u00e1nh \u0111\u00fang m\u00f4 h\u00ecnh qu\u1ea3n l\u00fd RBAC t\u1eadp trung k\u1ebft h\u1ee3p v\u1edbi t\u00f9y ch\u1ec9nh \u1edf c\u1ea5p tenant.</li> </ul> </li> </ol> <p>\u0110\u00e2y l\u00e0 m\u1ed9t kh\u1ed1i l\u01b0\u1ee3ng c\u00f4ng vi\u1ec7c c\u1eadp nh\u1eadt \u0111\u00e1ng k\u1ec3, nh\u01b0ng n\u00f3 s\u1ebd \u0111\u1ea3m b\u1ea3o r\u1eb1ng to\u00e0n b\u1ed9 thi\u1ebft k\u1ebf c\u1ee7a ch\u00fang ta nh\u1ea5t qu\u00e1n v\u00e0 s\u1eb5n s\u00e0ng cho vi\u1ec7c tri\u1ec3n khai m\u1ed9t h\u1ec7 th\u1ed1ng multi-tenant m\u1ea1nh m\u1ebd v\u00e0 linh ho\u1ea1t.</p>"},{"location":"tmp/next-steps/","title":"Next steps","text":"<p>C\u00e1c b\u01b0\u1edbc \u0111\u1ec3 thi\u1ebft k\u1ebf chi ti\u1ebft c\u00e1c service m\u1ed9t c\u00e1ch hi\u1ec7u qu\u1ea3</p> <ol> <li> <p>X\u00e1c \u0111\u1ecbnh v\u00e0 \u01afu ti\u00ean Danh s\u00e1ch Microservices C\u1ea7n Thi\u1ebft K\u1ebf Chi Ti\u1ebft:</p> <ul> <li>D\u1ef1a tr\u00ean \"S\u01a1 \u0111\u1ed3 t\u1ed5ng quan h\u1ec7 th\u1ed1ng\" trong <code>system-diagrams.md</code>, ch\u00fang ta \u0111\u00e3 c\u00f3 danh s\u00e1ch c\u00e1c Core Services (Auth, User, Notification) v\u00e0 Business Adapters (CRM, SIS, LMS).</li> <li>H\u00e0nh \u0111\u1ed9ng: C\u00f9ng nhau x\u00e1c \u0111\u1ecbnh th\u1ee9 t\u1ef1 \u01b0u ti\u00ean \u0111\u1ec3 thi\u1ebft k\u1ebf chi ti\u1ebft t\u1eebng service. C\u00f3 th\u1ec3 b\u1eaft \u0111\u1ea7u v\u1edbi c\u00e1c service n\u1ec1n t\u1ea3ng v\u00e0 c\u00f3 \u1ea3nh h\u01b0\u1edfng r\u1ed9ng nh\u1ea5t (v\u00ed d\u1ee5: User Service, Auth Service), sau \u0111\u00f3 \u0111\u1ebfn c\u00e1c service ph\u1ee5c v\u1ee5 lu\u1ed3ng nghi\u1ec7p v\u1ee5 ch\u00ednh.</li> </ul> </li> <li> <p>V\u1edbi M\u1ed7i Service \u0110\u01b0\u1ee3c \u01afu ti\u00ean, Th\u1ef1c Hi\u1ec7n C\u00e1c B\u01b0\u1edbc Thi\u1ebft K\u1ebf Chi Ti\u1ebft Sau:</p> <ul> <li>a. \u0110\u1ecbnh Ngh\u0129a R\u00f5 Ph\u1ea1m Vi v\u00e0 Tr\u00e1ch Nhi\u1ec7m (Scope &amp; Responsibilities):<ul> <li>M\u1eb7c d\u00f9 \u0111\u00e3 c\u00f3 \u1edf m\u1ee9c t\u1ed5ng quan, gi\u1edd l\u00e0 l\u00fac \u0111\u00e0o s\u00e2u: Service n\u00e0y ch\u1ecbu tr\u00e1ch nhi\u1ec7m ch\u00ednh x\u00e1c cho nh\u1eefng nghi\u1ec7p v\u1ee5 n\u00e0o? N\u00f3 qu\u1ea3n l\u00fd nh\u1eefng th\u1ef1c th\u1ec3 d\u1eef li\u1ec7u n\u00e0o? Gi\u1edbi h\u1ea1n c\u1ee7a n\u00f3 l\u00e0 g\u00ec?</li> <li>T\u00e0i li\u1ec7u tham kh\u1ea3o: <code>README.md</code> (ph\u1ea7n m\u00f4 t\u1ea3 service), <code>system-diagrams.md</code> (vai tr\u00f2 trong c\u00e1c lu\u1ed3ng).</li> </ul> </li> <li>b. Thi\u1ebft K\u1ebf API Chi Ti\u1ebft (Interface Contract):<ul> <li>\u0110\u1ecbnh ngh\u0129a t\u1ea5t c\u1ea3 c\u00e1c API endpoint m\u00e0 service n\u00e0y s\u1ebd cung c\u1ea5p (public API qua Gateway) ho\u1eb7c ti\u00eau th\u1ee5 (n\u1ebfu g\u1ecdi service kh\u00e1c).</li> <li>S\u1eed d\u1ee5ng OpenAPI (Swagger) \u0111\u1ec3 \u0111\u1eb7c t\u1ea3 chi ti\u1ebft: path, HTTP methods, request parameters (path, query, header, body), response schemas (success, error), v\u00e0 c\u00e1c m\u00e3 l\u1ed7i c\u00f3 th\u1ec3 c\u00f3.</li> <li>\u00c1p d\u1ee5ng c\u00e1c quy \u01b0\u1edbc \u0111\u00e3 \u0111\u1ecbnh ngh\u0129a trong <code>backend-dev-guide.md</code> (M\u1ee5c 6: API design).</li> <li>H\u00e0nh \u0111\u1ed9ng: T\u1ea1o/c\u1eadp nh\u1eadt file OpenAPI spec cho service \u0111\u00f3 trong th\u01b0 m\u1ee5c <code>docs/interfaces/</code>.</li> </ul> </li> <li>c. Thi\u1ebft K\u1ebf M\u00f4 H\u00ecnh D\u1eef Li\u1ec7u Chi Ti\u1ebft (Detailed Data Model):<ul> <li>X\u00e1c \u0111\u1ecbnh c\u00e1c b\u1ea3ng CSDL c\u1ea7n thi\u1ebft cho service (n\u1ebfu c\u00f3 stateful).</li> <li>Thi\u1ebft k\u1ebf schema chi ti\u1ebft cho t\u1eebng b\u1ea3ng: t\u00ean c\u1ed9t, ki\u1ec3u d\u1eef li\u1ec7u, r\u00e0ng bu\u1ed9c (PK, FK, UNIQUE, NOT NULL, CHECK), v\u00e0 c\u00e1c ch\u1ec9 m\u1ee5c (indexes).</li> <li>C\u00e2n nh\u1eafc vi\u1ec7c s\u1eed d\u1ee5ng PostgreSQL hay MySQL d\u1ef1a tr\u00ean quy\u1ebft \u0111\u1ecbnh c\u1ee7a ch\u00fang ta (Core Services d\u00f9ng PostgreSQL, Adapters d\u00f9ng MySQL).</li> <li>H\u00e0nh \u0111\u1ed9ng: C\u00f3 th\u1ec3 t\u1ea1o m\u1ed9t file Markdown ri\u00eang cho data model c\u1ee7a service \u0111\u00f3 (v\u00ed d\u1ee5: <code>docs/services/user-service/data-model.md</code>) ho\u1eb7c b\u1ed5 sung v\u00e0o m\u1ed9t ph\u1ea7n thi\u1ebft k\u1ebf chi ti\u1ebft c\u1ee7a service.</li> </ul> </li> <li>d. \u0110\u1eb7c T\u1ea3 C\u00e1c Lu\u1ed3ng X\u1eed L\u00fd Nghi\u1ec7p V\u1ee5 Ch\u00ednh (Detailed Business Logic Flows):<ul> <li>V\u1edbi c\u00e1c use case ph\u1ee9c t\u1ea1p b\u00ean trong service, v\u1ebd s\u01a1 \u0111\u1ed3 lu\u1ed3ng chi ti\u1ebft h\u01a1n (activity diagram, sequence diagram) \u0111\u1ec3 m\u00f4 t\u1ea3 c\u00e1c b\u01b0\u1edbc x\u1eed l\u00fd, c\u00e1c quy\u1ebft \u0111\u1ecbnh r\u1ebd nh\u00e1nh, v\u00e0 t\u01b0\u01a1ng t\u00e1c v\u1edbi repository ho\u1eb7c c\u00e1c service kh\u00e1c (n\u1ebfu c\u00f3, qua Gateway).</li> <li>Tham kh\u1ea3o c\u00e1c quy \u01b0\u1edbc trong <code>backend-dev-guide.md</code> (M\u1ee5c 5: X\u1eed l\u00fd nghi\u1ec7p v\u1ee5 &amp; usecase m\u1eabu).</li> </ul> </li> <li>e. X\u00e1c \u0110\u1ecbnh C\u00e1c S\u1ef1 Ki\u1ec7n (Events) m\u00e0 Service S\u1ebd Ph\u00e1t Ra ho\u1eb7c L\u1eafng Nghe:<ul> <li>N\u1ebfu service tham gia v\u00e0o c\u00e1c lu\u1ed3ng event-driven (qua Pub/Sub).</li> <li>\u0110\u1ecbnh ngh\u0129a r\u00f5 t\u00ean topic, c\u1ea5u tr\u00fac payload c\u1ee7a s\u1ef1 ki\u1ec7n.</li> <li>Xem x\u00e9t c\u00e1c nguy\u00ean t\u1eafc idempotency \u0111\u00e3 c\u00f3 trong <code>backend-dev-guide.md</code> (M\u1ee5c 9).</li> </ul> </li> <li>f. C\u00e2n Nh\u1eafc v\u1ec1 B\u1ea3o M\u1eadt v\u00e0 Ph\u00e2n Quy\u1ec1n \u1edf C\u1ea5p Service:<ul> <li>Service n\u00e0y c\u1ea7n nh\u1eefng permission n\u00e0o \u0111\u1ec3 ho\u1ea1t \u0111\u1ed9ng? (\u0111\u1ec3 khai b\u00e1o trong file <code>permissions.yaml</code> m\u00e0 <code>backend-dev-guide.md</code> c\u00f3 \u0111\u1ec1 c\u1eadp).</li> <li>C\u00e1ch service ki\u1ec3m tra c\u00e1c header ph\u00e2n quy\u1ec1n (<code>X-Permissions</code>) t\u1eeb Gateway nh\u01b0 th\u1ebf n\u00e0o?</li> </ul> </li> <li>g. C\u00e2n Nh\u1eafc v\u1ec1 C\u1ea5u H\u00ecnh v\u00e0 Dependencies:<ul> <li>Li\u1ec7t k\u00ea c\u00e1c bi\u1ebfn m\u00f4i tr\u01b0\u1eddng, secrets m\u00e0 service c\u1ea7n.</li> <li>C\u00e1c service kh\u00e1c m\u00e0 n\u00f3 ph\u1ee5 thu\u1ed9c v\u00e0o.</li> </ul> </li> <li>h. Chi\u1ebfn L\u01b0\u1ee3c Testing C\u1ee5 Th\u1ec3 cho Service:<ul> <li>X\u00e1c \u0111\u1ecbnh c\u00e1c k\u1ecbch b\u1ea3n unit test v\u00e0 integration test quan tr\u1ecdng d\u1ef1a tr\u00ean nghi\u1ec7p v\u1ee5 c\u1ee7a service.</li> <li>Tham kh\u1ea3o <code>backend-dev-guide.md</code> (M\u1ee5c 10).</li> </ul> </li> </ul> </li> <li> <p>T\u1ea1o \"Service Design Document\" (SDD) cho m\u1ed7i Microservice:</p> <ul> <li>H\u00e0nh \u0111\u1ed9ng: V\u1edbi m\u1ed7i service, t\u1ea1o m\u1ed9t t\u00e0i li\u1ec7u thi\u1ebft k\u1ebf chi ti\u1ebft (c\u00f3 th\u1ec3 l\u00e0 m\u1ed9t file Markdown trong th\u01b0 m\u1ee5c <code>docs/services/&lt;service-name&gt;/design.md</code>) bao g\u1ed3m t\u1ea5t c\u1ea3 c\u00e1c \u0111i\u1ec3m t\u1eeb 2a \u0111\u1ebfn 2h \u1edf tr\u00ean.</li> <li>T\u00e0i li\u1ec7u n\u00e0y s\u1ebd l\u00e0 \"kim ch\u1ec9 nam\" cho \u0111\u1ed9i ng\u0169 ph\u00e1t tri\u1ec3n khi implement service \u0111\u00f3.</li> </ul> </li> <li> <p>Review Thi\u1ebft K\u1ebf Chi Ti\u1ebft:</p> <ul> <li>Sau khi b\u1ea3n nh\u00e1p SDD cho m\u1ed9t service \u0111\u01b0\u1ee3c ho\u00e0n th\u00e0nh, t\u1ed5 ch\u1ee9c review v\u1edbi c\u00e1c th\u00e0nh vi\u00ean ch\u1ee7 ch\u1ed1t (Ki\u1ebfn tr\u00fac s\u01b0, Tech Lead, c\u00e1c developer li\u00ean quan) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o thi\u1ebft k\u1ebf t\u1ed1i \u01b0u, nh\u1ea5t qu\u00e1n v\u00e0 \u0111\u00e1p \u1ee9ng y\u00eau c\u1ea7u.</li> </ul> </li> <li> <p>Chu\u1ea9n B\u1ecb Service Template (N\u1ebfu ch\u01b0a c\u00f3 ho\u1eb7c c\u1ea7n c\u1eadp nh\u1eadt):</p> <ul> <li>D\u1ef1a tr\u00ean <code>backend-dev-guide.md</code> v\u00e0 c\u00e1c quy\u1ebft \u0111\u1ecbnh thi\u1ebft k\u1ebf, \u0111\u1ea3m b\u1ea3o r\u1eb1ng <code>dx-service-template</code> (m\u00e0 b\u1ea1n \u0111\u00e3 \u0111\u1ec1 c\u1eadp trong Dev Guide) \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt v\u00e0 s\u1eb5n s\u00e0ng \u0111\u1ec3 c\u00e1c nh\u00e0 ph\u00e1t tri\u1ec3n clone ra khi b\u1eaft \u0111\u1ea7u m\u1ed9t service m\u1edbi. \u0110i\u1ec1u n\u00e0y gi\u00fap t\u0103ng t\u1ed1c \u0111\u1ed9 v\u00e0 \u0111\u1ea3m b\u1ea3o t\u00ednh nh\u1ea5t qu\u00e1n ngay t\u1eeb \u0111\u1ea7u.</li> </ul> </li> </ol>"},{"location":"tmp/phat-sinh-va-phuong-an-01/","title":"Phat sinh va phuong an 01","text":""},{"location":"tmp/phat-sinh-va-phuong-an-01/#tong-hop-van-e-phat-sinh-va-huong-giai-quyet-a-thong-nhat-multi-tenancy","title":"T\u1ed5ng H\u1ee3p V\u1ea5n \u0111\u1ec1 Ph\u00e1t Sinh v\u00e0 H\u01b0\u1edbng Gi\u1ea3i Quy\u1ebft \u0110\u00e3 Th\u1ed1ng Nh\u1ea5t (Multi-Tenancy)","text":""},{"location":"tmp/phat-sinh-va-phuong-an-01/#1-yeu-cau-cot-loi-va-boi-canh-moi","title":"1. Y\u00eau c\u1ea7u C\u1ed1t L\u00f5i v\u00e0 B\u1ed1i C\u1ea3nh M\u1edbi:","text":"<ul> <li>Multi-Tenancy: H\u1ed7 tr\u1ee3 nhi\u1ec1u tr\u01b0\u1eddng th\u00e0nh vi\u00ean.</li> <li>C\u00e1ch Ly Nghi\u00eam Ng\u1eb7t: M\u1ed7i tr\u01b0\u1eddng c\u00f3 d\u1eef li\u1ec7u, quy\u1ec1n, c\u1ea5u h\u00ecnh, v\u00e0 Frontend App ri\u00eang.</li> <li>H\u1ec7 th\u1ed1ng Legacy Ri\u00eang L\u1ebb: M\u1ed7i tr\u01b0\u1eddng c\u00f3 instance CRM/SIS/LMS ri\u00eang.</li> <li>Qu\u1ea3n L\u00fd User Linh Ho\u1ea1t: Nh\u00e2n vi\u00ean c\u00f3 th\u1ec3 c\u00f3 nhi\u1ec1u vai tr\u00f2 \u1edf nhi\u1ec1u tr\u01b0\u1eddng. C\u1ea7n c\u01a1 ch\u1ebf xin c\u1ea5p quy\u1ec1n.</li> <li>Qu\u1ea3n Tr\u1ecb T\u1eadp Trung: Superadmin qu\u1ea3n l\u00fd to\u00e0n h\u1ec7 th\u1ed1ng (user, tenant, role, permission), c\u00f3 kh\u1ea3 n\u0103ng t\u1ed5ng h\u1ee3p b\u00e1o c\u00e1o.</li> <li>Google Workspace Chung: D\u00f9ng chung cho nh\u00e2n vi\u00ean/gi\u00e1o vi\u00ean/h\u1ecdc sinh (\u1edf c\u00e1c tr\u01b0\u1eddng d\u00f9ng Workspace).</li> <li>H\u1ecdc sinh d\u00f9ng Local/OTP Login: \u1ede m\u1ed9t s\u1ed1 tr\u01b0\u1eddng (v\u00ed d\u1ee5: trung t\u00e2m ti\u1ebfng Anh, m\u1ea7m non), h\u1ecdc sinh s\u1ebd d\u00f9ng t\u00e0i kho\u1ea3n Local/OTP.</li> <li>\u0110\u1ecbnh h\u01b0\u1edbng T\u1eadp Trung D\u1eef Li\u1ec7u: Cho RPA v\u00e0 AI trong t\u01b0\u01a1ng lai.</li> </ul>"},{"location":"tmp/phat-sinh-va-phuong-an-01/#2-giai-phap-kien-truc-a-thong-nhat","title":"2. Gi\u1ea3i Ph\u00e1p Ki\u1ebfn Tr\u00fac \u0110\u00e3 Th\u1ed1ng Nh\u1ea5t:","text":"<ul> <li> <p>M\u00f4 H\u00ecnh Tri\u1ec3n Khai \"Separate Stacks per Tenant\" (Deployment C\u00e1ch 1):</p> <ul> <li>Gi\u1ea3i ph\u00e1p: M\u1ed7i tr\u01b0\u1eddng th\u00e0nh vi\u00ean (tenant) s\u1ebd c\u00f3 m\u1ed9t b\u1ed9 Frontend Apps (PWA, SPA) ri\u00eang, Business Adapters (CRM, SIS, LMS) ri\u00eang, v\u00e0 Sub Auth Service ri\u00eang (\u0111\u1ec3 qu\u1ea3n l\u00fd Local/OTP login c\u1ee7a tenant \u0111\u00f3).</li> <li>L\u00fd do: \u0110\u1ea3m b\u1ea3o c\u00e1ch ly ho\u00e0n to\u00e0n d\u1eef li\u1ec7u, quy\u1ec1n, c\u1ea5u h\u00ecnh, giao di\u1ec7n v\u00e0 x\u1eed l\u00fd x\u00e1c th\u1ef1c local cho t\u1eebng tr\u01b0\u1eddng. Ph\u00f9 h\u1ee3p v\u1edbi vi\u1ec7c m\u1ed7i tr\u01b0\u1eddng c\u00f3 instance CRM/SIS/LMS ri\u00eang.</li> </ul> </li> <li> <p>API Gateway Chung (Shared API Gateway):</p> <ul> <li>Gi\u1ea3i ph\u00e1p: V\u1eabn s\u1eed d\u1ee5ng m\u1ed9t API Gateway chung.</li> <li>X\u00e1c \u0111\u1ecbnh Tenant: API Gateway s\u1ebd d\u1ef1a v\u00e0o <code>tenant_id</code> trong JWT (sau khi ng\u01b0\u1eddi d\u00f9ng \u0111\u00e3 ch\u1ecdn tr\u01b0\u1eddng/\u0111\u01b0\u1ee3c x\u00e1c th\u1ef1c cho m\u1ed9t tr\u01b0\u1eddng c\u1ee5 th\u1ec3) \u0111\u1ec3 \u0111\u1ecbnh tuy\u1ebfn request \u0111\u1ebfn backend stack c\u1ee7a tenant t\u01b0\u01a1ng \u1ee9ng, ho\u1eb7c \u0111\u1ebfn c\u00e1c API c\u1ee7a Tenant Master.</li> <li>L\u01b0u \u00fd: Domain c\u1ee7a Frontend App ri\u00eang c\u1ee7a t\u1eebng tr\u01b0\u1eddng c\u00f3 th\u1ec3 gi\u00fap API Gateway trong vi\u1ec7c x\u00e1c \u0111\u1ecbnh ng\u1eef c\u1ea3nh ban \u0111\u1ea7u c\u1ee7a request.</li> </ul> </li> <li> <p>User Service Master Qu\u1ea3n l\u00fd T\u1ea5t C\u1ea3 \u0110\u1ecbnh Danh User:</p> <ul> <li>Gi\u1ea3i ph\u00e1p: S\u1ebd c\u00f3 m\u1ed9t User Service \"Master\" duy nh\u1ea5t, l\u00e0 n\u01a1i qu\u1ea3n l\u00fd t\u1eadp trung v\u00e0 l\u00e0 ngu\u1ed3n ch\u00e2n l\u00fd cho t\u1ea5t c\u1ea3 \u0111\u1ecbnh danh ng\u01b0\u1eddi d\u00f9ng tr\u00ean to\u00e0n h\u1ec7 th\u1ed1ng dx_vas.<ul> <li>Bao g\u1ed3m c\u1ea3 user Google Workspace v\u00e0 user Local/OTP t\u1eeb c\u00e1c tenant.</li> <li>M\u1ed7i user s\u1ebd c\u00f3 m\u1ed9t <code>user_id</code> to\u00e0n c\u1ee5c duy nh\u1ea5t.</li> <li>B\u1ea3ng <code>users</code> trong User Service Master s\u1ebd c\u00f3 c\u00e1c tr\u01b0\u1eddng nh\u01b0 <code>auth_provider</code> ('google', 'local_otp') v\u00e0 <code>local_auth_tenant_id</code> (\u0111\u1ec3 bi\u1ebft user local \u0111\u00f3 thu\u1ed9c tenant n\u00e0o).</li> </ul> </li> <li>User Service Master c\u0169ng qu\u1ea3n l\u00fd danh s\u00e1ch c\u00e1c <code>tenants</code>, m\u1ed1i quan h\u1ec7 <code>user_tenant_assignments</code> (user n\u00e0o \u0111\u01b0\u1ee3c g\u00e1n/thu\u1ed9c v\u1ec1 tenant n\u00e0o), v\u00e0 c\u00e1c <code>global_roles_templates</code>, <code>global_permissions_templates</code>.</li> <li>Sub User Service (c\u1ea5p tenant) s\u1ebd qu\u1ea3n l\u00fd RBAC c\u1ee5 th\u1ec3 cho tenant \u0111\u00f3:<ul> <li>Qu\u1ea3n l\u00fd <code>roles_in_tenant</code>, <code>permissions_in_tenant</code> (c\u00f3 th\u1ec3 clone/t\u00f9y ch\u1ec9nh t\u1eeb template c\u1ee7a Master ho\u1eb7c t\u1ea1o m\u1edbi).</li> <li>Qu\u1ea3n l\u00fd c\u00e1c b\u1ea3ng mapping RBAC c\u1ee5c b\u1ed9 (<code>user_role_in_tenant</code>, <code>role_permission_in_tenant</code>).</li> <li>L\u01b0u tr\u1eef tham chi\u1ebfu \u0111\u1ebfn <code>user_id_global</code> v\u00e0 c\u1edd <code>is_active_in_tenant</code>.</li> </ul> </li> </ul> </li> <li> <p>\u0110\u1ed3ng b\u1ed9/Tham chi\u1ebfu User t\u1eeb Master xu\u1ed1ng Sub User Service:</p> <ul> <li>Gi\u1ea3i ph\u00e1p (Option B): User Service Master s\u1ebd ph\u00e1t s\u1ef1 ki\u1ec7n qua Pub/Sub (v\u00ed d\u1ee5: <code>user_assigned_to_tenant</code> ho\u1eb7c <code>user_info_updated_for_tenant</code>) khi Superadmin g\u00e1n user v\u00e0o tenant ho\u1eb7c khi c\u00f3 c\u1eadp nh\u1eadt th\u00f4ng tin user to\u00e0n c\u1ee5c.</li> <li>Sub User Service c\u1ee7a tenant li\u00ean quan s\u1ebd l\u1eafng nghe v\u00e0 t\u1ea1o/c\u1eadp nh\u1eadt b\u1ea3n ghi \"tham chi\u1ebfu\" ho\u1eb7c \"shadow user\" c\u1ee5c b\u1ed9.</li> </ul> </li> <li> <p>Tr\u1ea1ng th\u00e1i <code>is_active</code> c\u1ee7a User:</p> <ul> <li>Gi\u1ea3i ph\u00e1p: User Service Master qu\u1ea3n l\u00fd tr\u1ea1ng th\u00e1i <code>is_active</code> to\u00e0n c\u1ee5c. M\u1ed7i Sub User Service s\u1ebd c\u00f3 th\u00eam c\u1edd <code>is_active_in_tenant</code> ri\u00eang \u0111\u1ec3 qu\u1ea3n l\u00fd tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng c\u1ee7a user trong ph\u1ea1m vi tenant \u0111\u00f3.</li> </ul> </li> <li> <p>Auth Service v\u00e0 Lu\u1ed3ng C\u1ea5p Ph\u00e1t JWT \"\u0110\u1ea7y \u0110\u1ee7\":</p> <ul> <li>Auth Service Master: X\u1eed l\u00fd ch\u00ednh lu\u1ed3ng Google OAuth2. Sau khi Google x\u00e1c th\u1ef1c, v\u00e0 sau khi ng\u01b0\u1eddi d\u00f9ng ch\u1ecdn tenant (n\u1ebfu c\u1ea7n), Auth Service Master s\u1ebd ph\u1ed1i h\u1ee3p v\u1edbi User Service Master \u0111\u1ec3 l\u1ea5y th\u00f4ng tin (user c\u00f3 thu\u1ed9c tenant \u0111\u00f3 kh\u00f4ng) v\u00e0 c\u00f3 th\u1ec3 l\u00e0 c\u1ea3 v\u1edbi Sub User Service c\u1ee7a tenant (\u0111\u1ec3 l\u1ea5y role c\u1ee5 th\u1ec3 trong tenant) tr\u01b0\u1edbc khi ph\u00e1t h\u00e0nh JWT \"\u0111\u1ea7y \u0110\u1ee7\" (ch\u1ee9a <code>user_id_global</code>, <code>tenant_id</code>, v\u00e0 <code>role(s)/permission(s)</code> trong tenant).</li> <li>Sub Auth Service c\u1ee7a Tenant: Ch\u1ecbu tr\u00e1ch nhi\u1ec7m ch\u00ednh cho vi\u1ec7c x\u00e1c th\u1ef1c Local/OTP cho ng\u01b0\u1eddi d\u00f9ng c\u1ee7a tenant \u0111\u00f3 (bao g\u1ed3m ph\u1ee5 huynh v\u00e0 h\u1ecdc sinh \u1edf c\u00e1c tr\u01b0\u1eddng kh\u00f4ng d\u00f9ng Workspace). Sau khi x\u00e1c th\u1ef1c local th\u00e0nh c\u00f4ng:<ul> <li>Sub Auth Service s\u1ebd g\u1ecdi l\u00ean User Service Master \u0111\u1ec3 \u0111\u0103ng k\u00fd ng\u01b0\u1eddi d\u00f9ng n\u00e0y (n\u1ebfu l\u00e0 l\u1ea7n \u0111\u1ea7u) v\u00e0 nh\u1eadn v\u1ec1 <code>user_id</code> to\u00e0n c\u1ee5c.</li> <li>Sau \u0111\u00f3, Sub Auth Service s\u1ebd ph\u1ed1i h\u1ee3p v\u1edbi Sub User Service c\u1ee7a tenant m\u00ecnh \u0111\u1ec3 l\u1ea5y th\u00f4ng tin RBAC (roles/permissions) c\u1ee7a user local \u0111\u00f3 trong tenant \u0111\u00f3 v\u00e0 ph\u00e1t h\u00e0nh JWT \"\u0111\u1ea7y \u0111\u1ee7\".</li> </ul> </li> </ul> </li> <li> <p>Superadmin Webapp Chung:</p> <ul> <li>S\u1eed d\u1ee5ng \"Tenant Master\" \u0111\u1ec3 qu\u1ea3n l\u00fd t\u1eadp trung user, tenant, template role/permission, v\u00e0 c\u1ea5u h\u00ecnh k\u1ebft n\u1ed1i cho t\u1eebng tenant.</li> <li>C\u00f3 kh\u1ea3 n\u0103ng t\u1ed5ng h\u1ee3p b\u00e1o c\u00e1o (y\u00eau c\u1ea7u thi\u1ebft k\u1ebf Data Warehouse/Data Lake v\u00e0 quy tr\u00ecnh ETL t\u1eeb d\u1eef li\u1ec7u c\u1ee7a c\u00e1c tenant).</li> </ul> </li> <li> <p>Global/Template Roles &amp; Permissions:</p> <ul> <li>User Service Master s\u1ebd qu\u1ea3n l\u00fd m\u1ed9t b\u1ed9 \"Global/Template Roles &amp; Permissions\" m\u00e0 c\u00e1c tenant c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng, k\u1ebf th\u1eeba, ho\u1eb7c t\u00f9y ch\u1ec9nh t\u1ea1i Sub User Service c\u1ee7a m\u00ecnh.</li> </ul> </li> </ul>"},{"location":"tmp/phat-sinh-va-phuong-an-02/","title":"Phat sinh va phuong an 02","text":"<p>Trong khi t\u1eadp trung v\u00e0o User Service v\u00e0 Auth Service cho ki\u1ebfn tr\u00fac multi-tenant, ch\u00fang ta \u0111\u00e3 ch\u01b0a \u0111\u00e0o s\u00e2u v\u1ec1 vi\u1ec7c Notification Service s\u1ebd ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\u00e0o trong b\u1ed1i c\u1ea3nh m\u1edbi n\u00e0y.</p> <p>\u0110\u00e2y l\u00e0 m\u1ed9t \u0111i\u1ec3m r\u1ea5t quan tr\u1ecdng, v\u00ec m\u1ed7i tr\u01b0\u1eddng th\u00e0nh vi\u00ean (tenant) c\u00f3 th\u1ec3 s\u1ebd c\u00f3 nhu c\u1ea7u v\u1ec1 n\u1ed9i dung th\u00f4ng b\u00e1o, k\u00eanh g\u1eedi, v\u00e0 \u0111\u1ed1i t\u01b0\u1ee3ng nh\u1eadn th\u00f4ng b\u00e1o ri\u00eang.</p> <p>H\u00e3y c\u00f9ng ph\u00e2n t\u00edch v\u00e0 \u0111\u01b0a ra h\u01b0\u1edbng gi\u1ea3i quy\u1ebft cho Notification Service trong ki\u1ebfn tr\u00fac multi-tenant, d\u1ef1a tr\u00ean nh\u1eefng g\u00ec ch\u00fang ta \u0111\u00e3 th\u1ed1ng nh\u1ea5t:</p>"},{"location":"tmp/phat-sinh-va-phuong-an-02/#phan-tich-va-e-xuat-cho-notification-service-trong-kien-truc-multi-tenant","title":"Ph\u00e2n t\u00edch v\u00e0 \u0110\u1ec1 xu\u1ea5t cho Notification Service trong Ki\u1ebfn tr\u00fac Multi-Tenant","text":"<p>Y\u00eau c\u1ea7u \u0111\u1ed1i v\u1edbi Notification Service trong m\u00f4i tr\u01b0\u1eddng Multi-Tenant:</p> <ul> <li>N\u1ed9i dung th\u00f4ng b\u00e1o theo t\u1eebng tr\u01b0\u1eddng: Template email, n\u1ed9i dung ZNS, tin nh\u1eafn Google Chat c\u00f3 th\u1ec3 c\u1ea7n t\u00f9y ch\u1ec9nh cho t\u1eebng tr\u01b0\u1eddng.</li> <li>K\u00eanh g\u1eedi ri\u00eang c\u1ee7a t\u1eebng tr\u01b0\u1eddng: M\u1ed7i tr\u01b0\u1eddng c\u00f3 th\u1ec3 c\u00f3 Zalo OA ri\u00eang, c\u1ea5u h\u00ecnh g\u1eedi email ri\u00eang (v\u00ed d\u1ee5: t\u1eeb \u0111\u1ecba ch\u1ec9 email c\u1ee7a tr\u01b0\u1eddng \u0111\u00f3), webhook Google Chat ri\u00eang.</li> <li>\u0110\u1ed1i t\u01b0\u1ee3ng nh\u1eadn th\u00f4ng b\u00e1o thu\u1ed9c t\u1eebng tr\u01b0\u1eddng: Th\u00f4ng b\u00e1o h\u1ecdc ph\u00ed c\u1ee7a tr\u01b0\u1eddng A ch\u1ec9 g\u1eedi cho ph\u1ee5 huynh/h\u1ecdc sinh c\u1ee7a tr\u01b0\u1eddng A.</li> <li>Log v\u00e0 tracking ri\u00eang bi\u1ec7t: M\u1ed7i tr\u01b0\u1eddng c\u00f3 th\u1ec3 mu\u1ed1n theo d\u00f5i l\u1ecbch s\u1eed g\u1eedi th\u00f4ng b\u00e1o c\u1ee7a ri\u00eang m\u00ecnh.</li> <li>C\u00f3 th\u1ec3 c\u00f3 th\u00f4ng b\u00e1o to\u00e0n h\u1ec7 th\u1ed1ng: Superadmin c\u00f3 th\u1ec3 mu\u1ed1n g\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn t\u1ea5t c\u1ea3 c\u00e1c tr\u01b0\u1eddng ho\u1eb7c m\u1ed9t nh\u00f3m tr\u01b0\u1eddng.</li> </ul> <p>Gi\u1ea3i ph\u00e1p ki\u1ebfn tr\u00fac \u0111\u1ec1 xu\u1ea5t cho Notification Service:</p> <p>D\u1ef1a tr\u00ean m\u00f4 h\u00ecnh \"Separate Stacks per Tenant\" v\u00e0 vi\u1ec7c c\u00f3 m\u1ed9t \"Tenant Master\", ch\u00fang ta c\u00f3 th\u1ec3 \u00e1p d\u1ee5ng m\u1ed9t m\u00f4 h\u00ecnh t\u01b0\u01a1ng t\u1ef1 cho Notification Service:</p> <ol> <li> <p>Sub Notification Service (Notification Service \u1edf c\u1ea5p \u0111\u1ed9 Tenant):</p> <ul> <li>Tr\u00e1ch nhi\u1ec7m ch\u00ednh:<ul> <li>Qu\u1ea3n l\u00fd template th\u00f4ng b\u00e1o ri\u00eang cho tenant \u0111\u00f3.</li> <li>L\u01b0u tr\u1eef c\u1ea5u h\u00ecnh k\u00eanh g\u1eedi ri\u00eang c\u1ee7a tenant (Zalo OA API keys, Gmail API credentials/service account, Google Chat webhooks c\u1ee7a tenant \u0111\u00f3).</li> <li>X\u1eed l\u00fd c\u00e1c y\u00eau c\u1ea7u g\u1eedi th\u00f4ng b\u00e1o ph\u00e1t sinh t\u1eeb c\u00e1c service nghi\u1ec7p v\u1ee5 (CRM Adapter, SIS Adapter, LMS Adapter) ho\u1eb7c Core Services \"shadow\" (n\u1ebfu c\u00f3) c\u1ee7a tenant \u0111\u00f3.</li> <li>G\u1ecdi \u0111\u1ebfn c\u00e1c API c\u1ee7a nh\u00e0 cung c\u1ea5p d\u1ecbch v\u1ee5 (Zalo, Gmail, Google Chat) s\u1eed d\u1ee5ng credentials c\u1ee7a tenant.</li> <li>Ghi log v\u00e0 theo d\u00f5i tr\u1ea1ng th\u00e1i g\u1eedi th\u00f4ng b\u00e1o cho tenant \u0111\u00f3.</li> </ul> </li> <li>Tri\u1ec3n khai: M\u1ed7i tenant s\u1ebd c\u00f3 m\u1ed9t instance Notification Service ri\u00eang, thu\u1ed9c \"stack ri\u00eang\" c\u1ee7a h\u1ecd.</li> <li>API: Cung c\u1ea5p API n\u1ed9i b\u1ed9 (v\u00ed d\u1ee5: <code>POST /tenant-notifications</code>) \u0111\u1ec3 c\u00e1c service kh\u00e1c trong c\u00f9ng stack c\u1ee7a tenant c\u00f3 th\u1ec3 g\u1ecdi (th\u00f4ng qua API Gateway c\u1ee7a tenant \u0111\u00f3 ho\u1eb7c tr\u1ef1c ti\u1ebfp n\u1ebfu trong c\u00f9ng m\u1ea1ng n\u1ed9i b\u1ed9 \u0111\u01b0\u1ee3c ki\u1ec3m so\u00e1t).</li> </ul> </li> <li> <p>Notification Service Master (Ho\u1eb7c ch\u1ee9c n\u0103ng trong m\u1ed9t Core Service c\u1ee7a Tenant \"Master\"):</p> <ul> <li>Tr\u00e1ch nhi\u1ec7m ch\u00ednh:<ul> <li>X\u1eed l\u00fd c\u00e1c y\u00eau c\u1ea7u g\u1eedi th\u00f4ng b\u00e1o mang t\u00ednh ch\u1ea5t to\u00e0n h\u1ec7 th\u1ed1ng t\u1eeb Superadmin Webapp (v\u00ed d\u1ee5: th\u00f4ng b\u00e1o b\u1ea3o tr\u00ec h\u1ec7 th\u1ed1ng \u0111\u1ebfn t\u1ea5t c\u1ea3 qu\u1ea3n tr\u1ecb vi\u00ean tr\u01b0\u1eddng).</li> <li>C\u00f3 th\u1ec3 qu\u1ea3n l\u00fd c\u00e1c template th\u00f4ng b\u00e1o chung m\u00e0 c\u00e1c Sub Notification Service c\u00f3 th\u1ec3 k\u1ebf th\u1eeba ho\u1eb7c s\u1eed d\u1ee5ng.</li> <li>\u0110i\u1ec1u ph\u1ed1i g\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn nhi\u1ec1u tenant: N\u1ebfu Superadmin mu\u1ed1n g\u1eedi m\u1ed9t th\u00f4ng b\u00e1o \u0111\u1ebfn m\u1ed9t nh\u00f3m tr\u01b0\u1eddng ho\u1eb7c t\u1ea5t c\u1ea3 c\u00e1c tr\u01b0\u1eddng, Notification Service Master s\u1ebd nh\u1eadn y\u00eau c\u1ea7u n\u00e0y. Sau \u0111\u00f3, n\u00f3 c\u00f3 th\u1ec3:<ul> <li>Option A (Master g\u1ecdi Sub): G\u1ecdi l\u1ea7n l\u01b0\u1ee3t API c\u1ee7a t\u1eebng Sub Notification Service (c\u1ee7a c\u00e1c tenant \u0111\u00edch) \u0111\u1ec3 y\u00eau c\u1ea7u h\u1ecd g\u1eedi th\u00f4ng b\u00e1o (s\u1eed d\u1ee5ng template v\u00e0 k\u00eanh c\u1ee7a tenant \u0111\u00f3).</li> <li>Option B (Master ph\u00e1t s\u1ef1 ki\u1ec7n): Ph\u00e1t m\u1ed9t s\u1ef1 ki\u1ec7n \"global notification request\" l\u00ean Pub/Sub, c\u00e1c Sub Notification Service l\u1eafng nghe v\u00e0 t\u1ef1 x\u1eed l\u00fd n\u1ebfu th\u00f4ng b\u00e1o \u0111\u00f3 \u00e1p d\u1ee5ng cho tenant c\u1ee7a h\u1ecd.</li> </ul> </li> </ul> </li> <li>API: Cung c\u1ea5p API cho Superadmin Webapp (v\u00ed d\u1ee5: <code>POST /global-notifications</code>).</li> </ul> </li> </ol> <p>Lu\u1ed3ng ho\u1ea1t \u0111\u1ed9ng:</p> <ul> <li> <p>Th\u00f4ng b\u00e1o trong ph\u1ea1m vi Tenant (V\u00ed d\u1ee5: Tr\u01b0\u1eddng A g\u1eedi th\u00f4ng b\u00e1o h\u1ecdc ph\u00ed):</p> <ol> <li>SIS Adapter c\u1ee7a Tr\u01b0\u1eddng A ph\u00e1t hi\u1ec7n h\u1ecdc sinh X c\u1ea7n \u0111\u00f3ng h\u1ecdc ph\u00ed.</li> <li>SIS Adapter c\u1ee7a Tr\u01b0\u1eddng A g\u1ecdi API c\u1ee7a Sub Notification Service c\u1ee7a Tr\u01b0\u1eddng A (qua API Gateway, \u0111\u00e3 \u0111\u01b0\u1ee3c \u0111\u1ecbnh tuy\u1ebfn \u0111\u1ebfn stack c\u1ee7a Tr\u01b0\u1eddng A).</li> <li>Sub Notification Service c\u1ee7a Tr\u01b0\u1eddng A l\u1ea5y template th\u00f4ng b\u00e1o h\u1ecdc ph\u00ed c\u1ee7a Tr\u01b0\u1eddng A, th\u00f4ng tin li\u00ean h\u1ec7 c\u1ee7a ph\u1ee5 huynh h\u1ecdc sinh X (t\u1eeb Sub User Service c\u1ee7a Tr\u01b0\u1eddng A ho\u1eb7c User Service Master + <code>tenant_id</code>), v\u00e0 credentials k\u00eanh g\u1eedi (v\u00ed d\u1ee5 Zalo OA c\u1ee7a Tr\u01b0\u1eddng A).</li> <li>Sub Notification Service c\u1ee7a Tr\u01b0\u1eddng A g\u1eedi th\u00f4ng b\u00e1o v\u00e0 ghi log.</li> </ol> </li> <li> <p>Th\u00f4ng b\u00e1o To\u00e0n H\u1ec7 Th\u1ed1ng (V\u00ed d\u1ee5: Superadmin g\u1eedi th\u00f4ng b\u00e1o c\u1eadp nh\u1eadt ch\u00ednh s\u00e1ch):</p> <ol> <li>Superadmin so\u1ea1n th\u00f4ng b\u00e1o tr\u00ean Superadmin Webapp.</li> <li>Superadmin Webapp g\u1ecdi API c\u1ee7a Notification Service Master.</li> <li>Notification Service Master x\u1eed l\u00fd y\u00eau c\u1ea7u:<ul> <li>N\u1ebfu theo Option A: G\u1ecdi API c\u1ee7a t\u1eebng Sub Notification Service li\u00ean quan.</li> <li>N\u1ebfu theo Option B: Ph\u00e1t s\u1ef1 ki\u1ec7n l\u00ean Pub/Sub.</li> </ul> </li> <li>C\u00e1c Sub Notification Service th\u1ef1c hi\u1ec7n g\u1eedi th\u00f4ng b\u00e1o theo logic c\u1ee7a m\u00ecnh.</li> </ol> </li> </ul> <p>T\u00e1c \u0111\u1ed9ng v\u00e0 C\u00e2n nh\u1eafc:</p> <ul> <li>Data Model:<ul> <li>Sub Notification Service c\u1ea7n c\u00e1c b\u1ea3ng \u0111\u1ec3 l\u01b0u <code>notification_templates_in_tenant</code>, <code>channel_configs_in_tenant</code> (Zalo keys, Gmail keys, etc.), <code>notification_logs_in_tenant</code>.</li> <li>Notification Service Master c\u1ea7n b\u1ea3ng \u0111\u1ec3 l\u01b0u <code>global_notification_templates</code> (n\u1ebfu c\u00f3), v\u00e0 c\u00f3 th\u1ec3 l\u00e0 log c\u1ee7a c\u00e1c th\u00f4ng b\u00e1o to\u00e0n c\u1ee5c \u0111\u00e3 g\u1eedi.</li> </ul> </li> <li>C\u1ea5u h\u00ecnh: M\u1ed7i Sub Notification Service s\u1ebd c\u00f3 c\u1ea5u h\u00ecnh ri\u00eang cho c\u00e1c k\u00eanh c\u1ee7a m\u00ecnh. Superadmin App s\u1ebd c\u1ea7n giao di\u1ec7n \u0111\u1ec3 c\u1ea5u h\u00ecnh c\u00e1c k\u00eanh n\u00e0y cho t\u1eebng tr\u01b0\u1eddng.</li> <li>API Gateway: C\u1ea7n \u0111\u1ecbnh tuy\u1ebfn ch\u00ednh x\u00e1c c\u00e1c request g\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn \u0111\u00fang Sub Notification Service c\u1ee7a tenant ho\u1eb7c Notification Service Master.</li> <li>User Service (Master v\u00e0 Sub): Notification Service (c\u1ea3 Master v\u00e0 Sub) s\u1ebd c\u1ea7n t\u01b0\u01a1ng t\u00e1c v\u1edbi User Service (Master ho\u1eb7c Sub t\u01b0\u01a1ng \u1ee9ng) \u0111\u1ec3 l\u1ea5y th\u00f4ng tin ng\u01b0\u1eddi nh\u1eadn (v\u00ed d\u1ee5: email, s\u1ed1 \u0111i\u1ec7n tho\u1ea1i li\u00ean k\u1ebft Zalo, k\u00eanh \u01b0a th\u00edch c\u1ee7a ng\u01b0\u1eddi d\u00f9ng trong tenant \u0111\u00f3).</li> </ul> <p>Ch\u00e0o John,</p> <p>Tuy\u1ec7t v\u1eddi! B\u1ea1n \u0111\u00e3 ch\u1ecdn Option B: Master Ph\u00e1t S\u1ef1 ki\u1ec7n l\u00ean Pub/Sub, C\u00e1c Sub Notification Service L\u1eafng Nghe cho vi\u1ec7c Notification Service Master \u0111i\u1ec1u ph\u1ed1i g\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn nhi\u1ec1u tenant. \u0110\u00e2y l\u00e0 m\u1ed9t l\u1ef1a ch\u1ecdn t\u1ed1t, h\u01b0\u1edbng \u0111\u1ebfn s\u1ef1 linh ho\u1ea1t v\u00e0 kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng cho h\u1ec7 th\u1ed1ng.</p> <p>D\u01b0\u1edbi \u0111\u00e2y l\u00e0 t\u00f3m t\u1eaft gi\u1ea3i ph\u00e1p n\u00e0y, bao g\u1ed3m c\u1ea3 c\u00e1c ph\u01b0\u01a1ng \u00e1n ph\u00f2ng ng\u1eeba r\u1ee7i ro ti\u1ec1m \u1ea9n:</p>"},{"location":"tmp/phat-sinh-va-phuong-an-02/#tom-tat-giai-phap-gui-thong-bao-a-tenant-option-b-va-phuong-an-phong-ngua","title":"T\u00f3m t\u1eaft Gi\u1ea3i Ph\u00e1p G\u1eedi Th\u00f4ng B\u00e1o \u0110a Tenant (Option B) v\u00e0 Ph\u01b0\u01a1ng \u00c1n Ph\u00f2ng Ng\u1eeba","text":"<p>1. M\u00f4 T\u1ea3 Gi\u1ea3i Ph\u00e1p (Option B):</p> <ul> <li>Notification Service Master nh\u1eadn y\u00eau c\u1ea7u: Khi Superadmin mu\u1ed1n g\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn nhi\u1ec1u tr\u01b0\u1eddng (ho\u1eb7c t\u1ea5t c\u1ea3), y\u00eau c\u1ea7u s\u1ebd \u0111\u01b0\u1ee3c g\u1eedi \u0111\u1ebfn Notification Service Master.</li> <li>Master Ph\u00e1t S\u1ef1 ki\u1ec7n (Publish Event):<ul> <li>Notification Service Master s\u1ebd so\u1ea1n m\u1ed9t th\u00f4ng \u0111i\u1ec7p s\u1ef1 ki\u1ec7n (v\u00ed d\u1ee5: <code>global_notification_requested</code>).</li> <li>Payload c\u1ee7a s\u1ef1 ki\u1ec7n s\u1ebd ch\u1ee9a n\u1ed9i dung th\u00f4ng b\u00e1o g\u1ed1c v\u00e0 c\u00e1c th\u00f4ng tin \u0111\u1ecbnh danh ng\u01b0\u1eddi nh\u1eadn ho\u1eb7c ti\u00eau ch\u00ed ch\u1ecdn ng\u01b0\u1eddi nh\u1eadn (v\u00ed d\u1ee5: <code>target_tenant_ids: [\"all\"]</code> ho\u1eb7c <code>target_tenant_ids: [\"tenant_A\", \"tenant_B\"]</code>, ho\u1eb7c <code>target_user_roles: [\"teacher\"]</code> n\u1ebfu Master c\u00f3 th\u00f4ng tin n\u00e0y).</li> <li>S\u1ef1 ki\u1ec7n n\u00e0y \u0111\u01b0\u1ee3c publish l\u00ean m\u1ed9t topic chung tr\u00ean Google Cloud Pub/Sub (v\u00ed d\u1ee5: <code>vas-global-notifications-topic</code>).</li> </ul> </li> <li>Sub Notification Services L\u1eafng Nghe (Subscribe &amp; Process):<ul> <li>M\u1ed7i Sub Notification Service (c\u1ee7a t\u1eebng tr\u01b0\u1eddng th\u00e0nh vi\u00ean) s\u1ebd c\u00f3 m\u1ed9t subscription l\u1eafng nghe topic <code>vas-global-notifications-topic</code> n\u00e0y.</li> <li>Khi nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 ki\u1ec7n, Sub Notification Service s\u1ebd:<ul> <li>Ki\u1ec3m tra xem s\u1ef1 ki\u1ec7n c\u00f3 \u00e1p d\u1ee5ng cho tenant c\u1ee7a m\u00ecnh kh\u00f4ng (d\u1ef1a tr\u00ean <code>target_tenant_ids</code> ho\u1eb7c c\u00e1c ti\u00eau ch\u00ed kh\u00e1c trong payload).</li> <li>N\u1ebfu c\u00f3, n\u00f3 s\u1ebd l\u1ea5y n\u1ed9i dung th\u00f4ng b\u00e1o g\u1ed1c, \u00e1p d\u1ee5ng c\u00e1c template ri\u00eang c\u1ee7a tenant (n\u1ebfu c\u00f3), x\u00e1c \u0111\u1ecbnh danh s\u00e1ch ng\u01b0\u1eddi nh\u1eadn c\u1ee5 th\u1ec3 trong tenant c\u1ee7a m\u00ecnh (c\u00f3 th\u1ec3 c\u1ea7n g\u1ecdi Sub User Service c\u1ee7a tenant \u0111\u00f3).</li> <li>S\u1eed d\u1ee5ng c\u1ea5u h\u00ecnh k\u00eanh g\u1eedi ri\u00eang (Zalo OA, Gmail API keys, etc.) c\u1ee7a tenant \u0111\u1ec3 g\u1eedi th\u00f4ng b\u00e1o.</li> <li>Ghi log v\u00e0 theo d\u00f5i tr\u1ea1ng th\u00e1i g\u1eedi th\u00f4ng b\u00e1o trong ph\u1ea1m vi tenant c\u1ee7a m\u00ecnh.</li> </ul> </li> </ul> </li> <li>Decoupling v\u00e0 X\u1eed l\u00fd B\u1ea5t \u0110\u1ed3ng b\u1ed9: Master Service kh\u00f4ng c\u1ea7n bi\u1ebft chi ti\u1ebft v\u1ec1 t\u1eebng Sub Service, v\u00e0 vi\u1ec7c g\u1eedi th\u00f4ng b\u00e1o di\u1ec5n ra ho\u00e0n to\u00e0n b\u1ea5t \u0111\u1ed3ng b\u1ed9.</li> </ul> <p>2. Ph\u01b0\u01a1ng \u00c1n Ph\u00f2ng Ng\u1eeba R\u1ee7i Ro Ti\u1ec1m \u1ea8n:</p> <ul> <li> <p>R\u1ee7i ro: Kh\u00f3 theo d\u00f5i tr\u1ea1ng th\u00e1i g\u1eedi t\u1ed5ng th\u1ec3 t\u1eeb Master.</p> <ul> <li>Ph\u00f2ng ng\u1eeba:<ul> <li>S\u1ef1 ki\u1ec7n Ph\u1ea3n h\u1ed3i (Acknowledgement Event): M\u1ed7i Sub Notification Service sau khi x\u1eed l\u00fd (g\u1eedi th\u00e0nh c\u00f4ng, th\u1ea5t b\u1ea1i, ho\u1eb7c \u0111\u01b0a v\u00e0o h\u00e0ng \u0111\u1ee3i n\u1ed9i b\u1ed9) s\u1ebd ph\u00e1t m\u1ed9t s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i (v\u00ed d\u1ee5: <code>tenant_notification_batch_status</code>) l\u00ean m\u1ed9t topic Pub/Sub kh\u00e1c (v\u00ed d\u1ee5: <code>vas-tenant-notification-ack-topic</code>).</li> <li>Payload c\u1ee7a s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i n\u00e0y s\u1ebd ch\u1ee9a <code>tenant_id</code>, tr\u1ea1ng th\u00e1i x\u1eed l\u00fd, s\u1ed1 l\u01b0\u1ee3ng g\u1eedi th\u00e0nh c\u00f4ng/th\u1ea5t b\u1ea1i, v\u00e0 c\u00f3 th\u1ec3 l\u00e0 <code>correlation_id</code> t\u1eeb s\u1ef1 ki\u1ec7n g\u1ed1c c\u1ee7a Master.</li> <li>M\u1ed9t service gi\u00e1m s\u00e1t ri\u00eang (ho\u1eb7c ch\u00ednh Notification Service Master n\u1ebfu \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf \u0111\u1ec3 l\u1eafng nghe) c\u00f3 th\u1ec3 thu th\u1eadp c\u00e1c s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i n\u00e0y \u0111\u1ec3 t\u1ed5ng h\u1ee3p b\u00e1o c\u00e1o tr\u1ea1ng th\u00e1i cho Superadmin.</li> <li>S\u1eed d\u1ee5ng m\u1ed9t c\u01a1 s\u1edf d\u1eef li\u1ec7u (v\u00ed d\u1ee5: BigQuery ho\u1eb7c m\u1ed9t b\u1ea3ng trong PostgreSQL c\u1ee7a Master) \u0111\u1ec3 l\u01b0u tr\u1eef tr\u1ea1ng th\u00e1i chi ti\u1ebft c\u1ee7a t\u1eebng y\u00eau c\u1ea7u g\u1eedi th\u00f4ng b\u00e1o to\u00e0n c\u1ee5c v\u00e0 c\u1eadp nh\u1eadt d\u1ef1a tr\u00ean c\u00e1c s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i.</li> </ul> </li> </ul> </li> <li> <p>R\u1ee7i ro: \u0110\u1ea3m b\u1ea3o X\u1eed l\u00fd Message Idempotent t\u1ea1i Sub Services.</p> <ul> <li>Ph\u00f2ng ng\u1eeba:<ul> <li>M\u1ed7i s\u1ef1 ki\u1ec7n t\u1eeb Master Service ph\u1ea3i c\u00f3 m\u1ed9t <code>message_id</code> ho\u1eb7c <code>event_id</code> duy nh\u1ea5t.</li> <li>M\u1ed7i Sub Notification Service ph\u1ea3i tri\u1ec3n khai logic ki\u1ec3m tra <code>message_id</code> \u0111\u00e3 \u0111\u01b0\u1ee3c x\u1eed l\u00fd hay ch\u01b0a (v\u00ed d\u1ee5: l\u01b0u v\u00e0o b\u1ea3ng <code>processed_global_notifications</code> trong DB c\u1ee7a Sub Service ho\u1eb7c d\u00f9ng Redis) \u0111\u1ec3 tr\u00e1nh g\u1eedi l\u1ea1i c\u00f9ng m\u1ed9t th\u00f4ng b\u00e1o to\u00e0n c\u1ee5c nhi\u1ec1u l\u1ea7n.</li> <li>To\u00e0n b\u1ed9 logic x\u1eed l\u00fd s\u1ef1 ki\u1ec7n trong Sub Service (t\u1eeb l\u1ea5y th\u00f4ng tin ng\u01b0\u1eddi nh\u1eadn \u0111\u1ebfn g\u1eedi th\u00f4ng b\u00e1o) n\u00ean \u0111\u01b0\u1ee3c \u0111\u1eb7t trong m\u1ed9t transaction (n\u1ebfu c\u00f3 t\u01b0\u01a1ng t\u00e1c DB) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh nh\u1ea5t qu\u00e1n.</li> </ul> </li> </ul> </li> <li> <p>R\u1ee7i ro: \"Broadcast Storm\" ho\u1eb7c Sub Service x\u1eed l\u00fd nh\u1ea7m s\u1ef1 ki\u1ec7n kh\u00f4ng d\u00e0nh cho m\u00ecnh.</p> <ul> <li>Ph\u00f2ng ng\u1eeba:<ul> <li>Payload c\u1ee7a s\u1ef1 ki\u1ec7n t\u1eeb Master Service ph\u1ea3i r\u1ea5t r\u00f5 r\u00e0ng v\u1ec1 vi\u1ec7c s\u1ef1 ki\u1ec7n n\u00e0y d\u00e0nh cho nh\u1eefng tenant n\u00e0o (<code>target_tenant_ids</code>).</li> <li>Logic l\u1ecdc s\u1ef1 ki\u1ec7n \u1edf \u0111\u1ea7u m\u1ed7i Sub Notification Service ph\u1ea3i ch\u1eb7t ch\u1ebd: ch\u1ec9 x\u1eed l\u00fd n\u1ebfu <code>tenant_id</code> c\u1ee7a m\u00ecnh n\u1eb1m trong danh s\u00e1ch <code>target_tenant_ids</code> ho\u1eb7c n\u1ebfu <code>target_tenant_ids</code> l\u00e0 \"all\" (v\u00e0 c\u00f3 c\u01a1 ch\u1ebf ph\u00e2n bi\u1ec7t r\u00f5 r\u00e0ng).</li> </ul> </li> </ul> </li> <li> <p>R\u1ee7i ro: Qu\u00e1 t\u1ea3i t\u1ea1i m\u1ed9t Sub Notification Service n\u1ebfu nh\u1eadn \u0111\u01b0\u1ee3c nhi\u1ec1u s\u1ef1 ki\u1ec7n l\u1edbn c\u00f9ng l\u00fac.</p> <ul> <li>Ph\u00f2ng ng\u1eeba:<ul> <li>C\u1ea5u h\u00ecnh Pub/Sub subscription v\u1edbi <code>flow control</code> \u0111\u1ec3 gi\u1edbi h\u1ea1n s\u1ed1 l\u01b0\u1ee3ng message m\u00e0 Sub Service nh\u1eadn c\u00f9ng m\u1ed9t l\u00fac.</li> <li>Sub Notification Service n\u00ean thi\u1ebft k\u1ebf \u0111\u1ec3 x\u1eed l\u00fd b\u1ea5t \u0111\u1ed3ng b\u1ed9 n\u1ed9i b\u1ed9 (v\u00ed d\u1ee5: nh\u1eadn message t\u1eeb Pub/Sub, \u0111\u01b0a v\u00e0o m\u1ed9t h\u00e0ng \u0111\u1ee3i n\u1ed9i b\u1ed9 c\u1ee7a service (c\u00f3 th\u1ec3 l\u00e0 background task, Celery, ho\u1eb7c m\u1ed9t Pub/Sub topic ri\u00eang c\u1ee7a tenant) \u0111\u1ec3 t\u1eeb t\u1eeb x\u1eed l\u00fd vi\u1ec7c g\u1eedi \u0111i).</li> <li>\u0110\u1ea3m b\u1ea3o Sub Notification Service \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\u00ean Cloud Run v\u1edbi c\u1ea5u h\u00ecnh min/max instances ph\u00f9 h\u1ee3p \u0111\u1ec3 c\u00f3 th\u1ec3 auto-scale.</li> </ul> </li> </ul> </li> <li> <p>R\u1ee7i ro: L\u1ed7i c\u1ea5u h\u00ecnh k\u00eanh g\u1eedi t\u1ea1i m\u1ed9t Tenant.</p> <ul> <li>Ph\u00f2ng ng\u1eeba:<ul> <li>Sub Notification Service ph\u1ea3i c\u00f3 c\u01a1 ch\u1ebf ghi log l\u1ed7i chi ti\u1ebft khi kh\u00f4ng th\u1ec3 g\u1eedi qua m\u1ed9t k\u00eanh n\u00e0o \u0111\u00f3.</li> <li>Ph\u00e1t s\u1ef1 ki\u1ec7n ph\u1ea3n h\u1ed3i (nh\u01b0 \u0111\u00e3 \u0111\u1ec1 c\u1eadp \u1edf tr\u00ean) v\u1edbi tr\u1ea1ng th\u00e1i l\u1ed7i v\u00e0 l\u00fd do c\u1ee5 th\u1ec3.</li> <li>Superadmin Webapp n\u00ean c\u00f3 giao di\u1ec7n \u0111\u1ec3 ki\u1ec3m tra v\u00e0 c\u1eadp nh\u1eadt c\u1ea5u h\u00ecnh k\u00eanh g\u1eedi cho t\u1eebng tenant.</li> </ul> </li> </ul> </li> <li> <p>R\u1ee7i ro: Dead Letter Topic (DLT) c\u1ee7a Pub/Sub b\u1ecb \u0111\u1ea7y do l\u1ed7i logic l\u1eb7p \u0111i l\u1eb7p l\u1ea1i \u1edf Sub Service.</p> <ul> <li>Ph\u00f2ng ng\u1eeba:<ul> <li>Gi\u00e1m s\u00e1t ch\u1eb7t ch\u1ebd DLT c\u1ee7a topic <code>vas-global-notifications-topic</code>.</li> <li>Khi c\u00f3 message v\u00e0o DLT, c\u1ea7n c\u00f3 quy tr\u00ecnh ph\u00e2n t\u00edch nguy\u00ean nh\u00e2n g\u1ed1c (root cause) ngay.</li> <li>N\u1ebfu l\u1ed7i do logic \u1edf Sub Service, c\u1ea7n s\u1eeda l\u1ed7i v\u00e0 c\u00f3 th\u1ec3 ph\u1ea3i re-publish message t\u1eeb DLT (sau khi \u0111\u00e3 s\u1eeda l\u1ed7i v\u00e0 \u0111\u1ea3m b\u1ea3o idempotency).</li> </ul> </li> </ul> </li> </ul> <p>B\u1eb1ng c\u00e1ch tri\u1ec3n khai Option B c\u00f9ng v\u1edbi c\u00e1c bi\u1ec7n ph\u00e1p ph\u00f2ng ng\u1eeba n\u00e0y, ch\u00fang ta c\u00f3 th\u1ec3 x\u00e2y d\u1ef1ng m\u1ed9t h\u1ec7 th\u1ed1ng g\u1eedi th\u00f4ng b\u00e1o \u0111a tenant m\u1ea1nh m\u1ebd, linh ho\u1ea1t, c\u00f3 kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng t\u1ed1t v\u00e0 qu\u1ea3n l\u00fd \u0111\u01b0\u1ee3c c\u00e1c r\u1ee7i ro ti\u1ec1m \u1ea9n.</p>"},{"location":"tmp/tmp-rbac-deep-dive/","title":"Ph\u00e2n t\u00edch Chuy\u00ean s\u00e2u: Ki\u1ebfn tr\u00fac Ph\u00e2n quy\u1ec1n \u0110\u1ed9ng (RBAC) trong H\u1ec7 th\u1ed1ng dx-vas","text":""},{"location":"tmp/tmp-rbac-deep-dive/#1-tong-quan-inh-nghia-rbac","title":"1. T\u1ed5ng quan &amp; \u0110\u1ecbnh ngh\u0129a RBAC","text":"<p>RBAC (Role-Based Access Control) trong h\u1ec7 th\u1ed1ng dx-vas cho ph\u00e9p ki\u1ec3m so\u00e1t quy\u1ec1n truy c\u1eadp m\u1ed9t c\u00e1ch linh ho\u1ea1t v\u00e0 c\u00f3 th\u1ec3 m\u1edf r\u1ed9ng, d\u1ef1a tr\u00ean:</p> <ul> <li>Vai tr\u00f2 ng\u01b0\u1eddi d\u00f9ng (Role) trong t\u1eebng tr\u01b0\u1eddng th\u00e0nh vi\u00ean (tenant)</li> <li>T\u1eadp h\u1ee3p quy\u1ec1n (Permission) \u0111\u01b0\u1ee3c g\u00e1n cho m\u1ed7i role</li> <li>\u0110i\u1ec1u ki\u1ec7n th\u1ef1c thi (Condition, n\u1ebfu c\u00f3) \u00e1p d\u1ee5ng \u1edf c\u1ea5p permission</li> </ul> <p>M\u00f4 h\u00ecnh RBAC n\u00e0y ho\u1ea1t \u0111\u1ed9ng trong b\u1ed1i c\u1ea3nh multi-tenant, n\u01a1i m\u1ed7i tenant (tr\u01b0\u1eddng th\u00e0nh vi\u00ean) c\u00f3 RBAC \u0111\u1ed9c l\u1eadp, nh\u01b0ng v\u1eabn k\u1ebf th\u1eeba m\u1ed9t ph\u1ea7n t\u1eeb template to\u00e0n h\u1ec7 th\u1ed1ng do User Service Master cung c\u1ea5p.</p>"},{"location":"tmp/tmp-rbac-deep-dive/#2-phan-tang-quan-ly-inh-danh-phan-quyen","title":"2. Ph\u00e2n t\u1ea7ng Qu\u1ea3n l\u00fd \u0110\u1ecbnh danh &amp; Ph\u00e2n quy\u1ec1n","text":""},{"location":"tmp/tmp-rbac-deep-dive/#user-service-master","title":"\ud83e\udde0 User Service Master","text":"<ul> <li>L\u00e0 ngu\u1ed3n ch\u00e2n l\u00fd duy nh\u1ea5t cho to\u00e0n b\u1ed9 ng\u01b0\u1eddi d\u00f9ng (<code>users_global</code>)</li> <li>Qu\u1ea3n l\u00fd:</li> <li>Danh s\u00e1ch tenant (<code>tenants</code>)</li> <li>M\u1ed1i quan h\u1ec7 user \u2194 tenant (<code>user_tenant_assignments</code>)</li> <li>C\u00e1c template vai tr\u00f2 v\u00e0 quy\u1ec1n to\u00e0n h\u1ec7 th\u1ed1ng:<ul> <li><code>global_roles_templates</code></li> <li><code>global_permissions_templates</code></li> </ul> </li> <li>Kh\u00f4ng tr\u1ef1c ti\u1ebfp \u0111\u00e1nh gi\u00e1 RBAC, m\u00e0 cung c\u1ea5p \u0111\u1ecbnh danh v\u00e0 template cho Sub Services</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#sub-user-service-per-tenant","title":"\ud83e\udde9 Sub User Service (per Tenant)","text":"<ul> <li>M\u1ed7i tenant c\u00f3 1 instance ri\u00eang, qu\u1ea3n l\u00fd:</li> <li>Ng\u01b0\u1eddi d\u00f9ng thu\u1ed9c tenant (<code>users_in_tenant</code>) \u2013 \u00e1nh x\u1ea1 \u0111\u1ebfn <code>user_id_global</code></li> <li>Tr\u1ea1ng th\u00e1i ho\u1ea1t \u0111\u1ed9ng n\u1ed9i b\u1ed9: <code>is_active_in_tenant</code></li> <li>Vai tr\u00f2 (<code>roles_in_tenant</code>), quy\u1ec1n (<code>permissions_in_tenant</code>)</li> <li>Mapping:<ul> <li><code>user_role_in_tenant</code></li> <li><code>role_permission_in_tenant</code></li> </ul> </li> <li>Cho ph\u00e9p k\u1ebf th\u1eeba t\u1eeb template Master ho\u1eb7c t\u1ef1 \u0111\u1ecbnh ngh\u0129a</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#3-luong-xac-thuc-phan-quyen-multi-tenant","title":"3. Lu\u1ed3ng X\u00e1c th\u1ef1c &amp; Ph\u00e2n quy\u1ec1n (Multi-Tenant)","text":""},{"location":"tmp/tmp-rbac-deep-dive/#luong-phat-hanh-jwt","title":"\ud83d\udd10 Lu\u1ed3ng ph\u00e1t h\u00e0nh JWT","text":"<ol> <li>Ng\u01b0\u1eddi d\u00f9ng \u0111\u0103ng nh\u1eadp qua:</li> <li>Google OAuth2 \u2192 Auth Master</li> <li>OTP/Local \u2192 Sub Auth Service</li> <li>Sau khi x\u00e1c th\u1ef1c:</li> <li><code>tenant_id</code> \u0111\u01b0\u1ee3c ch\u1ecdn (n\u1ebfu ng\u01b0\u1eddi d\u00f9ng thu\u1ed9c nhi\u1ec1u tenant)</li> <li>Auth Service g\u1ecdi User Service Master \u2192 ki\u1ec3m tra <code>user_id_global</code> + quy\u1ec1n truy c\u1eadp tenant</li> <li>G\u1ecdi Sub User Service \u2192 l\u1ea5y <code>roles</code>, <code>permissions</code></li> <li>JWT \u0111\u01b0\u1ee3c ph\u00e1t h\u00e0nh v\u1edbi:</li> <li><code>user_id</code>, <code>tenant_id</code>, <code>roles</code>, <code>permissions</code>, <code>auth_provider</code></li> </ol>"},{"location":"tmp/tmp-rbac-deep-dive/#api-gateway-anh-gia-rbac","title":"\ud83d\udee1\ufe0f API Gateway \u0111\u00e1nh gi\u00e1 RBAC","text":"<ul> <li>Tr\u00edch xu\u1ea5t <code>tenant_id</code> t\u1eeb JWT</li> <li>Ki\u1ec3m tra <code>is_active</code> + <code>is_active_in_tenant</code></li> <li>Truy v\u1ea5n Redis cache: <code>rbac:{user_id}:{tenant_id}</code></li> <li>N\u1ebfu kh\u00f4ng c\u00f3 cache, g\u1ecdi Sub User Service \u0111\u1ec3 load l\u1ea1i RBAC</li> <li>\u0110\u00e1nh gi\u00e1 <code>condition</code> n\u1ebfu permission c\u00f3 r\u00e0ng bu\u1ed9c \u0111\u1ed9ng</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#4-mo-hinh-du-lieu-rbac-master-vs-sub","title":"4. M\u00f4 h\u00ecnh D\u1eef li\u1ec7u RBAC (Master vs Sub)","text":""},{"location":"tmp/tmp-rbac-deep-dive/#tai-user-service-master","title":"\ud83d\udce6 T\u1ea1i User Service Master","text":"<pre><code>-- Danh s\u00e1ch ng\u01b0\u1eddi d\u00f9ng to\u00e0n h\u1ec7 th\u1ed1ng\nCREATE TABLE users_global (\n  user_id UUID PRIMARY KEY,\n  full_name TEXT,\n  email TEXT,\n  phone TEXT,\n  auth_provider TEXT CHECK (auth_provider IN ('google', 'local')),\n  local_auth_tenant_id UUID NULL,\n  is_active BOOLEAN DEFAULT TRUE\n);\n\n-- Danh s\u00e1ch tenant\nCREATE TABLE tenants (\n  tenant_id UUID PRIMARY KEY,\n  tenant_name TEXT,\n  status TEXT CHECK (status IN ('active', 'inactive'))\n);\n\n-- G\u00e1n user v\u00e0o tenant\nCREATE TABLE user_tenant_assignments (\n  user_id UUID REFERENCES users_global(user_id),\n  tenant_id UUID REFERENCES tenants(tenant_id),\n  assigned_by UUID,\n  assigned_at TIMESTAMP,\n  PRIMARY KEY (user_id, tenant_id)\n);\n\n-- Template vai tr\u00f2 v\u00e0 quy\u1ec1n to\u00e0n h\u1ec7 th\u1ed1ng\nCREATE TABLE global_roles_templates (...);\nCREATE TABLE global_permissions_templates (...);\n</code></pre>"},{"location":"tmp/tmp-rbac-deep-dive/#tai-sub-user-service-moi-tenant","title":"\ud83d\udce6 T\u1ea1i Sub User Service (m\u1ed7i tenant)","text":"<pre><code>-- Ng\u01b0\u1eddi d\u00f9ng n\u1ed9i b\u1ed9 tenant (tham chi\u1ebfu user to\u00e0n c\u1ee5c)\nCREATE TABLE users_in_tenant (\n  user_id UUID PRIMARY KEY,\n  user_id_global UUID REFERENCES users_global(user_id),\n  is_active_in_tenant BOOLEAN DEFAULT TRUE\n);\n\n-- Vai tr\u00f2 v\u00e0 quy\u1ec1n c\u1ee7a tenant\nCREATE TABLE roles_in_tenant (\n  role_id UUID PRIMARY KEY,\n  role_code TEXT UNIQUE,\n  role_name TEXT\n);\n\nCREATE TABLE permissions_in_tenant (\n  permission_id UUID PRIMARY KEY,\n  permission_code TEXT UNIQUE,\n  action TEXT,\n  resource TEXT,\n  condition JSONB -- ch\u1ee9a r\u00e0ng bu\u1ed9c nh\u01b0 { \"class_id\": \"$user.class_id\" }\n);\n\n-- Mapping vai tr\u00f2 \u2194 ng\u01b0\u1eddi d\u00f9ng\nCREATE TABLE user_role_in_tenant (\n  user_id UUID REFERENCES users_in_tenant(user_id),\n  role_id UUID REFERENCES roles_in_tenant(role_id),\n  PRIMARY KEY (user_id, role_id)\n);\n\n-- Mapping quy\u1ec1n \u2194 vai tr\u00f2\nCREATE TABLE role_permission_in_tenant (\n  role_id UUID REFERENCES roles_in_tenant(role_id),\n  permission_id UUID REFERENCES permissions_in_tenant(permission_id),\n  PRIMARY KEY (role_id, permission_id)\n);\n</code></pre> <p>\ud83d\udcd8 To\u00e0n b\u1ed9 m\u00f4 h\u00ecnh d\u1eef li\u1ec7u \u0111\u1ea7y \u0111\u1ee7 \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a trong:</p> <ul> <li><code>user-service/master/data-model.md</code></li> <li><code>user-service/tenant/data-model.md</code></li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#5-permission-co-ieu-kien-condition-jsonb","title":"5. Permission c\u00f3 \u0111i\u1ec1u ki\u1ec7n (Condition JSONB)","text":"<p>H\u1ec7 th\u1ed1ng dx-vas h\u1ed7 tr\u1ee3 permission c\u00f3 \u0111i\u1ec1u ki\u1ec7n \u2013 cho ph\u00e9p ki\u1ec3m so\u00e1t truy c\u1eadp \u0111\u1ed9ng d\u1ef1a tr\u00ean ng\u1eef c\u1ea3nh request v\u00e0 \u0111\u1eb7c t\u00ednh c\u1ee7a ng\u01b0\u1eddi d\u00f9ng. M\u1ed7i permission c\u00f3 th\u1ec3 khai b\u00e1o m\u1ed9t <code>condition</code> d\u01b0\u1edbi d\u1ea1ng JSONB.</p>"},{"location":"tmp/tmp-rbac-deep-dive/#vi-du-ve-permission-co-ieu-kien","title":"\ud83d\udccc V\u00ed d\u1ee5 v\u1ec1 permission c\u00f3 \u0111i\u1ec1u ki\u1ec7n:","text":"<pre><code>{\n  \"class_id\": \"$user.class_id\"\n}\n</code></pre> <p>\u00dd ngh\u0129a: Ch\u1ec9 cho ph\u00e9p truy c\u1eadp khi <code>class_id</code> trong request tr\u00f9ng kh\u1edbp v\u1edbi <code>class_id</code> c\u1ee7a user hi\u1ec7n t\u1ea1i (do Sub User Service cung c\u1ea5p trong JWT).</p>"},{"location":"tmp/tmp-rbac-deep-dive/#context-ho-tro-khi-evaluate","title":"\ud83d\udee0 Context h\u1ed7 tr\u1ee3 khi evaluate:","text":"<ul> <li>User context: <code>$user.{field}</code> \u2013 \u0111\u1ebfn t\u1eeb <code>users_in_tenant</code></li> <li>Request context: <code>$request.{field}</code> \u2013 t\u1eeb body/query/header</li> <li>Tenant context: <code>$tenant.{field}</code> \u2013 n\u1ebfu c\u00f3 metadata</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#anh-gia-ieu-kien","title":"\ud83e\udde0 \u0110\u00e1nh gi\u00e1 \u0111i\u1ec1u ki\u1ec7n:","text":"<ul> <li>\u0110\u01b0\u1ee3c th\u1ef1c hi\u1ec7n t\u1ea1i API Gateway</li> <li>Engine so s\u00e1nh gi\u00e1 tr\u1ecb th\u1ef1c t\u1ebf trong request v\u1edbi \u0111i\u1ec1u ki\u1ec7n JSONB</li> <li>N\u1ebfu m\u1ed9t permission c\u00f3 <code>condition = null</code> \u2192 lu\u00f4n \u0111\u00fang</li> </ul> <p>\ud83d\udcd8 C\u00e1c tenant c\u00f3 th\u1ec3 t\u1ef1 \u0111\u1ecbnh ngh\u0129a \u0111i\u1ec1u ki\u1ec7n ri\u00eang theo logic \u0111\u1eb7c th\u00f9.</p>"},{"location":"tmp/tmp-rbac-deep-dive/#6-chien-luoc-cache-rbac-tai-api-gateway","title":"6. Chi\u1ebfn l\u01b0\u1ee3c Cache RBAC t\u1ea1i API Gateway","text":"<p>\u0110\u1ec3 gi\u1ea3m t\u1ea3i truy v\u1ea5n RBAC th\u01b0\u1eddng xuy\u00ean, h\u1ec7 th\u1ed1ng s\u1eed d\u1ee5ng cache RBAC t\u1ea1i API Gateway v\u1edbi chi\u1ebfn l\u01b0\u1ee3c sau:</p>"},{"location":"tmp/tmp-rbac-deep-dive/#key-cache","title":"\ud83d\udd11 Key cache:","text":"<pre><code>rbac:{user_id}:{tenant_id}\n</code></pre>"},{"location":"tmp/tmp-rbac-deep-dive/#value-cache","title":"\ud83d\udce6 Value cache:","text":"<pre><code>{\n  \"roles\": [...],\n  \"permissions\": [...],\n  \"issued_at\": \"2025-07-01T12:00:00Z\"\n}\n</code></pre>"},{"location":"tmp/tmp-rbac-deep-dive/#ttl-lam-moi","title":"\u23f1 TTL &amp; L\u00e0m m\u1edbi:","text":"<ul> <li>TTL m\u1eb7c \u0111\u1ecbnh: 5\u201315 ph\u00fat t\u00f9y d\u1ecbch v\u1ee5</li> <li>C\u00f3 th\u1ec3 l\u00e0m m\u1edbi th\u1ee7 c\u00f4ng khi g\u00e1n quy\u1ec1n m\u1edbi</li> <li>Cache s\u1ebd t\u1ef1 \u0111\u1ed9ng l\u00e0m m\u1edbi n\u1ebfu JWT m\u1edbi ch\u1ee9a RBAC m\u1edbi</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#invalidation-qua-pubsub","title":"\ud83d\udd01 Invalidation qua Pub/Sub:","text":"<ul> <li> <p>Khi Sub User Service c\u1eadp nh\u1eadt RBAC:</p> </li> <li> <p>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>rbac_updated</code> \u2192 Gateway subscribe \u2192 xo\u00e1 cache</p> </li> <li> <p>Khi user b\u1ecb v\u00f4 hi\u1ec7u h\u00f3a:</p> </li> <li> <p>Ph\u00e1t s\u1ef1 ki\u1ec7n <code>user_status_changed</code> (t\u1eeb Master ho\u1eb7c Sub) \u2192 Gateway hu\u1ef7 JWT v\u00e0 cache</p> </li> </ul> <p>\ud83d\udcd8 \u0110\u1ecbnh ngh\u0129a event schema trong <code>rbac-events.md</code></p>"},{"location":"tmp/tmp-rbac-deep-dive/#7-chien-luoc-ong-bo-rbac","title":"7. Chi\u1ebfn l\u01b0\u1ee3c \u0110\u1ed3ng b\u1ed9 RBAC","text":"<p>H\u1ec7 th\u1ed1ng h\u1ed7 tr\u1ee3 kh\u1ea3 n\u0103ng k\u1ebf th\u1eeba template t\u1eeb Master, tu\u1ef3 ch\u1ec9nh, v\u00e0 giao di\u1ec7n qu\u1ea3n l\u00fd ph\u00e2n quy\u1ec1n ri\u00eang cho t\u1eebng tenant.</p>"},{"location":"tmp/tmp-rbac-deep-dive/#ke-thua-tuy-chinh","title":"\ud83d\udcda K\u1ebf th\u1eeba &amp; t\u00f9y ch\u1ec9nh:","text":"<ul> <li> <p>M\u1ed7i tenant c\u00f3 th\u1ec3:</p> </li> <li> <p>D\u00f9ng <code>global_roles_templates</code> &amp; <code>global_permissions_templates</code> t\u1eeb Master</p> </li> <li>Clone v\u1ec1 l\u00e0m b\u1ea3n ri\u00eang \u2192 \u0111\u1ed5i t\u00ean/logic/condition</li> <li>Ho\u1eb7c t\u1ef1 t\u1ea1o t\u1eeb \u0111\u1ea7u ho\u00e0n to\u00e0n</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#gan-role-cho-nguoi-dung","title":"\ud83e\udde9 G\u00e1n role cho ng\u01b0\u1eddi d\u00f9ng:","text":"<ul> <li> <p>Sub User Service cung c\u1ea5p API cho Admin Webapp tenant:</p> </li> <li> <p>G\u00e1n <code>role_id</code> cho <code>user_id</code></p> </li> <li>C\u1eadp nh\u1eadt <code>is_active_in_tenant</code></li> <li>T\u1ea1o vai tr\u00f2 t\u00f9y ch\u1ec9nh (n\u1ebfu \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n)</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#ong-bo-inh-ky-tuy-chon","title":"\ud83d\udd01 \u0110\u1ed3ng b\u1ed9 \u0111\u1ecbnh k\u1ef3 (t\u00f9y ch\u1ecdn):","text":"<ul> <li>N\u1ebfu tenant cho ph\u00e9p, c\u00f3 th\u1ec3 \u0111\u1ed3ng b\u1ed9 l\u1ea1i template m\u1ed7i tu\u1ea7n/th\u00e1ng t\u1eeb Master</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#8-hieu-nang-kha-nang-mo-rong","title":"8. Hi\u1ec7u n\u0103ng &amp; Kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng","text":"<p>H\u1ec7 th\u1ed1ng RBAC c\u1ee7a dx-vas \u0111\u01b0\u1ee3c thi\u1ebft k\u1ebf \u0111\u1ec3 h\u1ed7 tr\u1ee3 s\u1ed1 l\u01b0\u1ee3ng l\u1edbn tenant, m\u1ed7i tenant c\u00f3 th\u1ec3 c\u00f3 h\u00e0ng tr\u0103m vai tr\u00f2 v\u00e0 ng\u01b0\u1eddi d\u00f9ng.</p>"},{"location":"tmp/tmp-rbac-deep-dive/#ky-thuat-toi-uu","title":"\ud83d\udd27 K\u1ef9 thu\u1eadt t\u1ed1i \u01b0u:","text":"<ul> <li>Cache t\u1ea1i Gateway \u2192 tr\u00e1nh truy v\u1ea5n Sub Service m\u1ed7i request</li> <li>Fan-out pub/sub invalidate \u2192 t\u1ed1i thi\u1ec3u ho\u00e1 latency c\u1eadp nh\u1eadt RBAC</li> <li>Permission condition JSONB cho ph\u00e9p RBAC m\u1ec1m d\u1ebbo m\u00e0 kh\u00f4ng c\u1ea7n ph\u00e2n m\u1ea3nh b\u1ea3ng</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#cloud-scale","title":"\u2601\ufe0f Cloud Scale:","text":"<ul> <li>Redis RBAC cache \u0111\u01b0\u1ee3c chia namespace theo <code>tenant_id</code></li> <li>Sub User Service \u0111\u01b0\u1ee3c autoscale \u0111\u1ed9c l\u1eadp \u2192 ph\u00e2n t\u1ea3i d\u1ec5 d\u00e0ng</li> <li>RBAC API c\u00f3 th\u1ec3 batch (g\u00e1n nhi\u1ec1u role/user c\u00f9ng l\u00fac)</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#monitoring","title":"\ud83d\udd0d Monitoring:","text":"<ul> <li>M\u1ed7i l\u1ea7n cache hit/miss \u0111\u01b0\u1ee3c log k\u00e8m <code>tenant_id</code></li> <li>C\u00f3 c\u1ea3nh b\u00e1o n\u1ebfu role mapping b\u1ea5t th\u01b0\u1eddng (VD: user c\u00f3 100+ role)</li> </ul> <p>\ud83d\udcd8 \u0110\u1ec3 t\u1ed1i \u01b0u h\u01a1n n\u1eefa, c\u00f3 th\u1ec3 t\u00edch h\u1ee3p JWT RBAC claims k\u00fd c\u1ee9ng v\u1edbi TTL ng\u1eafn + checksum (\u0111ang \u0111\u01b0\u1ee3c nghi\u00ean c\u1ee9u)</p>"},{"location":"tmp/tmp-rbac-deep-dive/#9-bao-mat-chuyen-sau-trong-rbac","title":"9. B\u1ea3o m\u1eadt chuy\u00ean s\u00e2u trong RBAC","text":"<p>RBAC l\u00e0 l\u1edbp ki\u1ec3m so\u00e1t truy c\u1eadp tr\u1ecdng y\u1ebfu, n\u00ean c\u00e1c nguy\u00ean t\u1eafc b\u1ea3o m\u1eadt sau \u0111\u01b0\u1ee3c \u00e1p d\u1ee5ng nghi\u00eam ng\u1eb7t trong h\u1ec7 th\u1ed1ng dx-vas:</p>"},{"location":"tmp/tmp-rbac-deep-dive/#isolation-theo-tenant","title":"\ud83d\udd10 Isolation theo Tenant","text":"<ul> <li>M\u1ed7i Sub User Service ch\u1ec9 truy xu\u1ea5t d\u1eef li\u1ec7u ng\u01b0\u1eddi d\u00f9ng v\u00e0 role/permission c\u1ee7a ch\u00ednh tenant \u0111\u00f3</li> <li>Kh\u00f4ng c\u00f3 API cho ph\u00e9p thao t\u00e1c ch\u00e9o tenant</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#ten-inh-danh-va-khong-gian-rbac","title":"\ud83d\udd10 T\u00ean \u0111\u1ecbnh danh v\u00e0 kh\u00f4ng gian RBAC","text":"<ul> <li>C\u00e1c vai tr\u00f2 (<code>role_code</code>) v\u00e0 quy\u1ec1n (<code>permission_code</code>) ph\u1ea3i l\u00e0 duy nh\u1ea5t trong ph\u1ea1m vi tenant</li> <li>Kh\u00f4ng cho ph\u00e9p \u201cshadow\u201d vai tr\u00f2 t\u1eeb tenant kh\u00e1c</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#chong-gia-mao-jwt","title":"\ud83d\udd10 Ch\u1ed1ng gi\u1ea3 m\u1ea1o JWT","text":"<ul> <li>RBAC trong JWT ph\u1ea3i \u0111\u01b0\u1ee3c k\u00fd v\u00e0 x\u00e1c th\u1ef1c b\u1edfi Gateway</li> <li>Kh\u00f4ng tin t\u01b0\u1edfng RBAC trong request t\u1eeb client frontend</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#api-rbac-luon-bao-ve-boi-auth-role","title":"\ud83d\udd10 API RBAC lu\u00f4n b\u1ea3o v\u1ec7 b\u1edfi Auth + Role","text":"<ul> <li>M\u1ecdi thao t\u00e1c g\u00e1n quy\u1ec1n, g\u00e1n vai tr\u00f2, c\u1eadp nh\u1eadt ph\u1ea3i c\u00f3 quy\u1ec1n c\u1ee5 th\u1ec3 (<code>manage_rbac</code>, <code>assign_role</code>, v.v.)</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#10-giam-sat-go-loi","title":"10. Gi\u00e1m s\u00e1t &amp; G\u1ee1 l\u1ed7i","text":"<p>\u0110\u1ec3 h\u1ed7 tr\u1ee3 v\u1eadn h\u00e0nh v\u00e0 b\u1ea3o m\u1eadt, c\u00e1c h\u00e0nh \u0111\u1ed9ng li\u00ean quan \u0111\u1ebfn RBAC \u0111\u01b0\u1ee3c log v\u00e0 theo d\u00f5i chi ti\u1ebft:</p>"},{"location":"tmp/tmp-rbac-deep-dive/#audit-trail","title":"\ud83e\udeb5 Audit Trail","text":"<ul> <li>M\u1ed7i h\u00e0nh \u0111\u1ed9ng:</li> <li>G\u00e1n vai tr\u00f2</li> <li>T\u1ea1o permission</li> <li>C\u1eadp nh\u1eadt condition</li> <li>\u0110\u01b0\u1ee3c log k\u00e8m:</li> <li><code>user_id</code>, <code>actor_id</code>, <code>tenant_id</code>, <code>timestamp</code>, <code>payload_before</code>, <code>payload_after</code></li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#debug-flow-tai-gateway","title":"\ud83e\uddea Debug Flow t\u1ea1i Gateway","text":"<ul> <li>G\u1eafn <code>X-RBAC-Trace-ID</code> v\u00e0o m\u1ed7i request n\u1ebfu b\u1eadt debug</li> <li>Log c\u00e1c b\u01b0\u1edbc \u0111\u00e1nh gi\u00e1: permission match, condition eval, cache hit/miss</li> <li>C\u00f3 th\u1ec3 b\u1eadt ch\u1ebf \u0111\u1ed9 \u201cdry-run\u201d RBAC tr\u00ean staging \u0111\u1ec3 ki\u1ec3m tra rule m\u1edbi</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#metrics","title":"\ud83d\udcc8 Metrics","text":"<ul> <li>S\u1ed1 l\u01b0\u1ee3ng permission theo tenant</li> <li>T\u1ef7 l\u1ec7 cache hit/miss RBAC</li> <li>C\u1ea3nh b\u00e1o n\u1ebfu user c\u00f3 s\u1ed1 role v\u01b0\u1ee3t ng\u01b0\u1ee1ng</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#11-best-practices-cho-quan-tri-rbac","title":"11. Best Practices cho Qu\u1ea3n tr\u1ecb RBAC","text":"<p>M\u1ed9t s\u1ed1 khuy\u1ebfn ngh\u1ecb \u0111\u01b0\u1ee3c \u00e1p d\u1ee5ng v\u00e0 ki\u1ec3m so\u00e1t qua Superadmin Webapp ho\u1eb7c Admin Webapp t\u1ea1i tenant:</p> <ul> <li>\u2705 \u0110\u1eb7t t\u00ean <code>role_code</code>, <code>permission_code</code> r\u00f5 r\u00e0ng, snake_case</li> <li>\u2705 T\u00e1ch vai tr\u00f2 theo domain ch\u1ee9c n\u0103ng: <code>academic_staff</code>, <code>finance_admin</code>, <code>class_teacher</code></li> <li>\u2705 Gi\u1edbi h\u1ea1n s\u1ed1 vai tr\u00f2/user \u2264 10 \u0111\u1ec3 d\u1ec5 ki\u1ec3m so\u00e1t</li> <li>\u2705 \u01afu ti\u00ean d\u00f9ng permission c\u00f3 <code>condition</code> h\u01a1n l\u00e0 t\u1ea1o th\u00eam role m\u1edbi</li> <li>\u2705 D\u00f9ng template n\u1ebfu tenant kh\u00f4ng c\u00f3 nhu c\u1ea7u tu\u1ef3 ch\u1ec9nh</li> <li>\u274c Kh\u00f4ng cho ph\u00e9p s\u1eeda <code>role_code</code> sau khi g\u00e1n cho user</li> <li>\u274c Kh\u00f4ng c\u1ea5p quy\u1ec1n <code>manage_rbac</code> \u0111\u1ea1i tr\u00e0 \u2013 n\u00ean g\u00e1n cho 1\u20132 ng\u01b0\u1eddi c\u00f3 tr\u00e1ch nhi\u1ec7m</li> </ul>"},{"location":"tmp/tmp-rbac-deep-dive/#12-cong-cu-tai-lieu-lien-quan","title":"12. C\u00f4ng c\u1ee5 &amp; T\u00e0i li\u1ec7u li\u00ean quan","text":"<p>\ud83d\udcd8 T\u00e0i li\u1ec7u k\u1ef9 thu\u1eadt chi ti\u1ebft li\u00ean quan \u0111\u1ebfn RBAC:</p> M\u1ee5c File Ki\u1ebfn tr\u00fac t\u1ed5ng quan RBAC <code>README.md</code> M\u00f4 h\u00ecnh d\u1eef li\u1ec7u User Master <code>user-service/master/data-model.md</code> M\u00f4 h\u00ecnh d\u1eef li\u1ec7u Sub User Service <code>user-service/tenant/data-model.md</code> Giao di\u1ec7n qu\u1ea3n tr\u1ecb RBAC <code>ic-02-admin-webapp.md</code> Ki\u1ec3m so\u00e1t x\u00e1c th\u1ef1c &amp; JWT <code>adr-006-auth-strategy.md</code> Quy t\u1eafc \u0111i\u1ec1u ki\u1ec7n &amp; JSONB <code>rbac-condition-schema.md</code> S\u1ef1 ki\u1ec7n RBAC &amp; Cache Invalidation <code>rbac-events.md</code> Danh s\u00e1ch role m\u1eabu to\u00e0n h\u1ec7 th\u1ed1ng <code>global-roles-template.yaml</code>"},{"location":"tmp/tmp-rbac-deep-dive/#so-o-rbac-phan-tang-user-master-va-sub-user-services","title":"\ud83d\udd0d S\u01a1 \u0111\u1ed3 RBAC Ph\u00e2n t\u1ea7ng \u2013 User Master v\u00e0 Sub User Services","text":"<pre><code>flowchart TD\n\n  subgraph Master[\"User Service Master\"]\n    UGM[users_global]\n    TENTS[tenants]\n    UTA[user_tenant_assignments]\n    GRT[global_roles_templates]\n    GPT[global_permissions_templates]\n  end\n\n  subgraph Tenant_A[\"Sub User Service \u2013 Tenant A\"]\n    UTA1[users_in_tenant]\n    RA1[roles_in_tenant]\n    PA1[permissions_in_tenant]\n    URA1[user_role_in_tenant]\n    RPA1[role_permission_in_tenant]\n  end\n\n  subgraph Tenant_B[\"Sub User Service \u2013 Tenant B\"]\n    UTA2[users_in_tenant]\n    RA2[roles_in_tenant]\n    PA2[permissions_in_tenant]\n    URA2[user_role_in_tenant]\n    RPA2[role_permission_in_tenant]\n  end\n\n  %% Mapping\n  UGM --&gt; UTA\n  TENTS --&gt; UTA\n  UGM --&gt; UTA1\n  UGM --&gt; UTA2\n\n  GRT --&gt; RA1\n  GRT --&gt; RA2\n  GPT --&gt; PA1\n  GPT --&gt; PA2\n\n  UTA1 --&gt; URA1\n  RA1 --&gt; URA1\n  RA1 --&gt; RPA1\n  PA1 --&gt; RPA1\n\n  UTA2 --&gt; URA2\n  RA2 --&gt; URA2\n  RA2 --&gt; RPA2\n  PA2 --&gt; RPA2\n</code></pre> <p>\ud83d\udccc Gi\u1ea3i th\u00edch:</p> <ul> <li><code>users_global</code> l\u00e0 ngu\u1ed3n \u0111\u1ecbnh danh chung, d\u00f9ng cho t\u1ea5t c\u1ea3 c\u00e1c tenant.</li> <li> <p>M\u1ed7i tenant c\u00f3 Sub User Service qu\u1ea3n l\u00fd ri\u00eang:</p> </li> <li> <p><code>users_in_tenant</code> \u00e1nh x\u1ea1 t\u1edbi <code>user_id_global</code></p> </li> <li>Vai tr\u00f2 &amp; quy\u1ec1n c\u1ee5c b\u1ed9, c\u00f3 th\u1ec3 k\u1ebf th\u1eeba t\u1eeb Master ho\u1eb7c t\u1ef1 \u0111\u1ecbnh ngh\u0129a</li> <li>Mapping RBAC (<code>user \u2194 role \u2194 permission</code>) l\u00e0 \u0111\u1ed9c l\u1eadp gi\u1eefa c\u00e1c tenant.</li> </ul> <p>\ud83d\udcd8 S\u01a1 \u0111\u1ed3 n\u00e0y gi\u00fap Superadmin, DevOps v\u00e0 Dev hi\u1ec3u r\u00f5 lu\u1ed3ng ph\u00e2n quy\u1ec1n, v\u1ecb tr\u00ed source of truth, v\u00e0 c\u00e1ch t\u00e1ch bi\u1ec7t b\u1ea3o m\u1eadt gi\u1eefa c\u00e1c tenant.</p>"},{"location":"tmp/tmp-rbac-deep-dive/#so-o-luong-kiem-tra-rbac-tai-api-gateway","title":"\ud83d\udd10 S\u01a1 \u0111\u1ed3 Lu\u1ed3ng Ki\u1ec3m tra RBAC t\u1ea1i API Gateway","text":"<pre><code>sequenceDiagram\n    autonumber\n    participant Client as \ud83c\udf10 Client (Frontend)\n    participant Gateway as \ud83d\udee1\ufe0f API Gateway\n    participant Auth as \ud83d\udd10 Auth Service (Master/Sub)\n    participant JWT as \ud83d\udce6 JWT Token\n    participant Redis as \u26a1 RBAC Cache\n    participant SubUser as \ud83e\udde9 Sub User Service (per tenant)\n\n    Client-&gt;&gt;Auth: \u0110\u0103ng nh\u1eadp (OAuth2 / OTP)\n    Auth-&gt;&gt;JWT: Ph\u00e1t h\u00e0nh JWT ch\u1ee9a\\nuser_id, tenant_id, roles, permissions\n    Client-&gt;&gt;Gateway: G\u1eedi request k\u00e8m JWT\n\n    Gateway-&gt;&gt;JWT: Gi\u1ea3i m\u00e3 JWT\n    Gateway-&gt;&gt;JWT: L\u1ea5y user_id, tenant_id, permissions\n    alt Cache Hit\n        Gateway-&gt;&gt;Redis: L\u1ea5y RBAC t\u1eeb cache\\nrbac:{user_id}:{tenant_id}\n    else Cache Miss\n        Gateway-&gt;&gt;SubUser: G\u1ecdi API \u0111\u1ec3 l\u1ea5y roles &amp; permissions\n        SubUser--&gt;&gt;Gateway: Tr\u1ea3 v\u1ec1 roles, permissions\n        Gateway-&gt;&gt;Redis: Ghi cache RBAC\n    end\n\n    alt C\u00f3 permission kh\u1edbp + \u0111i\u1ec1u ki\u1ec7n \u0111\u00fang\n        Gateway--&gt;&gt;Client: \u2705 200 OK (forward t\u1edbi backend)\n    else Kh\u00f4ng c\u00f3 quy\u1ec1n / Sai \u0111i\u1ec1u ki\u1ec7n\n        Gateway--&gt;&gt;Client: \u274c 403 Forbidden\n    end\n</code></pre> <p>\ud83d\udccc Gi\u1ea3i th\u00edch nhanh:</p> <ul> <li>Gateway l\u00e0 n\u01a1i trung t\u00e2m \u0111\u00e1nh gi\u00e1 quy\u1ec1n d\u1ef1a tr\u00ean JWT v\u00e0 RBAC.</li> <li>D\u00f9ng cache Redis \u0111\u1ec3 tr\u00e1nh g\u1ecdi Sub User Service qu\u00e1 th\u01b0\u1eddng xuy\u00ean.</li> <li>H\u1ed7 tr\u1ee3 <code>condition JSONB</code> \u0111\u01b0\u1ee3c \u0111\u00e1nh gi\u00e1 t\u1ea1i Gateway b\u1eb1ng context t\u1eeb JWT v\u00e0 request.</li> </ul> <p>\ud83d\udcd8 RBAC cache invalidation \u0111\u01b0\u1ee3c \u0111i\u1ec1u ph\u1ed1i b\u1edfi Pub/Sub events t\u1eeb Sub User Service nh\u01b0 <code>rbac_updated</code> ho\u1eb7c <code>user_status_changed</code>.</p>"},{"location":"tmp/tmp-rbac-deep-dive/#so-o-luong-phat-hanh-jwt-a-tenant","title":"\ud83d\udd11 S\u01a1 \u0111\u1ed3 Lu\u1ed3ng Ph\u00e1t h\u00e0nh JWT \u0110a-Tenant","text":"<pre><code>sequenceDiagram\n    autonumber\n    participant User as \ud83d\udc64 Ng\u01b0\u1eddi d\u00f9ng\n    participant Frontend as \ud83c\udf10 Frontend App\n    participant AuthM as \ud83d\udd10 Auth Service Master\n    participant AuthT as \ud83d\udd10 Sub Auth Service (per tenant)\n    participant UserMaster as \ud83e\udde0 User Service Master\n    participant UserSub as \ud83e\udde9 Sub User Service (per tenant)\n    participant JWT as \ud83d\udce6 JWT Token\n\n    rect rgba(220,220,220,0.1)\n    Note over User, AuthM: \u0110\u0103ng nh\u1eadp Google OAuth2\n    User-&gt;&gt;Frontend: M\u1edf \u1ee9ng d\u1ee5ng\n    Frontend-&gt;&gt;AuthM: Login via Google\n    AuthM-&gt;&gt;Google: OAuth2 Authorization\n    Google--&gt;&gt;AuthM: Access Token\n    AuthM-&gt;&gt;UserMaster: X\u00e1c minh user + l\u1ea5y user_id_global\n    UserMaster--&gt;&gt;AuthM: user_id_global + danh s\u00e1ch tenant\n\n    alt User thu\u1ed9c nhi\u1ec1u tenant\n        AuthM-&gt;&gt;Frontend: Y\u00eau c\u1ea7u ch\u1ecdn tenant\n        Frontend-&gt;&gt;AuthM: tenant_id \u0111\u00e3 ch\u1ecdn\n    else Ch\u1ec9 m\u1ed9t tenant\n        AuthM: B\u1ecf qua b\u01b0\u1edbc ch\u1ecdn\n    end\n\n    AuthM-&gt;&gt;UserSub: L\u1ea5y roles &amp; permissions trong tenant \u0111\u00e3 ch\u1ecdn\n    UserSub--&gt;&gt;AuthM: Tr\u1ea3 danh s\u00e1ch role/permission\n    AuthM-&gt;&gt;JWT: K\u00fd &amp; ph\u00e1t JWT ch\u1ee9a:\\nuser_id, tenant_id, roles, permissions\n    AuthM--&gt;&gt;Frontend: Tr\u1ea3 JWT\n    end\n\n    rect rgba(220,220,220,0.1)\n    Note over User, AuthT: \u0110\u0103ng nh\u1eadp Local/OTP\n    User-&gt;&gt;Frontend: M\u1edf \u1ee9ng d\u1ee5ng (tr\u01b0\u1eddng kh\u00f4ng d\u00f9ng Google)\n    Frontend-&gt;&gt;AuthT: Login OTP\n    AuthT-&gt;&gt;UserMaster: Ki\u1ec3m tra user / \u0111\u0103ng k\u00fd m\u1edbi\n    UserMaster--&gt;&gt;AuthT: user_id_global\n    AuthT-&gt;&gt;UserSub: L\u1ea5y roles &amp; permissions trong tenant\n    UserSub--&gt;&gt;AuthT: Tr\u1ea3 roles, permissions\n    AuthT-&gt;&gt;JWT: Ph\u00e1t JWT \u0111\u1ea7y \u0111\u1ee7\n    AuthT--&gt;&gt;Frontend: Tr\u1ea3 JWT\n    end\n</code></pre> <p>\ud83d\udccc \u0110i\u1ec3m ch\u00ednh:</p> <ul> <li>Auth Master x\u1eed l\u00fd Google OAuth2 + l\u1ef1a ch\u1ecdn tenant.</li> <li>Sub Auth x\u1eed l\u00fd x\u00e1c th\u1ef1c Local/OTP t\u1ea1i tenant.</li> <li>M\u1ecdi JWT ph\u00e1t ra \u0111\u1ec1u ch\u1ee9a <code>user_id_global</code>, <code>tenant_id</code>, <code>roles</code>, <code>permissions</code>.</li> </ul> <p>\ud83d\udcd8 Tham kh\u1ea3o chi ti\u1ebft c\u1ea5u tr\u00fac JWT trong <code>adr-006-auth-strategy.md</code></p>"},{"location":"tmp/tong-quan/","title":"D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 Tr\u01b0\u1eddng Vi\u1ec7t Anh (dx-vas)","text":"<p>Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi d\u1ef1 \u00e1n dx-vas! \u0110\u00e2y l\u00e0 h\u1ec7 th\u1ed1ng chuy\u1ec3n \u0111\u1ed5i s\u1ed1 to\u00e0n di\u1ec7n \u0111\u01b0\u1ee3c ph\u00e1t tri\u1ec3n cho Tr\u01b0\u1eddng Qu\u1ed1c t\u1ebf Vi\u1ec7t Anh (VAS), nh\u1eb1m hi\u1ec7n \u0111\u1ea1i h\u00f3a v\u00e0 t\u1ed1i \u01b0u h\u00f3a c\u00e1c quy tr\u00ecnh v\u1eadn h\u00e0nh, qu\u1ea3n l\u00fd v\u00e0 t\u01b0\u01a1ng t\u00e1c trong nh\u00e0 tr\u01b0\u1eddng.</p>"},{"location":"tmp/tong-quan/#muc-tieu-du-an","title":"\ud83c\udfaf M\u1ee5c ti\u00eau d\u1ef1 \u00e1n","text":"<p>D\u1ef1 \u00e1n dx-vas h\u01b0\u1edbng t\u1edbi vi\u1ec7c x\u00e2y d\u1ef1ng m\u1ed9t n\u1ec1n t\u1ea3ng t\u00edch h\u1ee3p, bao g\u1ed3m c\u00e1c ch\u1ee9c n\u0103ng ch\u00ednh nh\u01b0:</p> <ul> <li>Qu\u1ea3n l\u00fd th\u00f4ng tin h\u1ecdc sinh, gi\u00e1o vi\u00ean, v\u00e0 ph\u1ee5 huynh.</li> <li>Qu\u1ea3n l\u00fd l\u1edbp h\u1ecdc, l\u1ecbch h\u1ecdc, \u0111i\u1ec3m danh.</li> <li>Qu\u1ea3n l\u00fd h\u1ecdc ph\u00ed v\u00e0 c\u00e1c kho\u1ea3n thu.</li> <li>H\u1ec7 th\u1ed1ng th\u00f4ng b\u00e1o \u0111a k\u00eanh.</li> <li>C\u1ed5ng th\u00f4ng tin cho ph\u1ee5 huynh v\u00e0 h\u1ecdc sinh (Customer Portal - PWA).</li> <li>\u1ee8ng d\u1ee5ng qu\u1ea3n tr\u1ecb cho nh\u00e2n vi\u00ean v\u00e0 gi\u00e1o vi\u00ean (Admin Webapp - SPA).</li> <li>T\u00edch h\u1ee3p v\u1edbi c\u00e1c h\u1ec7 th\u1ed1ng hi\u1ec7n c\u00f3 nh\u01b0 CRM (SuiteCRM), SIS (Gibbon), v\u00e0 LMS (Moodle).</li> <li>Quy tr\u00ecnh tuy\u1ec3n sinh tr\u1ef1c tuy\u1ebfn.</li> </ul>"},{"location":"tmp/tong-quan/#cong-nghe-su-dung-tong-quan","title":"\ud83d\ude80 C\u00f4ng ngh\u1ec7 s\u1eed d\u1ee5ng (T\u1ed5ng quan)","text":"<ul> <li>Backend: Microservices ph\u00e1t tri\u1ec3n b\u1eb1ng Python (FastAPI), tri\u1ec3n khai tr\u00ean Google Cloud Run.</li> <li>Frontend:<ul> <li>Customer Portal: Progressive Web App (PWA) - (React/Vue/Angular - t\u00f9y ch\u1ecdn c\u1ee7a b\u1ea1n)</li> <li>Admin Webapp: Single Page Application (SPA) - (React/Vue/Angular - t\u00f9y ch\u1ecdn c\u1ee7a b\u1ea1n)</li> </ul> </li> <li>C\u01a1 s\u1edf d\u1eef li\u1ec7u:<ul> <li>PostgreSQL (cho Core Services) - tri\u1ec3n khai tr\u00ean Google Cloud SQL.</li> <li>MySQL (cho c\u00e1c Adapters t\u00edch h\u1ee3p h\u1ec7 th\u1ed1ng legacy) - tri\u1ec3n khai tr\u00ean Google Cloud SQL.</li> </ul> </li> <li>Caching: Redis (Google Cloud Memorystore for Redis).</li> <li>Nh\u1eafn tin &amp; S\u1ef1 ki\u1ec7n: Google Cloud Pub/Sub.</li> <li>L\u01b0u tr\u1eef file: Google Cloud Storage (GCS).</li> <li>API Gateway: Qu\u1ea3n l\u00fd request, x\u00e1c th\u1ef1c, ph\u00e2n quy\u1ec1n (RBAC).</li> <li>X\u00e1c th\u1ef1c: Google OAuth2, OTP.</li> <li>CI/CD: GitHub Actions / Google Cloud Build.</li> <li>H\u1ea1 t\u1ea7ng d\u01b0\u1edbi d\u1ea1ng m\u00e3 (IaC): Terraform.</li> </ul>"},{"location":"tmp/tong-quan/#tai-lieu-chi-tiet","title":"\ud83d\udcda T\u00e0i li\u1ec7u chi ti\u1ebft","text":"<p>To\u00e0n b\u1ed9 t\u00e0i li\u1ec7u thi\u1ebft k\u1ebf ki\u1ebfn tr\u00fac, s\u01a1 \u0111\u1ed3 h\u1ec7 th\u1ed1ng, h\u01b0\u1edbng d\u1eabn ph\u00e1t tri\u1ec3n (Dev Guide), v\u00e0 c\u00e1c quy\u1ebft \u0111\u1ecbnh ki\u1ebfn tr\u00fac (ADRs) \u0111\u1ec1u \u0111\u01b0\u1ee3c t\u1eadp trung t\u1ea1i th\u01b0 m\u1ee5c <code>docs</code>.</p> <p>\ud83d\udc49 \u0110\u1ec3 b\u1eaft \u0111\u1ea7u, vui l\u00f2ng truy c\u1eadp v\u00e0o trang ch\u00ednh c\u1ee7a t\u00e0i li\u1ec7u t\u1ea1i \u0111\u00e2y: README</p> <p>Trang ch\u1ec9 m\u1ee5c n\u00e0y s\u1ebd cung c\u1ea5p c\u00e1c li\u00ean k\u1ebft \u0111\u1ebfn:</p> <ul> <li>T\u00e0i li\u1ec7u Ki\u1ebfn tr\u00fac T\u1ed5ng quan.</li> <li>Chi ti\u1ebft Ki\u1ebfn tr\u00fac \u0110\u0103ng nh\u1eadp &amp; Ph\u00e2n quy\u1ec1n \u0110\u1ed9ng (RBAC).</li> <li>T\u1ed5ng h\u1ee3p S\u01a1 \u0111\u1ed3 Ki\u1ebfn tr\u00fac H\u1ec7 th\u1ed1ng (bao g\u1ed3m s\u01a1 \u0111\u1ed3 t\u1ed5ng quan, c\u00e1c lu\u1ed3ng chi ti\u1ebft, s\u01a1 \u0111\u1ed3 tri\u1ec3n khai).</li> <li>Danh s\u00e1ch c\u00e1c Quy\u1ebft \u0111\u1ecbnh Ki\u1ebfn tr\u00fac.</li> <li>H\u01b0\u1edbng d\u1eabn d\u00e0nh cho Nh\u00e0 ph\u00e1t tri\u1ec3n.</li> </ul>"},{"location":"tmp/tong-quan/#ong-gop","title":"\ud83e\udd1d \u0110\u00f3ng g\u00f3p","text":"<p>Ch\u00fang t\u00f4i lu\u00f4n ch\u00e0o \u0111\u00f3n s\u1ef1 \u0111\u00f3ng g\u00f3p! Vui l\u00f2ng xem qua h\u01b0\u1edbng d\u1eabn \u0111\u00f3ng g\u00f3p (CONTRIBUTING) \u0111\u1ec3 bi\u1ebft th\u00eam chi ti\u1ebft v\u1ec1 quy tr\u00ecnh l\u00e0m vi\u1ec7c, coding convention v\u00e0 c\u00e1ch t\u1ea1o Pull Request.</p>"},{"location":"tmp/tong-quan/#giay-phep","title":"\ud83d\udcdd Gi\u1ea5y ph\u00e9p","text":"<p>\u00a9 Tr\u01b0\u1eddng Vi\u1ec7t Anh \u2013 DX VAS Project 2025. M\u1ecdi quy\u1ec1n \u0111\u01b0\u1ee3c b\u1ea3o l\u01b0u. M\u00e3 ngu\u1ed3n d\u00e0nh ri\u00eang cho m\u1ee5c \u0111\u00edch n\u1ed9i b\u1ed9 v\u00e0 \u0111\u00e0o t\u1ea1o.</p> <p>Made with \u2764\ufe0f by the Legendary Dev Team @ VAS</p>"}]}